[{"id":"b195bb21.61fb38","type":"tab","label":"Moteur | Sandra","disabled":false,"info":""},{"id":"a52b5017.4b5dd","type":"tab","label":"CyberScopeTest","disabled":true,"info":"Test Pierre-Louis MDA2"},{"id":"ab1796ad.d3dd28","type":"tab","label":"CyberScopeConfig","disabled":true,"info":"Template de paramètrage des communications des appareils;\nLes sources de lumières sont répétés deux fois car il est possible\nd'avoir deux mêmes type d'équipements connectés en même temps.\nEx: deux COOL-LED-pE-4000, un en fluorescence, l'autre sur la mosaïc"},{"id":"d495b1f5.94e8a","type":"tab","label":"µFluidic","disabled":true,"info":"Fabien DUVEAU\nNoeud embarqué avec AirTable"},{"id":"e1a56311.cf0a1","type":"tab","label":"MissMarpleDebugg","disabled":true,"info":""},{"id":"64fc7af.b478584","type":"tab","label":"Break function","disabled":false,"info":""},{"id":"cb80149c.966208","type":"tab","label":"SimuMDA1","disabled":false,"info":""},{"id":"34847536.cbb3ea","type":"tab","label":"Version1.1","disabled":true,"info":""},{"id":"2f633666.5f0b8a","type":"tab","label":"Version1.2","disabled":true,"info":""},{"id":"5805ee3f.7d54f","type":"tab","label":"Version1.0","disabled":true,"info":""},{"id":"2a3df03.3a7851","type":"tab","label":"NodeTest","disabled":true,"info":""},{"id":"116d4e1.f9ed6b2","type":"tab","label":"WSite+WaitTasks","disabled":true,"info":""},{"id":"8bcc9762.886108","type":"tab","label":"MachineL","disabled":true,"info":""},{"id":"cd751f4f.c3b7b","type":"tab","label":"ChartJS","disabled":true,"info":""},{"id":"dbe04189.6c773","type":"tab","label":"NavigatorImage","disabled":false,"info":""},{"id":"1ba9e059.87ebc","type":"tab","label":"OSC","disabled":true,"info":""},{"id":"576581be.5c0f1","type":"serial-port","z":"","serialport":"COM22","serialbaud":"19200","databits":"8","parity":"even","stopbits":"1","newline":"\\n","bin":"bin","out":"char","addchar":true},{"id":"8bdec412.d66738","type":"serial-port","z":"","serialport":"COM23","serialbaud":"57600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":true},{"id":"5ab7c3bd.eb735c","type":"serial-port","z":"","serialport":"COM28","serialbaud":"56000","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":false},{"id":"164d3199.4508ee","type":"serial-port","z":"","serialport":"COM28","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":false},{"id":"81e9a193.91adf","type":"serial-port","z":"","serialport":"COM3","serialbaud":"38400","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":true},{"id":"c16bde4f.bbb0f","type":"ui_group","z":"","name":"PE-4000","tab":"94dd2d76.afa11","disp":true,"width":"20"},{"id":"94dd2d76.afa11","type":"ui_tab","z":"","name":"Données","icon":"dashboard"},{"id":"bf3e3ec9.46395","type":"websocket-listener","z":"","path":"/receiveEVOLV512","wholemsg":"false"},{"id":"13d119a.59502e6","type":"websocket-listener","z":"","path":"/publishEVOLV512","wholemsg":"false"},{"id":"7890883e.915758","type":"ui_group","z":"","name":"Sequencer","tab":"23992012.cc785","disp":false,"width":"18"},{"id":"4e5eae81.9ddfb","type":"serial-port","z":"","serialport":"COM6","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":true},{"id":"23992012.cc785","type":"ui_tab","z":"","name":"µFluidic - Fabien Duveau","icon":"dashboard"},{"id":"376dfed1.28fb92","type":"serial-port","z":"","serialport":"COM16","serialbaud":"57600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":true},{"id":"e396fe84.939d1","type":"ui_tab","z":"","name":"Camera LIve","icon":"dashboard","order":3},{"id":"ff87ca75.0cb6b8","type":"ui_link","z":"","name":"µScope Miss Marple","link":"http://192.168.1.7:1880/simple","icon":"open_in_browser","target":"iframe","order":1},{"id":"903bc815.6247d8","type":"websocket-listener","z":"2a3df03.3a7851","path":"/ws/simple","wholemsg":"false"},{"id":"42d2442d.3a7e6c","type":"ui_group","z":"","name":"Performance","tab":"e9c1179a.70e298","disp":true,"width":"24"},{"id":"e9c1179a.70e298","type":"ui_tab","z":"","name":"Performance","icon":"show_chart","order":5},{"id":"8d37dba3.62cd58","type":"ui_base","name":"Miss Marple","theme":"theme-light"},{"id":"c92005fd.498128","type":"ui_group","z":"","name":"Consumo","tab":"","order":1,"disp":true,"width":"6"},{"id":"9b0215d3.2eaaf8","type":"ui_group","z":"","name":"Consumo","tab":"","order":1,"disp":true,"width":"6"},{"id":"ef228511.5a1988","type":"ui_group","z":"","name":"Demo","tab":"b3a1b38f.4c012","disp":true,"width":"12"},{"id":"b3a1b38f.4c012","type":"ui_tab","z":"","name":"Demo","icon":"home","order":"1"},{"id":"da7e8f9b.c87dc","type":"websocket-listener","z":"cb80149c.966208","path":"/ws/cyberscope","wholemsg":"false"},{"id":"79f90969.395868","type":"websocket-listener","z":"","path":"/ws/simple","wholemsg":"false"},{"id":"8ba196b1.7c4438","type":"ui_group","z":"","name":"dbg","tab":"d10781a3.32e1c","order":1,"disp":true,"width":"6"},{"id":"d10781a3.32e1c","type":"ui_tab","z":"","name":"DBG","icon":"fa-quora","order":5},{"id":"c51b6505.3d7af8","type":"websocket-listener","z":"5805ee3f.7d54f","path":"/ws/missmarple","wholemsg":"false"},{"id":"e8e77e72.f768b","type":"websocket-listener","z":"","path":"/receive","wholemsg":"false"},{"id":"b1d0bce3.0ecdd","type":"websocket-listener","z":"","path":"/ws/missmarple","wholemsg":"false"},{"id":"61a4f449.1f741c","type":"websocket-listener","z":"","path":"/publishEVOLV512","wholemsg":"false"},{"id":"35215fcb.75dd2","type":"websocket-listener","z":"","path":"/receiveEVOLV512","wholemsg":"false"},{"id":"331a47c7.c6e0c8","type":"mqtt-broker","z":"","name":"","broker":"iot.eclipse.org","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"622d74a6.df3dbc","type":"ui_tab","z":"","name":"Moteur | Sandra","icon":"dashboard"},{"id":"d790a61c.487ea8","type":"ui_group","z":"","name":"Paramètres","tab":"622d74a6.df3dbc","order":1,"disp":true,"width":"6"},{"id":"b99bc98f.8d5338","type":"ui_group","z":"","name":"Mesures","tab":"622d74a6.df3dbc","order":3,"disp":true,"width":"6"},{"id":"8ba9b4f1.0a9cb8","type":"ui_group","z":"","name":"Contrôle","tab":"622d74a6.df3dbc","order":4,"disp":true,"width":"6"},{"id":"33fcd40d.811aac","type":"ui_group","z":"","name":"Grapique","tab":"622d74a6.df3dbc","order":2,"disp":true,"width":"20"},{"id":"52d4306f.12102","type":"ui_group","z":"","name":"Info","tab":"622d74a6.df3dbc","disp":false,"width":"33"},{"id":"7fce37bb.d6ed98","type":"ui_group","z":"","name":"Relative","tab":"3819163.72400ea","order":2,"disp":true,"width":"12"},{"id":"3819163.72400ea","type":"ui_tab","z":"","name":"Random","icon":"dashboard"},{"id":"ba00a4f5.035c08","type":"ui_group","z":"","name":"Chart with integer X axis","tab":"e7d9bcf1.42aa5","order":1,"disp":true,"width":"12"},{"id":"e7d9bcf1.42aa5","type":"ui_tab","z":"","name":"Chart.js example","icon":"dashboard","order":2},{"id":"bc14f821.ddffa8","type":"websocket-listener","z":"a52b5017.4b5dd","path":"/ws/simple","wholemsg":"false"},{"id":"d277807b.b2231","type":"serial-port","z":"","serialport":"COM5","serialbaud":"57600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":false},{"id":"3a81dd6a.d56bd2","type":"serial-port","z":"","serialport":"COM15","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"","bin":"false","out":"char","addchar":true},{"id":"631e9d92.6b2024","type":"serial-port-coolLed-pE4000","z":"","serialport":"COM5","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":true},{"id":"870a98b6.ef94e8","type":"serial-port-CooLLed","z":"","serialport":"COM7","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":true},{"id":"7ce68456.504c4c","type":"websocket-listener","z":"","path":"/test","wholemsg":"false"},{"id":"d3affff0.c4cfe","type":"websocket-listener","z":"dbe04189.6c773","path":"/ws/simple","wholemsg":"false"},{"id":"feb68a0.3299678","type":"ui_tab","z":"","name":"Hardware Configuration Miss Marple","icon":"dashboard"},{"id":"be0f5ba9.41a6f8","type":"ui_group","z":"","name":"Light-source","tab":"feb68a0.3299678","order":2,"disp":true,"width":"10"},{"id":"fe8ba4c0.c72178","type":"ui_group","z":"","name":"Light-source","tab":"feb68a0.3299678","order":3,"disp":true,"width":"10"},{"id":"b7c475a5.bfc228","type":"ui_group","z":"","name":"Light-source","tab":"feb68a0.3299678","order":4,"disp":true,"width":"10"},{"id":"da0c2a0.2ec2cd8","type":"ui_group","z":"","name":"Light-source","tab":"feb68a0.3299678","order":5,"disp":true,"width":"10"},{"id":"2f769871.a2e208","type":"ui_group","z":"","name":"Light-source","tab":"feb68a0.3299678","order":6,"disp":true,"width":"10"},{"id":"b2ce23e1.5916b","type":"ui_group","z":"","name":"Light-source","tab":"feb68a0.3299678","order":7,"disp":true,"width":"10"},{"id":"335417ac.ce8778","type":"ui_group","z":"","name":"Informations","tab":"feb68a0.3299678","order":1,"disp":true,"width":"10"},{"id":"92ee0ba2.6b7608","type":"ui_group","z":"","name":"Light-source","tab":"feb68a0.3299678","disp":true,"width":"10"},{"id":"5206c349.b65f1c","type":"ui_group","z":"","name":"Light-source","tab":"feb68a0.3299678","disp":true,"width":"10"},{"id":"3d863089.d6894","type":"ui_group","z":"","name":"Motion-stage","tab":"feb68a0.3299678","disp":true,"width":"10"},{"id":"241da606.2bfa2a","type":"ui_group","z":"","name":"Microscope","tab":"feb68a0.3299678","disp":true,"width":"10"},{"id":"c30805d2.544a38","type":"ui_group","z":"","name":"main","tab":"e1fe903e.2d3a","disp":true,"width":"8"},{"id":"e1fe903e.2d3a","type":"ui_tab","z":"","name":"Home","icon":"dashboard","order":"1"},{"id":"7c673538.864f8c","type":"ui_group","z":"","name":"Registros","tab":"5a203cb0.200014","disp":true,"width":"6"},{"id":"5a203cb0.200014","type":"ui_tab","z":"","name":"Home","icon":"dashboard"},{"id":"d59e064e.4c0198","type":"ftp-download-server","z":"","host":"","port":"21","user":"","connTimeout":"10000","pasvTimeout":"10000","keepalive":"10000","name":""},{"id":"5ddbe829.05e198","type":"websocket-listener","z":"","path":"/ws/missmarple","wholemsg":"false"},{"id":"5c3438cf.719e38","type":"websocket-listener","z":"","path":"/publishEVOLV512","wholemsg":"false"},{"id":"bbb8a174.f32a4","type":"websocket-listener","z":"","path":"/receiveEVOLV512","wholemsg":"false"},{"id":"a0ff328f.46b28","type":"serial-port","z":"","serialport":"COM22","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"0x0d","bin":"false","out":"char","addchar":true},{"id":"61377ccf.63db94","type":"serial-port","z":"","serialport":"COM6","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":true},{"id":"a06b2dfc.c5bc2","type":"websocket-listener","z":"","path":"/test","wholemsg":"true"},{"id":"5fd31cac.ee4084","type":"serial in","z":"e1a56311.cf0a1","name":"","serial":"81e9a193.91adf","x":950,"y":600,"wires":[["88d584cc.4a0fa8","b8281db3.69c2c","3f6bc03b.1015e"]]},{"id":"b8281db3.69c2c","type":"debug","z":"e1a56311.cf0a1","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1430,"y":600,"wires":[]},{"id":"c8f7a70.e09d158","type":"serial out","z":"e1a56311.cf0a1","name":"","serial":"81e9a193.91adf","x":530,"y":160,"wires":[]},{"id":"6ba17cba.4a3ec4","type":"inject","z":"e1a56311.cf0a1","name":"","topic":"ZZZZ","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":440,"wires":[["5041dab0.a8f8e4"]]},{"id":"5041dab0.a8f8e4","type":"function","z":"e1a56311.cf0a1","name":"1SHUT1 OUT","func":"msg.payload = \"1SHUT1 OUT\";\nreturn msg;","outputs":1,"noerr":0,"x":280,"y":440,"wires":[["25f71a36.c94366"]]},{"id":"25f71a36.c94366","type":"function","z":"e1a56311.cf0a1","name":"string to buffer","func":"function ascii_to_hexa(str)\n  {\n\tvar arr1 = [];\n\tfor (var n = 0, l = str.length; n < l; n ++) \n     {\n\t\tvar hex = Number(str.charCodeAt(n)).toString(16);\n\t\tarr1.push(hex);\n\t }\n\treturn arr1.join('');\n   }\n   \nvar order = msg.payload;\nvar buf = new Buffer((order.length)+1);\nfor(var lg=0;lg<(order.length);lg++) buf[lg] = '0x'+ascii_to_hexa(order.substr(lg,1));\nbuf[(order.length)] = '0x0d';\n//buf[0] = '0x0d';\nmsg.payload = buf; \nreturn [msg];","outputs":"1","noerr":0,"x":480,"y":440,"wires":[["9b82233a.07dac"]]},{"id":"88d584cc.4a0fa8","type":"function","z":"e1a56311.cf0a1","name":"console.log(bufferOriginal.toString('utf8'));","func":"msg.payload = msg.payload.toString('utf8');\nreturn msg;","outputs":1,"noerr":0,"x":1180,"y":560,"wires":[["b8281db3.69c2c"]]},{"id":"ae679c48.024b8","type":"function","z":"e1a56311.cf0a1","name":"1LOG IN","func":"msg.payload = \"1LOG IN\";\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":400,"wires":[["25f71a36.c94366"]]},{"id":"86bb9459.58ed98","type":"function","z":"e1a56311.cf0a1","name":"1LOG OUT","func":"msg.payload = \"1LOG OUT\";\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":480,"wires":[["25f71a36.c94366"]]},{"id":"59ad255a.929bac","type":"inject","z":"e1a56311.cf0a1","name":"","topic":"ZZZZ","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":400,"wires":[["ae679c48.024b8"]]},{"id":"1b012eca.74c431","type":"inject","z":"e1a56311.cf0a1","name":"","topic":"ZZZZ","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":480,"wires":[["86bb9459.58ed98"]]},{"id":"cd409522.ec5a08","type":"inject","z":"e1a56311.cf0a1","name":"","topic":"","payload":"LOAD:500","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":540,"y":240,"wires":[["c8f7a70.e09d158"]]},{"id":"d7cf07eb.5a7588","type":"ui_button","z":"e1a56311.cf0a1","name":"","group":"c16bde4f.bbb0f","order":1,"width":"2","height":"1","label":"405","color":"","icon":"","payload":"LOAD:405","payloadType":"str","topic":"","x":270,"y":280,"wires":[["c8f7a70.e09d158"]]},{"id":"3fe7c6de.7da51a","type":"ui_button","z":"e1a56311.cf0a1","name":"","group":"c16bde4f.bbb0f","order":4,"width":"2","height":"1","label":"770","color":"","icon":"","payload":"LOAD:770","payloadType":"str","topic":"","x":270,"y":200,"wires":[["c8f7a70.e09d158"]]},{"id":"d37d6d68.970e1","type":"ui_button","z":"e1a56311.cf0a1","name":"","group":"c16bde4f.bbb0f","order":5,"width":"2","height":"1","label":"A=ON","color":"","icon":"","payload":"CAN","payloadType":"str","topic":"","x":270,"y":120,"wires":[["c8f7a70.e09d158"]]},{"id":"e8370d73.627fd","type":"ui_button","z":"e1a56311.cf0a1","name":"","group":"c16bde4f.bbb0f","order":6,"width":"2","height":"1","label":"A=OFF","color":"","icon":"","payload":"CAF","payloadType":"str","topic":"","x":140,"y":120,"wires":[["c8f7a70.e09d158"]]},{"id":"4b9d7f80.fdb9","type":"ui_button","z":"e1a56311.cf0a1","name":"","group":"c16bde4f.bbb0f","order":3,"width":"2","height":"1","label":"740","color":"","icon":"","payload":"LOAD:740","payloadType":"str","topic":"","x":150,"y":200,"wires":[["c8f7a70.e09d158"]]},{"id":"914ac4c4.856998","type":"ui_button","z":"e1a56311.cf0a1","name":"","group":"c16bde4f.bbb0f","order":2,"width":"2","height":"1","label":"435","color":"","icon":"","payload":"LOAD:435","payloadType":"str","topic":"","x":270,"y":240,"wires":[["c8f7a70.e09d158"]]},{"id":"c402f6c5.cd7168","type":"ui_button","z":"e1a56311.cf0a1","name":"","group":"c16bde4f.bbb0f","order":7,"width":"2","height":"1","label":"C_i=50","color":"","icon":"","payload":"CCI050","payloadType":"str","topic":"","x":280,"y":160,"wires":[["c8f7a70.e09d158"]]},{"id":"498af9f5.00fd78","type":"ui_button","z":"e1a56311.cf0a1","name":"","group":"c16bde4f.bbb0f","order":8,"width":"2","height":"1","label":"C_i=100","color":"","icon":"","payload":"CCI100","payloadType":"str","topic":"","x":140,"y":160,"wires":[["c8f7a70.e09d158"]]},{"id":"3f6bc03b.1015e","type":"ui_text","z":"e1a56311.cf0a1","group":"c16bde4f.bbb0f","order":0,"width":"20","height":"6","name":"","label":"text","format":"{{msg.payload}}","layout":"row-spread","x":1090,"y":640,"wires":[]},{"id":"8cfdb023.7c4fc","type":"ui_button","z":"e1a56311.cf0a1","name":"","group":"c16bde4f.bbb0f","order":6,"width":"2","height":"1","label":"CSS","color":"","icon":"","payload":"CSS?","payloadType":"str","topic":"","x":150,"y":80,"wires":[["c8f7a70.e09d158"]]},{"id":"67390bc9.4cf244","type":"ui_button","z":"e1a56311.cf0a1","name":"","group":"c16bde4f.bbb0f","order":6,"width":"2","height":"1","label":"LAMS","color":"","icon":"","payload":"LAMS","payloadType":"str","topic":"","x":270,"y":80,"wires":[["c8f7a70.e09d158"]]},{"id":"9b82233a.07dac","type":"serial out","z":"e1a56311.cf0a1","name":"","serial":"576581be.5c0f1","x":640,"y":440,"wires":[]},{"id":"99bc11bd.2b8b1","type":"serial in","z":"e1a56311.cf0a1","name":"","serial":"576581be.5c0f1","x":950,"y":120,"wires":[["2860c34a.5f6f1c"]]},{"id":"2860c34a.5f6f1c","type":"debug","z":"e1a56311.cf0a1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1160,"y":120,"wires":[]},{"id":"f335a06a.f1e08","type":"sequencer","z":"e1a56311.cf0a1","name":"","topic":"control of microfluidic valves","save":"","ApiKey":"keyg2DOt9vukY1MhL","BaseKey":"appDgnv2cpbuCsgCO","duration":"60","rules":[{"nm":"","en_c":false,"en_s":"false","et":"20","es":"false","ths":"10","tls":"10","stc":"false","sws":"false"}],"x":1020,"y":240,"wires":[[]],"inputLabels":["TEST"],"outputLabels":["TES"]},{"id":"81100be4.16c7a8","type":"brain","z":"e1a56311.cf0a1","name":"brain","learningRate":0.3,"errorThresh":0.005,"iterations":20000,"log":false,"logPeriod":10,"x":950,"y":300,"wires":[[]]},{"id":"34a4bc78.295454","type":"sequencer","z":"e1a56311.cf0a1","name":"","topic":"control of microfluidic valves","save":"","ApiKey":"keyg2DOt9vukY1MhL","BaseKey":"appDgnv2cpbuCsgCO","duration":"60","rules":[{"nm":"","en_c":false,"en_s":false,"et":"20","es":false,"ths":"10","tls":"10","stc":false,"sws":false}],"x":1020,"y":180,"wires":[[]]},{"id":"27e26004.d6776","type":"change","z":"d495b1f5.94e8a","name":"Valve1","rules":[{"t":"move","p":"payload.Valve1","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"Valve1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":320,"wires":[["7c0d193e.3942f8"]]},{"id":"7c0d193e.3942f8","type":"ui_chart","z":"d495b1f5.94e8a","name":"","group":"7890883e.915758","order":4,"width":"18","height":"5","label":"","chartType":"line","legend":"true","xformat":"%H:%M:%S","interpolate":"step-after","nodata":"","ymin":"","ymax":"","removeOlder":"1","removeOlderUnit":"3600","x":1270,"y":320,"wires":[[],[]]},{"id":"fb11168f.a81858","type":"ui_chart","z":"d495b1f5.94e8a","name":"","group":"7890883e.915758","order":5,"width":"18","height":"5","label":"","chartType":"line","legend":"true","xformat":"%H:%M:%S","interpolate":"step-after","nodata":"","ymin":"","ymax":"","removeOlder":"1","removeOlderUnit":"3600","x":1270,"y":360,"wires":[[],[]]},{"id":"d8044531.b6fec8","type":"change","z":"d495b1f5.94e8a","name":"Valve2","rules":[{"t":"move","p":"payload.Valve2","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"Valve2","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":360,"wires":[["fb11168f.a81858"]]},{"id":"c576a210.9a0f4","type":"ui_button","z":"d495b1f5.94e8a","name":"","group":"7890883e.915758","order":1,"width":"6","height":"1","label":"START","color":"","icon":"","payload":"{\"run\":true,\"enable\":false}","payloadType":"json","topic":"","x":520,"y":580,"wires":[["2ba1fc71.4b1044","32798d34.477562"]]},{"id":"5ab8eed1.cb036","type":"ui_button","z":"d495b1f5.94e8a","name":"","group":"7890883e.915758","order":2,"width":"6","height":"1","label":" STOP  ","color":"","icon":"","payload":"{\"run\":false}","payloadType":"json","topic":"","x":510,"y":380,"wires":[["2ba1fc71.4b1044"]]},{"id":"faf5875f.7261c8","type":"ui_chart","z":"d495b1f5.94e8a","name":"","group":"7890883e.915758","order":6,"width":"18","height":"5","label":"","chartType":"line","legend":"true","xformat":"%H:%M:%S","interpolate":"step-after","nodata":"","ymin":"","ymax":"","removeOlder":"1","removeOlderUnit":"3600","x":1270,"y":400,"wires":[[],[]]},{"id":"875eff22.00b6f","type":"change","z":"d495b1f5.94e8a","name":"Valve3","rules":[{"t":"move","p":"payload.Valve3","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"Valve3","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":400,"wires":[["faf5875f.7261c8"]]},{"id":"2c93fcbf.98b684","type":"change","z":"d495b1f5.94e8a","name":"com","rules":[{"t":"move","p":"payload.com","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"com","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":520,"wires":[["288f54fd.6f96dc"]]},{"id":"288f54fd.6f96dc","type":"serial out","z":"d495b1f5.94e8a","name":"","serial":"4e5eae81.9ddfb","x":1280,"y":520,"wires":[]},{"id":"2ba1fc71.4b1044","type":"sequencer","z":"d495b1f5.94e8a","name":"real_test_1_60min","topic":"control of microfluidic valves","save":"real_test_1_60min","ApiKey":"keyg2DOt9vukY1MhL","BaseKey":"appDgnv2cpbuCsgCO","duration":"10","rules":[{"nm":"Valve1","en_c":true,"en_s":"false","et":"1","es":"false","ths":"1","tls":"1","stc":"false","sws":"true"},{"nm":"Valve2","en_c":true,"en_s":"false","et":"1","es":"false","ths":"1","tls":"1","stc":"true","sws":"false"},{"nm":"Valve3","en_c":true,"en_s":"true","et":"1","es":"false","ths":"1","tls":"1","stc":"true","sws":"true"},{"nm":"Valve4","en_c":true,"en_s":"false","et":"5","es":"false","ths":"1","tls":"1","stc":"true","sws":"true"},{"nm":"Valve5","en_c":false,"en_s":"true","et":"20","es":"false","ths":"10","tls":"10","stc":"false","sws":"false"}],"x":710,"y":400,"wires":[["27e26004.d6776","d8044531.b6fec8","2c93fcbf.98b684","875eff22.00b6f","6df9c598.a45c6c","f2517bea.51a9d8","7acea110.7888c"]]},{"id":"3d8683c0.07f08c","type":"camera","z":"2a3df03.3a7851","name":"","x":110,"y":140,"wires":[["abf5dc1b.1560b","596ddb09.86e264"]]},{"id":"9fccc36e.e60cc","type":"multipart-encoder","z":"2a3df03.3a7851","name":"","statusCode":"","ignoreMessages":true,"outputOneNew":true,"outputIfSingle":true,"outputIfAll":true,"globalHeaders":{"Content-Type":"multipart/x-mixed-replace;boundary=--myboundary","Connection":"keep-alive","Expires":"Fri, 01 Jan 1990 00:00:00 GMT","Cache-Control":"no-cache, no-store, max-age=0, must-revalidate","Pragma":"no-cache"},"partHeaders":{"Content-Type":"image/jpeg"},"destination":"all","highWaterMark":16384,"x":360,"y":160,"wires":[[]]},{"id":"abf5dc1b.1560b","type":"base64","z":"2a3df03.3a7851","name":"Encode","x":340,"y":220,"wires":[["596ddb09.86e264"]]},{"id":"d770212f.f0a0d","type":"ui_template","z":"2a3df03.3a7851","group":"42d2442d.3a7e6c","name":"Display image","order":1,"width":"14","height":"14","format":"<!--<img width=\"16\" height=\"16\" alt=\"stream test\" src=\"data:image/jpg;base64,{{msg.payload}}\" />-->\n<iframe z-index=\"0\" height=550 width=650 src=\"http://127.0.0.1:5000\"></iframe>\n<iframe z-index=\"-1\" height=550 width=650 src=\"http://127.0.0.1:5000\"></iframe>\n","storeOutMessages":true,"fwdInMessages":true,"x":860,"y":80,"wires":[[]]},{"id":"1ee694be.bea3bb","type":"inject","z":"2a3df03.3a7851","name":"","topic":"","payload":"[255]","payloadType":"bin","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":100,"wires":[["abf5dc1b.1560b"]]},{"id":"72e7b78.a8cd248","type":"fileinject","z":"2a3df03.3a7851","name":"","x":100,"y":60,"wires":[["abf5dc1b.1560b","596ddb09.86e264"]]},{"id":"6df9c598.a45c6c","type":"change","z":"d495b1f5.94e8a","name":"state","rules":[{"t":"move","p":"payload.state","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"START","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":280,"wires":[["9ed04646.64dcb8","347fb2e7.1b446e"]]},{"id":"9ed04646.64dcb8","type":"change","z":"d495b1f5.94e8a","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"unlock","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"lock","fromt":"str","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1080,"y":280,"wires":[["7c0d193e.3942f8","fb11168f.a81858","faf5875f.7261c8","7106211c.6e30a","2711695e.9c63c6","2783e1ef.6cc24e"]]},{"id":"7106211c.6e30a","type":"link out","z":"d495b1f5.94e8a","name":"out","links":["4e2214ad.bc28bc"],"x":1235,"y":280,"wires":[]},{"id":"4e2214ad.bc28bc","type":"link in","z":"d495b1f5.94e8a","name":"in","links":["7106211c.6e30a"],"x":255,"y":420,"wires":[["ee6cc1fe.3d2ad"]]},{"id":"ee6cc1fe.3d2ad","type":"function","z":"d495b1f5.94e8a","name":"Enabled...","func":"var start = {};\nvar stop = {};\nstart.payload = \"\" ;\nstop.payload = \"\" ;\nif(msg.payload === \"1\"){\n    start.enabled = false ;\n    stop.enabled = true ;\n}\nelse {\n    start.enabled = true;\n    stop.enabled = false ;\n}\nreturn [stop,start];","outputs":2,"noerr":0,"x":360,"y":400,"wires":[["5ab8eed1.cb036"],["c576a210.9a0f4"]]},{"id":"182d8f4c.528bd1","type":"inject","z":"d495b1f5.94e8a","name":"Init...","topic":"","payload":"0","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":210,"y":380,"wires":[["ee6cc1fe.3d2ad"]]},{"id":"347fb2e7.1b446e","type":"ui_text","z":"d495b1f5.94e8a","group":"7890883e.915758","order":3,"width":"6","height":"1","name":"","label":"State: ","format":"{{msg.payload}}","layout":"row-left","x":1050,"y":240,"wires":[]},{"id":"32798d34.477562","type":"function","z":"d495b1f5.94e8a","name":"Erase graph....","func":"//not used actually\nvar erase = {};\nerase.payload = [];\nreturn [erase];","outputs":1,"noerr":0,"x":1080,"y":580,"wires":[["7c0d193e.3942f8","fb11168f.a81858","faf5875f.7261c8","2711695e.9c63c6","2783e1ef.6cc24e"]]},{"id":"2711695e.9c63c6","type":"ui_chart","z":"d495b1f5.94e8a","name":"","group":"7890883e.915758","order":6,"width":"18","height":"5","label":"","chartType":"line","legend":"true","xformat":"%H:%M:%S","interpolate":"step-after","nodata":"","ymin":"","ymax":"","removeOlder":"1","removeOlderUnit":"3600","x":1270,"y":440,"wires":[[],[]]},{"id":"f2517bea.51a9d8","type":"change","z":"d495b1f5.94e8a","name":"Valve4","rules":[{"t":"move","p":"payload.Valve4","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"Valve4","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":440,"wires":[["2711695e.9c63c6"]]},{"id":"2783e1ef.6cc24e","type":"ui_chart","z":"d495b1f5.94e8a","name":"","group":"7890883e.915758","order":6,"width":"18","height":"5","label":"","chartType":"line","legend":"true","xformat":"%H:%M:%S","interpolate":"step-after","nodata":"","ymin":"","ymax":"","removeOlder":"1","removeOlderUnit":"3600","x":1270,"y":480,"wires":[[],[]]},{"id":"7acea110.7888c","type":"change","z":"d495b1f5.94e8a","name":"Valve5","rules":[{"t":"move","p":"payload.Valve5","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"Valve5","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":480,"wires":[["2783e1ef.6cc24e"]]},{"id":"b3369b6b.69b598","type":"pythonshell in","z":"cb80149c.966208","pyfile":"C:/Users/Williams/Desktop/flask-video-streaming-master/app.py","x":1120,"y":540,"wires":[[]]},{"id":"824df123.5bcac","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":940,"y":540,"wires":[["b3369b6b.69b598"]]},{"id":"596ddb09.86e264","type":"debug","z":"2a3df03.3a7851","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":370,"y":80,"wires":[]},{"id":"726c7353.cebbbc","type":"inject","z":"2a3df03.3a7851","name":"","topic":"","payload":"[255,216,255,224,0,16,74,70,73,70,0,1,2,1,0,96,0,96,0,0,255,238,0,14,65,100,111,98,101,0,100,0,0,0,0,1,255,225,19,93,69,120,105,102,0,0,77,77,0,42,0,0,0,8,0,7,1,50,0,2,0,0,0,20,0,0,0,98,1,59,0,2,0,0,0,7,0,0,0,118,71,70,0,3,0,0,0,1,0,4,0,0,71,73,0,3,0,0,0,1,0,63,0,0,156,157,0,1,0,0,0,14,0,0,0,0,234,28,0,7,0,0,8,12,0,0,0,0,135,105,0,4,0,0,0,1,0,0,0,125,0,0,0,231,50,48,48,57,58,48,51,58,49,50,32,49,51,58,52,54,58,52,50,0,67,111,114,98,105,115,0,0,5,144,3,0,2,0,0,0,20,0,0,0,191,144,4,0,2,0,0,0,20,0,0,0,211,146,145,0,2,0,0,0,3,53,52,0,0,146,146,0,2,0,0,0,3,53,52,0,0,234,28,0,7,0,0,7,180,0,0,0,0,0,0,0,0,50,48,48,56,58,48,51,58,49,52,32,49,51,58,53,57,58,50,54,0,50,48,48,56,58,48,51,58,49,52,32,49,51,58,53,57,58,50,54,0,0,5,1,3,0,3,0,0,0,1,0,6,0,0,1,26,0,5,0,0,0,1,0,0,1,41,1,27,0,5,0,0,0,1,0,0,1,49,2,1,0,4,0,0,0,1,0,0,1,57,2,2,0,4,0,0,0,1,0,0,18,28,0,0,0,0,0,0,0,72,0,0,0,1,0,0,0,72,0,0,0,1,255,216,255,224,0,16,74,70,73,70,0,1,1,0,0,1,0,1,0,0,255,219,0,67,0,16,11,12,14,12,10,16,14,13,14,18,17,16,19,24,40,26,24,22,22,24,49,35,37,29,40,58,51,61,60,57,51,56,55,64,72,92,78,64,68,87,69,55,56,80,109,81,87,95,98,103,104,103,62,77,113,121,112,100,120,92,101,103,99,255,219,0,67,1,17,18,18,24,21,24,47,26,26,47,99,66,56,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99]","payloadType":"bin","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":180,"wires":[["abf5dc1b.1560b","596ddb09.86e264"]]},{"id":"8d19fc7e.eb97b","type":"inject","z":"2a3df03.3a7851","name":"","topic":"","payload":"127.0.0.1","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":640,"y":80,"wires":[["d770212f.f0a0d"]]},{"id":"aee09b5b.e21a78","type":"ui_template","z":"2a3df03.3a7851","group":"c16bde4f.bbb0f","name":"Display image","order":1,"width":"14","height":"14","format":"<!--<img width=\"16\" height=\"16\" alt=\"stream test\" src=\"data:image/jpg;base64,{{msg.payload}}\" />-->\n<iframe height=550 width=650 src=\"http://127.0.0.1:5000\"></iframe>\n","storeOutMessages":true,"fwdInMessages":true,"x":860,"y":120,"wires":[[]]},{"id":"4464253b.c91d5c","type":"http in","z":"2a3df03.3a7851","name":"","url":"/mysite2","method":"get","swaggerDoc":"","x":110,"y":840,"wires":[["f145b346.5d9ea"]]},{"id":"9ae1eed8.a4286","type":"http in","z":"2a3df03.3a7851","name":"","url":"/mysitepost","method":"post","swaggerDoc":"","x":120,"y":940,"wires":[["f2f5aa8.ff60358","c6a7d8e.3626528"]]},{"id":"f145b346.5d9ea","type":"function","z":"2a3df03.3a7851","name":"msg.url = \"mysitepost\";","func":"msg.url = \"mysitepost\";\nmsg.name = \"Maëva\";\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":840,"wires":[["e8a543fe.dabaa"]]},{"id":"f2f5aa8.ff60358","type":"debug","z":"2a3df03.3a7851","name":"mysitepost","active":true,"console":"false","complete":"payload","x":760,"y":940,"wires":[]},{"id":"af518444.3c8668","type":"http response","z":"2a3df03.3a7851","name":"","x":780,"y":900,"wires":[]},{"id":"932d3611.255638","type":"template","z":"2a3df03.3a7851","name":"CSS","field":"payload.style","fieldType":"msg","format":"css","syntax":"mustache","template":"input[type=text], select {\n    width: 100%;\n    padding: 12px 20px;\n    margin: 8px 0;\n    display: inline-block;\n    border: 1px solid #ccc;\n    border-radius: 4px;\n    box-sizing: border-box;\n}\n\ninput[type=submit] {\n    width: 100%;\n    background-color: #4CAF50;\n    color: white;\n    padding: 14px 20px;\n    margin: 8px 0;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n}\n\ninput[type=submit]:hover {\n    background-color: #45a049;\n}\n\ndiv {\n    border-radius: 5px;\n    background-color: #f2f2f2;\n    padding: 20px;\n}","x":710,"y":840,"wires":[["9f0b4a56.6352f8"]]},{"id":"fc5a6040.7620e","type":"http response","z":"2a3df03.3a7851","name":"","x":1210,"y":840,"wires":[]},{"id":"edbf5a24.e05a48","type":"template","z":"2a3df03.3a7851","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<html>\n  <head>\n    <title>My Site</title>\n    <meta name=\"viewport\" content=\"initial-scale=1.0, user-scalable=no\">\n    <meta charset=\"utf-8\">\n    <script src=\"http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js\"></script>\n    <style>{{{payload.style}}}</style>\n  </head>\n  \n    <h1>{{name}}</h1>\n    <h2>Using CSS to style an HTML form with AJAX POST and Node-RED{{{payload.essai}}}</h2>\n    <h4><a href=\"http://www.internetoflego.com\">Internet of LEGO</a></h4>\n<div>\n  <form method=\"post\" action=\"/{{url}}\" ajax=\"true\">\n    <label for=\"fname\">First Name</label>\n    <input type=\"text\" id=\"fname\" name=\"firstname\">\n\n    <label for=\"lname\">Last Name</label>\n    <input type=\"text\" id=\"lname\" name=\"lastname\">\n\n    <label for=\"country\">Country</label>\n    <select id=\"country\" name=\"country\">\n      <option value=\"uk\">United Kingdom</option>\n      <option value=\"canada\">Canada</option>\n      <option value=\"usa\">USA</option>\n    </select>\n  \n    <input type=\"submit\" value=\"Submit\">\n  </form>\n</div>\n<div>\n    <span id=\"result\"></span>\n</div>\n\n</body>\n</html>\n<script>{{{payload.script}}}</script>","x":1030,"y":840,"wires":[["fc5a6040.7620e"]]},{"id":"5b3ec14a.19c8","type":"comment","z":"2a3df03.3a7851","name":"Login Form","info":"","x":850,"y":800,"wires":[]},{"id":"21f0569c.a5d6ba","type":"function","z":"2a3df03.3a7851","name":"return msg.payload to client","func":"msg.payload = 'The following data was submitted and available in the msg.payload: '+msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":900,"wires":[["af518444.3c8668"]]},{"id":"c6a7d8e.3626528","type":"json","z":"2a3df03.3a7851","name":"","x":320,"y":900,"wires":[["21f0569c.a5d6ba"]]},{"id":"7173edf6.9f4d54","type":"comment","z":"2a3df03.3a7851","name":"Form Submission","info":"","x":120,"y":900,"wires":[]},{"id":"6fa322a.ac1d7dc","type":"comment","z":"2a3df03.3a7851","name":"To JSON","info":"This Flow demonstrates how to create\na simple frontend webpage with Node-RED.\n\nThe public facing page consists of the \nclient side JavaScript, CSS and HTML. \n\nThe important technique is how the mustache \ntemplates are used. Each template will set the\n\"property\" relative to the content. \n\nThe CSS node sets the \"msg.payload.style\" property.\nThe JavaScript node sets the \"msg.payload.script\" property.\nThe HTML node then includes these properties \n<script>{{{payload.script}}}</script>\n<style>{{{payload.style}}}</style>\n\n\nThis example was created by http://www.InternetofLEGO.com\n\n","x":100,"y":740,"wires":[]},{"id":"cdeb4f95.3f79f","type":"HTML-PDF","z":"2a3df03.3a7851","name":"HTML-PDF","output":"file","x":630,"y":220,"wires":[["19c586a9.9ae249"]]},{"id":"19c586a9.9ae249","type":"http response","z":"2a3df03.3a7851","name":"","x":830,"y":220,"wires":[]},{"id":"ff2e27e.88507d8","type":"inject","z":"2a3df03.3a7851","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":110,"y":780,"wires":[["90827a0.eafc588"]]},{"id":"90827a0.eafc588","type":"function","z":"2a3df03.3a7851","name":"","func":"\nvar x ={ip : 92};\nmsg.payload = x;\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":780,"wires":[["a7dadaa3.c750c8"]]},{"id":"a7dadaa3.c750c8","type":"json","z":"2a3df03.3a7851","name":"","property":"payload","action":"","pretty":false,"x":410,"y":780,"wires":[["95bcf7aa.a3f2d8"]]},{"id":"95bcf7aa.a3f2d8","type":"debug","z":"2a3df03.3a7851","name":"","active":true,"console":"false","complete":"false","x":570,"y":780,"wires":[]},{"id":"9f0b4a56.6352f8","type":"template","z":"2a3df03.3a7851","name":"essai","field":"payload.essai","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{{ip}}","x":850,"y":840,"wires":[["edbf5a24.e05a48"]]},{"id":"acb4db39.ce3bb8","type":"pythonshell in","z":"2a3df03.3a7851","pyfile":"C:/Users/Williams/Desktop/flask-video-streaming-master/app.py","x":380,"y":280,"wires":[[]]},{"id":"73426f3b.79bf4","type":"inject","z":"2a3df03.3a7851","name":"","topic":"","payload":"START","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":280,"wires":[["acb4db39.ce3bb8"]]},{"id":"f72e5097.4f5c1","type":"template","z":"2a3df03.3a7851","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n\t<script>\n\tvar i = 0 ;\n    setInterval(function(){\n    document.getElementById(\"test\").src = \"test_\"+i+\"\".png\";\n    \n    },100);\n    </script>\n</head>\n<body>\n\t<img id=\"test\" src=\"test.png\">\n</body>\n</html>","output":"str","x":270,"y":420,"wires":[["d10b1017.c0a36"]]},{"id":"c2c47ded.672e1","type":"http in","z":"2a3df03.3a7851","name":"","url":"/photo","method":"get","upload":false,"swaggerDoc":"","x":100,"y":420,"wires":[["f72e5097.4f5c1"]]},{"id":"d10b1017.c0a36","type":"http response","z":"2a3df03.3a7851","name":"","statusCode":"","headers":{},"x":430,"y":420,"wires":[]},{"id":"e8a543fe.dabaa","type":"template","z":"2a3df03.3a7851","name":"JavaScript","field":"payload.script","fieldType":"msg","format":"javascript","syntax":"plain","template":"$(document).ready(function(e) {\n    \n    $(\"form[ajax=true]\").submit(function(e) {\n        \n        e.preventDefault();\n        \n        var form_data = $(this).serialize();\n        var form_url = $(this).attr(\"action\");\n        var form_method = $(this).attr(\"method\").toUpperCase();\n        \n        $(\"#loadingimg\").show();\n        \n        $.ajax({\n            url: form_url, \n            type: form_method,      \n            data: form_data,     \n            cache: false,\n            success: function(returnhtml){                          \n                $(\"#result\").html(returnhtml); \n                $(\"#loadingimg\").hide();                    \n            }           \n        });    \n        \n    });\n    \n});","x":550,"y":840,"wires":[["932d3611.255638"]]},{"id":"42bc3373.ad0abc","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":150,"y":240,"wires":[["b04c3fdb.3d97c","3a4eac6d.b7be14","36712d46.f2bbb2","ad8abd92.4ea1d","4989917b.b7a27"]]},{"id":"7b9203eb.3c718c","type":"function","z":"cb80149c.966208","name":"Object sequencer","func":"context.global.sequence = {\n    \"sync0\": {\n        'topic' : 'Fluorescence1',\n        'device' : context.global.Fluorescence1,\n        'mode' : 'MDA',\n        \"update\" :{\n          \"A\" : [120,100,\"ON\"],\n          \"B\" : [200,100,\"ON\"],\n          \"C\" : [330,100,\"ON\"],\n          \"D\" : [410,100,\"ON\"]\n        }    \n    },\n    'sync1': {\n        'topic' : 'Camera1',\n        'device' : context.global.Camera1,\n        'mode' : 'MDA',\n        'exposure': 20,\n        'fonction' : 'getFrame'\n    },\n    'sync2': {\n        'topic' : 'MotionStage1',\n        'device' : context.global.MotionStage1,\n        'mode' : 'MDA',\n        'x': 1365,\n        'y': 3420,\n        'fonction': 'moveToPositionXY'\n    },\n    'sync3': {\n        'topic' : 'Camera1',\n        'device' : context.global.Camera1,\n        'mode' : 'MDA',\n        'exposure': 20,\n        'fonction' : 'getFrame'\n    },\n    'sync4': {\n        'topic' : 'MotionStage1',\n        'device' : context.global.MotionStage1,\n        'mode' : 'MDA',\n        'x': 20,\n        'y': 50,\n        'fonction' : 'moveAbsoluePosition'\n    }\n};","outputs":1,"noerr":0,"x":380,"y":520,"wires":[[]]},{"id":"ffe37292.dc527","type":"inject","z":"cb80149c.966208","name":"START","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":3690,"y":420,"wires":[["f8201b4d.b43878","e12e2817.d069c8"]]},{"id":"92761880.364808","type":"inject","z":"cb80149c.966208","name":"STOP","topic":"","payload":"MDA-FINISH","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2110,"y":320,"wires":[["bace8a16.5d18c8","657c5962.be6f98"]]},{"id":"bace8a16.5d18c8","type":"function","z":"cb80149c.966208","name":"stop MDA time Order","func":"if(msg.payload === 'MDA-FINISH'){\n    context.global.startMDA = 0 ;\n    node.status ({fill:\"red\",shape:\"dot\", text: \"STOP\"});\n    //stop camera python code\n    var msg = {};\n    msg.payload = \"STOP,\"+Date.now();\n    node.send(msg);    \n}\nif(msg.payload === 'MDA-START'){\n    context.global.startMDA = 1 ;\n    node.status ({text: \"waiting stop ...\"});\n}","outputs":1,"noerr":0,"x":2340,"y":280,"wires":[["f6b45637.8cbd88"]]},{"id":"a7eae48a.24d768","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":3700,"y":660,"wires":[["92f19dd4.aa54d"]]},{"id":"92f19dd4.aa54d","type":"function","z":"cb80149c.966208","name":"sequence","func":"msg.payload = context.global.settingChannels;\nreturn msg;","outputs":1,"noerr":0,"x":3880,"y":660,"wires":[["90471aad.219f28"]]},{"id":"88cb6c3b.12179","type":"function","z":"cb80149c.966208","name":"Simu noeud LED","func":"if(msg.device === context.global.topicFluo1){\n    msg.topic = context.global.topicFluo1 ;\n    msg.payload = \"done\";\n    msg.parameters = {\n        \"1\":\"a\",\n        \"2\":\"b\",\n        \"3\":\"c\"\n    }\n    \n    return [msg];\n}","outputs":1,"noerr":0,"x":1110,"y":580,"wires":[[]]},{"id":"71c8b2d.caa514c","type":"http in","z":"cb80149c.966208","name":"","url":"/windowDHTMLX","method":"get","upload":false,"swaggerDoc":"","x":800,"y":120,"wires":[["e8a6022.d16e3"]]},{"id":"254e58a4.09d568","type":"http response","z":"cb80149c.966208","name":"","statusCode":"","headers":{},"x":1130,"y":120,"wires":[]},{"id":"e8a6022.d16e3","type":"template","z":"cb80149c.966208","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n\t<title>Minimal init</title>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"/>\n\t<meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"/>\n\t<link rel=\"stylesheet\" type=\"text/css\" href=\"codebase/fonts/font_roboto/roboto.css\"/>\n\t<link rel=\"stylesheet\" type=\"text/css\" href=\"codebase/dhtmlx.css\"/>\n\t<script src=\"codebase/dhtmlx.js\"></script>\n\t\n\t<script>\n\t\t\n\t\tvar dhxWins\n\t\tfunction doOnLoad() {\n\t\t\tdhxWins = new dhtmlXWindows();\n\t\t\tdhxWins.attachViewportTo(\"winVP\");\n\t\t}\n\t\t\n\t\tvar idPrefix = 1;\n\t\tfunction createWindow() {\n\t\t\tvar p = 0;\n\t\t\tdhxWins.forEachWindow(function(){p++;});\n\t\t\tif (p>5) {\n\t\t\t\talert(\"Too many windows\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar id = \"userWin\"+(idPrefix++);\n\t\t\t//\n\t\t\tvar w = Number(document.getElementById(\"win_w\").value);\n\t\t\tvar h = Number(document.getElementById(\"win_h\").value);\n\t\t\tvar x = Number(document.getElementById(\"win_x\").value);\n\t\t\tvar y = Number(document.getElementById(\"win_y\").value);\n\t\t\t//\n\t\t\tdhxWins.createWindow(id, x, y, w, h);\n\t\t\tdhxWins.window(id).setText(\"Evolv512 Camera\");\n\t\t\tdhxWins.window(id).attachURL(\"http://127.0.0.1:5000\");\n\t\t\t\n\t\t\t// dhxWins.window(id).keepInViewport(true);\n\t\t\t//\n\t\t\tdocument.getElementById(\"win_x\").value = x+50;\n\t\t\tdocument.getElementById(\"win_y\").value = y+40;\n\t\t}\n\t\t\n\t\tfunction doOnUnload() {\n\t\t\tif (dhxWins != null && dhxWins.unload != null) {\n\t\t\t\tdhxWins.unload();\n\t\t\t\tdhxWins = null;\n\t\t\t}\n\t\t}\n\t\t\n\t</script>\n</head>\n<body onload=\"doOnLoad();\" onunload=\"doOnUnload();\">\n\t<div>\n\t\t<table>\n\t\t\t<tr>\n\t\t\t\t<td>Input Position (x,y)</td>\n\t\t\t\t<td><input id=\"win_x\" type=\"text\" style=\"width: 30px;\" value=\"20\"> <input id=\"win_y\" type=\"text\" style=\"width: 30px;\" value=\"30\"></td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td>Input Size (width, height)</td>\n\t\t\t\t<td><input id=\"win_w\" type=\"text\" style=\"width: 30px;\" value=\"320\"> <input id=\"win_h\" type=\"text\" style=\"width: 30px;\" value=\"200\"></td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td>Input Header Text</td>\n\t\t\t\t<td><input id=\"win_t\" type=\"text\" style=\"width: 150px;\" value=\"New dhtmlxWindow\"></td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td colspan=\"2\" align=\"center\" style=\"padding-top: 10px;\"><input type=\"button\" value=\"Create Window\" onclick=\"createWindow();\"></td>\n\t\t\t</tr>\n\t\t</table>\n\t</div>\n\t<div id=\"winVP\" style=\"position: relative; height: 500px; border: #cecece 1px solid; margin: 10px;\"></div>\n</body>\n</html>","x":990,"y":120,"wires":[["254e58a4.09d568"]]},{"id":"1e72484c.9abca8","type":"template","z":"cb80149c.966208","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n\t<title>Init from xml file</title>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"/>\n\t<meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"/>\n\t<link rel=\"stylesheet\" type=\"text/css\" href=\"codebase/fonts/font_roboto/roboto.css\"/>\n\t<link rel=\"stylesheet\" type=\"text/css\" href=\"codebase/dhtmlx.css\"/>\n\t<script src=\"codebase/dhtmlx.js\"></script>\n\t\t<script>\n\t\tvar myMenu;\n\t\tfunction doOnLoad() {\n\t\t\tmyMenu = new dhtmlXMenuObject({\n\t\t\t\tparent: \"menuObj\",\n\t\t\t\ticons_path: \"commonMenu/imgs/\",\n\t\t\t\txml: \"commonMenu/dhxmenu.xml\",\n\t\t\t\tonload: function() {\n\t\t\t\t\t// callback\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t</script>\n</head>\n<body onload=\"doOnLoad();\">\n\t<div style=\"height: 250px;\">\n\t\t<div id=\"menuObj\"></div>\n\t</div>\n</body>\n</html>","output":"str","x":990,"y":160,"wires":[["495294e7.78100c"]]},{"id":"1cf4785a.979648","type":"http in","z":"cb80149c.966208","name":"","url":"/menuDHTMLX","method":"get","upload":false,"swaggerDoc":"","x":810,"y":160,"wires":[["1e72484c.9abca8"]]},{"id":"495294e7.78100c","type":"http response","z":"cb80149c.966208","name":"","statusCode":"","headers":{},"x":1130,"y":160,"wires":[]},{"id":"fbfba594.012e38","type":"function","z":"2a3df03.3a7851","name":"Wait for all tasks to finish","func":"context.data = context.data || new Object();\n\nswitch (msg.topic) {\n    case \"task1\":\n        context.data.task1 = msg.payload;\n        msg = null;\n        break;\n    case \"task2\":\n        context.data.task2 = msg.payload;\n        msg = null;\n        break;\n    case \"task3\":\n        context.data.task3 = msg.payload;\n        msg = null;\n        break;\n        \n    default:\n        msg = null;\n    \tbreak;\n\n}\n\nif(context.data.task1 != null && context.data.task2 != null && context.data.task3 != null) {\n\tmsg2 = new Object();\n    msg2 = context.data;\n    context.data=null;\n\treturn msg2;\n} else return msg;","outputs":1,"noerr":0,"x":690,"y":580,"wires":[["8b799d20.a451a"]]},{"id":"8b799d20.a451a","type":"debug","z":"2a3df03.3a7851","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":930,"y":580,"wires":[]},{"id":"7a3b39da.eb8b88","type":"function","z":"2a3df03.3a7851","name":"Task1","func":"msg.topic=\"task1\";\nmsg.payload=\"Task1's payload\"\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":540,"wires":[["781585d3.364f7c"]]},{"id":"16d75da5.92d752","type":"function","z":"2a3df03.3a7851","name":"Task2","func":"msg.topic=\"task2\";\nmsg.payload=\"Task2's payload\"\nreturn msg;","outputs":1,"noerr":0,"x":276.7778015136719,"y":579.5555648803711,"wires":[["e2f1b410.d94fc8"]]},{"id":"a27dfa0d.f889b8","type":"function","z":"2a3df03.3a7851","name":"Task3","func":"msg.topic=\"task3\";\nmsg.payload=\"Task3's payload\"\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":620,"wires":[["a1fc4140.893ae"]]},{"id":"a753300.5d886d","type":"inject","z":"2a3df03.3a7851","name":"Start","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":"","x":110,"y":580,"wires":[["7a3b39da.eb8b88","16d75da5.92d752","a27dfa0d.f889b8"]]},{"id":"9bc5390b.89d7e8","type":"http response","z":"cb80149c.966208","name":"","x":1140,"y":240,"wires":[]},{"id":"86819aec.be7398","type":"http in","z":"cb80149c.966208","name":"","url":"/simple","method":"get","swaggerDoc":"","x":820,"y":240,"wires":[["566b57e.f9e7ca8"]]},{"id":"e0d3f4a9.9c52d8","type":"websocket in","z":"cb80149c.966208","name":"","server":"da7e8f9b.c87dc","client":"","x":140,"y":940,"wires":[["164a13c0.02011c","7fabf17e.1dc57","98d63808.a30b18","362f9069.c410b","2bab3a9e.e33206","ad1b264.f7a68d8","a0026845.d77168","e381bc1c.e5ad8"]]},{"id":"79c8bebe.99dc4","type":"comment","z":"cb80149c.966208","name":"Simulation Multi Acquisition","info":"","x":200,"y":100,"wires":[]},{"id":"781585d3.364f7c","type":"delay","z":"2a3df03.3a7851","name":"","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":420,"y":540,"wires":[["fbfba594.012e38"]]},{"id":"e2f1b410.d94fc8","type":"delay","z":"2a3df03.3a7851","name":"","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":420,"y":580,"wires":[["fbfba594.012e38"]]},{"id":"a1fc4140.893ae","type":"delay","z":"2a3df03.3a7851","name":"","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":420,"y":620,"wires":[["fbfba594.012e38"]]},{"id":"36712d46.f2bbb2","type":"function","z":"cb80149c.966208","name":"Initialisation","func":"context.global.startMDA = 0 ;\n\ncontext.global.sync = 0 ;\ncontext.global.sync2 = 0 ;\ncontext.global.sync3 = 0 ;\ncontext.global.sync4 = 0 ;\n\ncontext.global.settingChannels = [];\n\ncontext.global.saveConfigChannel = '' ;\ncontext.global.saveConfigMda = '' ;\n\n//context.global.listConfigChannel = ['williams1.json'] ;\n//context.global.initialize = false ;\n//context.global.ressources = [] ;\n\n//context.global.test = [];\n","outputs":1,"noerr":0,"x":350,"y":240,"wires":[[]]},{"id":"4ee30745.c64048","type":"http response","z":"cb80149c.966208","name":"","x":1130,"y":80,"wires":[]},{"id":"34f602d3.91b9de","type":"http in","z":"cb80149c.966208","name":"","url":"/d3_js","method":"get","upload":false,"swaggerDoc":"","x":840,"y":80,"wires":[["faaef7b1.bc2b98"]]},{"id":"faaef7b1.bc2b98","type":"template","z":"cb80149c.966208","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!doctype html>\n<html lang=\"en\">\n  <head>\n    <!-- Required meta tags -->\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n\n    <!-- Bootstrap CSS -->\n    <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css\" integrity=\"sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO\" crossorigin=\"anonymous\">\n\n    <title>Hello, world!</title>\n  </head>\n  <body>\n    <h1>Hello, world!</h1>\n\n    <!-- Optional JavaScript -->\n    <!-- jQuery first, then Popper.js, then Bootstrap JS -->\n    <script src=\"https://code.jquery.com/jquery-3.3.1.slim.min.js\" integrity=\"sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo\" crossorigin=\"anonymous\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js\" integrity=\"sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49\" crossorigin=\"anonymous\"></script>\n    <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js\" integrity=\"sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy\" crossorigin=\"anonymous\"></script>\n  </body>\n</html>","x":990,"y":80,"wires":[["4ee30745.c64048"]]},{"id":"9daba4a7.c3fe28","type":"websocket out","z":"cb80149c.966208","name":"InitObjectHTMLDevice","server":"da7e8f9b.c87dc","client":"","x":1090,"y":280,"wires":[]},{"id":"566b57e.f9e7ca8","type":"template","z":"cb80149c.966208","name":"Simple Live Test","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE HTML>\n<html>\n    <head>\n    <title>Simple Live Test Miss Marple</title>\n    <script type=\"text/javascript\">\n        var ws;\n        var wsUri = \"ws:\";\n        var loc = window.location;\n        console.log(loc);\n        if (loc.protocol === \"https:\") { wsUri = \"wss:\"; }\n        // This needs to point to the web socket in the Node-RED flow\n        // ... in this case it's ws/simple\n        wsUri += \"//\" + loc.host + loc.pathname.replace(\"simple\",\"ws/simple\");\n        \n        \n        var i = 0;\n        function wsConnect() {\n            console.log(\"connect\",wsUri);\n            ws = new WebSocket(wsUri);\n            ws.onmessage = function(msg) {\n                var line = \"\";  // or uncomment this to overwrite the existing message\n                // parse the incoming message as a JSON object\n                var data = msg.data;\n                if(data.substr(0,4)==\"grab\"){ \n                    var x = document.createElement(\"IMG\");\n                    x.setAttribute(\"src\", \"media/\"+data);\n                    x.setAttribute(\"width\", \"304\");\n                    x.setAttribute(\"height\", \"228\");\n                    document.body.appendChild(x);\n                    \n                }\n                else {\n                    //console.log(data);\n                    // build the output from the topic and payload parts of the object\n                    line += \"<p>\"+data+\"</p>\";\n                    // replace the messages div with the new \"line\"\n                    document.getElementById('messages').innerHTML = line;\n                    //ws.send(JSON.stringify({data:data}));\n                }\n            }\n            ws.onopen = function() {\n                // update the status div with the connection status\n                document.getElementById('status').innerHTML = \"Connected to server\";\n                //ws.send(\"Open for data\");\n                console.log(\"connected\");\n            }\n            ws.onclose = function() {\n                // update the status div with the connection status\n                document.getElementById('status').innerHTML = \"Not connected - retry in 3 seconds ...\";\n                setTimeout(wsConnect,3000);\n            }\n            \n        }\n        \n        function doit(m) {\n            if (ws) { ws.send(m); }\n        }\n    </script>\n    </head>\n    <body onload=\"wsConnect();\" onunload=\"ws.disconnect();\" style=\"background-color:#708090;\">\n        <font face=\"Arial\">\n        <h3>Miss Marple :-)</h3>\n        <img src=\"media/e475238aca49b9f6bb53cc4138fbdb27--funny-caricatures-celebrity-caricatures.jpg\">\n        \n        <div id=\"messages\"></div>\n        <button type=\"button\" onclick='doit(\"click\");'>START TEST MDA</button>\n        <hr/>\n        <div id=\"status\">unknown</div>\n        <hr/>\n        </font>\n    </body>\n</html>\n","x":990,"y":240,"wires":[["9bc5390b.89d7e8"]]},{"id":"672f335.5cad3cc","type":"pythonshell in","z":"e1a56311.cf0a1","pyfile":"","x":700,"y":40,"wires":[[]]},{"id":"bb39a7f3.5dae38","type":"python-function","z":"e1a56311.cf0a1","name":"","func":"\nreturn msg","outputs":1,"x":760,"y":220,"wires":[[]]},{"id":"3ac4b512.04200a","type":"twitter in","z":"e1a56311.cf0a1","tags":"","user":"false","name":"","inputs":0,"x":240,"y":600,"wires":[["e95d35c3.136ae8"]]},{"id":"e95d35c3.136ae8","type":"function","z":"e1a56311.cf0a1","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":600,"wires":[["5a06379e.636e58"]]},{"id":"5a06379e.636e58","type":"serial out","z":"e1a56311.cf0a1","name":"","serial":"376dfed1.28fb92","x":630,"y":600,"wires":[]},{"id":"fd1a5d25.eba38","type":"http in","z":"cb80149c.966208","name":"","url":"/cyberscope","method":"get","upload":false,"swaggerDoc":"","x":90,"y":860,"wires":[["cd0d4adf.dbcb98"]]},{"id":"1ca919d8.2e3c36","type":"http response","z":"cb80149c.966208","name":"","x":660,"y":860,"wires":[]},{"id":"cd0d4adf.dbcb98","type":"template","z":"cb80149c.966208","name":"MissMarpleHTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html lang=\"en\">\n    <head>\n        <meta charset=\"utf-8\">\n        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n        <meta name=\"description\" content=\"\">\n        <meta name=\"author\" content=\"\">\n        <link rel=\"icon\" href=\"bootstrap/favicon.ico\">\n        <title>CyberScope | Lab513</title>\n        <link href=\"bootstrap/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n        <link href=\"bootstrap/assets/css/ie10-viewport-bug-workaround.css\" rel=\"stylesheet\">\n        <link href=\"bootstrap/dashboard.css\" rel=\"stylesheet\">\n        <link href=\"css/style1.css\" rel=\"stylesheet\">\n        <script src=\"bootstrap/assets/js/ie-emulation-modes-warning.js\"></script>\n        \n        <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js\"></script>\n        \n        <script src=\"js/js1.js\"></script>\n        <script src=\"//code.jquery.com/jquery-3.3.1.min.js\"></script>\n        \n        <script type=\"text/javascript\" src=\"wPaint/lib/jquery.1.10.2.min.js\"></script>\n    \n        <link href=\"//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css\" rel=\"stylesheet\">\n        <script src=\"//code.jquery.com/ui/1.12.1/jquery-ui.min.js\"></script>\n        <script src=\"//cdn.jsdelivr.net/npm/ui-contextmenu/jquery.ui-contextmenu.min.js\"></script>\n        \n        \n        <link href=\"fancytree-master/src/skin-win8/ui.fancytree.css\" rel=\"stylesheet\">\n        <script src=\"fancytree-master/src/jquery.fancytree.js\"></script>\n        <script src=\"fancytree-master/src/jquery.fancytree.dnd5.js\"></script>\n        <script src=\"fancytree-master/src/jquery.fancytree.edit.js\"></script>\n        <script src=\"fancytree-master/src/jquery.fancytree.gridnav.js\"></script>\n        <script src=\"fancytree-master/src/jquery.fancytree.table.js\"></script>\n        <script src=\"fancytree-master/src/jquery.fancytree.multi.js\"></script>\n        \n        <script type=\"text/javascript\" src=\"js/jquery.maphilight.js\"></script>\n\n\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.css\">\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.js\"></script>\n      \n        <style type=\"text/css\">\n            img:hover {\n              box-shadow: 0 0 2px 1px rgba(0, 140, 186, 0.5);\n            }\n            .ui-menu {\n                width: 200px;\n                height: 30px;\n                font-size: 63%;\n            }\n            .ui-menu kbd {\n                float: right;\n            }\n            td.alignRight {\n                text-align: right;\n            }\n            td.alignCenter {\n                text-align: center;\n            }\n            td input[type=input] {\n                width: 40px;\n            }\n            span.drag-source{\n                border: 1px solid lightgray;\n                border-radius: 3px;\n                padding: 2px;\n                background-color: lightgray\n            }\n            ul.fancytree-container {\n                max-height: 200px;\n                overflow-y: scroll;\n            }\n            span.fancytree-node.fancytree-drag-source {\n                outline: 1px dotted grey;\n            }\n            span.fancytree-node.fancytree-drop-accept {\n                outline: 1px dotted green;\n            }\n            span.fancytree-node.fancytree-drop-reject {\n                outline: 1px dotted red;\n            }\n            #my_tree{max-height: 700px; overflow-y:scroll; overflow-x: hidden;}\n            #my_function{max-height: 700px; overflow-y:scroll; overflow-x: hidden;}\n            #settings{max-height: 800px; overflow-y:scroll; overflow-x: hidden;}\n        </style>\n    </head>\n\n    <body  onload=\"wsConnect();\" onunload=\"ws.onclose();\">\n    \n        <div id=\"wait\" style=\"text-align: center;\" >\n            <img style=\"margin: 0 auto;\" src='media/Audit.png'><img style=\"margin: 0 auto;\" src='media/loading.gif'><br>\n            <h2>Loading parameters, please wait a few seconds</h2>\n        </div>\n    \n        <div id=\"main\">\n            <nav class=\"navbar navbar-inverse navbar-fixed-top\">\n                <div class=\"container-fluid\">\n                    <div class=\"navbar-header\">\n                        <button type=\"button\" class=\"navbar-toggle collapsed\" data-toggle=\"collapse\" data-target=\"#navbar\" aria-expanded=\"false\" aria-controls=\"navbar\">\n                            <span class=\"sr-only\">Toggle navigation</span>\n                            <span class=\"icon-bar\"></span>\n                            <span class=\"icon-bar\"></span>\n                            <span class=\"icon-bar\"></span>\n                        </button>\n                        <a class=\"navbar-brand\" href=\"javascript: setting();\"><small>Settings Channels</small></a>\n                        <a class=\"navbar-brand\" href=\"javascript: mda();\"><small>Acquisition</small></a>\n                        <a class=\"navbar-brand\" href=\"javascript: calibration();\"><small>Self Calibration</small></a>\n                        <a class=\"navbar-brand\" href=\"javascript: mosaic();\"><small>Mosaic</small></a>\n                        <a class=\"navbar-brand\" href=\"javascript: conf();\"><small>Configuration</small></a>\n                        <a class=\"navbar-brand\" href=\"#\"><small><div id=\"name_user\"></div></small></a>\n                    </div>\n                    <div id=\"navbar\" class=\"navbar-collapse collapse\">\n                        <ul class=\"nav navbar-nav navbar-right\">\n                            <li><a style=\"color: rgb(255, 102, 102);\" href=\"#\"><small>Documentation | Wiki</small></a></li>\n                            <li><a style=\"color: rgb(0, 255, 64);\" href=\"http://lab513.fr/labr/\"><small>Lab 513 - Hersen's Lab</small></a></li>\n                            <li><a style=\"color: rgb(0, 255, 64);\"  href=\"#\"><small><div id=\"status\"></div></small></a></li>\n                        </ul>\n                    </div>\n                </div>\n            </nav>\n            <div class=\"container-fluid\">\n                <div class=\"row\">\n                    <div>    \n                        <br>\n                        <div id=\"receive\"></div>\n                        <div id=\"alert-success\" class=\"alert alert-success\" role=\"alert\"></div>\n                \n                        <div id=\"live_mode\">\n                            <h2 class=\"sub-header\">Live mode</h2>\n                            <div id=\"live_div\" class=\"table-responsive\">\n                                <img src='icons/work_in_progress.jpg'>\n                        </div>    \n                    </div>\n    \n                    <div id=\"settings\">\n                        <h2 class=\"sub-header\">Settings channels</h2>\n                        <div id=\"name_configChannels\"></div>\n                        <div id=\"available_configChannels\"></div>\n                        <br>\n                        <form method=\"post\" id='setting_channel_form' action=\"/formpost\" ajax=\"true\">\n                            <button class='setting_button' alt='add channel' id=\"setting_button_add_channel\"><img src='icons/add.png'> Add a new setting channel</button>\n                            <button type='submit' alt='save' class='setting_button' id='setting_button_save_channel'><img src='icons/disk.png'> Save the current settings</button>\n                            <div id=\"setting_table_channel\" class=\"table-responsive\"></div>\n                        </form>\n                        <br>\n                        <hr/>\n                    </div>\n                    \n                    <div id=\"settings\">\n                    \n                    </div>  \n                    <div id=\"calibration\">\t\n                        <!--<table style=\"text-align: left; width: 100%;\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n                          <tbody>\n                            <tr>\n                              <td style=\"width:1%;\"></td>\n                              <td style=\"width: 600px;\">\n                                <h3>\n                                    Load a design&nbsp;: &nbsp;\n                                    <select>\n                                        <option>µFluidic sample 1 (25 rooms)</option>\n                                        <option>static pattern (5 rooms)</option>\n                                    </select>\n                                </h3>\n                                <a name=\"map\"></a>\n                                <img class=\"map\" src=\"icons/test_uf2.png\" usemap=\"#map\">\n                                <map name=\"map\">\n                                    <area id=\"room1\" shape=\"poly\" title=\"Room 1\" onmouseover= \"info(1);\" onclick=\"visibilite(1);\" data-maphilight='{ \"fillColor\":\"0000ff\", \"strokeColor\":0000ff, \"strokeWidth\":2, \"fillOpacity\":0.5}' coords=\"361,78,342,96,361,114,381,97\" >\n                                    <area id=\"room2\" shape=\"poly\" title=\"Room 2\" onmouseover= \"info(2);\" onclick=\"visibilite(2);\" data-maphilight='{ \"fillColor\":0000ff, \"strokeColor\":0000ff, \"strokeWidth\":2, \"fillOpacity\":1}' coords=\"381,98,362,116,381,134,401,117\" > \n                                    <area id=\"room3\" shape=\"poly\" title=\"Room 3\" onmouseover= \"info(3);\" onclick=\"visibilite(3);\" data-maphilight='{ \"fillColor\":0000ff, \"strokeColor\":0000ff, \"strokeWidth\":2, \"fillOpacity\":1}' coords=\"400,118,381,136,400,154,420,137\" > \n                                    <area id=\"room4\" shape=\"poly\" title=\"Room 4\" onmouseover= \"info(4);\" onclick=\"visibilite(4);\" data-maphilight='{ \"fillColor\":0000ff, \"strokeColor\":0000ff, \"strokeWidth\":2, \"fillOpacity\":1}' coords=\"420,137,400,155,420,173,440,156\" > \n                                    <area id=\"room5\" shape=\"poly\" title=\"Room 5\" onmouseover= \"info(5);\" onclick=\"visibilite(5);\" data-maphilight='{ \"fillColor\":0000ff, \"strokeColor\":0000ff, \"strokeWidth\":2, \"fillOpacity\":1}' coords=\"438,156,419,174,438,192,458,175\" > \n                                    <area id=\"room6\" shape=\"poly\" title=\"Room 6\" onmouseover= \"info(6);\" onclick=\"visibilite(6);\" data-maphilight='{ \"fillColor\":0000ff, \"strokeColor\":0000ff, \"strokeWidth\":2, \"fillOpacity\":1}' coords=\"285,153,265,173,285,191,304,173\" > \n                                </map>\n                              </td>\n                              <td>\n                                    <div id=\"room\"></div>\n                              </td>\n                            </tr>\n                          </tbody>\n                        </table>-->\n<hr>\n<h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This module allows you to calibrate a μFlu chip.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The software calculates the movement between the different chambers, then he creates a selection list in order to simplify the move</h5>\n<table style=\"text-align: left;\"\n border=\"0\" cellpadding=\"2\" cellspacing=\"5\">\n  <tbody>\n    <tr>\n      <td style=\"width: 1%;\"></td>\n      <td\n style=\"width: 173px; background-color: rgb(204, 204, 204); text-align: center;\">Load\na specific design : &nbsp;\n      <select name=\"design\">\n      <option>&micro;Fluidic -\n25 rooms</option>\n      <option>static pattern - 6\nrooms</option>\n      </select>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 0px;\"><br>\n      </td>\n      <td\n style=\"width: 511px; background-color: rgb(204, 204, 204);\">Live</td>\n      <td\n style=\"width: 13px; background-color: rgb(255, 255, 255);\"\n colspan=\"1\" rowspan=\"1\"><br>\n      </td>\n      <td rowspan=\"1\"\n style=\"background-color: rgb(204, 204, 204); width: 241px;\"\n colspan=\"10\">Global\nparameters</td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 173px;\"></td>\n      <td style=\"width: 0px;\"></td>\n      <td style=\"width: 511px;\"></td>\n      <td style=\"width: 13px;\"\n colspan=\"1\" rowspan=\"1\"><br>\n      </td>\n      <td style=\"width: 241px;\"\n colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 1%;\"></td>\n      <td colspan=\"1\" rowspan=\"22\"\n style=\"width: 46%; text-align: center; vertical-align: top;\">\n      <div>&nbsp;<a\n name=\"map\"></a><img\n class=\"map\" src=\"icons/test_uf2.png\" usemap=\"#map\"><map\n name=\"map\">\n      <area id=\"room1\" shape=\"poly\"\n title=\"Room 1\" onmouseover=\"info(1);\"\n onclick=\"visibilite(1);\"\n data-maphilight=\"{ &quot;fillColor&quot;:&quot;0000ff&quot;, &quot;strokeColor&quot;:0000ff, &quot;strokeWidth&quot;:2, &quot;fillOpacity&quot;:0.5}\"\n coords=\"361,78,342,96,361,114,381,97\">\n      <area id=\"room2\" shape=\"poly\"\n title=\"Room 2\" onmouseover=\"info(2);\"\n onclick=\"visibilite(2);\"\n data-maphilight=\"{ &quot;fillColor&quot;:0000ff, &quot;strokeColor&quot;:0000ff, &quot;strokeWidth&quot;:2, &quot;fillOpacity&quot;:1}\"\n coords=\"381,98,362,116,381,134,401,117\">\n      <area id=\"room3\" shape=\"poly\"\n title=\"Room 3\" onmouseover=\"info(3);\"\n onclick=\"visibilite(3);\"\n data-maphilight=\"{ &quot;fillColor&quot;:0000ff, &quot;strokeColor&quot;:0000ff, &quot;strokeWidth&quot;:2, &quot;fillOpacity&quot;:1}\"\n coords=\"400,118,381,136,400,154,420,137\">\n      <area id=\"room4\" shape=\"poly\"\n title=\"Room 4\" onmouseover=\"info(4);\"\n onclick=\"visibilite(4);\"\n data-maphilight=\"{ &quot;fillColor&quot;:0000ff, &quot;strokeColor&quot;:0000ff, &quot;strokeWidth&quot;:2, &quot;fillOpacity&quot;:1}\"\n coords=\"420,137,400,155,420,173,440,156\">\n      <area id=\"room5\" shape=\"poly\"\n title=\"Room 5\" onmouseover=\"info(5);\"\n onclick=\"visibilite(5);\"\n data-maphilight=\"{ &quot;fillColor&quot;:0000ff, &quot;strokeColor&quot;:0000ff, &quot;strokeWidth&quot;:2, &quot;fillOpacity&quot;:1}\"\n coords=\"438,156,419,174,438,192,458,175\">\n      <area id=\"room6\" shape=\"poly\"\n title=\"Room 6\" onmouseover=\"info(6);\"\n onclick=\"visibilite(6);\"\n data-maphilight=\"{ &quot;fillColor&quot;:0000ff, &quot;strokeColor&quot;:0000ff, &quot;strokeWidth&quot;:2, &quot;fillOpacity&quot;:1}\"\n coords=\"285,153,265,173,285,191,304,173\">\n      </map>\n      </div>\n      </td>\n      <td style=\"width: 1%;\"\n rowspan=\"21\"> </td>\n      <td\n style=\"text-align: right; width: 511px; vertical-align: top;\"\n colspan=\"1\" rowspan=\"22\">\n      <iframe src=\"http://127.0.0.1:5000/\"\n frameborder=\"0\" height=\"512\" width=\"512\"></iframe></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Objective</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"9\"\n rowspan=\"1\">\n      <select onchange='updateAftbl0();' class=\"aftbl0\"\n style=\"width: 150px;\">\n      <option name=\"LCPlanFl 20x\"\n value=\"75\">LCPlanFl 20x</option>\n      <option name=\"LCPlanFl 40x\"\n value=\"76\">LCPlanFl 40x</option>\n      <option name=\"LCPlanFl 60x\"\n value=\"79\">LCPlanFl 60x</option>\n      <option name=\"LUCPlanFl 40x\"\n value=\"78\">LUCPlanFl 40x</option>\n      <option name=\"LUCPlanFlN 20x\"\n value=\"75\">LUCPlanFlN 20x</option>\n      <option name=\"LUCPlanFlN 40x\"\n value=\"76\">LUCPlanFlN 40x</option>\n      <option name=\"LUCPlanFlN 60x\"\n value=\"79\">LUCPlanFlN 60x</option>\n      <option name=\"PlanApo 100x O3\"\n value=\"31\">PlanApo 100x O3</option>\n      <option name=\"PlanApo 60x O TIRFM-SP\"\n value=\"70\">PlanApo 60x O TIRFM-SP</option>\n      <option name=\"PlanApo 60x O/LSM\"\n value=\"62\">PlanApo 60x O/LSM</option>\n      <option name=\"PlanApo 60x O3\"\n value=\"30\">PlanApo 60x O3</option>\n      <option name=\"PlanApo 40x W/LSM\"\n value=\"60\">PlanApo 40x W/LSM</option>\n      <option name=\"PlanApoN 60x O\"\n value=\"30\">PlanApoN 60x O</option>\n      <option name=\"SLCPlanFl 40x\"\n value=\"77\">SLCPlanFl 40x</option>\n      <option name=\"UApo 30x 3/340\"\n value=\"45\">UApo 30x 3/340</option>\n      <option name=\"UApo 40x 3/340\"\n value=\"47\">UApo 40x 3/340</option>\n      <option name=\"UApo 40x W\"\n value=\"48\">UApo 40x W</option>\n      <option name=\"UPlanFl 60x OI3\"\n value=\"57\">UPlanFl 60x OI3</option>\n      <option name=\"UPlanApo 20x\"\n value=\"36\">UPlanApo 20x</option>\n      <option name=\"UPlanApo 100x OI3\"\n value=\"43\">UPlanApo 100x OI3</option>\n      <option name=\"UPlanApo 40x OI3\"\n value=\"39\">UPlanApo 40x OI3</option>\n      <option name=\"UPlanApo 60x\"\n value=\"40\">UPlanApo 60x</option>\n      <option name=\"UPlanApo 60x W\"\n value=\"41\">UPlanApo 60x W</option>\n      <option name=\"UPlanApo 60x W/IR\"\n value=\"42\">UPlanApo 60x W/IR</option>\n      <option name=\"UplanFl 100x O3\"\n value=\"58\">UplanFl 100x O3</option>\n      <option name=\"UPlanFl 20x\"\n value=\"55\">UPlanFl 20x</option>\n      <option name=\"UPlanFl 40x O-SP\"\n value=\"71\">UPlanFl 40x O-SP</option>\n      <option name=\"UPlanFl 40x\"\n value=\"56\">UPlanFl 40x</option>\n      <option name=\"UPlanFlN 100x O\"\n value=\"58\">UPlanFlN 100x O</option>\n      <option name=\"UPlanFlN 100x OI\"\n value=\"58\">UPlanFlN 100x OI</option>\n      <option name=\"UPlanFlN 20x\"\n value=\"55\">UPlanFlN 20x</option>\n      <option name=\"UPlanFlN 40x O\"\n value=\"39\">UPlanFlN 40x O</option>\n      <option name=\"UPlanFl 60x\"\n value=\"40\">UPlanFl 60x</option>\n      <option name=\"UPlanFlN 60x OI\"\n value=\"57\">UPlanFlN 60x OI</option>\n      <option name=\"UPlanSApo 100x O\"\n value=\"43\">UPlanSApo 100x O</option>\n      <option name=\"UPlanSApo 20x\"\n value=\"36\">UPlanSApo 20x</option>\n      <option name=\"UPlanSApo 40x\"\n value=\"47\">UPlanSApo 40x</option>\n      <option name=\"UPlanSApo 60x O\"\n value=\"30\">UPlanSApo 60x O</option>\n      <option name=\"UPlanSApo 60x W\"\n value=\"41\">UPlanSApo 60x W</option>\n      <option name=\"UPlanFlN 40x\"\n value=\"56\">UPlanFlN 40x</option>\n      </select>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Initialize\nauto-focus</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP2\"><img\n src=\"icons/shape_align_middle.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\">Refocus</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"1\"\n rowspan=\"1\"><button\n id=\"xPosUP2\"><img\n src=\"icons/shape_align_top.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\">Offset<br>\n      </td>\n      <td\n colspan=\"2\" rowspan=\"1\"\n style=\"background-color: rgb(255, 255, 255);\">\n<input style=\"width: 50px;\" class=\"offset required=\" min=\"0\" max=\"100000\" step=\"1\" type=\"number\" readonly>\n</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><br>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"\n colspan=\"10\" rowspan=\"1\"><br>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204); width: 241px;\"\n colspan=\"10\" rowspan=\"1\">Navigation</td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"><br>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"><img\n alt=\"\" src=\"icons/008-arrow-2B.png\"><img\n alt=\"\" src=\"icons/001-arrowB.png\"><img\n alt=\"\" src=\"icons/005-downB.png\"><img\n alt=\"\" src=\"icons/004-arrow-1B.png\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\">\n      <div style=\"text-align: left;\"><input\n style=\"width: 50px;\" class=\"res10\" onchange='updateRes10();' required=\"\"\n value=\"1\" min=\"0\" max=\"100000\" step=\"1\"\n type=\"number\"></div>\n      </td>\n      <td\n style=\"width: 50px; background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP2\"><img\n src=\"icons/007-ascending.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"width: 50px; text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"zPosUP2\"><img\n src=\"icons/007-ascendingB.png\"></button></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"><img\n alt=\"\" src=\"icons/007-ascendingB.png\"><img\n alt=\"\" src=\"icons/002-backB.png\"><img\n alt=\"\" src=\"icons/006-down-1B.png\"><img\n alt=\"\" src=\"icons/003-rightB.png\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); text-align: center;\">\n      <div style=\"text-align: left;\"><input\n style=\"width: 50px;\" class=\"res20\" onchange='updateRes20();' required=\"\"\n value=\"10\" min=\"0\" max=\"100000\" step=\"1\"\n type=\"number\"></div>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP1\"><img\n src=\"icons/008-arrow-2.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"zPosUP1\"><img\n src=\"icons/008-arrow-2B.png\"></button></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">&nbsp;</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><br>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"yPosLF2\"><img\n src=\"icons/002-back.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"yPosLF1\"><img\n src=\"icons/001-arrow.png\"></button></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><strong>X-Y</strong></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"yPosRG1\"><img\n src=\"icons/004-arrow-1.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"yPosRG2\"><img\n src=\"icons/003-right.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><strong>Z</strong></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"><img\n src=\"icons/008-arrow-2.png\"><img\n src=\"icons/001-arrow.png\"><img\n src=\"icons/005-down.png\"><img\n src=\"icons/004-arrow-1.png\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); text-align: left;\"><input\n style=\"width: 50px;\" class=\"res30\" onchange='updateRes30();' required=\"\"\n value=\"5\" min=\"0\" max=\"100000\" step=\"1\"\n type=\"number\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"xPosDW1\"><img\n src=\"icons/005-down.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"zPosDW1\"><img\n src=\"icons/005-downB.png\"></button></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"><img\n src=\"icons/007-ascending.png\"><img\n src=\"icons/002-back.png\"><img\n src=\"icons/006-down-1.png\"><img\n src=\"icons/003-right.png\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); text-align: left;\"><input\n style=\"width: 50px;\" class=\"res40\" onchange='updateRes40();' required=\"\"\n value=\"50\" min=\"0\" max=\"100000\" step=\"1\"\n type=\"number\">\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"xPosDW2\"><img\n src=\"icons/006-down-1.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"zPosDW2\"><img\n src=\"icons/006-down-1B.png\"></button></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td></td>\n      <td colspan=\"1\" rowspan=\"1\">Move\nto :&nbsp;</td>\n      <td colspan=\"7\" rowspan=\"1\">\n      <div id=\"designMove0\"></div>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"\n colspan=\"10\" rowspan=\"1\"><br>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204); width: 241px;\"\n colspan=\"10\" rowspan=\"1\">Camera\ncontrol</td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"><br>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"\n colspan=\"2\" rowspan=\"1\">Time\nexposure (ms)<br>\nTemperature<br>\nGain<br>\nInvert color<br>\nActive color mapping<br>\nBrightness and contrast<br>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"8\"\n rowspan=\"1\"><input\n style=\"width: 50px;\" class=\"timeExp0\" onchange=\"updateTimeExp0();\" required=\"\"\n min=\"0\" max=\"100000\" step=\"1\" value=\"100\"\n type=\"number\"><br>\n      <input style=\"width: 50px;\"\n class=\"temp0\" onchange=\"updateTemp0();\"  value=\" 20\" required=\"\" min=\"0\"\n max=\"100000\" step=\"1\" type=\"number\">&nbsp;\n(only for\nZyla)<br>\n      <input style=\"width: 50px;\"\n class=\"gain0\" onchange=\"updateGain0();\"  value=\"1\" required=\"\" min=\"0\"\n max=\"100000\" step=\"1\" type=\"number\"><br>\n      <select onchange='updateInvert0();' id=\"posInvert0\">\n      <option selected=\"selected\"\n value=\"OFF\">OFF</option>\n      <option value=\"ON\">ON</option>\n      </select>\n      <br>\n      <select onchange='updateMap0();' id=\"posMap0\">\n      <option value=\"OFF\">OFF</option>\n      <option selected=\"selected\"\n value=\"ON\">ON</option>\n      </select>\n      <br>\n      <select onchange='updateBC0();' id=\"posBC0\">\n      <option value=\"OFF\">OFF</option>\n      <option selected=\"selected\"\n value=\"ON\">ON</option>\n      </select>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"\n colspan=\"10\" rowspan=\"1\"><br>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204); width: 241px;\"\n colspan=\"10\" rowspan=\"1\">Functions</td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td\n style=\"text-align: left; vertical-align: top; width: 13px;\"></td>\n      <td style=\"width: 241px;\"><br>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Setting\nchannel</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\">\n      <select onchange='updateSC0();' id=\"posSC0\">\n      <option selected=\"selected\"\n value=\"BF\">BF</option>\n      <option value=\"RFP\">RFP</option>\n      <option value=\"GFP\">GFP</option>\n      <option value=\"YFP\">YFP</option>\n      </select>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"2\"\n rowspan=\"1\"><button>ON</button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"2\"\n rowspan=\"1\"><button>OFF</button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Simple\npicture</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP2\"><img\n src=\"icons/camera.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Z-stack</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP2\"><img\n src=\"icons/zstack.png\"></button></td>\n      <td\n style=\"text-align: right; background-color: rgb(255, 255, 255);\"></td>\n      <td colspan=\"2\" rowspan=\"1\"\n style=\"background-color: rgb(255, 255, 255); text-align: left;\">Start:\n      <input style=\"width: 50px;\"\n class=\"start0\" required=\"\" onchange=\"updateStart0();\"  min=\"0\" max=\"100000\"\n step=\"1\" type=\"number\"></td>\n      <td colspan=\"2\" rowspan=\"1\"\n style=\"background-color: rgb(255, 255, 255); text-align: left;\">Stop:\n      <input style=\"width: 50px;\"\n class=\"stop0\" onchange=\"updateStop0();\"  required=\"\" min=\"0\" max=\"100000\"\n step=\"1\" type=\"number\"></td>\n      <td colspan=\"3\" rowspan=\"1\"\n style=\"background-color: rgb(255, 255, 255); text-align: left;\">Step:\n      <input style=\"width: 50px;\"\n class=\"step0\" onchange=\"updateStep0();\"  required=\"\" min=\"0\" max=\"100000\"\n step=\"1\" type=\"number\"></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 0px;\"></td>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td\n style=\"text-align: center; vertical-align: middle;\">\n      <div id=\"room\"></div>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n  </tbody>\n</table>\n<hr>\n\n\n\n\n                  </div>\n\n                    <div id=\"mda\">\n                        <div id=\"name_configMda\"></div>\n                        <div id=\"available_configMda\"></div>\n                        <div id=\"available_channels_mda\"></div>\n\n                        <div id=\"available_ressources\">\n                            <span>&nbsp;&nbsp;&nbsp;Available resources and functions | drag and drop directly on the tree</span><br>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Sequence');\"><img src='icons/arrow_rotate_clockwise.png'>&nbsp;Sequence</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'BREAK');\"><img src='icons/bullet_red.png'>&nbsp;Break</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Group Position');\"><img src='icons/plugin.png'>&nbsp;Group-position</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'XYZ Position');\"><img src='icons/yxz-512.png'>&nbsp;XYZ-position</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Imaging');\"><img src='icons/image.png'>&nbsp;Imaging</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Analysis');\"><img src='icons/color_swatch.png'>&nbsp;Analysis</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'IF');\"><img src='icons/if.png'>&nbsp;IF</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Delay');\"><img src='icons/clock.png'>&nbsp;Delay</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Slack');\"><img src='icons/comments.png'>&nbsp;Slack</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'µFluidic');\"><img src='icons/uf2.png'>&nbsp;µFluidic</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'STOP');\"><img src='icons/stop.png'>&nbsp;STOP</span>\n                            &nbsp;   \n                            <button onclick=test();><img src='icons/package_go.png'>&nbsp;Create a new protocol</button>\n                            <button class='setting_button' alt='save' id=\"setting_button_save_configMda\"><img src='icons/package_link.png'>&nbsp;Save the actual protocol</button>\n                            <button class='setting_button' alt='Tooggle' id=\"setting_button_toogle\"><img src='icons/layout_content.png' >Toggle expand</button>\n                            <button onclick=test();><img src='icons/package_go.png'>&nbsp;Start the acquisition</button><br><br>\n                    \n                            <table id=\"\" class=\"table table-striped\" style=\"height: 80%;\">\n                                <tbody>\n                                    <tr>\n                                        <th style=\"width:23%;\">                \n                                            <div id='my_tree'>\n                                                <table id=\"tree\" class=\"sampletree\">\n                                                    <colgroup>\n                                                        <col><col><col style=\"width:100%\">\n                                                    </colgroup>\n                                                    <thead>\n                                                        <tr> <th></th> <th></th> <th></th> <!--<th></th> <th>Z-stacks</th> <th>Autofocus</th> <th>Save Images</th> <th>Comment</th> <th>Color</th>--> </tr>\n                                                    </thead>\n                                                    <tbody>\n                                                    <tr>\n                                                        <td class=\"alignCenter\"></td><td></td><td></td>\n                                                    </tr>\n                                                    </tbody>\n                                                </table>\n                                            </div>\n                                        </th>\n                                        <th style=\"width:25%;\">                \n                                            <div id='my_function'>\n                                                <p><span id=\"lblActive\"></span></p>\n                                                <p><span id=\"lblActiveEsttimatedTime\"></span></p>\n                                            </div>\n                                        </th>\n                                        <th style=\"width:54%;\">                \n \n<table style=\"text-align: left;\"\n border=\"0\" cellpadding=\"2\" cellspacing=\"5\">\n  <tbody>\n    <tr>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 16px;\"><br>\n      </td>\n      <td\n style=\"background-color: rgb(204, 204, 204); width: 511px;\">Live</td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 13px;\"\n colspan=\"1\" rowspan=\"1\"><br>\n      </td>\n      <td\n style=\"background-color: rgb(204, 204, 204); width: 241px;\"\n colspan=\"1\">Global\nparameters</td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\"></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 16px;\"></td>\n      <td style=\"width: 511px;\"></td>\n      <td style=\"width: 13px;\"\n colspan=\"1\" rowspan=\"1\"><br>\n      </td>\n      <td style=\"width: 241px;\"\n colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 16px;\"\n rowspan=\"21\"> </td>\n      <td\n style=\"text-align: right; vertical-align: top; width: 511px;\"\n colspan=\"1\" rowspan=\"22\">\n      <div\n style=\"text-align: right; vertical-align: top;\" id=\"content\">\n      <div\n style=\"text-align: right; vertical-align: top;\"\n class=\"content-box\"><!-- jQuery UI -->\n      <script type=\"text/javascript\"\n src=\"wPaint/lib/jquery.ui.core.1.10.3.min.js\"></script>\n      <script type=\"text/javascript\"\n src=\"wPaint/lib/jquery.ui.widget.1.10.3.min.js\"></script>\n      <script type=\"text/javascript\"\n src=\"wPaint/lib/jquery.ui.mouse.1.10.3.min.js\"></script>\n      <script type=\"text/javascript\"\n src=\"wPaint/lib/jquery.ui.draggable.1.10.3.min.js\"></script><!-- wColorPicker -->\n      <link rel=\"Stylesheet\"\n type=\"text/css\" href=\"wPaint/lib/wColorPicker.min.css\">\n      <script type=\"text/javascript\"\n src=\"wPaint/lib/wColorPicker.min.js\"></script>\n<!-- wPaint -->\n      <link rel=\"Stylesheet\"\n type=\"text/css\" href=\"wPaint/wPaint.min.css\">\n      <script type=\"text/javascript\"\n src=\"wPaint/wPaint.min.js\"></script>\n      <script type=\"text/javascript\"\n src=\"wPaint/plugins/main/wPaint.menu.main.min.js\"></script>\n      <script type=\"text/javascript\"\n src=\"wPaint/plugins/text/wPaint.menu.text.min.js\"></script>\n      <script type=\"text/javascript\"\n src=\"wPaint/plugins/shapes/wPaint.menu.main.shapes.min.js\"></script>\n      <script type=\"text/javascript\"\n src=\"wPaint/plugins/file/wPaint.menu.main.file.min.js\"></script>\n      <div id=\"wPaint\"\n style=\"position: relative;\"><iframe\n src=\"http://127.0.0.1:5000/\" frameborder=\"0\" height=\"512\"\n width=\"512\"></iframe><!--<center style=\"margin-bottom: 50px;\">\n<input value=\"toggle menu\"\nonclick=\"console.log($('#wPaint').wPaint('menuOrientation')); $('#wPaint').wPaint('menuOrientation', $('#wPaint').wPaint('menuOrientation') === 'vertical' ? 'horizontal' : 'vertical');\"\ntype=\"button\"></center>\n<center id=\"wPaint-img\"></center>-->\n      <script type=\"text/javascript\">\nvar images = [\n'/test/uploads/wPaint.png',\n];\nfunction saveImg(image) {\nvar _this = this;\nmask = image ;\nupdateImaging();\nalertmessage('Image saved successfuly !');\n}\nfunction loadImgBg (image) {\n$('#wPaint').wPaint('image', nodeParameters.data.mask);\n}\nfunction loadImgFg (image) {\n$('#wPaint').wPaint('image', nodeParameters.data.mask);\n}\n// init wPaint\n$('#wPaint').wPaint({\nmenuOffsetLeft: -35,\nmenuOffsetTop: 600,\nmenuOrientation : 'horizontal',\nsaveImg: saveImg,\nloadImgBg: loadImgBg,\nloadImgFg: loadImgFg,\nmode: 'square',\nlineWidth : '1'\n});\n      </script></div>\n      </div>\n      </div>\n      </td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Objective</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"9\"\n rowspan=\"1\">\n      <select onchange='updateAftbl();' class=\"aftbl\"\n style=\"width: 150px;\">\n      <option name=\"LCPlanFl 20x\"\n value=\"75\">LCPlanFl 20x</option>\n      <option name=\"LCPlanFl 40x\"\n value=\"76\">LCPlanFl 40x</option>\n      <option name=\"LCPlanFl 60x\"\n value=\"79\">LCPlanFl 60x</option>\n      <option name=\"LUCPlanFl 40x\"\n value=\"78\">LUCPlanFl 40x</option>\n      <option name=\"LUCPlanFlN 20x\"\n value=\"75\">LUCPlanFlN 20x</option>\n      <option name=\"LUCPlanFlN 40x\"\n value=\"76\">LUCPlanFlN 40x</option>\n      <option name=\"LUCPlanFlN 60x\"\n value=\"79\">LUCPlanFlN 60x</option>\n      <option name=\"PlanApo 100x O3\"\n value=\"31\">PlanApo 100x O3</option>\n      <option name=\"PlanApo 60x O TIRFM-SP\"\n value=\"70\">PlanApo 60x O TIRFM-SP</option>\n      <option name=\"PlanApo 60x O/LSM\"\n value=\"62\">PlanApo 60x O/LSM</option>\n      <option name=\"PlanApo 60x O3\"\n value=\"30\">PlanApo 60x O3</option>\n      <option name=\"PlanApo 40x W/LSM\"\n value=\"60\">PlanApo 40x W/LSM</option>\n      <option name=\"PlanApoN 60x O\"\n value=\"30\">PlanApoN 60x O</option>\n      <option name=\"SLCPlanFl 40x\"\n value=\"77\">SLCPlanFl 40x</option>\n      <option name=\"UApo 30x 3/340\"\n value=\"45\">UApo 30x 3/340</option>\n      <option name=\"UApo 40x 3/340\"\n value=\"47\">UApo 40x 3/340</option>\n      <option name=\"UApo 40x W\"\n value=\"48\">UApo 40x W</option>\n      <option name=\"UPlanFl 60x OI3\"\n value=\"57\">UPlanFl 60x OI3</option>\n      <option name=\"UPlanApo 20x\"\n value=\"36\">UPlanApo 20x</option>\n      <option name=\"UPlanApo 100x OI3\"\n value=\"43\">UPlanApo 100x OI3</option>\n      <option name=\"UPlanApo 40x OI3\"\n value=\"39\">UPlanApo 40x OI3</option>\n      <option name=\"UPlanApo 60x\"\n value=\"40\">UPlanApo 60x</option>\n      <option name=\"UPlanApo 60x W\"\n value=\"41\">UPlanApo 60x W</option>\n      <option name=\"UPlanApo 60x W/IR\"\n value=\"42\">UPlanApo 60x W/IR</option>\n      <option name=\"UplanFl 100x O3\"\n value=\"58\">UplanFl 100x O3</option>\n      <option name=\"UPlanFl 20x\"\n value=\"55\">UPlanFl 20x</option>\n      <option name=\"UPlanFl 40x O-SP\"\n value=\"71\">UPlanFl 40x O-SP</option>\n      <option name=\"UPlanFl 40x\"\n value=\"56\">UPlanFl 40x</option>\n      <option name=\"UPlanFlN 100x O\"\n value=\"58\">UPlanFlN 100x O</option>\n      <option name=\"UPlanFlN 100x OI\"\n value=\"58\">UPlanFlN 100x OI</option>\n      <option name=\"UPlanFlN 20x\"\n value=\"55\">UPlanFlN 20x</option>\n      <option name=\"UPlanFlN 40x O\"\n value=\"39\">UPlanFlN 40x O</option>\n      <option name=\"UPlanFl 60x\"\n value=\"40\">UPlanFl 60x</option>\n      <option name=\"UPlanFlN 60x OI\"\n value=\"57\">UPlanFlN 60x OI</option>\n      <option name=\"UPlanSApo 100x O\"\n value=\"43\">UPlanSApo 100x O</option>\n      <option name=\"UPlanSApo 20x\"\n value=\"36\">UPlanSApo 20x</option>\n      <option name=\"UPlanSApo 40x\"\n value=\"47\">UPlanSApo 40x</option>\n      <option name=\"UPlanSApo 60x O\"\n value=\"30\">UPlanSApo 60x O</option>\n      <option name=\"UPlanSApo 60x W\"\n value=\"41\">UPlanSApo 60x W</option>\n      <option name=\"UPlanFlN 40x\"\n value=\"56\">UPlanFlN 40x</option>\n      </select>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Initialize\nauto-focus</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP2\"><img\n src=\"icons/shape_align_middle.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\">Refocus</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"1\"\n rowspan=\"1\"><button\n id=\"xPosUP2\"><img\n src=\"icons/shape_align_top.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\">&nbsp;</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\">Offset<br>\n      </td>\n      <td colspan=\"2\" rowspan=\"1\"\n style=\"background-color: rgb(255, 255, 255);\">\n      <div id=\"offset\"><input\n style=\"width: 50px;\" class=\"offset required=\" min=\"0\"\n max=\"100000\" step=\"1\" type=\"number\" readonly></div>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><br>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"\n colspan=\"10\" rowspan=\"1\"><br>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204); width: 241px;\"\n colspan=\"10\" rowspan=\"1\">Navigation</td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"><br>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"><img\n alt=\"\" src=\"icons/008-arrow-2B.png\"><img\n alt=\"\" src=\"icons/001-arrowB.png\"><img\n alt=\"\" src=\"icons/005-downB.png\"><img\n alt=\"\" src=\"icons/004-arrow-1B.png\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><input\n style=\"width: 50px;\" class=\"res1\" onchange='updateRes1();' required=\"\"\n value=\"1\" min=\"0\" max=\"100000\" step=\"1\"\n type=\"number\">\n      </td>\n      <td\n style=\"width: 50px; background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP2\"><img\n src=\"icons/007-ascending.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"width: 50px; text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"zPosUP2\"><img\n src=\"icons/007-ascendingB.png\"></button></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"><img\n alt=\"\" src=\"icons/007-ascendingB.png\"><img\n alt=\"\" src=\"icons/002-backB.png\"><img\n alt=\"\" src=\"icons/006-down-1B.png\"><img\n alt=\"\" src=\"icons/003-rightB.png\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); text-align: center;\"><input\n style=\"width: 50px;\" class=\"res2\" onchange='updateRes2();' required=\"\"\n value=\"10\" min=\"0\" max=\"100000\" step=\"1\"\n type=\"number\">\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP1\"><img\n src=\"icons/008-arrow-2.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"zPosUP1\"><img\n src=\"icons/008-arrow-2B.png\"></button></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">&nbsp;</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><br>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"yPosLF2\"><img\n src=\"icons/002-back.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"yPosLF1\"><img\n src=\"icons/001-arrow.png\"></button></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><strong>X-Y</strong></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"yPosRG1\"><img\n src=\"icons/004-arrow-1.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"yPosRG2\"><img\n src=\"icons/003-right.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><strong>Z</strong></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"><img\n src=\"icons/008-arrow-2.png\"><img\n src=\"icons/001-arrow.png\"><img\n src=\"icons/005-down.png\"><img\n src=\"icons/004-arrow-1.png\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><input\n style=\"width: 50px;\" class=\"res3\" onchange='updateRes3();' required=\"\"\n value=\"5\" min=\"0\" max=\"100000\" step=\"1\"\n type=\"number\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"xPosDW1\"><img\n src=\"icons/005-down.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"zPosDW1\"><img\n src=\"icons/005-downB.png\"></button></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"><img\n src=\"icons/007-ascending.png\"><img\n src=\"icons/002-back.png\"><img\n src=\"icons/006-down-1.png\"><img\n src=\"icons/003-right.png\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); text-align: center;\"><input\n style=\"width: 50px;\" class=\"res4\" onchange='updateRes4();' required=\"\"\n value=\"50\" min=\"0\" max=\"100000\" step=\"1\"\n type=\"number\">\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"xPosDW2\"><img\n src=\"icons/006-down-1.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"zPosDW2\"><img\n src=\"icons/006-down-1B.png\"></button></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\">Move to\n: </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"9\"\n rowspan=\"1\">\n      <div id=\"designMove\"></div>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"\n colspan=\"10\" rowspan=\"1\"><br>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204); width: 241px;\"\n colspan=\"10\" rowspan=\"1\">Camera\ncontrol</td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"><br>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"\n colspan=\"2\" rowspan=\"1\">Time\nexposure (ms)<br>\nTemperature<br>\nGain<br>\nInvert color<br>\nActive color mapping<br>\nBrightness and contrast<br>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"8\"\n rowspan=\"1\"><input\n style=\"width: 50px;\" class=\"timeExp\" onchange=\"updateTimeExp();\"  required=\"\"\n min=\"0\" max=\"100000\" step=\"1\" value=\"100\"\n type=\"number\"><br>\n      <input style=\"width: 50px;\"\n class=\"temp\" onchange=\"updateTemp();\"  value=\"20\" required=\"\" min=\"0\"\n max=\"100000\" step=\"1\" type=\"number\">&nbsp;\n(only for\nZyla)<br>\n      <input style=\"width: 50px;\"\n class=\"gain\" onchange=\"updateGain();\"  value=\"1\" required=\"\" min=\"0\"\n max=\"100000\" step=\"1\" type=\"number\"><br>\n      <select onchange='updateInvert();' id=\"posInvert\">\n      <option selected=\"selected\"\n value=\"OFF\">OFF</option>\n      <option value=\"ON\">ON</option>\n      </select>\n      <br>\n      <select onchange='updateMap();' id=\"posMap\">\n      <option value=\"OFF\">OFF</option>\n      <option selected=\"selected\"\n value=\"ON\">ON</option>\n      </select>\n      <br>\n      <select onchange='updateBC();' id=\"posBC\">\n      <option value=\"OFF\">OFF</option>\n      <option selected=\"selected\"\n value=\"ON\">ON</option>\n      </select>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"\n colspan=\"10\" rowspan=\"1\"><br>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204); width: 241px;\"\n colspan=\"10\" rowspan=\"1\">Functions</td>\n      <td></td>\n    </tr>\n    <tr>\n      <td\n style=\"text-align: left; vertical-align: top; width: 13px;\"></td>\n      <td style=\"width: 241px;\"><br>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Setting\nchannel</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\">\n      <select onchange='updateSC();' id=\"posSC\">\n      <option  value=\"BF\">BF</option>\n      <option value=\"RFP\">RFP</option>\n      <option value=\"GFP\">GFP</option>\n      <option value=\"YFP\">YFP</option>\n      </select>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"2\"\n rowspan=\"1\"><button>ON</button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"2\"\n rowspan=\"1\"><button>OFF</button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Simple\npicture</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP2\"><img\n src=\"icons/camera.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Z-stack</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP2\"><img\n src=\"icons/zstack.png\"></button></td>\n      <td\n style=\"text-align: right; background-color: rgb(255, 255, 255);\"></td>\n      <td colspan=\"2\" rowspan=\"1\"\n style=\"background-color: rgb(255, 255, 255); text-align: left;\">Start:\n      <input style=\"width: 50px;\"\n class=\"start\" onchange=\"updateStart();\"  required=\"\" min=\"0\" max=\"100000\"\n step=\"1\" type=\"number\"></td>\n      <td colspan=\"2\" rowspan=\"1\"\n style=\"background-color: rgb(255, 255, 255); text-align: left;\">Stop:\n      <input style=\"width: 50px;\"\n class=\"stop\" onchange=\"updateStop();\"  required=\"\" min=\"0\" max=\"100000\"\n step=\"1\" type=\"number\"></td>\n      <td colspan=\"3\" rowspan=\"1\"\n style=\"background-color: rgb(255, 255, 255); text-align: left;\">Step:\n      <input style=\"width: 50px;\"\n class=\"step\" onchange=\"updateStep();\"  required=\"\" min=\"0\" max=\"100000\"\n step=\"1\" type=\"number\"></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 16px;\"></td>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n  </tbody>\n</table>\n\n\n\n\n\n\n                                        </th>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <script type=\"text/javascript\">\n        var images = [\n          '/test/uploads/wPaint.png',\n        ];\n\n        function saveImg(image) {\n          var _this = this;\n\n          $.ajax({\n            type: 'POST',\n            url: '/test/upload.php',\n            data: {image: image},\n            success: function (resp) {\n\n              // internal function for displaying status messages in the canvas\n              _this._displayStatus('Image saved successfully');\n\n              // doesn't have to be json, can be anything\n              // returned from server after upload as long\n              // as it contains the path to the image url\n              // or a base64 encoded png, either will work\n              resp = $.parseJSON(resp);\n\n              // update images array / object or whatever\n              // is being used to keep track of the images\n              // can store path or base64 here (but path is better since it's much smaller)\n              images.push(resp.img);\n\n              // do something with the image\n              $('#wPaint-img').attr('src', image);\n            }\n          });\n        }\n\n        function loadImgBg () {\n\n          // internal function for displaying background images modal\n          // where images is an array of images (base64 or url path)\n          // NOTE: that if you can't see the bg image changing it's probably\n          // becasue the foregroud image is not transparent.\n          this._showFileModal('bg', images);\n        }\n\n        function loadImgFg () {\n\n          // internal function for displaying foreground images modal\n          // where images is an array of images (base64 or url path)\n          this._showFileModal('fg', images);\n        }\n\n        // init wPaint\n        $('#wPaint').wPaint({\n          menuOffsetLeft: -35,\n          menuOffsetTop: -50,\n          saveImg: saveImg,\n          loadImgBg: loadImgBg,\n          loadImgFg: loadImgFg\n        });\n      </script>\n        \n        \n        \n        \n        \n        <script>window.jQuery || document.write('<script src=\"bootstrap/assets/js/vendor/jquery.min.js\"><\\/script>')</script>\n        <script src=\"bootstrap/dist/js/bootstrap.min.js\"></script>\n        <script src=\"bootstrap/assets/js/vendor/holder.min.js\"></script>\n        <script src=\"bootstrap/assets/js/ie10-viewport-bug-workaround.js\"></script>\n        <script type=\"text/javascript\">\n            $.confirm({\n                title: 'CYBERSCOPE !',\n                theme: \"supervan\",\n                content: '' +\n                '<form action=\"\" class=\"formName\">' +\n                '<div class=\"form-group\">' +\n                '<select class=\"userLog form-control\" id=\"userLog\"><option name=WilliamsB value=0>WilliamsB</option><option name=KalinaH value=1>KalinaH</option><option name=MatthiasL value=2>MatthiasL</option><option name=CélineC value=4>CélineC</option></select>'+\n                '</div>' +\n                '</form>',\n                buttons: {\n                    formSubmit: {\n                        text: 'Log in',\n                        btnClass: 'btn-blue',\n                        action: function () {\n                            var value = $('.userLog').find('option:selected').attr(\"name\");\n                            document.getElementById('name_user').innerHTML = \"User: \"+value;\n                        }\n                    }\n                },\n                onContentReady: function () {\n                    // bind to events\n                    var jc = this;\n                    this.$content.find('form').on('submit', function (e) {\n                        // if the user submits the form by pressing enter in the field.\n                        e.preventDefault();\n                        jc.$$formSubmit.trigger('click'); // reference the button and click it\n                    });\n                }\n            });\n        </script>\n    </body>\n</html>","x":430,"y":800,"wires":[["1ca919d8.2e3c36"]]},{"id":"c05256d5.243a08","type":"websocket in","z":"cb80149c.966208","name":"","server":"79f90969.395868","client":"","x":1110,"y":360,"wires":[[]]},{"id":"7fabf17e.1dc57","type":"debug","z":"cb80149c.966208","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","x":730,"y":620,"wires":[]},{"id":"141dfb9b.7ccb54","type":"http in","z":"116d4e1.f9ed6b2","name":"","url":"/mysite2","method":"get","swaggerDoc":"","x":310,"y":260,"wires":[["3b4478b3.3e8e18"]]},{"id":"76655b44.752be4","type":"http in","z":"116d4e1.f9ed6b2","name":"","url":"/mysitepost","method":"post","swaggerDoc":"","x":330,"y":460,"wires":[["7eeb7068.15fea","3fe9479.3e78eb8"]]},{"id":"3b4478b3.3e8e18","type":"function","z":"116d4e1.f9ed6b2","name":"msg.url = \"mysitepost\";","func":"msg.url = \"mysitepost\";\nmsg.name = \"Maëva\";\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":260,"wires":[["56678db9.451d54"]]},{"id":"7eeb7068.15fea","type":"debug","z":"116d4e1.f9ed6b2","name":"mysitepost","active":true,"console":"false","complete":"payload","x":970,"y":460,"wires":[]},{"id":"d4295f23.38c11","type":"http response","z":"116d4e1.f9ed6b2","name":"","statusCode":"","headers":{},"x":990,"y":420,"wires":[]},{"id":"5e0355ea.245c9c","type":"template","z":"116d4e1.f9ed6b2","name":"CSS","field":"payload.style","fieldType":"msg","format":"css","syntax":"mustache","template":"input[type=text], select {\n    width: 100%;\n    padding: 12px 20px;\n    margin: 8px 0;\n    display: inline-block;\n    border: 1px solid #ccc;\n    border-radius: 4px;\n    box-sizing: border-box;\n}\n\ninput[type=submit] {\n    width: 100%;\n    background-color: #4CAF50;\n    color: white;\n    padding: 14px 20px;\n    margin: 8px 0;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n}\n\ninput[type=submit]:hover {\n    background-color: #45a049;\n}\n\ndiv {\n    border-radius: 5px;\n    background-color: #f2f2f2;\n    padding: 20px;\n}","x":710,"y":360,"wires":[["f34056e9.0e9508"]]},{"id":"56678db9.451d54","type":"template","z":"116d4e1.f9ed6b2","name":"JavaScript","field":"payload.script","fieldType":"msg","format":"javascript","syntax":"plain","template":"$(document).ready(function(e) {\n    \n    $(\"form[ajax=true]\").submit(function(e) {\n        \n        e.preventDefault();\n        \n        var form_data = $(this).serialize();\n        var form_url = $(this).attr(\"action\");\n        var form_method = $(this).attr(\"method\").toUpperCase();\n        \n        $(\"#loadingimg\").show();\n        \n        $.ajax({\n            url: form_url, \n            type: form_method,      \n            data: form_data,     \n            cache: false,\n            success: function(returnhtml){                          \n                $(\"#result\").html(returnhtml); \n                $(\"#loadingimg\").hide();                    \n            }           \n        });    \n        \n    });\n    \n});","x":550,"y":360,"wires":[["5e0355ea.245c9c"]]},{"id":"f1959df3.f0ed6","type":"http response","z":"116d4e1.f9ed6b2","name":"","statusCode":"","headers":{},"x":990,"y":360,"wires":[]},{"id":"82b9104b.13ee7","type":"template","z":"116d4e1.f9ed6b2","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<html>\n  <head>\n    <title>My Site</title>\n    <meta name=\"viewport\" content=\"initial-scale=1.0, user-scalable=no\">\n    <meta charset=\"utf-8\">\n    <script src=\"http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js\"></script>\n    <style>{{{payload.style}}}</style>\n  </head>\n  \n    <h1>{{name}}</h1>\n    <h2>Using CSS to style an HTML form with AJAX POST and Node-RED{{{payload.essai}}}</h2>\n    <h4><a href=\"http://www.internetoflego.com\">Internet of LEGO</a></h4>\n<div>\n  <form method=\"post\" action=\"/{{url}}\" ajax=\"true\">\n    <label for=\"fname\">First Name</label>\n    <input type=\"text\" id=\"fname\" name=\"firstname\">\n\n    <label for=\"lname\">Last Name</label>\n    <input type=\"text\" id=\"lname\" name=\"lastname\">\n\n    <label for=\"country\">Country</label>\n    <select id=\"country\" name=\"country\">\n      <option value=\"uk\">United Kingdom</option>\n      <option value=\"canada\">Canada</option>\n      <option value=\"usa\">USA</option>\n    </select>\n  \n    <input type=\"submit\" value=\"Submit\">\n  </form>\n</div>\n<div>\n    <span id=\"result\"></span>\n</div>\n\n</body>\n</html>\n<script>{{{payload.script}}}</script>","x":919.7778015136719,"y":255.5555648803711,"wires":[["f1959df3.f0ed6"]]},{"id":"a09ac7a7.cc4c88","type":"comment","z":"116d4e1.f9ed6b2","name":"Login Form","info":"","x":510,"y":320,"wires":[]},{"id":"839a4b43.ef80d8","type":"function","z":"116d4e1.f9ed6b2","name":"return msg.payload to client","func":"msg.payload = 'The following data was submitted and available in the msg.payload: '+msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":720,"y":420,"wires":[["d4295f23.38c11"]]},{"id":"bc45fb3e.ce86f8","type":"comment","z":"116d4e1.f9ed6b2","name":"Inject msg object properties","info":"","x":520,"y":220,"wires":[]},{"id":"3fe9479.3e78eb8","type":"json","z":"116d4e1.f9ed6b2","name":"","property":"payload","action":"","pretty":false,"x":530,"y":420,"wires":[["839a4b43.ef80d8"]]},{"id":"1fa2d941.1430d7","type":"comment","z":"116d4e1.f9ed6b2","name":"Website","info":"","x":290,"y":180,"wires":[]},{"id":"38e08e4a.40ba22","type":"comment","z":"116d4e1.f9ed6b2","name":"Form Submission","info":"","x":320,"y":400,"wires":[]},{"id":"1b541879.116598","type":"comment","z":"116d4e1.f9ed6b2","name":"Node-RED Public Site - README","info":"This Flow demonstrates how to create\na simple frontend webpage with Node-RED.\n\nThe public facing page consists of the \nclient side JavaScript, CSS and HTML. \n\nThe important technique is how the mustache \ntemplates are used. Each template will set the\n\"property\" relative to the content. \n\nThe CSS node sets the \"msg.payload.style\" property.\nThe JavaScript node sets the \"msg.payload.script\" property.\nThe HTML node then includes these properties \n<script>{{{payload.script}}}</script>\n<style>{{{payload.style}}}</style>\n\n\nThis example was created by http://www.InternetofLEGO.com\n\n","x":620,"y":80,"wires":[]},{"id":"29f32e15.6560c2","type":"HTML-PDF","z":"116d4e1.f9ed6b2","name":"HTML-PDF","output":"file","x":759.7778015136719,"y":195.5555648803711,"wires":[["73c4f283.53f66c"]]},{"id":"73c4f283.53f66c","type":"http response","z":"116d4e1.f9ed6b2","name":"","x":1159.7778015136719,"y":155.5555648803711,"wires":[]},{"id":"b5f97fdf.e7231","type":"inject","z":"116d4e1.f9ed6b2","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":369.7778015136719,"y":95.5555648803711,"wires":[["2a7d89d9.5651d6"]]},{"id":"2a7d89d9.5651d6","type":"function","z":"116d4e1.f9ed6b2","name":"","func":"\nvar x ={ip : \"192.168.0.1\"};\nmsg.payload = x;\nreturn msg;","outputs":1,"noerr":0,"x":539.7778015136719,"y":135.5555648803711,"wires":[["e26ed2fb.f2679"]]},{"id":"e26ed2fb.f2679","type":"json","z":"116d4e1.f9ed6b2","name":"","x":679.7778015136719,"y":135.5555648803711,"wires":[["65ae2d5c.147664"]]},{"id":"65ae2d5c.147664","type":"debug","z":"116d4e1.f9ed6b2","name":"","active":false,"console":"false","complete":"false","x":909.7778015136719,"y":135.5555648803711,"wires":[]},{"id":"f34056e9.0e9508","type":"template","z":"116d4e1.f9ed6b2","name":"essai","field":"payload.essai","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{{ip}}","x":779.7778015136719,"y":275.5555648803711,"wires":[["82b9104b.13ee7","4b08f6ed.3cfb48"]]},{"id":"ce0cbcb1.f70bd","type":"function","z":"116d4e1.f9ed6b2","name":"Wait for all tasks to finish","func":"context.data = context.data || new Object();\n\nswitch (msg.topic) {\n    case \"task1\":\n        context.data.task1 = msg.payload;\n        msg = null;\n        break;\n    case \"task2\":\n        context.data.task2 = msg.payload;\n        msg = null;\n        break;\n    case \"task3\":\n        context.data.task3 = msg.payload;\n        msg = null;\n        break;\n        \n    default:\n        msg = null;\n    \tbreak;\n\n}\n\nif(context.data.task1 != null && context.data.task2 != null && context.data.task3 != null) {\n\tmsg2 = new Object();\n    msg2 = context.data;\n    context.data=null;\n\treturn msg2;\n} else return msg;","outputs":1,"noerr":0,"x":579.7778015136719,"y":615.5555648803711,"wires":[["4b08f6ed.3cfb48","f34056e9.0e9508"]]},{"id":"4b08f6ed.3cfb48","type":"debug","z":"116d4e1.f9ed6b2","name":"","active":false,"console":"false","complete":"true","x":786.7778015136719,"y":614.5555648803711,"wires":[]},{"id":"8806b1c.004735","type":"function","z":"116d4e1.f9ed6b2","name":"Task1","func":"msg.topic=\"ip\";\nmsg.payload=\"192.168.0.1\"\nreturn msg;","outputs":1,"noerr":0,"x":273.7778015136719,"y":524.5555648803711,"wires":[["ce0cbcb1.f70bd"]]},{"id":"2e845cda.eb3d74","type":"function","z":"116d4e1.f9ed6b2","name":"Task2","func":"msg.topic=\"task2\";\nmsg.payload=\"Task2's payload\"\nreturn msg;","outputs":1,"x":276.7778015136719,"y":619.5555648803711,"wires":[["ce0cbcb1.f70bd"]]},{"id":"5085e47.13ecb1c","type":"function","z":"116d4e1.f9ed6b2","name":"Task3","func":"msg.topic=\"task3\";\nmsg.payload=\"Task3's payload\"\nreturn msg;","outputs":1,"x":271.7778015136719,"y":703.5555648803711,"wires":[["ce0cbcb1.f70bd"]]},{"id":"39f6d025.bb982","type":"inject","z":"116d4e1.f9ed6b2","name":"Start","topic":"","payload":"","payloadType":"none","repeat":"","crontab":"","once":false,"x":107.77780151367188,"y":608.5555648803711,"wires":[["8806b1c.004735","2e845cda.eb3d74","5085e47.13ecb1c"]]},{"id":"7b6521b9.1babc","type":"http in","z":"cb80149c.966208","name":"","url":"/formpost","method":"post","upload":false,"swaggerDoc":"","x":150,"y":1120,"wires":[["a4c36126.13e18","4b8c912c.1dc4d"]]},{"id":"a4c36126.13e18","type":"function","z":"cb80149c.966208","name":"return msg.payload to client","func":"var obj = msg.payload;\n\nif(obj['topicpost']==='setting_channel_form'){\n    context.global.settingChannels = [] ;\n    var index = '' ;                    \n    var old_index = '' ;\n    var indexation = -1 ;\n    var namechannel = '' ;\n    var oldlid = '';\n    var oldnid = '';\n    \n    for(var key in obj){\n        if(key !== 'topicpost'){\n            var str = key.split(\"_\");\n            index = str[0];\n            if(index != old_index){ indexation = indexation + 1 ; oldlid = '';}\n            old_index = parseInt(str[0]);    \n            if(key === (index + \"_channel\")){namechannel = obj[key];}\n            if(key === (index + \"_devices\")) {\n                context.global.settingChannels[indexation] = {};   \n                context.global.settingChannels[indexation]['id'] = indexation + 1;\n                context.global.settingChannels[indexation]['name'] = namechannel;\n                var obj2 = context.global.ressources[obj[key]] ;\n                for (var key2 in obj2) if(key!=='update')context.global.settingChannels[indexation][''+key2] = obj2[key2];\n                context.global.settingChannels[indexation]['update'] = {} ;\n            }\n            if((key !== (index + \"_channel\")) && (key !== (index + \"_devices\"))){    \n                var balise = str[1];\n                var lid = balise.substr(0,1) ; //a modifier expression régulière\n                var nid = parseInt(balise.substr(1,1)) ; //a modifier expression régulière\n                if (lid !== oldlid) context.global.settingChannels[indexation]['update'][lid] = [] ;\n                oldlid = lid ;\n                context.global.settingChannels[indexation]['update'][lid][nid] = obj[key]; // = obj[key];//settingChannel = name.concat(settingChannel);\n            }\n        }\n    }\n    //msg.payload = context.global.settingChannels;\n    msg.payload = 'The settings channels data was submitted and available';\n    return [msg];\n}","outputs":1,"noerr":0,"x":410,"y":1120,"wires":[["1ca919d8.2e3c36","2d34c0a7.fbe07","c42ec656.f0d428"]]},{"id":"164a13c0.02011c","type":"function","z":"cb80149c.966208","name":"get ? set ?","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\"=\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n  // expected output: ReferenceError: nonExistantFunction is not defined\n  // Note - error messages will vary depending on browser\n}\n\nif(order[0] === 'MDA-FINISH') msg.payload = 'MDA-FINISH';\n\nif(order[0] === 'getSettingChannels') msg.payload = context.global.settingChannels;\nif(order[0] === 'getSettingChannels2') msg.payload = context.global.settingChannels;\nif(order[0] === 'listConfigChannel') msg.payload = context.global.listConfigChannel;\nif(order[0] === 'listConfigMda') msg.payload = context.global.listConfigMda;\n\n\nif(order[0] === 'updateSettingChannels') msg.payload = context.global.settingChannels;\nif(order[0] === 'getSettingChannels-MDA') msg.payload = context.global.settingChannels;\nif(order[0] === 'getRessources') msg.payload = context.global.ressources;\n\nif(order[0] === 'getMDA-mdazs_zstart_set') msg.payload = \"123\";\n\nif(order[0] === 'setMDATimepointUse') context.global.mda['timepoints']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDATimepointNumber') context.global.mda['timepoints']['number'] = parseInt(order[1]) ;\nif(order[0] === 'setMDATimepointInterval') context.global.mda['timepoints']['interval'] = parseInt(order[1]) ;\nif(order[0] === 'setMDATimepointUnity') context.global.mda['timepoints']['unity'] = (order[1]) ;\n\nif(order[0] === 'setMDAMultiplespositionsUse') context.global.mda['multiplespositions']['use'] = parseInt(order[1]) ;\n\nif(order[0] === 'setMDAZstacksUse') context.global.mda['zstacks']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAZstacksZstart') context.global.mda['zstacks']['zstart'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAZstacksZend') context.global.mda['zstacks']['zend'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAZstacksZstep') context.global.mda['zstacks']['zstep'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAZstacksType') context.global.mda['zstacks']['type'] = (order[1]) ;\nif(order[0] === 'setMDAZstacksShutter') context.global.mda['zstacks']['shutteropen'] = parseInt(order[1]) ;\n\nif(order[0] === 'setMDAAutofocusUse') context.global.mda['autofocus']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAAutofocusSkip') context.global.mda['autofocus']['skip'] = parseInt(order[1]) ;\n\nif(order[0] === 'setMDAChannelsUse') context.global.mda['channels']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAChannelsConfiguration'){\n    var config = order[1].split(\",\");\n    var id = context.global.mda['channels']['config'].length;\n    context.global.mda['channels']['config'][id] = {} ;\n    context.global.mda['channels']['config'][id]['use'] = parseInt(config[0]);\n    context.global.mda['channels']['config'][id]['exposure'] = parseInt(config[1]);\n    context.global.mda['channels']['config'][id]['zoffset'] = parseInt(config[2]);\n    context.global.mda['channels']['config'][id]['channel'] = (config[3]);\n    context.global.mda['channels']['config'][id]['zstack'] = parseInt(config[4]);\n    context.global.mda['channels']['config'][id]['skipframe'] = parseInt(config[5]);\n    context.global.mda['channels']['config'][id]['refHTML'] = parseInt(config[6]);\n}\n\nif(order[0] === 'setMDAChannelsConfigurationUse'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['use'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationExposure'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['exposure'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationZoffset'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['zoffset'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationChannel'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['channel'] = config[0];\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationZstack'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['zstack'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationSkipframe'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['skipframe'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'MDAChannelsConfigurationRemove'){\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(order[1])){\n            context.global.mda['channels']['config'].splice(i, 1);\n        }\n    }\n}\n\n\n\n\n\nif(order[0] === 'setMDASaveimagesUse') context.global.mda['saveimages']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDASaveimagesDirectory') context.global.mda['saveimages']['directory'] = (order[1]) ;\nif(order[0] === 'setMDASaveimagesPrefix') context.global.mda['saveimages']['prefix'] = (order[1]) ;\nif(order[0] === 'setMDASaveimagesFormat') context.global.mda['saveimages']['format'] = (order[1]) ;\n\nif(order[0] === 'setMDAAcquisitioncommentComment') context.global.mda['acquisitioncomment'] = (order[1]) ;\n\n\nreturn msg ;\n\n","outputs":1,"noerr":0,"x":460,"y":980,"wires":[["2d34c0a7.fbe07","753f8664.351ae8"]]},{"id":"4b8c912c.1dc4d","type":"debug","z":"cb80149c.966208","name":"","active":true,"tosidebar":false,"console":false,"tostatus":false,"complete":"payload","x":440,"y":1160,"wires":[]},{"id":"2d34c0a7.fbe07","type":"websocket out","z":"cb80149c.966208","name":"","server":"da7e8f9b.c87dc","client":"","x":770,"y":1120,"wires":[]},{"id":"5b8e613b.5bd27","type":"function","z":"cb80149c.966208","name":"Object SettingChannels","func":"context.global.settingChannels = [\n  {\n      \"id\" : 0,\n      \"name\": \"channelA\",\n      \"device\" : \"CoolLed-PE-4000\",\n      \"type\" : \"ligth-source\",\n      \"topic\" : \"fluo1\",\n      \"update\" :{\n          \"A\" : [120,100,true],\n          \"B\" : [200,40,false],\n          \"C\" : [330,80,false],\n          \"D\" : [410,10,false]\n      },\n      \"config\":{\n          \"A\" : [\"<select name='0A0' id='0A0'><option name='0A00' id='0A00' value=100>100</option>          <option name='0A01' id='0A01' value=110>110</option>           <option name='0A02' id='0A02' selected value=120>120</option>   <option name='0A03' id='0A03' value=130>130</option></select>\",          \"<input name='0A1' id='0A1' type='number' min='0' max='100' step='1' value='100'/>\",    \"<input name='0A2'  id='0A2' checked type='checkbox'/>\"],\n          \"B\" : [\"<select name='0B0' id='0B0'><option name='0B00' id='0B00' selected value=200>200</option> <option name='0B01' id='0B01' value=210>210</option>           <option name='0B02' id='0B02' value=220>220</option>            <option name='0B03' id='0B03' value=230>230</option></select>\",          \"<input name='0B1' id='0B1' type='number' min='0' max='100' step='1' value='40'/>\",     \"<input name='0B2'  id='0B2' type='checkbox'/>\"],\n          \"C\" : [\"<select name='0C0' id='0C0'><option name='0C00' id='0C00' value=300>300</option>          <option name='0C01' id='0C01' value=310>310</option>           <option name='0C02' id='0C02' value=320>320</option>            <option name='0C03' id='0C03' selected value=330>330</option></select>\", \"<input name='0C1' id='0C1' type='number' min='0' max='100' step='1' value='80'/>\",     \"<input name='0C2'  id='0C2' type='checkbox'/>\"],\n          \"D\" : [\"<select name='0D0' id='0D0'><option name='0D00' id='0D00' value=400>400</option>          <option name='0D01' id='0D01' selected value=410>410</option>  <option name='0D02' id='tD02' value=420>420</option>            <option name='0D03' id='0D03' value=430>430</option></select>\",          \"<input name='0D1' id='0D1' type='number' min='0' max='100' step='1' value='10'/>\",     \"<input name='0D2'  id='0D2' type='checkbox'/>\"]\n        }\n  },\n  {\n      \"id\" : 1,\n      \"name\" : \"channelB\",\n      \"device\" : \"X-Cite-120-PC\",\n      \"type\" : \"ligth-source\",\n      \"topic\" : \"fluo2\",\n      \"update\" :{\n          \"A\" : [365,100,true]\n      },\n      \"config\":{\n          \"A\" : [\"<input name='1A0' id='1A0' type='number'  min='0' max='100' step='1' value='365'/>\",\"<input  name='1A1' id='1A1' type='number'  min='0' max='100' step='1' value='100'/>\",\"<input  name='1A2' id='1A2' checked type='checkbox'/>\"],\n      }\n  }\n];\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":480,"wires":[[]]},{"id":"f29bd186.6c79b","type":"function","z":"cb80149c.966208","name":"Object Ressources -- afaire garce a l'ini des noeuds","func":"\ncontext.global.ressources = [\n  {\n      \"device\" : \"CoolLed-PE-4000\",\n      \"type\" : \"ligth-source\",\n      \"topic\" : \"fluo1\",\n      \"update\" :{\n          \"A\" : [120,10,\"ON\"],\n          \"B\" : [200,40,\"OFF\"],\n          \"C\" : [330,80,\"ON\"],\n          \"D\" : [410,10,\"OFF\"]\n      },\n      \"config\":{\n          \"A\" : [\"LambdaA: <select required name='%A0' id='%A0'><option value=100>100</option><option value=110>110</option><option value=120>120</option><option value=130>130</option></select>\",\"IntensityA: <input required name='%A1' id='%A1' type='number' min='0' max='100' step='1'/>\",\"ShutterA: <select required name='%A2' id='%A2'><option value=ON>ON</option><option value=OFF>OFF</option></select>\"],\n          \"B\" : [\"LambdaB: <select required name='%B0' id='%B0'><option value=200>200</option><option value=210>210</option><option value=220>220</option><option value=230>230</option></select>\",\"IntensityB: <input required name='%B1' id='%B1' type='number' min='0' max='100' step='1'/>\",\"ShutterB: <select required name='%B2' id='%B2'><option value=ON>ON</option><option value=OFF>OFF</option></select>\"],\n          \"C\" : [\"LambdaC: <select required name='%C0' id='%C0'><option value=300>300</option><option value=310>310</option><option value=320>320</option><option value=330>330</option></select>\",\"IntensityC: <input required name='%C1' id='%C1' type='number' min='0' max='100' step='1'/>\",\"ShutterC: <select required name='%C2' id='%C2'><option value=ON>ON</option><option value=OFF>OFF</option></select>\"],\n          \"D\" : [\"LambdaD: <select required name='%D0' id='%D0'><option value=400>400</option><option value=410>410</option><option value=420>420</option><option value=430>430</option></select>\",\"IntensityD: <input required name='%D1' id='%D1' type='number' min='0' max='100' step='1'/>\",\"ShutterD: <select required name='%D2' id='%D2'><option value=ON>ON</option><option value=OFF>OFF</option></select>\"]\n      }\n  },\n  {\n      \"device\" : \"X-Cite-120-PC\",\n      \"type\" : \"ligth-source\",\n      \"topic\" : \"fluo2\",\n      \"update\" :{\n          \"A\" : [35]\n      },\n      \"config\":{\n          \"A\" : [\"Intensity: <input required name='%A0'  id='%A0' type='number'  min='0' max='100' step='1' />\"],\n      }\n  },\n  {\n      \"device\" : \"Olympus-IX-81\",\n      \"type\" : \"ligth-source\",\n      \"topic\" : \"brigth-field\",\n      \"update\" :{\n          \"A\" : [5]\n      },\n      \"config\":{\n          \"A\" : [\"Int. Lamp: <input required name='%A0'  id='%A0' type='number'  min='0' max='100' step='1' />\"],\n      }\n  },\n  {\n      \"device\" : \"Evolv-512\",\n      \"type\" : \"camera\",\n      \"topic\" : \"camera1\",\n      \"update\" :{\n      },\n      \"config\":{\n      }\n  }\n\n];\n//context.global.test = [];\n","outputs":1,"noerr":0,"x":480,"y":560,"wires":[[]]},{"id":"b04c3fdb.3d97c","type":"function","z":"cb80149c.966208","name":"Object MDA","func":"context.global.mda = {\n    \"timepoints\": {\n        \"use\" : 0,\n        \"number\" : 1,\n        \"interval\" : 1,\n        \"unity\" : \"ms\"\n    },\n    \"multiplespositions\": {\n        \"use\" : 0,\n        \"param\" : []\n    },\n    \"zstacks\": {\n        \"use\" : 0 ,\n        \"zstart\" : 0,\n        \"zend\" : 10,\n        \"zstep\" : 1,\n        \"type\" : \"relative Z\",\n        \"shutteropen\" : 0\n    },\n    \"autofocus\": {\n        \"use\" : 0,\n        \"skip\" : 0\n    },\n    \"channels\": {\n        \"use\" : 0,\n        \"config\" : []\n    },\n    \"saveimages\": {\n        \"use\" : 0,\n        \"directory\" : \"\",\n        \"prefix\" : \"\",\n        \"format\" : \"separate images files\"\n    },\n    \"acquisitioncomment\" : \"\"\n};\n","outputs":1,"noerr":0,"x":350,"y":320,"wires":[[]]},{"id":"df5060c9.40c03","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":470,"y":1060,"wires":[["c42ec656.f0d428"]]},{"id":"c42ec656.f0d428","type":"function","z":"cb80149c.966208","name":"save settingChannels","func":"var test = [\n  {\n      \"id\" : 0,\n      \"name\": \"channelA\",\n      \"device\" : \"CoolLed-PE-4000\",\n      \"type\" : \"ligth-source\",\n      \"topic\" : \"fluo1\",\n      \"update\" :{\n          \"A\" : [120,100,true],\n          \"B\" : [200,40,false],\n          \"C\" : [330,80,false],\n          \"D\" : [410,10,false]\n      },\n      \"config\":{\n          \"A\" : [\"<select name='0A0' id='0A0'><option name='0A00' id='0A00' value=100>100</option>          <option name='0A01' id='0A01' value=110>110</option>           <option name='0A02' id='0A02' selected value=120>120</option>   <option name='0A03' id='0A03' value=130>130</option></select>\",          \"<input name='0A1' id='0A1' type='number' min='0' max='100' step='1' value='100'/>\",    \"<input name='0A2'  id='0A2' checked type='checkbox'/>\"],\n          \"B\" : [\"<select name='0B0' id='0B0'><option name='0B00' id='0B00' selected value=200>200</option> <option name='0B01' id='0B01' value=210>210</option>           <option name='0B02' id='0B02' value=220>220</option>            <option name='0B03' id='0B03' value=230>230</option></select>\",          \"<input name='0B1' id='0B1' type='number' min='0' max='100' step='1' value='40'/>\",     \"<input name='0B2'  id='0B2' type='checkbox'/>\"],\n          \"C\" : [\"<select name='0C0' id='0C0'><option name='0C00' id='0C00' value=300>300</option>          <option name='0C01' id='0C01' value=310>310</option>           <option name='0C02' id='0C02' value=320>320</option>            <option name='0C03' id='0C03' selected value=330>330</option></select>\", \"<input name='0C1' id='0C1' type='number' min='0' max='100' step='1' value='80'/>\",     \"<input name='0C2'  id='0C2' type='checkbox'/>\"],\n          \"D\" : [\"<select name='0D0' id='0D0'><option name='0D00' id='0D00' value=400>400</option>          <option name='0D01' id='0D01' selected value=410>410</option>  <option name='0D02' id='tD02' value=420>420</option>            <option name='0D03' id='0D03' value=430>430</option></select>\",          \"<input name='0D1' id='0D1' type='number' min='0' max='100' step='1' value='10'/>\",     \"<input name='0D2'  id='0D2' type='checkbox'/>\"]\n        }\n  }\n ];\nmsg.payload =  test.concat(context.global.settingChannels);\n//msg.payload =  context.global.settingChannels;\nif(context.global.saveConfigChannel !== '' ) msg.filename = context.global.saveConfigChannel;\n\nreturn msg ;\n\n","outputs":1,"noerr":0,"x":790,"y":1060,"wires":[["3ba95c06.a74dd4"]]},{"id":"3ba95c06.a74dd4","type":"file","z":"cb80149c.966208","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","x":1020,"y":1060,"wires":[[]]},{"id":"a28a6c34.d3063","type":"file in","z":"cb80149c.966208","name":"","filename":"","format":"utf8","chunk":false,"sendError":false,"x":660,"y":900,"wires":[["533ae4fa.60128c","7fabf17e.1dc57"]]},{"id":"62849356.22381c","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":470,"y":940,"wires":[["a28a6c34.d3063"]]},{"id":"533ae4fa.60128c","type":"function","z":"cb80149c.966208","name":"","func":"msg.payload = JSON.parse(msg.payload);\ncontext.global.settingChannels = msg.payload ;\n//msg.payload = context.global.settingChannels;\nreturn msg;","outputs":1,"noerr":0,"x":1020,"y":900,"wires":[["2d34c0a7.fbe07"]]},{"id":"f399684c.d091b8","type":"exec","z":"cb80149c.966208","command":"DIR","addpay":false,"append":"C:\\Users\\Williams\\.node-red\\lib\\config\\*.json","useSpawn":"false","timer":"","oldrc":false,"name":"","x":420,"y":1260,"wires":[["aa559e1d.98357","958e58ce.90a3f8"],["958e58ce.90a3f8"],["958e58ce.90a3f8"]]},{"id":"88f2436e.ddb9b","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":230,"y":1260,"wires":[["f399684c.d091b8"]]},{"id":"958e58ce.90a3f8","type":"debug","z":"cb80149c.966208","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1050,"y":1560,"wires":[]},{"id":"aa559e1d.98357","type":"function","z":"cb80149c.966208","name":"get ? set ?","func":"msg.payload = msg.payload.toString();\nvar reg = /\\json/;\nvar resultat = reg.test(msg.payload);\nmsg.payload = (resultat);\nreturn msg ;\n\n","outputs":1,"noerr":0,"x":580,"y":1240,"wires":[["958e58ce.90a3f8"]]},{"id":"98d63808.a30b18","type":"function","z":"cb80149c.966208","name":"load","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\n\nif(order[0] === 'LoadSettingChannelsConfiguration') {\n    context.global.saveConfigChannel = 'C:/Users/Williams/.node-red/lib/config/'+context.global.listConfigChannel[parseInt(order[1])];\n    msg.filename = context.global.saveConfigChannel ;\n    return msg ;\n}\n\nif(order[0] === 'LoadSettingMda') {\n    context.global.saveConfigMda = 'C:/Users/Williams/.node-red/lib/mda/'+context.global.listConfigMda[parseInt(order[1])];\n    msg.filename = context.global.saveConfigMda ;\n    return msg ;\n}\n\n\n\n","outputs":1,"noerr":0,"x":480,"y":900,"wires":[["a28a6c34.d3063","958e58ce.90a3f8"]]},{"id":"13f0919b.b09f2e","type":"debug","z":"cb80149c.966208","name":"","active":true,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","x":1090,"y":320,"wires":[]},{"id":"e0ca72ab.88","type":"function","z":"cb80149c.966208","name":"Sequencer Miss Marple - MDA","func":"if(false){\n    \n//if(msg.parameters['mode'] !== 'init'){\nif( (context.global.startMDA === 1) && (context.global.initialize === true)){\n    var output = {};\n    var topic = (msg.topic) ;\n    var keyWord = Object.keys(context.global.sequence)[0].substr(0,4); //sync\n    var length = Object.keys(context.global.sequence).length - 1; //longueur de l'objet json\n    \n    if( length  !== context.global.sync ){\n        if((msg.payload === 'done') /*&& (topic === context.global.sequence[keyWord+context.global.sync].device)*/){\n            context.global.sync = context.global.sync + 1 ;\n            key = Object.keys(context.global.sequence)[context.global.sync];\n        }\n        output.payload = context.global.sequence[keyWord+context.global.sync].topic;\n        output.topic = context.global.sequence[keyWord+context.global.sync].topic;\n        output.device = context.global.sequence[keyWord+context.global.sync].device;\n        output.parameters = context.global.sequence[keyWord+context.global.sync];\n        delete output.parameters.device;\n        delete output.parameters.topic;\n        return [output];\n    }\n    else {context.global.startMDA = 0; context.global.sync=0;}    \n}\n\n}","outputs":1,"noerr":0,"x":3750,"y":260,"wires":[[]]},{"id":"59b6e457.29d87c","type":"link out","z":"cb80149c.966208","name":"output_cam","links":["2e57212f.297fce","66fdc750.1163a8","1bb85def.9475f2"],"x":2895,"y":380,"wires":[]},{"id":"2e57212f.297fce","type":"link in","z":"cb80149c.966208","name":"input_cam","links":["59b6e457.29d87c","c0d9a069.ab39c"],"x":2135,"y":760,"wires":[["53eab063.b255d","bace8a16.5d18c8","16638acb.b95075","1dd25af4.d9ac15","8c5d29ac.1b7c48","657c5962.be6f98","f83a8755.6ebcb8"]]},{"id":"f8201b4d.b43878","type":"delay","z":"cb80149c.966208","name":"","pauseType":"delay","timeout":"0.2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":4050,"y":500,"wires":[[]]},{"id":"68647a9d.492fb4","type":"comment","z":"cb80149c.966208","name":"ST/ST","info":"","x":4030,"y":380,"wires":[]},{"id":"2655b295.3b4e1e","type":"function","z":"cb80149c.966208","name":"name_grab","func":"if(msg.mode === 'MDA'){\n    if (msg.parameters.name.substr(0,4)==='grab'){\n        msg.payload = msg.parameters.name ;\n        return msg;\n    }\n}","outputs":1,"noerr":0,"x":3690,"y":580,"wires":[[]]},{"id":"e12e2817.d069c8","type":"function","z":"cb80149c.966208","name":"START","func":"context.global.startMDA = 1 ;\ncontext.global.checkFinish = 0 ;","outputs":1,"noerr":0,"x":4040,"y":420,"wires":[[]]},{"id":"90471aad.219f28","type":"debug","z":"cb80149c.966208","name":"","active":true,"tosidebar":true,"console":true,"tostatus":true,"complete":"true","x":4070,"y":700,"wires":[]},{"id":"86e3beed.f0099","type":"ressources","z":"cb80149c.966208","topic":"ressources for MDA microscopy","x":3750,"y":300,"wires":[["51dbf5c8.ddc78c"]]},{"id":"51dbf5c8.ddc78c","type":"function","z":"cb80149c.966208","name":"toGlobal","func":"context.global.ressources = msg;\ncontext.global.initialize = true ;\n    \t","outputs":1,"noerr":0,"x":3980,"y":300,"wires":[[]]},{"id":"fb96e8d8.3431c8","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":3700,"y":700,"wires":[["14fc9190.6d1e5e"]]},{"id":"14fc9190.6d1e5e","type":"function","z":"cb80149c.966208","name":"ressources","func":"msg.payload = context.global.ressources;\nreturn msg;","outputs":1,"noerr":0,"x":3870,"y":700,"wires":[["90471aad.219f28"]]},{"id":"6e87ad65.84c384","type":"function","z":"cb80149c.966208","name":"wait for all devices are initilized","func":"function verifyIsTopicExists(ressources,topic){\n    if(ressources.length !==0){\n        var verify = false ;\n        for(var i=0; i<ressources.length;i++){\n            if(ressources[i]['topic']===topic){ verify = true ; return i;}\n        }\n        if(verify ===false) return (-1);\n    }\n    else return (-1) ;\n}\n\n\nif(msg.mode === 'init'){\n    \n    context.data = context.data || new Object();\n    context.global.ressources = context.global.ressources || [];\n    \n    var verify = verifyIsTopicExists(context.global.ressources,msg.topic) ;\n    \n    switch (msg.topic) {\n        case \"Fluorescence1\":\n            context.data.task1 = msg.device;\n            context.global.Fluorescence1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;\n        case \"MotionStage1\":\n            context.data.task2 = msg.device;\n            context.global.MotionStage1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;\n        case \"Microscope1\":\n            context.data.task3 = msg.device;\n            context.global.Microscope1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;\n        case \"Mosaic1\":\n            context.data.task4 = msg.device;\n            context.global.Mosaic1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;\n        case \"Camera1\":\n            context.data.task5 = msg.device;\n            context.global.Camera1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;\n        case \"Fluorescence2\":\n            context.data.task6 = msg.device;\n            context.global.Fluorescence2 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;\n        default:\n            msg = null;\n        \tbreak;\n    \n    }\n    \n    if(context.data.task1 != null && context.data.task2 != null && context.data.task3 != null && context.data.task4 != null && context.data.task5 != null && context.data.task6 != null) {\n    \tmsg2 = new Object();\n        msg2 = context.data;\n        msg2.payload = \"Initialisation >>> DONE :-)\";\n        context.global.initialize = true ;\n        context.data=null;\n    \treturn msg2;\n    } else return msg;\n}","outputs":1,"noerr":0,"x":2730,"y":700,"wires":[[]]},{"id":"3e24b8df.836ea8","type":"PhotometricsEvolv512","z":"cb80149c.966208","name":"","x":2370,"y":420,"wires":[["6e87ad65.84c384","83f36ecf.e2c38"]]},{"id":"908f8c51.1898","type":"function","z":"cb80149c.966208","name":"initialize","func":"msg.payload = context.global.initialize ;\nreturn msg;","outputs":1,"noerr":0,"x":3880,"y":740,"wires":[["90471aad.219f28"]]},{"id":"629773bc.d05ecc","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":3700,"y":740,"wires":[["908f8c51.1898"]]},{"id":"53eab063.b255d","type":"CoolLedPe4000","z":"cb80149c.966208","name":"PE-4000","topic":"drive the PE-4000","x":2380,"y":700,"wires":[["6e87ad65.84c384","ac0464d2.d7a6a8","83f36ecf.e2c38"]]},{"id":"2d2d269.9cf84da","type":"AndorMosaic3","z":"cb80149c.966208","name":"","x":2370,"y":640,"wires":[["6e87ad65.84c384","ac0464d2.d7a6a8","83f36ecf.e2c38"]]},{"id":"3a4eac6d.b7be14","type":"function","z":"cb80149c.966208","name":"Object sequencer 2","func":"context.global.sequence2 = {\n    \"0\" : \n        [\n            [{\n            'topic' : 'MotionStage1',\n            'device' : context.global.MotionStage1,\n            'action' : 'set',\n            'mode' : 'MDA',\n            'x': 1365,\n            'y': 3420,\n            }],\n            [{\n            'topic' : 'Camera1',\n            'device' : context.global.Camera1,\n            'action' : 'GRAB'\n            }]\n        ]\n}\nmsg.payload = context.global.sequence2;\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":280,"wires":[[]]},{"id":"ac0464d2.d7a6a8","type":"function","z":"cb80149c.966208","name":"Sequencer 2 Miss Marple - MDA","func":"node.status ({fill:\"green\",shape:\"dot\", text: \"request\"});\nif( (context.global.startMDA === 1) && (context.global.initialize === true)){\n    node.status ({fill:\"yellow\",shape:\"dot\", text: context.global.sync2+\"-\"+context.global.sync3+\"--\"+context.global.finish+\"-\"+context.global.checkFinish});\n    var length = context.global.sequence2[context.global.sync2].length ;\n    if( length  !== context.global.sync3 ){\n        var order = context.global.sequence2[context.global.sync2];\n        if(msg.payload === 'done'){\n            context.global.checkFinish = context.global.checkFinish + 1 ;\n            node.status ({fill:\"red\",shape:\"dot\", text: context.global.sync2+\"-\"+context.global.sync3+\"--\"+context.global.finish+\"-\"+context.global.checkFinish});\n            if(context.global.checkFinish === context.global.finish){\n                context.global.checkFinish = 0 ;\n                if(order.length !==1) {\n                    context.global.finish = order[context.global.sync3].length ; // nombre d'instructions dans la branche la plus profonde de l'object sequencer\n                    for(var i=0;i<order[context.global.sync3].length;i++){ node.send(order[context.global.sync3][i]);}\n                }\n                else{ \n                    node.send(order[context.global.sync3]) ;\n                    context.global.finish = 1 ;\n                }\n                context.global.sync3 = context.global.sync3 + 1 ;\n            }\n        }\n        else{\n            if(order.length !==1) {\n                context.global.finish = order[context.global.sync3].length ; // nombre d'instructions dans la branche la plus profonde de l'object sequencer\n                for(var i=0;i<order[context.global.sync3].length;i++){ node.send(order[context.global.sync3][i]);}\n            }\n            else { \n                context.global.finish = 1 ;\n                node.send(order[context.global.sync3]) ;\n            }\n            context.global.sync3 = context.global.sync3 + 1 ;\n        }\n    }\n} ","outputs":1,"noerr":0,"x":2730,"y":380,"wires":[["59b6e457.29d87c","e7edb993.338178"]],"icon":"node-red/trigger.png"},{"id":"774fbd7b.383994","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":3700,"y":780,"wires":[["1dfd1e61.6c7522"]]},{"id":"1dfd1e61.6c7522","type":"function","z":"cb80149c.966208","name":"sequence2","func":"msg.payload = context.global.sequence2;\nreturn msg;","outputs":1,"noerr":0,"x":3890,"y":780,"wires":[["90471aad.219f28"]]},{"id":"65835391.a4004c","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":3700,"y":820,"wires":[["beb4011a.e4db1"]]},{"id":"beb4011a.e4db1","type":"function","z":"cb80149c.966208","name":"sync2","func":"context.global.sync2 = context.global.sync2 + 1;\ncontext.global.sync3 = 0 ;\nreturn msg;","outputs":1,"noerr":0,"x":3870,"y":820,"wires":[["90471aad.219f28"]]},{"id":"e3ecb0d5.bf5d3","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":3700,"y":860,"wires":[["b956bdab.9ccea"]]},{"id":"b956bdab.9ccea","type":"function","z":"cb80149c.966208","name":"sync3","func":"context.global.sync3 = context.global.sync3 + 1;\ncontext.global.sync4 = 0 ;\nreturn msg;","outputs":1,"noerr":0,"x":3870,"y":860,"wires":[["90471aad.219f28"]]},{"id":"a2373890.2d7e98","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":3700,"y":900,"wires":[["1609c56f.71960b"]]},{"id":"1609c56f.71960b","type":"function","z":"cb80149c.966208","name":"sync4","func":"context.global.sync4 = context.global.sync4 + 1;\nreturn msg;","outputs":1,"noerr":0,"x":3870,"y":900,"wires":[["90471aad.219f28"]]},{"id":"f3291786.d6a708","type":"function","z":"cb80149c.966208","name":"","func":"msg = {} ;\nmsg.payload = \"RUN\" ;\n\ncontext.global.sync2  =  0 ;\nnode.send(msg);","outputs":1,"noerr":0,"x":3830,"y":460,"wires":[["e12e2817.d069c8","f8201b4d.b43878"]]},{"id":"188167c1.4539f8","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":3680,"y":460,"wires":[["f3291786.d6a708"]]},{"id":"b72132a6.1d9cf","type":"function","z":"cb80149c.966208","name":"","func":"msg = {} ;\nmsg.payload = \"RUN\" ;\n\ncontext.global.sync2 =  20 ;\ncontext.global.sync3 = 0;\nnode.send(msg);","outputs":1,"noerr":0,"x":3830,"y":500,"wires":[["f8201b4d.b43878"]]},{"id":"ed3d2ad6.5be6c8","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":3680,"y":500,"wires":[["b72132a6.1d9cf"]]},{"id":"f85b62f5.508b3","type":"function","z":"cb80149c.966208","name":"sequencer2 key","func":"if(msg.payload === 'MDA-START'){\n    context.global.startMDA = 1 ;\n    context.global.checkFinish = 0 ;\n    \n    node.status ({fill:\"green\",shape:\"dot\", text: \"START\"});\n    //else node.status ({fill:\"red\",shape:\"dot\", text: \"\"}); \n    \n    for(var key in context.global.sequence2) {\n        sendCMD(key,context.global.sequence2[key]);\n    }\n}\nif(msg.payload === 'MDA-FINISH'){\n    node.status ({text: \"waiting start ...\"});\n}\n\nfunction sendCMD(key,data){\n    var msg = {} ;\n    msg.payload = \"RUN:\"+data;\n    setTimeout(function(){\n        context.global.sync2 = key;\n        context.global.sync3 = 0;\n        node.send(msg);\n    },parseInt(key) * 60000);\n}\n","outputs":1,"noerr":0,"x":2360,"y":180,"wires":[[]]},{"id":"f02e588e.05eb38","type":"inject","z":"cb80149c.966208","name":"START","topic":"","payload":"MDA-START","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2110,"y":200,"wires":[["bace8a16.5d18c8","c9c2d993.9b2278","657c5962.be6f98"]]},{"id":"67d88f34.94468","type":"template","z":"cb80149c.966208","name":"","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"utf-8\">\n    <title>jQuery maphilight documentation</title>\n    <script type=\"text/javascript\" src=\"https://code.jquery.com/jquery-3.3.1.min.js\"></script>\n    <script type=\"text/javascript\" src=\"../jquery.maphilight.js\"></script>\n    <script>$(function() {\n        $('.map').maphilight({\n            fillColor: '008800'\n        });\n        $('#hilightlink').mouseover(function(e) {\n            $('#square2').mouseover();\n        }).mouseout(function(e) {\n            $('#square2').mouseout();\n        }).click(function(e) { e.preventDefault(); });\n        $('#starlink').click(function(e) {\n            e.preventDefault();\n            var data = $('#star').data('maphilight') || {};\n            data.neverOn = !data.neverOn;\n            $('#star').data('maphilight', data);\n        });\n        $('#star,#starlink2').click(function(e) {\n            e.preventDefault();\n            var data = $('#star').mouseout().data('maphilight') || {};\n            data.alwaysOn = !data.alwaysOn;\n            $('#star').data('maphilight', data).trigger('alwaysOn.maphilight');\n        });\n    });</script>\n</head>\n<body>\n<h1>Assorted features</h1>\n<p>This is an assortment of feature-demonstrations.</p>\n<p>\n<img src=\"demo_features.png\" width=\"300\" height=\"301\" class=\"map\" usemap=\"#features\">\n<map name=\"features\">\n    <area id=\"arrow\" shape=\"poly\" style=\"display:none;\" coords=\"211,3,121,67,112,53,95,103,146,108,136,92,229,25\" href=\"#\" alt=\"arrow\">\n    <area id=\"star\" shape=\"poly\" coords=\"78,83,70,100,52,104,64,115,61,133,78,124,94,133,91,116,104,102,87,101,79,88\" href=\"#\" alt=\"star\" class=\"group\" data-maphilight='{\"strokeColor\":\"0000ff\",\"strokeWidth\":5,\"fillColor\":\"ff0000\",\"fillOpacity\":0.6}'>\n    <area id=\"square1\" shape=\"poly\" coords=\"248,126,222,150,202,122,233,105,239,118,249,125,250,128\" href=\"#\" alt=\"a square\" data-maphilight='{\"alwaysOn\":true,\"stroke\":false}'>\n    <area id=\"square2\" shape=\"poly\" coords=\"151,249,175,225,182,222,167,193,136,221,153,250\" href=\"#\" alt=\"another square\" class=\"group\" data-maphilight='{\"groupBy\":\".group\"}'>\n    <area id=\"shadowed\" shape=\"rect\" coords=\"250,250,290,290\" href=\"#\" alt=\"Shadow for some\" data-maphilight='{\"fillColor\":\"00ff00\",\"shadow\":true,\"shadowBackground\":\"ffffff\",\"alwaysOn\":true}'>\n</map>\n</p>\n<p>Features:</p>\n    <ul>\n        <li>The star uses a <code>data-maphilight</code> attribute to adjust how it looks</li>\n        <li>The right-hand square uses a <code>data-maphilight</code> attribute to always be visible, to have no border, and to have a greenish fill</li>\n        <li>The lower-left square is linked to the star using groupBy. When you mouse over it the star will hilight as well.</li>\n        <li>The lower-right square has a shadow.</li>\n        <li><a id=\"hilightlink\" href=\"#\">Mouse over this to trigger a hilight from an external element!</a></li>\n        <li><a id=\"starlink\" href=\"#\">Click this to toggle whether or not the star will hilight</a></li>\n        <li><a id=\"starlink2\" href=\"#\">Click this to toggle whether or not the star is always hilighted; or click the star itself</a></li>\n    </ul>\n<small>The image is <a href=\"http://www.openclipart.org/detail/3325\">Ruffled Map by midkiffaries</a></small><br/>\n<a href=\"./\">Back to the index</a>\n</body>\n</html>","output":"str","x":870,"y":800,"wires":[["4fc6a7f.59e3b58"]]},{"id":"c38141bd.92ee6","type":"http in","z":"cb80149c.966208","name":"","url":"/map","method":"get","upload":false,"swaggerDoc":"","x":610,"y":720,"wires":[["67d88f34.94468"]]},{"id":"4fc6a7f.59e3b58","type":"http response","z":"cb80149c.966208","name":"","statusCode":"","headers":{},"x":1110,"y":720,"wires":[]},{"id":"362f9069.c410b","type":"function","z":"cb80149c.966208","name":"loadmsg.payload","func":"if(msg.payload==='www') return msg ;\n\n\n","outputs":1,"noerr":0,"x":420,"y":760,"wires":[["2d34c0a7.fbe07","7fabf17e.1dc57"]]},{"id":"218c17e9.ab2e68","type":"websocket in","z":"cb80149c.966208","name":"","server":"da7e8f9b.c87dc","client":"","x":1790,"y":920,"wires":[["4b5cfb86.1b5074","3d76617c.59f4be","b44d17f3.7e3218","8a14bd8a.cd608","214c2af.76f8ad6","860c0e33.38f85","659a5e24.685e"]]},{"id":"4b5cfb86.1b5074","type":"function","z":"cb80149c.966208","name":"fancyTree switch MODIF 1","func":"context.global.sendDataLive = {} ;\nvar order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\nvar output = {} ;\nif(order[0] === 'getValueXYZ'){\n    context.global.sendDataLiveLg = 3 ;\n    output.payload =  context.global.MotionStage1;\n    output.topic = 'MotionStage1';\n    output.device =  context.global.MotionStage1;\n    output.mode = 'live';\n    output.action = 'getAll';\n    node.send(output);\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'getZposition';\n    node.send(output);\n}\nif(order[0] === 'tryAutoFocus'){\n    context.global.sendDataLiveLg = 2 ;\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'autoFocus';\n    node.send(output);\n}\nif(order[0] === 'getAutofocus'){\n    context.global.sendDataLiveLg = 2 ;\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'getAll';\n    node.send(output);\n}\n","outputs":1,"noerr":0,"x":2040,"y":840,"wires":[["16638acb.b95075","1dd25af4.d9ac15","8c5d29ac.1b7c48"]],"icon":"node-red/application_side_tree.png"},{"id":"2deca699.f8b0fa","type":"websocket out","z":"cb80149c.966208","name":"","server":"da7e8f9b.c87dc","client":"","x":3020,"y":820,"wires":[]},{"id":"af45d040.35ff9","type":"function","z":"cb80149c.966208","name":"for setting live","func":"//if(Object.keys(context.global.sendDataLive).length !== 0){\n        if(msg.mode === 'live'){\n        //context.global.sendDataLive.push(msg.update);\n        \n        for(var key in msg.update){\n            context.global.sendDataLive[key] = msg.update[key];    \n        }\n        if(Object.keys(context.global.sendDataLive).length === context.global.sendDataLiveLg){\n            var msg = {};\n            msg.payload = context.global.sendDataLive ;\n            node.send(msg);\n            context.global.sendDataLive = {} ;\n        } \n    }\n//}","outputs":1,"noerr":0,"x":2540,"y":740,"wires":[["2deca699.f8b0fa","860c0e33.38f85"]]},{"id":"16638acb.b95075","type":"OlympusIx81","z":"cb80149c.966208","name":"","x":2390,"y":760,"wires":[["ac0464d2.d7a6a8","6e87ad65.84c384","af45d040.35ff9","83f36ecf.e2c38","860c0e33.38f85"]]},{"id":"3d76617c.59f4be","type":"function","z":"cb80149c.966208","name":"create config channel","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\nvar output = {} ;\nif(order[0] === 'configChannels'){\n    context.global.saveConfigChannel = 'C:/Users/Williams/.node-red/lib/config/'+order[1]+\".json\" ;\n    output.filename =  context.global.saveConfigChannel;\n    output.payload =  \"create\";\n    context.global.listConfigChannel.push(order[1]+\".json\");\n    node.send(output);\n}","outputs":1,"noerr":0,"x":2020,"y":880,"wires":[["4589e0f7.c91fc"]]},{"id":"4589e0f7.c91fc","type":"file","z":"cb80149c.966208","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","x":2350,"y":880,"wires":[[]]},{"id":"ad8abd92.4ea1d","type":"file in","z":"cb80149c.966208","name":"","filename":"C:\\Users\\Williams\\.node-red\\lib\\config\\list.txt","format":"utf8","chunk":false,"sendError":false,"x":450,"y":360,"wires":[["244913c.38141ec"]]},{"id":"244913c.38141ec","type":"function","z":"cb80149c.966208","name":"Initialisation","func":"context.global.listConfigChannel = msg.payload.split(\";\");\n//context.global.initialize = false ;\n//context.global.ressources = [] ;\n\n//context.global.test = [];\n","outputs":1,"noerr":0,"x":730,"y":360,"wires":[[]]},{"id":"b44d17f3.7e3218","type":"function","z":"cb80149c.966208","name":"extend config channel","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\nvar output = {} ;\nif(order[0] === 'configChannels'){\n    output.payload = \";\"+order[1]+\".json\";\n    node.send(output);\n}","outputs":1,"noerr":0,"x":2020,"y":920,"wires":[["fe963ba4.3d9428"]]},{"id":"fe963ba4.3d9428","type":"file","z":"cb80149c.966208","name":"","filename":"C:\\Users\\Williams\\.node-red\\lib\\config\\list.txt","appendNewline":false,"createDir":true,"overwriteFile":"false","x":2470,"y":920,"wires":[[]]},{"id":"65d3917.0dcdf7","type":"json","z":"cb80149c.966208","name":"","property":"payload","action":"","pretty":false,"x":250,"y":640,"wires":[["ce439721.774368","e381bc1c.e5ad8"]]},{"id":"e381bc1c.e5ad8","type":"debug","z":"cb80149c.966208","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":370,"y":700,"wires":[]},{"id":"29f34be5.fca424","type":"function","z":"cb80149c.966208","name":"","func":"var mda = msg.payload ;\nvar test = {} ;\ntry {\n    if(mda['type'] === 'mda'){\n        //repeat sequence\n        for(var i=0; i<parseInt(mda.children[0].children[0].data.repeat);i++)\n            test[String(i*parseInt(mda.children[0].children[0].data.time*1000*60))] = [] ;\n            node.warn(mda.children[0].children[0].length);\n        \n        for(var i=0; i<mda.children[0].children[0].length;i++){\n            test[i] = [] ;\n            node.warn('push');\n            test.push(//go to position x et y \n                {\n                'topic' : 'MotionStage1',\n                'device' : context.global.MotionStage1,\n                'action' : 'set',\n                'mode' : 'MDA',\n                'xPosition': parseInt(mda.children[0].children[0].children[i].data.xPosition),\n                'yPosition': parseInt(mda.children[0].children[0].children[i].data.yPosition),\n                },//go to z position + filter\n                {\n                'topic' : 'Microscope1',\n                'device' : context.global.Microscope1,\n                'action' : 'setZPosition',\n                'mode' : 'MDA',\n                'zPosition': parseInt(mda.children[0].children[0].children[i].data.zPosition),\n                },//set wheel filter\n                {\n                'topic' : 'Microscope1',\n                'device' : context.global.Microscope1,\n                'action' : 'setWheelFilter',\n                'mode' : 'MDA',\n                'wheelFilter': parseInt(mda.children[0].children[0].children[i].children[i*2].data.wheel),\n                });//set Ligth\n            for(var l=1; l<context.global.settingChannels.length; l++){\n                if(context.global.settingChannels[l].name === mda.children[0].children[0].children[i].children[i*2].data.title2){\n                    //XCITE\n                    if(context.global.settingChannels[l].device === \"X-Cite-120PC\"){\n                        test.push({\n                            'topic' : context.global.settingChannels[l].topic,\n                            'device' : context.global.settingChannels[l].device,\n                            'action' : 'set',\n                            'mode' : 'MDA',\n                            'update' : {\n                                'intensity': parseInt(context.global.settingChannels[l].update.A[0]),\n                                'shutter': true\n                            }\n                        });\n                    }\n                    //COOLLED\n                    if(context.global.settingChannels[l].device === \"CoolLed-PE-4000\"){\n                        test.push({\n                            'topic' : context.global.settingChannels[l].topic,\n                            'device' : context.global.settingChannels[l].device,\n                            'action' : 'set',\n                            'mode' : 'MDA',\n                            'update' : {\n                                \"A\" :[parseInt(context.global.settingChannels[l].update.A[0]),parseInt(context.global.settingChannels[l].update.A[1]),context.global.settingChannels[l].update.A[0] == \"ON\" ? true : false],\n                                \"B\" :[parseInt(context.global.settingChannels[l].update.B[0]),parseInt(context.global.settingChannels[l].update.B[1]),context.global.settingChannels[l].update.B[0] == \"ON\" ? true : false],\n                                \"C\" :[parseInt(context.global.settingChannels[l].update.C[0]),parseInt(context.global.settingChannels[l].update.C[1]),context.global.settingChannels[l].update.C[0] == \"ON\" ? true : false],\n                                \"D\" :[parseInt(context.global.settingChannels[l].update.D[0]),parseInt(context.global.settingChannels[l].update.D[1]),context.global.settingChannels[l].update.D[0] == \"ON\" ? true : false]\n                            }\n                        });\n                    }\n                    //BF\n                }\n            }\n            //picture\n            \n        }\n        \n    }\n        //msg.payload = test ;\n        return msg;\n}\ncatch(error){}\n","outputs":1,"noerr":0,"x":190,"y":580,"wires":[[]]},{"id":"e81f4432.d25988","type":"websocket in","z":"cb80149c.966208","name":"","server":"13d119a.59502e6","client":"","x":2120,"y":480,"wires":[["3eb28054.2843"]]},{"id":"f6b45637.8cbd88","type":"websocket out","z":"cb80149c.966208","name":"","server":"bf3e3ec9.46395","client":"","x":2710,"y":520,"wires":[]},{"id":"1dd25af4.d9ac15","type":"function","z":"cb80149c.966208","name":"Camera send","func":"if(msg.device === 'PHOTOMETRICS-EVOLV-512'){\n    //ici msg.payload = timestamp\n    //msg.payload =  \"GRAB,PREFIX,POSITION,CHANNELS,\"+Date.now();\n    if(msg.action === 'GRAB'){\n        msg.payload =  'GRAB,'+msg.prefixe+','+msg.position+','+msg.channel+','+Date.now();\n        return msg;\n    }\n}    \n","outputs":1,"noerr":0,"x":2360,"y":520,"wires":[["f6b45637.8cbd88"]],"icon":"node-red/camera.png"},{"id":"3eb28054.2843","type":"function","z":"cb80149c.966208","name":"Camera rec.","func":"if(msg.paylad !== 'STOP'){\n    data = msg.payload;\n    var msg = {};\n    msg.topic = \"Camera1\";\n    msg.payload = \"done\";\n    msg.action = 'GRAB' ;\n    msg.device = 'PHOTOMETRICS-EVOLV-512';\n    msg.update ={'name': data};\n    msg.status = {\"SUCCESS\" : Date.now()};\n    node.send(msg);\n}","outputs":1,"noerr":0,"x":2370,"y":480,"wires":[["ac0464d2.d7a6a8","83f36ecf.e2c38","59e19566.4a551c"]],"icon":"node-red/camera.png"},{"id":"c9c2d993.9b2278","type":"pythonshell in","z":"cb80149c.966208","pyfile":"C:/Users/Williams/Desktop/node-red-contrib-photometrics-evolv-512/PhotometricsEvolv512/test2.py","x":2360,"y":320,"wires":[[]],"icon":"node-red/camera.png"},{"id":"19665c21.861374","type":"comment","z":"cb80149c.966208","name":"start | EVOL512","info":"","x":2540,"y":320,"wires":[]},{"id":"45228668.2bcb68","type":"comment","z":"cb80149c.966208","name":"grab | stop | EVOL512","info":"","x":2940,"y":520,"wires":[]},{"id":"8c5d29ac.1b7c48","type":"PriorProScan","z":"cb80149c.966208","name":"","x":2370,"y":580,"wires":[["af45d040.35ff9","6e87ad65.84c384","ac0464d2.d7a6a8","83f36ecf.e2c38"]]},{"id":"cebf58.c67270a8","type":"file","z":"cb80149c.966208","name":"","filename":"testWILL.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":2790,"y":580,"wires":[[]],"icon":"node-red-node-watson/ConceptInsights.png"},{"id":"83f36ecf.e2c38","type":"function","z":"cb80149c.966208","name":"conv.","func":"if(context.global.startMDA === 1){\n    if(msg.payload !== 'MDA-FINISH'){\n        msg.payload = msg.device+\",\"+Date.now();\n        return msg;\n    }\n}","outputs":1,"noerr":0,"x":2650,"y":580,"wires":[["cebf58.c67270a8"]]},{"id":"eeec302c.55c53","type":"comment","z":"cb80149c.966208","name":"MODIFICATIONS","info":"**1ère modification:**\n\n-Il s'agit du timeout; il faut envoyer un message à l'allumage et à l'extinction du setChannel en veillant\nà avoir msg.action = '' dans le noeud.\nDans le sequencer mettre if(msg.action !== 'timeout')\n\n**2ème modification**\n-Websocket avec la camèra pour l'instant; il faut impérativement générer les messages \nd'entrées et de sorties du noeud sans quoi le MDA ne fonctionnera pas\n\n[Lundi 21/01]\n1. tester le timeout sur IX-81, COOL-LED et X-CITE\n2. Injecter les modifs","x":1900,"y":200,"wires":[]},{"id":"caf88a20.f0d638","type":"comment","z":"cb80149c.966208","name":"journal Log","info":"","x":2940,"y":580,"wires":[]},{"id":"b271d330.2407b","type":"comment","z":"cb80149c.966208","name":"initialize","info":"","x":2930,"y":700,"wires":[]},{"id":"bd31834d.6e387","type":"comment","z":"cb80149c.966208","name":"send to page html","info":"","x":3090,"y":760,"wires":[]},{"id":"83b46b2c.158b98","type":"comment","z":"cb80149c.966208","name":"sequencer","info":"","x":2980,"y":380,"wires":[]},{"id":"1bb85def.9475f2","type":"link in","z":"cb80149c.966208","name":"input_cam","links":["59b6e457.29d87c","c0d9a069.ab39c"],"x":2615,"y":640,"wires":[["83f36ecf.e2c38"]]},{"id":"657c5962.be6f98","type":"function","z":"cb80149c.966208","name":"start MDA time Order","func":"if(msg.payload === 'MDA-START'){\n    context.global.startMDA = 1 ;\n    context.global.checkFinish = 0 ;\n    global.set('scanTime',0) ;\n    //msg.payload = String(0) ;\n    context.global.sync2 = String(0);\n    context.global.sync3 = 0;\n    msg.payload = context.global.sequence2[String(0)];\n    node.send(msg);\n    node.status ({fill:\"green\",shape:\"dot\", text: \"START: timeOrder@0min\"});\n    var mdaSync = setInterval(function(){\n        scanTime = global.get('scanTime') + 1 ;\n        global.set('scanTime', scanTime) ;\n        for(var key in context.global.sequence2)\n            if(key===String(scanTime)){\n                context.global.sync2 = key;\n                msg.payload = context.global.sequence2[key];\n                context.global.sync3 = 0;\n                node.send(msg);\n                node.status ({fill:\"green\",shape:\"dot\", text: \"START: timeOrder@\"+scanTime+\"min\"});\n        }\n        \n    },60000);\n    global.set('mdaSync',mdaSync);\n}\nif(msg.payload === 'MDA-FINISH'){\n    context.global.startMDA = 0 ;\n    node.status ({text: \"waiting start ...\"});\n    clearTimeout(global.get('mdaSync'));\n}\n/*if(context.global.startMDA === 1){\n    var msg = {};\n    var date = Date.now();\n    var scanTime = date ; //global.get('scanTime'); \n    var previousScanTime = global.get('previousScanTime') | 0; \n    if ((scanTime-previousScanTime)>60000){\n        global.set('previousScanTime', date) ;\n        }\n    }\n*/","outputs":1,"noerr":0,"x":2340,"y":240,"wires":[["ac0464d2.d7a6a8"]]},{"id":"fce86da2.2bd7b","type":"inject","z":"5805ee3f.7d54f","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":750,"y":100,"wires":[["7e97adf9.299934","f85b28ea.a1ec78","ea052f3f.8f8a4","2b62922c.5e1dbe"]]},{"id":"31b4e64c.464a5a","type":"inject","z":"5805ee3f.7d54f","name":"STOP","topic":"","payload":"MDA-FINISH","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":650,"y":320,"wires":[["bda3fce2.407f5","6b85ec5e.62bdb4"]]},{"id":"bda3fce2.407f5","type":"function","z":"5805ee3f.7d54f","name":"stop MDA","func":"if(msg.payload === 'MDA-FINISH'){\n    context.global.startMDA = 0 ;\n    node.status ({fill:\"red\",shape:\"dot\", text: \"STOP\"});\n}\nif(msg.payload === 'MDA-START'){\n    node.status ({text: \"waiting stop ...\"});\n}","outputs":1,"noerr":0,"x":960,"y":320,"wires":[[]]},{"id":"c81a2e88.52c9d","type":"websocket in","z":"5805ee3f.7d54f","name":"","server":"c51b6505.3d7af8","client":"","x":790,"y":1300,"wires":[["187f3940.beaac7","d486ff99.b7315"]]},{"id":"ea052f3f.8f8a4","type":"function","z":"5805ee3f.7d54f","name":"Initialisation","func":"context.global.startMDA = 0 ;\ncontext.global.sync = 0 ;\ncontext.global.sync2 = 0 ;\ncontext.global.sync3 = 0 ;\ncontext.global.sync4 = 0 ;\ncontext.global.settingChannels = [];\ncontext.global.saveConfigChannel = '' ;\ncontext.global.camGrab = \"\";\ncontext.global.camGrabOld = \"\" ;\n\ncontext.global.Fluorescence1 = 'CoolLed-PE4000';\n//context.global.listConfigChannel = ['williams1.json'] ;\n//context.global.initialize = false ;\n//context.global.ressources = [] ;\n\n//context.global.test = [];\n","outputs":1,"noerr":0,"x":950,"y":40,"wires":[[]]},{"id":"28ca042.24d4dfc","type":"http in","z":"5805ee3f.7d54f","name":"","url":"/missmarple","method":"get","upload":false,"swaggerDoc":"","x":800,"y":1420,"wires":[["3d102567.fd98ea"]]},{"id":"8c0196c9.84da48","type":"http response","z":"5805ee3f.7d54f","name":"","x":1330,"y":1420,"wires":[]},{"id":"3d102567.fd98ea","type":"template","z":"5805ee3f.7d54f","name":"MissMarpleHTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->\n    <meta name=\"description\" content=\"\">\n    <meta name=\"author\" content=\"\">\n    <link rel=\"icon\" href=\"bootstrap/favicon.ico\">\n\n    <title>Miss Marple | Bootstrap</title>\n\n    <script>\n    </script>\n\n    <link href=\"bootstrap/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link href=\"bootstrap/assets/css/ie10-viewport-bug-workaround.css\" rel=\"stylesheet\">\n    <link href=\"bootstrap/dashboard.css\" rel=\"stylesheet\">\n    <link href=\"css/style1.css\" rel=\"stylesheet\">\n    <script src=\"bootstrap/assets/js/ie-emulation-modes-warning.js\"></script>\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js\"></script>\n    <script src=\"js/js1.js\"></script>\n    \n    <script src=\"//code.jquery.com/jquery-3.3.1.min.js\"></script>\n    \n    <!-- This demo uses an 3rd-party, jQuery UI based context menu -->\n    <link href=\"//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css\" rel=\"stylesheet\">\n    <script src=\"//code.jquery.com/ui/1.12.1/jquery-ui.min.js\"></script>\n    <!-- jquery-contextmenu (https://github.com/mar10/jquery-ui-contextmenu/) -->\n    <script src=\"//cdn.jsdelivr.net/npm/ui-contextmenu/jquery.ui-contextmenu.min.js\"></script>\n    \n    <link href=\"fancytree-master/src/skin-win8/ui.fancytree.css\" rel=\"stylesheet\">\n    <script src=\"fancytree-master/src/jquery.fancytree.js\"></script>\n    <script src=\"fancytree-master/src/jquery.fancytree.dnd5.js\"></script>\n    <script src=\"fancytree-master/src/jquery.fancytree.edit.js\"></script>\n    <script src=\"fancytree-master/src/jquery.fancytree.gridnav.js\"></script>\n    <script src=\"fancytree-master/src/jquery.fancytree.table.js\"></script>\n    <script src=\"fancytree-master/src/jquery.fancytree.multi.js\"></script>\n    \n    <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.css\">\n    <script src=\"//cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.js\"></script>\n  \n    <style type=\"text/css\">\n      .ui-menu {\n        width: 200px;\n        height: 30px;\n        font-size: 63%;\n      }\n      .ui-menu kbd { /* Keyboard shortcuts for ui-contextmenu titles */\n        float: right;\n      }\n      /* custom alignment (set by 'renderColumns'' event) */\n      td.alignRight {\n         text-align: right;\n      }\n      td.alignCenter {\n         text-align: center;\n      }\n      td input[type=input] {\n        width: 40px;\n      }\n       span.drag-source {\n    border: 1px solid lightgray;\n    border-radius: 3px;\n    padding: 2px;\n    background-color: silver\n  }\n\n  ul.fancytree-container {\n    max-height: 200px;\n    overflow-y: scroll;\n  }\n\n  span.fancytree-node.fancytree-drag-source {\n    outline: 1px dotted grey;\n  }\n  span.fancytree-node.fancytree-drop-accept {\n    outline: 1px dotted green;\n  }\n  span.fancytree-node.fancytree-drop-reject {\n    outline: 1px dotted red;\n  }\n    </style>\n\n\n  </head>\n\n  <body  onload=\"wsConnect();\" onunload=\"ws.onclose();\">\n    \n     <div id=\"wait\" style=\"text-align: center;\" >\n        <img style=\"margin: 0 auto;\" src='media/Audit.png'><img style=\"margin: 0 auto;\" src='media/loading.gif'>\n        <br>\n        <h2>Loading parameters, please wait a few seconds</h2>\n     </div>\n    \n     <div id=\"main\">\n         <nav class=\"navbar navbar-inverse navbar-fixed-top\">\n          <div class=\"container-fluid\">\n            <div class=\"navbar-header\">\n              <button type=\"button\" class=\"navbar-toggle collapsed\" data-toggle=\"collapse\" data-target=\"#navbar\" aria-expanded=\"false\" aria-controls=\"navbar\">\n                <span class=\"sr-only\">Toggle navigation</span>\n                <span class=\"icon-bar\"></span>\n                <span class=\"icon-bar\"></span>\n                <span class=\"icon-bar\"></span>\n              </button>\n              <a class=\"navbar-brand\" href=\"#\"><img src=\"e475238aca49b9f6bb53cc4138fbdb27--funny-caricatures-celebrity-caricatures.jpg\" style=\"width: 40px; height: 50px\"></a>\n              <a class=\"navbar-brand\" href=\"#\">Miss Marple</a>\n              <a class=\"navbar-brand\" href=\"#\"><div id=\"status\"></div></a>\n              <a class=\"navbar-brand\" href=\"#\"><div id=\"name_user\"></div></a>\n            </div>\n            \n            <div id=\"navbar\" class=\"navbar-collapse collapse\">\n              <ul class=\"nav navbar-nav navbar-right\">\n                <li><a href=\"#\"><!--<img src=\"user.png\" style=\"width: 40px; height: 50px\">--></a></li>\n              </ul>\n            </div>\n          </div>\n        </nav>\n    \n    \n        <div class=\"container-fluid\">\n          <div class=\"row\">\n            <div class=\"col-sm-3 col-md-2 sidebar\">\n              <ul class=\"nav nav-sidebar\">\n                <li><a href=\"#\"></a></li>\n                <li id='livemodeli'><a href=\"javascript: live_mode();\">Live mode<span class=\"sr-only\" ></span></a></li>\n                <li id='settingschannelsli'><a href=\"javascript: setting();\">Settings Channels<span class=\"sr-only\"></span></a></li>\n                <li id='mdali'><a href=\"javascript: mda();\">MDA<span class=\"sr-only\" ></span></a></li>\n              </ul>\n            </div>\n            <div class=\"col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main\">    \n    \n            \n            <br>\n            <div id=\"receive\"></div>\n            <hr/>\n            <div id=\"alert-success\" class=\"alert alert-success\" role=\"alert\"></div>\n            <!--<div id=\"alert-warning\"  class=\"alert alert-warning\" role=\"alert\"></div>          -->\n\n          <div id=\"live_mode\">\n            <h2 class=\"sub-header\">Live mode</h2>\n<!--            -->\n            <div id=\"live_div\" class=\"table-responsive\">\n                <!--<span class=\"drag-source\" draggable=\"true\" id=\"live_olympusix81\"><img src='icons/OlympusIx81.png'>&nbsp;OLYMPUS-IX-81</span>-->\n                <img src='icons/work_in_progress.jpg'>\n            </div>    \n          </div>\n  \n          <div id=\"settings\">\n              <h2 class=\"sub-header\">Settings channels</h2>\n                <div id=\"name_configChannels\">\n                </div>\n                <div id=\"available_configChannels\">\n                </div>\n                <br>\n                <!--<button class='setting_button' alt='load channel' id=\"setting_button_load_channel\"><img src='icons/arrow_up.png'> Load a new setting channel configuration</button>-->\n                <button class='setting_button' alt='add channel' id=\"setting_button_add_channel\"><img src='icons/add.png'> Add a new setting channel</button>\n                <button class='setting_button' alt='new configuration' id=\"setting_button_new_configChannel\"><img src='icons/add.png'> New configuration</button><br><br>\n                <div id='Enlightened'></div><br>\n                <form method=\"post\" id='setting_channel_form' action=\"/formpost\" ajax=\"true\">\n                      <!--<label hidden id='label_config'> Name: &nbsp;&nbsp;</label><input hidden required type='text' id='name_config' name=\"nam_config\" ><br>-->\n                      <div id=\"setting_table_channel\" class=\"table-responsive\"></div>\n                      <button type='submit' alt='save' class='setting_button' id='setting_button_save_channel'><img src='icons/disk.png'> Save the current settings</button>\n                </form>\n                <br>\n                <hr/>\n                \n<!--                Futur<br>\n                <button type='setting_button' alt='export setting' class='setting_button' id=\"setting_button_export_channel\"> Load</button>\n                <button type='setting_button' alt='import setting' class='setting_button' id=\"setting_button_import_channel\"> Save as</button>\n    -->             \n          </div>\n                \n          \n          <div id=\"mda\">\n            <h2 class=\"sub-header\">Multi-dimensional Acquisition</h2>\n                \n                <div id=\"available_channels_mda\">\n                </div>\n\n                <div id=\"available_ressources\">\n                    <span>Available resources and functions</span><br>\n                    <span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Simple picture');\"><img src='icons/camera.png'>&nbsp;Simple picture</span>\n                    &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Autofocus');\"><img src='icons/autofocus.png'>&nbsp;Autofocus</span>\n                    &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Z-stack');\"><img src='icons/zstack.png'>&nbsp;Z-stack</span>\n                    &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'XYZ Position');\"><img src='icons/yxz-512.png'>&nbsp;XYZ-position</span>\n                    &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Sequence');\"><img src='icons/arrow_rotate_clockwise.png'>&nbsp;Sequence</span>\n                </div>\n                <h3>Definition of the experimental protocol</h3><hr/>\n\n                <table id=\"\" class=\"table table-striped\">\n                    <tbody>\n                        <tr>\n                            <th style=\"width:50%;\">                \n                                <button class='' alt='load' id=\"\"><img src='icons/arrow_up.png'> Load a existing protocol</button>\n                                <button class='' alt='new' id=\"\"><img src='icons/add.png'> New protocol</button><br><br>\n                                <table id=\"tree\">\n                                    <colgroup>\n                                        <col width=\"1%\">\n                                        <col width=\"1%\">\n                                        <col width=\"38%\">\n                                        <col width=\"10%\">\n                                    </colgroup>\n                                    <thead>\n                                        <tr> <th></th> <th></th> <th></th> <th></th> <!--<th>Z-stacks</th> <th>Autofocus</th> <th>Save Images</th> <th>Comment</th> <th>Color</th>--> </tr>\n                                    </thead>\n                                    <tbody>\n                                      <tr>\n                                        <td class=\"alignCenter\"></td>\n                                        <td></td>\n                                        <td></td>\n                                        <td class=\"alignCenter\"></td>\n                                      </tr>\n                                    </tbody>\n                                </table>\n                            </th>\n                            <th style=\"width:50%;\">                \n                                <!--<label>PDMS chip:</label> <select><option>1</option><option>2</option></select><br>\n                                <img width=\"100%\" src='icons/test_uf.png'><br>\n                                <hr/>-->\n                                <label>Comments :</label><br>    \n                                <textarea type=\"text\" cols=\"40\" rows=\"5\" style=\"width:100%; height:100px;\" name=\"mdaac_comment\" value=\"\"></textarea><br>\n                                <hr/>\n                                <label>Prefix image:</label><br><input name ='mdapr_use' type='text'><label ></label><br>\n                                <hr/>\n                                <label>Saving folder:</label><br><input name ='mdapr_use' type='text'><label ></label><br>\n                                <hr/>\n                                \n                                <p>Active: <span id=\"lblActive\">-</span></p>\n                                <button onclick=test();>TEST</button>\n                                <button id=\"btnOpenPopup\">Select products...</button>\n\n                            </th>\n                        </tr>\n                    </tbody>\n                </table>\n  <!-- (Irrelevant source removed.) -->\n  \n  <script>\n  </script>\n\n            </div>\n            <!--</strong>-->\n            \n          </div>\n    \n              \n        </div>\n      </div>\n    </div>\n<!-- Bootstrap core JavaScript Placed at the end of the document so the pages load faster -->\n    <script>window.jQuery || document.write('<script src=\"bootstrap/assets/js/vendor/jquery.min.js\"><\\/script>')</script>\n    <script src=\"bootstrap/dist/js/bootstrap.min.js\"></script>\n    <script src=\"bootstrap/assets/js/vendor/holder.min.js\"></script>\n    <script src=\"bootstrap/assets/js/ie10-viewport-bug-workaround.js\"></script>\n    <script type=\"text/javascript\">\n    $.confirm({\n    title: 'WELCOME !',\n    theme: \"supervan\",\n    content: '' +\n    '<form action=\"\" class=\"formName\">' +\n    '<div class=\"form-group\">' +\n    '<label>Enter your name</label>' +\n    '<input type=\"text\" placeholder=\"Your name\" class=\"name form-control\" required />' +\n    '</div>' +\n    '</form>',\n    buttons: {\n        formSubmit: {\n            text: 'Submit',\n            btnClass: 'btn-blue',\n            action: function () {\n                var name = this.$content.find('.name').val();\n                if(!name){\n                    $.alert('provide a valid name');\n                    return false;\n                }\n                document.getElementById('name_user').innerHTML = \"USER:\"+name;\n                }\n        }\n    },\n    onContentReady: function () {\n        // bind to events\n        var jc = this;\n        this.$content.find('form').on('submit', function (e) {\n            // if the user submits the form by pressing enter in the field.\n            e.preventDefault();\n            jc.$$formSubmit.trigger('click'); // reference the button and click it\n        });\n    }\n});\n    </script>\n</body>\n</html>\n","x":1070,"y":1420,"wires":[["8c0196c9.84da48"]]},{"id":"fc00dc9a.266e8","type":"http in","z":"5805ee3f.7d54f","name":"","url":"/formpost","method":"post","upload":false,"swaggerDoc":"","x":800,"y":1360,"wires":[["7b943375.8dc03c"]]},{"id":"7b943375.8dc03c","type":"function","z":"5805ee3f.7d54f","name":"return msg.payload to client","func":"var obj = msg.payload;\n\nif(obj['topicpost']==='setting_channel_form'){\n    context.global.settingChannels = [] ;\n    var index = '' ;                    \n    var old_index = '' ;\n    var indexation = -1 ;\n    var namechannel = '' ;\n    var oldlid = '';\n    var oldnid = '';\n    \n    for(var key in obj){\n        if(key !== 'topicpost'){\n            var str = key.split(\"_\");\n            index = str[0];\n            if(index != old_index){ indexation = indexation + 1 ; oldlid = '';}\n            old_index = parseInt(str[0]);    \n            if(key === (index + \"_channel\")){namechannel = obj[key];}\n            if(key === (index + \"_devices\")) {\n                context.global.settingChannels[indexation] = {};   \n                context.global.settingChannels[indexation]['id'] = indexation + 1;\n                context.global.settingChannels[indexation]['name'] = namechannel;\n                var obj2 = context.global.ressources[obj[key]] ;\n                for (var key2 in obj2) if(key!=='update')context.global.settingChannels[indexation][''+key2] = obj2[key2];\n                context.global.settingChannels[indexation]['update'] = {} ;\n            }\n            if((key !== (index + \"_channel\")) && (key !== (index + \"_devices\"))){    \n                var balise = str[1];\n                var lid = balise.substr(0,1) ; //a modifier expression régulière\n                var nid = parseInt(balise.substr(1,1)) ; //a modifier expression régulière\n                if (lid !== oldlid) context.global.settingChannels[indexation]['update'][lid] = [] ;\n                oldlid = lid ;\n                context.global.settingChannels[indexation]['update'][lid][nid] = obj[key]; // = obj[key];//settingChannel = name.concat(settingChannel);\n            }\n        }\n    }\n    //msg.payload = context.global.settingChannels;\n    msg.payload = 'The settings channels data was submitted and available';\n    return [msg];\n}","outputs":1,"noerr":0,"x":1060,"y":1360,"wires":[["8c0196c9.84da48","9abccdf3.152fc","2279898d.82bd86"]]},{"id":"187f3940.beaac7","type":"function","z":"5805ee3f.7d54f","name":"get ? set ?","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\"=\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n  // expected output: ReferenceError: nonExistantFunction is not defined\n  // Note - error messages will vary depending on browser\n}\n\nif(order[0] === 'getSettingChannels') msg.payload = context.global.settingChannels;\nif(order[0] === 'getSettingChannels2') msg.payload = context.global.settingChannels;\nif(order[0] === 'listConfigChannel') msg.payload = context.global.listConfigChannel;\nif(order[0] === 'updateSettingChannels') msg.payload = context.global.settingChannels;\nif(order[0] === 'getSettingChannels-MDA') msg.payload = context.global.settingChannels;\nif(order[0] === 'getRessources') msg.payload = context.global.ressources;\n\nif(order[0] === 'getMDA-mdazs_zstart_set') msg.payload = \"123\";\n\nif(order[0] === 'setMDATimepointUse') context.global.mda['timepoints']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDATimepointNumber') context.global.mda['timepoints']['number'] = parseInt(order[1]) ;\nif(order[0] === 'setMDATimepointInterval') context.global.mda['timepoints']['interval'] = parseInt(order[1]) ;\nif(order[0] === 'setMDATimepointUnity') context.global.mda['timepoints']['unity'] = (order[1]) ;\n\nif(order[0] === 'setMDAMultiplespositionsUse') context.global.mda['multiplespositions']['use'] = parseInt(order[1]) ;\n\nif(order[0] === 'setMDAZstacksUse') context.global.mda['zstacks']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAZstacksZstart') context.global.mda['zstacks']['zstart'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAZstacksZend') context.global.mda['zstacks']['zend'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAZstacksZstep') context.global.mda['zstacks']['zstep'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAZstacksType') context.global.mda['zstacks']['type'] = (order[1]) ;\nif(order[0] === 'setMDAZstacksShutter') context.global.mda['zstacks']['shutteropen'] = parseInt(order[1]) ;\n\nif(order[0] === 'setMDAAutofocusUse') context.global.mda['autofocus']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAAutofocusSkip') context.global.mda['autofocus']['skip'] = parseInt(order[1]) ;\n\nif(order[0] === 'setMDAChannelsUse') context.global.mda['channels']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAChannelsConfiguration'){\n    var config = order[1].split(\",\");\n    var id = context.global.mda['channels']['config'].length;\n    context.global.mda['channels']['config'][id] = {} ;\n    context.global.mda['channels']['config'][id]['use'] = parseInt(config[0]);\n    context.global.mda['channels']['config'][id]['exposure'] = parseInt(config[1]);\n    context.global.mda['channels']['config'][id]['zoffset'] = parseInt(config[2]);\n    context.global.mda['channels']['config'][id]['channel'] = (config[3]);\n    context.global.mda['channels']['config'][id]['zstack'] = parseInt(config[4]);\n    context.global.mda['channels']['config'][id]['skipframe'] = parseInt(config[5]);\n    context.global.mda['channels']['config'][id]['refHTML'] = parseInt(config[6]);\n}\n\nif(order[0] === 'setMDAChannelsConfigurationUse'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['use'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationExposure'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['exposure'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationZoffset'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['zoffset'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationChannel'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['channel'] = config[0];\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationZstack'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['zstack'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationSkipframe'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['skipframe'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'MDAChannelsConfigurationRemove'){\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(order[1])){\n            context.global.mda['channels']['config'].splice(i, 1);\n        }\n    }\n}\n\n\n\n\n\nif(order[0] === 'setMDASaveimagesUse') context.global.mda['saveimages']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDASaveimagesDirectory') context.global.mda['saveimages']['directory'] = (order[1]) ;\nif(order[0] === 'setMDASaveimagesPrefix') context.global.mda['saveimages']['prefix'] = (order[1]) ;\nif(order[0] === 'setMDASaveimagesFormat') context.global.mda['saveimages']['format'] = (order[1]) ;\n\nif(order[0] === 'setMDAAcquisitioncommentComment') context.global.mda['acquisitioncomment'] = (order[1]) ;\n\n\nreturn msg ;\n\n","outputs":1,"noerr":0,"x":1110,"y":1200,"wires":[["9abccdf3.152fc"]]},{"id":"9abccdf3.152fc","type":"websocket out","z":"5805ee3f.7d54f","name":"","server":"c51b6505.3d7af8","client":"","x":1540,"y":1160,"wires":[]},{"id":"7e97adf9.299934","type":"function","z":"5805ee3f.7d54f","name":"Object MDA","func":"context.global.mda = {\n    \"timepoints\": {\n        \"use\" : 0,\n        \"number\" : 1,\n        \"interval\" : 1,\n        \"unity\" : \"ms\"\n    },\n    \"multiplespositions\": {\n        \"use\" : 0,\n        \"param\" : []\n    },\n    \"zstacks\": {\n        \"use\" : 0 ,\n        \"zstart\" : 0,\n        \"zend\" : 10,\n        \"zstep\" : 1,\n        \"type\" : \"relative Z\",\n        \"shutteropen\" : 0\n    },\n    \"autofocus\": {\n        \"use\" : 0,\n        \"skip\" : 0\n    },\n    \"channels\": {\n        \"use\" : 0,\n        \"config\" : []\n    },\n    \"saveimages\": {\n        \"use\" : 0,\n        \"directory\" : \"\",\n        \"prefix\" : \"\",\n        \"format\" : \"separate images files\"\n    },\n    \"acquisitioncomment\" : \"\"\n};\n","outputs":1,"noerr":0,"x":950,"y":120,"wires":[[]]},{"id":"2279898d.82bd86","type":"function","z":"5805ee3f.7d54f","name":"save settingChannels","func":"var test = [\n  {\n      \"id\" : 0,\n      \"name\": \"channelA\",\n      \"device\" : \"CoolLed-PE-4000\",\n      \"type\" : \"ligth-source\",\n      \"topic\" : \"fluo1\",\n      \"update\" :{\n          \"A\" : [120,100,true],\n          \"B\" : [200,40,false],\n          \"C\" : [330,80,false],\n          \"D\" : [410,10,false]\n      },\n      \"config\":{\n          \"A\" : [\"<select name='0A0' id='0A0'><option name='0A00' id='0A00' value=100>100</option>          <option name='0A01' id='0A01' value=110>110</option>           <option name='0A02' id='0A02' selected value=120>120</option>   <option name='0A03' id='0A03' value=130>130</option></select>\",          \"<input name='0A1' id='0A1' type='number' min='0' max='100' step='1' value='100'/>\",    \"<input name='0A2'  id='0A2' checked type='checkbox'/>\"],\n          \"B\" : [\"<select name='0B0' id='0B0'><option name='0B00' id='0B00' selected value=200>200</option> <option name='0B01' id='0B01' value=210>210</option>           <option name='0B02' id='0B02' value=220>220</option>            <option name='0B03' id='0B03' value=230>230</option></select>\",          \"<input name='0B1' id='0B1' type='number' min='0' max='100' step='1' value='40'/>\",     \"<input name='0B2'  id='0B2' type='checkbox'/>\"],\n          \"C\" : [\"<select name='0C0' id='0C0'><option name='0C00' id='0C00' value=300>300</option>          <option name='0C01' id='0C01' value=310>310</option>           <option name='0C02' id='0C02' value=320>320</option>            <option name='0C03' id='0C03' selected value=330>330</option></select>\", \"<input name='0C1' id='0C1' type='number' min='0' max='100' step='1' value='80'/>\",     \"<input name='0C2'  id='0C2' type='checkbox'/>\"],\n          \"D\" : [\"<select name='0D0' id='0D0'><option name='0D00' id='0D00' value=400>400</option>          <option name='0D01' id='0D01' selected value=410>410</option>  <option name='0D02' id='tD02' value=420>420</option>            <option name='0D03' id='0D03' value=430>430</option></select>\",          \"<input name='0D1' id='0D1' type='number' min='0' max='100' step='1' value='10'/>\",     \"<input name='0D2'  id='0D2' type='checkbox'/>\"]\n        }\n  }\n ];\nmsg.payload =  test.concat(context.global.settingChannels);\n//msg.payload =  context.global.settingChannels;\nif(context.global.saveConfigChannel !== '' ) msg.filename = context.global.saveConfigChannel;\n\nreturn msg ;\n\n","outputs":1,"noerr":0,"x":1380,"y":1360,"wires":[["4c36fa22.65a954"]]},{"id":"4c36fa22.65a954","type":"file","z":"5805ee3f.7d54f","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","x":1590,"y":1360,"wires":[[]]},{"id":"64b99616.88eb78","type":"file in","z":"5805ee3f.7d54f","name":"","filename":"","format":"utf8","chunk":false,"sendError":false,"x":710,"y":1160,"wires":[["764cb2be.1148ec"]]},{"id":"764cb2be.1148ec","type":"function","z":"5805ee3f.7d54f","name":"","func":"msg.payload = JSON.parse(msg.payload);\ncontext.global.settingChannels = msg.payload ;\n//msg.payload = context.global.settingChannels;\nreturn msg;","outputs":1,"noerr":0,"x":1130,"y":1160,"wires":[["9abccdf3.152fc"]]},{"id":"1eea5019.20115","type":"function","z":"5805ee3f.7d54f","name":"load","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\n\nif(order[0] === 'LoadSettingChannelsConfiguration') {\n    context.global.saveConfigChannel = 'C:/Users/labo/.node-red/lib2/config/'+context.global.listConfigChannel[parseInt(order[1])];\n    msg.filename = context.global.saveConfigChannel ;\n    return msg ;\n}\n\n\n\n","outputs":1,"noerr":0,"x":590,"y":1160,"wires":[["64b99616.88eb78"]]},{"id":"bc8d57a8.9a7558","type":"link out","z":"5805ee3f.7d54f","name":"output_cam","links":["559aebf0.a5df94","66fdc750.1163a8"],"x":1535,"y":500,"wires":[]},{"id":"559aebf0.a5df94","type":"link in","z":"5805ee3f.7d54f","name":"input_cam","links":["bc8d57a8.9a7558"],"x":715,"y":960,"wires":[["bda3fce2.407f5","6b85ec5e.62bdb4","e1cfe124.79f0b","3fabc478.cfceac","7ceaa5d0.c12d4c","7cf30c8c.9d6a94"]]},{"id":"13b85ff6.4b75f","type":"function","z":"5805ee3f.7d54f","name":"wait for all devices are initilized","func":"function verifyIsTopicExists(ressources,topic){\n    if(ressources.length !==0){\n        var verify = false ;\n        for(var i=0; i<ressources.length;i++){\n            if(ressources[i]['topic']===topic){ verify = true ; return i;}\n        }\n        if(verify ===false) return (-1);\n    }\n    else return (-1) ;\n}\n\n\nif(msg.mode === 'init'){\n    \n    context.data = context.data || new Object();\n    context.global.ressources = context.global.ressources || [];\n    \n    var verify = verifyIsTopicExists(context.global.ressources,msg.topic) ;\n    \n    switch (msg.topic) {\n        case \"Fluorescence1\":\n            context.data.task1 = msg.device;\n            context.global.Fluorescence1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;\n        case \"MotionStage1\":\n            context.data.task2 = msg.device;\n            context.global.MotionStage1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;\n        case \"Microscope1\":\n            context.data.task3 = msg.device;\n            context.global.Microscope1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;\n        /*case \"Mosaic1\":\n            context.data.task4 = msg.device;\n            context.global.Mosaic1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;*/\n        /*case \"Camera1\":\n            context.data.task5 = msg.device;\n            context.global.Camera1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;*/\n       /* case \"Fluorescence2\":\n            context.data.task6 = msg.device;\n            context.global.Fluorescence2 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;*/\n        default:\n            msg = null;\n        \tbreak;\n    \n    }\n    \n    if(context.data.task1 != null && context.data.task2 != null && context.data.task3 != null ){//&& context.data.task4 != null && context.data.task5 != null && context.data.task6 != null) {\n    \tmsg2 = new Object();\n        msg2 = context.data;\n        msg2.payload = \"Initialisation >>> DONE :-)\";\n        context.global.initialize = true ;\n        context.data=null;\n    \treturn msg2;\n    } else return msg;\n}","outputs":1,"noerr":0,"x":1350,"y":680,"wires":[["e97ab55e.c6c9e8"]]},{"id":"e97ab55e.c6c9e8","type":"debug","z":"5805ee3f.7d54f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1590,"y":680,"wires":[]},{"id":"f6f34818.6ccc88","type":"debug","z":"5805ee3f.7d54f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1610,"y":620,"wires":[]},{"id":"655abe45.782ee","type":"inject","z":"5805ee3f.7d54f","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":520,"y":800,"wires":[["d4243bc2.38afe8"]]},{"id":"d4243bc2.38afe8","type":"function","z":"5805ee3f.7d54f","name":"live","func":"msg.payload =  context.global.Fluorescence1;\nmsg.topic = 'Fluorescence1';\nmsg.device =  context.global.Fluorescence1;\nmsg.mode = 'live';\nmsg.action = 'set';\nmsg.update = {\n  \"A\" : [385,10,true],\n  \"B\" : [490,100,true],\n  \"C\" : [580,45,false],\n  \"D\" : [740,100,true],\n  'timeout' : 5000\n}    \nreturn msg;","outputs":1,"noerr":0,"x":690,"y":800,"wires":[["3fabc478.cfceac"]]},{"id":"7e72b79e.9a6268","type":"function","z":"5805ee3f.7d54f","name":"live","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\nmsg.action = 'setChannel';\n//msg.action = 'setWheelFilter';\nmsg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 5000\n}\n/*msg.update = {\n    \"wheelFilter\" : 3\n}*/\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":860,"wires":[["7cf30c8c.9d6a94"]]},{"id":"3a48d521.01cfba","type":"inject","z":"5805ee3f.7d54f","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":560,"y":860,"wires":[["7e72b79e.9a6268"]]},{"id":"9f1c17b6.ad9218","type":"function","z":"5805ee3f.7d54f","name":"live","func":"msg.payload =  context.global.MotionStage1;\nmsg.topic = 'MotionStage1';\nmsg.device =  context.global.MotionStage1;\nmsg.mode = 'live';\nmsg.action = 'set';\nmsg.update = {\n    \"xPosition\" : 0,\n    \"yPosition\" : 0,\n    \"moveType\" : \"G\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":680,"wires":[["e1cfe124.79f0b"]]},{"id":"5b94f42.d60560c","type":"inject","z":"5805ee3f.7d54f","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":560,"y":680,"wires":[["9f1c17b6.ad9218"]]},{"id":"120c5d12.408503","type":"function","z":"5805ee3f.7d54f","name":"live","func":"msg.payload =  context.global.Mosaic1;\nmsg.topic = 'Mosaic1';\nmsg.device =  context.global.Mosaic1;\nmsg.mode = 'live';\nmsg.update = {\n  \"matrice\" : 2324\n}    \nreturn msg;","outputs":1,"noerr":0,"x":690,"y":740,"wires":[[]]},{"id":"26be2662.efc1aa","type":"inject","z":"5805ee3f.7d54f","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":560,"y":740,"wires":[["120c5d12.408503"]]},{"id":"14d8da41.c09de6","type":"function","z":"5805ee3f.7d54f","name":"live","func":"msg.payload =  context.global.Fluorescence2;\nmsg.topic = 'Fluorescence2';\nmsg.device =  context.global.Fluorescence2;\nmsg.mode = 'live';\nmsg.action = 'set' ;\nmsg.update = {\n  \"shutter\" : true,\n  \"intensity\" : 40\n}    \nreturn msg;","outputs":1,"noerr":0,"x":690,"y":560,"wires":[[]]},{"id":"cb11fff3.2323c","type":"inject","z":"5805ee3f.7d54f","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":540,"y":560,"wires":[["14d8da41.c09de6"]]},{"id":"5b38cd0a.87d604","type":"function","z":"5805ee3f.7d54f","name":"live","func":"msg.topic = 'Camera1';\nmsg.action = 'GRAB';\nmsg.prefixe = \"prefix\";\nmsg.channel = \"ch\";\nmsg.position = \"pos\";\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":620,"wires":[["7ceaa5d0.c12d4c"]]},{"id":"d62e808c.39c66","type":"inject","z":"5805ee3f.7d54f","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":560,"y":620,"wires":[["5b38cd0a.87d604"]]},{"id":"f85b28ea.a1ec78","type":"function","z":"5805ee3f.7d54f","name":"Object sequencer 2","func":"/*context.global.sequence2 = {\n    \"0\" : \n        [\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : context.global.Fluorescence1,\n            'mode' : 'MDA',\n            \"update\" :\n                {\n                \"A\" : [120,100,\"ON\"],\n                \"B\" : [200,100,\"ON\"],\n                \"C\" : [330,100,\"ON\"],\n                \"D\" : [410,100,\"ON\"]\n                }    \n            },\n            {\n            'topic' : 'MotionStage1',\n            'device' : context.global.MotionStage1,\n            'action' : 'set',\n            'mode' : 'MDA',\n            'x': 100,\n            'y': 100,\n            'fonction': 'moveToPositionXY'    \n            }],\n            [{\n                'topic' : 'Camera1',\n                'device' : context.global.Camera1,\n                'mode' : 'MDA',\n                'exposure': 20,\n                'fonction' : 'getFrame'\n            }],\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : context.global.Fluorescence1,\n            'mode' : 'MDA',\n            \"update\" :\n                {\n                \"A\" : [120,100,\"ON\"],\n                \"B\" : [200,100,\"ON\"],\n                \"C\" : [330,100,\"ON\"],\n                \"D\" : [410,100,\"ON\"]\n                }    \n            },\n            {\n            'topic' : 'MotionStage1',\n            'device' : context.global.MotionStage1,\n            'mode' : 'MDA',\n            'action' : 'setAll',\n            'x': 1365,\n            'y': 3420,\n            'fonction': 'moveToPositionXY'    \n            }],\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : context.global.Fluorescence1,\n            'mode' : 'MDA',\n            \"update\" :\n                {\n                \"A\" : [120,100,\"ON\"],\n                \"B\" : [200,100,\"ON\"],\n                \"C\" : [330,100,\"ON\"],\n                \"D\" : [410,100,\"ON\"]\n                }    \n            },\n            {\n            'topic' : 'MotionStage1',\n            'device' : context.global.MotionStage1,\n            'mode' : 'MDA',\n            'action' : 'setAll',\n            'x': 1365,\n            'y': 3420,\n            'fonction': 'moveToPositionXY'    \n            }]\n        ],\n    \"10\" : \n        [\n            [{\n            'topic' : 'Camera1',\n            'device' : context.global.Camera1,\n            'mode' : 'MDA',\n            'exposure': 200,\n            'fonction' : 'getFrame'\n            }],\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : context.global.Fluorescence1,\n            'mode' : 'MDA',\n            \"update\" :\n                {\n                \"A\" : [120,100,\"ON\"],\n                \"B\" : [200,100,\"ON\"],\n                \"C\" : [330,100,\"ON\"],\n                \"D\" : [410,100,\"ON\"]\n                }    \n            },\n            {\n            'topic' : 'MotionStage1',\n            'device' : context.global.MotionStage1,\n            'mode' : 'MDA',\n            'action' : 'setAll',\n            'x': 1365,\n            'y': 3420,\n            'fonction': 'moveToPositionXY'    \n            }]\n        ],\n    \"20\" : \n        [{\n        'topic' : 'MotionStage1',\n        'device' : context.global.MotionStage1,\n        'mode' : 'MDA',\n        'action' : 'setAll',\n        'x': 1365,\n        'y': 3420,\n        'fonction': 'moveToPositionXY'\n        }],\n    \"40\" : \n        [\n            [{\n            'topic' : 'Camera1',\n            'device' : context.global.Camera1,\n            'mode' : 'MDA',\n            'exposure': 20,\n            'fonction' : 'getFrame'\n            }],\n            [{\n            'payload' : 'MDA-FINISH',\n            }]\n        ]\n}*/\n\n\ncontext.global.sequence2 = {\n    \"0\" : \n        [\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : 'CoolLed-PE4000',\n            'mode' : 'MDA',\n            'action' : 'set',\n            \"update\" :\n                {\n                \"A\" : [435,70,true],\n                \"B\" : [470,100,true],\n                \"C\" : [580,100,true],\n                \"D\" : [660,100,true]\n                }    \n            },\n            {\n            'topic' : 'MotionStage1',\n            'device' : 'PRIOR-PRO-SCAN',\n            'action' : 'set',\n            'mode' : 'MDA',\n            'update' : {\n                'xPosition': 10000,\n                'yPosition': 10000,\n                'moveType': 'GR'    \n                }\n            }],\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : 'CoolLed-PE4000',\n            'mode' : 'MDA',\n            'action' : 'set',\n            \"update\" :\n                {\n                \"A\" : [435,100,true],\n                \"B\" : [470,2,false],\n                \"C\" : [580,100,true],\n                \"D\" : [660,2,false]\n                }    \n            }]\n        ],\n    \"10\" : \n        [\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : 'CoolLed-PE4000',\n            'mode' : 'MDA',\n            'action' : 'set',\n            \"update\" :\n                {\n                \"A\" : [435,100,false],\n                \"B\" : [470,100,false],\n                \"C\" : [580,100,false],\n                \"D\" : [660,100,false]\n                }    \n            }\n            ]\n        ],\n    \"20\" : \n        [\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : 'CoolLed-PE4000',\n            'mode' : 'MDA',\n            'action' : 'set',\n            \"update\" :\n                {\n                \"A\" : [435,100,true],\n                \"B\" : [470,100,true],\n                \"C\" : [580,100,true],\n                \"D\" : [660,100,true]\n                }    \n            },\n            {\n            'topic' : 'MotionStage1',\n            'device' : 'PRIOR-PRO-SCAN',\n            'action' : 'set',\n            'mode' : 'MDA',\n            'update' : {\n                'xPosition': 2000,\n                'yPosition': 2000,\n                'moveType': 'GR'    \n                }\n            }]\n        ],\n    \"30\" : \n        [\n            [{\n                'topic' : 'MotionStage1',\n            'device' : 'PRIOR-PRO-SCAN',\n            'action' : 'set',\n            'mode' : 'MDA',\n            'update' : {\n                'xPosition': 0,\n                'yPosition': 0,\n                'moveType': 'G'    \n                }\n            }],\n            [{\n            'payload' : 'MDA-FINISH',\n            }]\n        ]\n    }","outputs":1,"noerr":0,"x":970,"y":80,"wires":[[]]},{"id":"882fdb4d.2c9878","type":"function","z":"5805ee3f.7d54f","name":"Sequencer 2 Miss Marple - MDA","func":"    node.status ({fill:\"green\",shape:\"dot\", text: \"request\"});\n    \n    if( (context.global.startMDA === 1) && (context.global.initialize === true)){\n        node.status ({fill:\"yellow\",shape:\"dot\", text: context.global.sync2+\"-\"+context.global.sync3});\n    \n        var length = context.global.sequence2[context.global.sync2].length ;\n        \n        if( length  !== context.global.sync3 ){\n        \n            var order = context.global.sequence2[context.global.sync2];\n        \n            if(msg.payload === 'done'){\n        \n                context.global.checkFinish = context.global.checkFinish + 1 ;\n        \n                if(context.global.checkFinish === context.global.finish){\n                    context.global.checkFinish = 0 ;\n                    if(order.length !==1) {\n                        context.global.finish = order[context.global.sync3].length ; // nombre d'instructions dans la branche la plus profonde de l'object sequencer\n                        for(var i=0;i<order[context.global.sync3].length;i++){ node.send(order[context.global.sync3][i]);}\n                        //if(order[context.global.sync3][i]['payload'] === 'MDA-FINISH') node.status ({fill:\"red\",shape:\"dot\", text: \"finished and waiting order ...\"});\n        //                node.warn(\"ZFZ\");\n                    }\n                    else{ \n                        node.send(order[context.global.sync3]) ;\n                        context.global.finish = 1 ;\n        //                node.warn(\"ZZZ\");\n                    }\n                    context.global.sync3 = context.global.sync3 + 1 ;\n                }\n            }\n            else{\n                if(order.length !==1) {\n                    context.global.finish = order[context.global.sync3].length ; // nombre d'instructions dans la branche la plus profonde de l'object sequencer\n                    for(var i=0;i<order[context.global.sync3].length;i++){ node.send(order[context.global.sync3][i]);}\n                }\n                else { \n                    context.global.finish = 1 ;\n                    node.send(order[context.global.sync3]) ;\n                }\n                context.global.sync3 = context.global.sync3 + 1 ;\n            }\n        }\n    } \n","outputs":1,"noerr":0,"x":1350,"y":560,"wires":[["f6f34818.6ccc88","bc8d57a8.9a7558","e55d6e46.0a55a","355fbd5a.adc732"]]},{"id":"2c0358b9.c322a8","type":"function","z":"5805ee3f.7d54f","name":"","func":"msg.payload = context.global.settingChannels;\nreturn msg;","outputs":1,"noerr":0,"x":1090,"y":1640,"wires":[["8bd24fb5.753df"]]},{"id":"6961b79b.316b28","type":"inject","z":"5805ee3f.7d54f","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":860,"y":1580,"wires":[["2c0358b9.c322a8"]]},{"id":"6b85ec5e.62bdb4","type":"function","z":"5805ee3f.7d54f","name":"sequencer2 key","func":"if(msg.payload === 'MDA-START'){\n    context.global.startMDA = 1 ;\n    context.global.checkFinish = 0 ;\n    \n    node.status ({fill:\"green\",shape:\"dot\", text: \"START\"});\n    //else node.status ({fill:\"red\",shape:\"dot\", text: \"\"}); \n    \n    for(var key in context.global.sequence2) {\n        sendCMD(key,context.global.sequence2[key]);\n    }\n}\nif(msg.payload === 'MDA-FINISH'){\n    node.status ({text: \"waiting start ...\"});\n}\n\nfunction sendCMD(key,data){\n    var msg = {} ;\n    msg.payload = \"RUN:\"+data;\n    setTimeout(function(){\n        context.global.sync2 = key;\n        context.global.sync3 = 0;\n        node.send(msg);\n    },parseInt(key) * 1000);\n}\n","outputs":1,"noerr":0,"x":980,"y":380,"wires":[["882fdb4d.2c9878"]]},{"id":"b0768b65.752d08","type":"inject","z":"5805ee3f.7d54f","name":"START","topic":"","payload":"MDA-START","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":650,"y":380,"wires":[["6b85ec5e.62bdb4","bda3fce2.407f5"]]},{"id":"ba6250c3.6852","type":"websocket in","z":"5805ee3f.7d54f","name":"","server":"c51b6505.3d7af8","client":"","x":330,"y":1040,"wires":[["eb30bfc2.5d91c","359ab051.267d6","3463cb6e.d267c4","1eea5019.20115","134a603f.9b243"]]},{"id":"eb30bfc2.5d91c","type":"function","z":"5805ee3f.7d54f","name":"fancyTree switch","func":"context.global.sendDataLive = {} ;\nvar order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\ncontext.global.fancyTreeOrder = order[0] ;\nvar output = {} ;\n\nif(order[0] === 'getValueXYZ'){\n    context.global.sendDataLiveLg = 3 ;\n    output.payload =  context.global.MotionStage1;\n    output.topic = 'MotionStage1';\n    output.device =  context.global.MotionStage1;\n    output.mode = 'live';\n    output.action = 'get';\n    node.send(output);\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'getZPosition';\n    node.send(output);\n}\n\nif(order[0] === 'getValueZ'){\n    context.global.sendDataLiveLg = 1 ;\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'getZPosition';\n    node.send(output);\n}\n\nif(order[0] === 'tryAutoFocus'){\n    context.global.sendDataLiveLg = 1;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'af';\n    output.update = {\n        \"farLimit\" : 1,\n        \"nearLimit\" : 3000000,\n        \"affLimit\": parseInt(order[1])-parseInt(order[2]),\n        \"afnLimit\":parseInt(order[1])+parseInt(order[3]),\n        \"objective\":parseInt(order[4])\n    }\n    node.send(output);\n}\n\nif(order[0] === 'moveX'){\n    context.global.sendDataLiveLg = 3 ;\n    output.payload =  context.global.MotionStage1;\n    output.topic = 'MotionStage1';\n    output.device =  context.global.MotionStage1;\n    output.mode = 'live';\n    output.action = 'set';\n    output.update = {} ;\n    output.update = {\n        \"xPosition\" : 0,\n        \"yPosition\" : parseInt(order[2]) * (order[1] ==\"UP\" ? 1 : -1),\n        \"moveType\" : \"GR\"\n    } ;\n    node.send(output);\n}\n\nif(order[0] === 'moveY'){\n    context.global.sendDataLiveLg = 3 ;\n    output.payload =  context.global.MotionStage1;\n    output.topic = 'MotionStage1';\n    output.device =  context.global.MotionStage1;\n    output.mode = 'live';\n    output.action = 'set';\n    output.update = {} ;\n    output.update = {\n        \"xPosition\" : parseInt(order[2]) * (order[1] ==\"RG\" ? 1 : -1)  ,\n        \"yPosition\" : 0,\n        \"moveType\" : \"GR\"\n    } ;\n    node.send(output);\n}\n\nif(order[0] === 'moveZ'){\n    //context.global.sendDataLiveLg = 9 ;\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'setZPosition';\n    output.update = {\n        \"zPosition\" : parseInt(order[2]),\n        \"moveType\": order[1]\n    };\n    node.send(output);\n}\n\nif(order[0] === 'goToPosition'){\n    //context.global.sendDataLiveLg = 3 ;\n    output.payload =  context.global.MotionStage1;\n    output.topic = 'MotionStage1';\n    output.device =  context.global.MotionStage1;\n    output.mode = 'live';\n    output.action = 'set';\n    output.update = {} ;\n    output.update = {\n        \"xPosition\" : parseInt(order[1]),\n        \"yPosition\" : parseInt(order[2]),\n        \"moveType\" : \"G\"\n    } ;\n    node.send(output);\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'setZPosition';\n    output.update = {\n        \"zPosition\" : parseInt(order[3]),\n        \"moveType\": \"d\"\n    };\n    node.send(output);\n}\n\nif(order[0] === 'Enlightened'){\n    var olympus = false ;\n    var coolled = false ;\n    var xcite = false;\n    for(var i=1 ; i<context.global.settingChannels.length; i++){\n        if(i === parseInt(order[1])){\n            node.warn(i+\",\"+parseInt(order[1]));\n            if((context.global.settingChannels[i]['device'] === 'OLYMPUS-IX-81')){\n                olympus = true ;\n                output = {} ;\n                output.payload =  context.global.Microscope1;\n                output.topic = 'Microscope1';\n                output.device =  context.global.Microscope1;\n                output.mode = 'live';\n                output.action = 'setChannel';\n                output.update = {\n                    \"lamp\" : context.global.settingChannels[i]['update']['A'][0] == \"OFF\" ? false : true ,\n                    \"intensity\": parseFloat(context.global.settingChannels[i]['update']['A'][1]) ,\n                    \"shutter\":context.global.settingChannels[i]['update']['A'][2] == \"OFF\" ? false : true \n                };\n                node.send(output);\n            }\n            if((context.global.settingChannels[i]['device'] === 'X-Cite-120PC')){\n                xcite = true ;\n                output = {} ;\n                output.payload =  context.global.Fluorescence2;\n                output.topic = 'Fluorescence2';\n                output.device =  context.global.Fluorescence2;\n                output.mode = 'live';\n                output.action = 'set';\n                output.update = {\n                    \"intensity\" : context.global.settingChannels[i]['update']['A'][0] == \"OFF\" ? false : true ,\n                    \"shutter\":context.global.settingChannels[i]['update']['A'][2] == \"OFF\" ? false : true \n                };\n               node.send(output);\n            }\n            if((context.global.settingChannels[i]['device'] === 'CoolLed-PE4000')){\n                coolled = true ;\n                output = {} ;\n                output.payload =  context.global.Fluorescence1;\n                output.topic = 'Fluorescence1';\n                output.device =  context.global.Fluorescence1;\n                output.mode = 'live';\n                output.action = 'set';\n                output.update = {\n                    \"A\" : [context.global.settingChannels[i]['update']['A'][0],context.global.settingChannels[i]['update']['A'][1],context.global.settingChannels[i]['update']['A'][2] == \"OFF\" ? false : true] ,\n                    \"B\" : [context.global.settingChannels[i]['update']['B'][0],context.global.settingChannels[i]['update']['B'][1],context.global.settingChannels[i]['update']['B'][2] == \"OFF\" ? false : true] ,\n                    \"C\" : [context.global.settingChannels[i]['update']['C'][0],context.global.settingChannels[i]['update']['C'][1],context.global.settingChannels[i]['update']['C'][2] == \"OFF\" ? false : true] ,\n                    \"D\" : [context.global.settingChannels[i]['update']['D'][0],context.global.settingChannels[i]['update']['D'][1],context.global.settingChannels[i]['update']['D'][2] == \"OFF\" ? false : true] ,\n                };\n                node.send(output);\n            }\n        }\n        else {\n            if((context.global.settingChannels[i]['device'] === 'CoolLed-PE4000')&&(coolled === false)){\n                //coolled = true ;\n                output = {} ;\n                output.payload =  context.global.Fluorescence1;\n                output.topic = 'Fluorescence1';\n                output.device =  context.global.Fluorescence1;\n                output.mode = 'live';\n                output.action = 'setOFF';\n                node.send(output);\n            }\n            if((context.global.settingChannels[i]['device'] === 'OLYMPUS-IX-81')&&(olympus === false)){\n                //olympus = true ;\n                output = {} ;\n                output.payload =  context.global.Microscope1;\n                output.topic = 'Microscope1';\n                output.device =  context.global.Microscope1;\n                output.mode = 'live';\n                output.action = 'setChannel';\n                output.update = {\n                    \"lamp\" : true ,\n                    \"intensity\": 1.0 ,\n                    \"shutter\": false \n                };\n                node.send(output);\n            }\n            if((context.global.settingChannels[i]['device'] === 'X-Cite-120PC')&&(xcite === false)){\n                //xcite = true ;\n                output = {} ;\n                output.payload =  context.global.Fluorescence2;\n                output.topic = 'Fluorescence2';\n                output.device =  context.global.Fluorescence2;\n                output.mode = 'live';\n                output.action = 'set';\n                output.update = {\n                    \"intensity\" : context.global.settingChannels[i]['update']['A'][0] == \"OFF\" ? false : true ,\n                    \"shutter\": false  \n                };\n               node.send(output);\n            }\n        }\n    }\n}\n","outputs":1,"noerr":0,"x":630,"y":1040,"wires":[["e1cfe124.79f0b","f98cce8f.09cd","3fabc478.cfceac","7cf30c8c.9d6a94"]]},{"id":"8bd24fb5.753df","type":"debug","z":"5805ee3f.7d54f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1170,"y":1540,"wires":[]},{"id":"a1c86982.b38ad8","type":"websocket out","z":"5805ee3f.7d54f","name":"","server":"c51b6505.3d7af8","client":"","x":1540,"y":860,"wires":[]},{"id":"bc7cdb2d.115398","type":"function","z":"5805ee3f.7d54f","name":"if mode === live","func":"\n    if(msg.mode === 'live'){\n\n        if((context.global.fancyTreeOrder === 'getValueXYZ')||(context.global.fancyTreeOrder === 'getValueZ')||(context.global.fancyTreeOrder === 'tryAutoFocus')){\n        \n            for(var key in msg.update){\n                context.global.sendDataLive[key] = msg.update[key];    \n            }\n            //var msg={};\n            //msg.payload = context.global.fancyTreeOrder+\"-\"+context.global.sendDataLiveLg+\"-\"+Object.keys(context.global.sendDataLive).length;\n            node.send(msg);\n            if(Object.keys(context.global.sendDataLive).length === context.global.sendDataLiveLg){\n                var msg = {};\n                msg.payload = context.global.sendDataLive ;\n                node.send(msg);\n                context.global.sendDataLive = {} ;\n                context.global.fancyTreeOrder = \"\";\n            } \n        }\n    }","outputs":1,"noerr":0,"x":1300,"y":860,"wires":[["a1c86982.b38ad8","65186ca1.3db8a4"]]},{"id":"359ab051.267d6","type":"function","z":"5805ee3f.7d54f","name":"create config channel","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\nvar output = {} ;\nif(order[0] === 'configChannels'){\n    context.global.saveConfigChannel = 'C:/Users/labo/.node-red/lib2/config/'+order[1]+\".json\" ;\n    output.filename =  context.global.saveConfigChannel;\n    output.payload =  \"create\";\n    context.global.listConfigChannel.push(order[1]+\".json\");\n    node.send(output);\n}","outputs":1,"noerr":0,"x":640,"y":1080,"wires":[["b3cfd06.aa6803"]]},{"id":"b3cfd06.aa6803","type":"file","z":"5805ee3f.7d54f","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","x":1590,"y":1080,"wires":[[]]},{"id":"2b62922c.5e1dbe","type":"file in","z":"5805ee3f.7d54f","name":"","filename":"C:\\Users\\labo\\.node-red\\lib2\\config\\list.txt","format":"utf8","chunk":false,"sendError":false,"x":1040,"y":160,"wires":[["a8027d11.1001b"]]},{"id":"a8027d11.1001b","type":"function","z":"5805ee3f.7d54f","name":"Initialisation","func":"context.global.listConfigChannel = msg.payload.split(\";\");\n//context.global.initialize = false ;\n//context.global.ressources = [] ;\n\n//context.global.test = [];\n","outputs":1,"noerr":0,"x":1310,"y":180,"wires":[[]]},{"id":"3463cb6e.d267c4","type":"function","z":"5805ee3f.7d54f","name":"extend config channel","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\nvar output = {} ;\nif(order[0] === 'configChannels'){\n    output.payload = \";\"+order[1]+\".json\";\n    node.send(output);\n}","outputs":1,"noerr":0,"x":640,"y":1120,"wires":[["8a6ef62c.93add8"]]},{"id":"8a6ef62c.93add8","type":"file","z":"5805ee3f.7d54f","name":"","filename":"C:\\Users\\labo\\.node-red\\lib2\\config\\list.txt","appendNewline":false,"createDir":true,"overwriteFile":"false","x":1480,"y":1120,"wires":[[]]},{"id":"f98cce8f.09cd","type":"debug","z":"5805ee3f.7d54f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1230,"y":940,"wires":[]},{"id":"e1cfe124.79f0b","type":"PriorProScan","z":"5805ee3f.7d54f","name":"","x":990,"y":680,"wires":[["882fdb4d.2c9878","13b85ff6.4b75f","f98cce8f.09cd","bc7cdb2d.115398"]]},{"id":"d486ff99.b7315","type":"debug","z":"5805ee3f.7d54f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1590,"y":1300,"wires":[]},{"id":"65186ca1.3db8a4","type":"debug","z":"5805ee3f.7d54f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1430,"y":940,"wires":[]},{"id":"3eb1091f.20d4d6","type":"function","z":"5805ee3f.7d54f","name":"live","func":"msg.payload =  context.global.Fluorescence2;\nmsg.topic = 'Fluorescence2';\nmsg.device =  context.global.Fluorescence2;\nmsg.mode = 'live';\nmsg.action = 'set' ;\nmsg.update = {\n  \"shutter\" : false,\n  \"intensity\" : 40\n}    \nreturn msg;","outputs":1,"noerr":0,"x":690,"y":520,"wires":[[]]},{"id":"78d09a47.7ad3a4","type":"inject","z":"5805ee3f.7d54f","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":560,"y":520,"wires":[["3eb1091f.20d4d6"]]},{"id":"7800ee7d.4abb2","type":"inject","z":"5805ee3f.7d54f","name":"","topic":"","payload":"STOP","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":220,"wires":[["54bb76a9.814a48"]]},{"id":"54bb76a9.814a48","type":"websocket out","z":"5805ee3f.7d54f","name":"","server":"e8e77e72.f768b","client":"","x":430,"y":260,"wires":[]},{"id":"e0c2db99.11e728","type":"inject","z":"5805ee3f.7d54f","name":"","topic":"","payload":",,,","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":260,"wires":[["54bb76a9.814a48","f60567d9.c909a8"]]},{"id":"fa18369c.c96b18","type":"inject","z":"5805ee3f.7d54f","name":"","topic":"","payload":"","payloadType":"date","repeat":"0.1","crontab":"","once":true,"onceDelay":0.1,"x":130,"y":180,"wires":[["bb59d88c.6e6ed8"]]},{"id":"f60567d9.c909a8","type":"debug","z":"5805ee3f.7d54f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":340,"y":340,"wires":[]},{"id":"134a603f.9b243","type":"json","z":"5805ee3f.7d54f","name":"","property":"payload","action":"","pretty":false,"x":310,"y":1420,"wires":[["81a7e786.4ba738"]]},{"id":"a8f2589b.d16958","type":"function","z":"5805ee3f.7d54f","name":"MM Kalina 1","func":"var mda = msg.payload ;\nvar test = {} ;\ntry {\n    if(mda['type'] === 'mda'){\n        //repeat sequence\n        for(var i=0; i<parseInt(mda.children[0].children[0].data.repeat);i++){\n            //node.warn(\"repeat:\"+mda.children[0].children[0].data.repeat);\n            //node.warn(\"time:\"+mda.children[0].children[0].data.time);\n            test[String(i*parseInt(mda.children[0].children[0].data.time*1000*60))] = [] ;\n            //node.warn(\"nbpos:\"+mda.children[0].children[0].children.length);\n        \n            //position\n            for(var ii=0; ii<mda.children[0].children[0].children.length;ii++){\n                test[String(i*parseInt(mda.children[0].children[0].data.time*1000*60))][ii] = [] ;\n            \n                //go to position x et y \n                test[String(i*parseInt(mda.children[0].children[0].data.time*1000*60))][ii].push(\n                    {\n                    'payload' :  context.global.MotionStage1,\n                    'topic' : 'MotionStage1',\n                    'device' :  context.global.MotionStage1,\n                    'mode' : 'MDA',\n                    'action' : 'set',\n                    'update' : {\n                        \"xPosition\" : parseInt(mda.children[0].children[0].children[ii].data.xPosition),\n                        \"yPosition\" : parseInt(mda.children[0].children[0].children[ii].data.yPosition),\n                        \"moveType\" : \"G\"\n                        }\n                    });\n                //go to z position\n                 test[String(i*parseInt(mda.children[0].children[0].data.time*1000*60))][ii].push(\n                    {\n                    'topic' : 'Microscope1',\n                    'device' : context.global.Microscope1,\n                    'action' : 'setZPosition',\n                    'mode' : 'MDA',\n                    'update' : {\n                        'zPosition': parseInt(mda.children[0].children[0].children[ii].data.zPosition),\n                        }\n                    });\n                    \n                //in the position\n                for(var iii=0; iii<mda.children[0].children[0].children[ii].children.length;iii++){\n                    //node.warn(mda.children[0].children[0].children[ii].children.length);\n                    //node.warn(mda.children[0].children[0].children[ii].length);\n                    //filter\n                    if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT'){\n                        test[String(i*parseInt(mda.children[0].children[0].data.time*1000*60))][ii].push(//set wheel filter\n                            {\n                            'topic' : 'Microscope1',\n                            'device' : context.global.Microscope1,\n                            'action' : 'setWheelFilter',\n                            'mode' : 'MDA',\n                            'update':{\n                                'wheelFilter': parseInt(mda.children[0].children[0].children[ii].children[iii].data.wheel)\n                                }\n                            });\n                    }\n                    //set Ligth\n                    for(var l=1; l<context.global.settingChannels.length; l++){\n                        //node.warn(context.global.settingChannels[l].name);\n                        //node.warn(mda.children[0].children[0].children[ii].children[ii*2].data.title2);\n                        if(context.global.settingChannels[l].name === mda.children[0].children[0].children[ii].children[iii].data.title2){\n                            //BF\n                            if(context.global.settingChannels[l].device === \"OLYMPUS-IX-81\"){\n                                test[String(i*parseInt(mda.children[0].children[0].data.time*1000*60))][ii].push({\n                                    'topic' : context.global.settingChannels[l].topic,\n                                    'device' : context.global.settingChannels[l].device,\n                                    'action' : 'setChannel',\n                                    'mode' : 'MDA',\n                                    'update' : {\n                                        'lamp' : true,\n                                        'intensity': parseInt(context.global.settingChannels[l].update.A[1]),\n                                        'shutter': true,\n                                        'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time)\n                                    } \n                                });\n                            }\n                            //COOLLED\n                            if(context.global.settingChannels[l].device === \"CoolLed-PE4000\"){\n                                test[String(i*parseInt(mda.children[0].children[0].data.time*1000*60))][ii].push({\n                                    'topic' : context.global.settingChannels[l].topic,\n                                    'device' : context.global.settingChannels[l].device,\n                                    'action' : 'set',\n                                    'mode' : 'MDA',\n                                    'update' : {\n                                        \"A\" :[parseInt(context.global.settingChannels[l].update.A[0]),parseInt(context.global.settingChannels[l].update.A[1]),context.global.settingChannels[l].update.A[0] == \"ON\" ? false : true],\n                                        \"B\" :[parseInt(context.global.settingChannels[l].update.B[0]),parseInt(context.global.settingChannels[l].update.B[1]),context.global.settingChannels[l].update.B[0] == \"ON\" ? false : true],\n                                        \"C\" :[parseInt(context.global.settingChannels[l].update.C[0]),parseInt(context.global.settingChannels[l].update.C[1]),context.global.settingChannels[l].update.C[0] == \"ON\" ? false : true],\n                                        \"D\" :[parseInt(context.global.settingChannels[l].update.D[0]),parseInt(context.global.settingChannels[l].update.D[1]),context.global.settingChannels[l].update.D[0] == \"ON\" ? false : true],\n                                        'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time)\n                                    }\n                                });\n                            }\n                            //BF\n                        }\n                    }\n                    if(mda.children[0].children[0].children[ii].children[iii].type === 'CAMERA')\n                        test[String(i*parseInt(mda.children[0].children[0].data.time*1000*60))][ii].push(\"photo\");\n                    //picture+af\n                }\n            }\n        }\n        msg.payload = test ;\n        return msg;   \n    }\n   \n}\ncatch(error){}\n","outputs":1,"noerr":0,"x":490,"y":1340,"wires":[[]]},{"id":"ab5e2022.212cc","type":"debug","z":"5805ee3f.7d54f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":590,"y":1420,"wires":[]},{"id":"3fabc478.cfceac","type":"CoolLedPe4000","z":"5805ee3f.7d54f","name":"PE4000","topic":"drive the PE-4000","x":1000,"y":800,"wires":[["882fdb4d.2c9878","13b85ff6.4b75f","bc7cdb2d.115398","f98cce8f.09cd"]]},{"id":"7ceaa5d0.c12d4c","type":"function","z":"5805ee3f.7d54f","name":"camera","func":"if(msg.topic === 'Camera1'){\n    context.global.camGrab = msg.action+\",\"+msg.prefixe+\",\"+msg.channel+\",\"+msg.position ;\n    msg.payload = \"done\";\n    msg.status = {\"SUCCESS\" : Date.now()};\n    return [msg]\n}\n","outputs":1,"noerr":0,"x":980,"y":620,"wires":[["882fdb4d.2c9878"]]},{"id":"81a7e786.4ba738","type":"function","z":"5805ee3f.7d54f","name":"","func":"var mda = msg.payload ;\nvar test = {} ;\n\n\ntry {\n    if(mda['type'] === 'mda'){\n        //repeat sequence\n        for(var i=0; i<parseInt(mda.children[0].children[0].data.repeat);i++){\n            //node.warn(\"repeat:\"+mda.children[0].children[0].data.repeat);\n            //node.warn(\"time:\"+mda.children[0].children[0].data.time);\n            test[String(i*parseInt(mda.children[0].children[0].data.time*1000*60))] = [] ;\n            //node.warn(\"nbpos:\"+mda.children[0].children[0].children.length);\n        \n            //position\n            for(var ii=0; ii<mda.children[0].children[0].children.length;ii++){\n                test[String(i*parseInt(mda.children[0].children[0].data.time*1000*60))][ii] = [] ;\n            \n                var titlePisition = mda.children[0].children[0].children[ii].title ;\n                           \n                //go to position x et y \n                test[String(i*parseInt(mda.children[0].children[0].data.time*1000*60))][ii].push(\n                    {\n                    'payload' :  context.global.MotionStage1,\n                    'topic' : 'MotionStage1',\n                    'device' :  context.global.MotionStage1,\n                    'mode' : 'MDA',\n                    'action' : 'set',\n                    'update' : {\n                        \"xPosition\" : parseInt(mda.children[0].children[0].children[ii].data.xPosition),\n                        \"yPosition\" : parseInt(mda.children[0].children[0].children[ii].data.yPosition),\n                        \"moveType\" : \"G\"\n                        }\n                    });\n                //go to z position\n                 test[String(i*parseInt(mda.children[0].children[0].data.time*1000*60))][ii].push(\n                    {\n                    'topic' : 'Microscope1',\n                    'device' : context.global.Microscope1,\n                    'action' : 'setZPosition',\n                    'mode' : 'MDA',\n                    'update' : {\n                        'zPosition': parseInt(mda.children[0].children[0].children[ii].data.zPosition),\n                        }\n                    });\n                    \n                //in the position\n                for(var iii=0; iii<mda.children[0].children[0].children[ii].children.length;iii++){\n                    //node.warn(mda.children[0].children[0].children[ii].children.length);\n                    //node.warn(mda.children[0].children[0].children[ii].length);\n                    //filter\n                    if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT'){\n                        test[String(i*parseInt(mda.children[0].children[0].data.time*1000*60))][ii].push(//set wheel filter\n                            {\n                            'topic' : 'Microscope1',\n                            'device' : context.global.Microscope1,\n                            'action' : 'setWheelFilter',\n                            'mode' : 'MDA',\n                            'update':{\n                                'wheelFilter': parseInt(mda.children[0].children[0].children[ii].children[iii].data.wheel)\n                                }\n                            });\n                    }\n                    //set Ligth\n                    for(var l=1; l<context.global.settingChannels.length; l++){\n                        //node.warn(context.global.settingChannels[l].name);\n                        //node.warn(mda.children[0].children[0].children[ii].children[ii*2].data.title2);\n                        if(context.global.settingChannels[l].name === mda.children[0].children[0].children[ii].children[iii].data.title2){\n                            //BF\n                            var titleChannel = mda.children[0].children[0].children[ii].children[iii].data.title2 ;\n                            if(context.global.settingChannels[l].device === \"OLYMPUS-IX-81\"){\n                                test[String(i*parseInt(mda.children[0].children[0].data.time*1000*60))][ii].push({\n                                    'topic' : context.global.settingChannels[l].topic,\n                                    'device' : context.global.settingChannels[l].device,\n                                    'action' : 'setChannel',\n                                    'mode' : 'MDA',\n                                    'update' : {\n                                        'lamp' : true,\n                                        'intensity': parseInt(context.global.settingChannels[l].update.A[1]),\n                                        'shutter': true,\n                                        'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time)\n                                    } \n                                });\n                            }\n                            //COOLLED\n                            if(context.global.settingChannels[l].device === \"CoolLed-PE4000\"){\n                                test[String(i*parseInt(mda.children[0].children[0].data.time*1000*60))][ii].push({\n                                    'topic' : context.global.settingChannels[l].topic,\n                                    'device' : context.global.settingChannels[l].device,\n                                    'action' : 'set',\n                                    'mode' : 'MDA',\n                                    'update' : {\n                                        \"A\" :[parseInt(context.global.settingChannels[l].update.A[0]),parseInt(context.global.settingChannels[l].update.A[1]),context.global.settingChannels[l].update.A[0] == \"ON\" ? false : true],\n                                        \"B\" :[parseInt(context.global.settingChannels[l].update.B[0]),parseInt(context.global.settingChannels[l].update.B[1]),context.global.settingChannels[l].update.B[0] == \"ON\" ? false : true],\n                                        \"C\" :[parseInt(context.global.settingChannels[l].update.C[0]),parseInt(context.global.settingChannels[l].update.C[1]),context.global.settingChannels[l].update.C[0] == \"ON\" ? false : true],\n                                        \"D\" :[parseInt(context.global.settingChannels[l].update.D[0]),parseInt(context.global.settingChannels[l].update.D[1]),context.global.settingChannels[l].update.D[0] == \"ON\" ? false : true],\n                                        'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time)\n                                    }\n                                });\n                            }\n                            //BF\n                        }\n                    }\n                    if(mda.children[0].children[0].children[ii].children[iii].type === 'CAMERA')\n                        test[String(i*parseInt(mda.children[0].children[0].data.time*1000*60))][ii].push({\n                            'topic' : 'Camera1',\n                            'device' : context.global.Camera1,\n                            'action' : 'GRAB',\n                            'prefixe' : mda['prefix'],\n                            'channel': titleChannel,\n                            'position' : titlePisition    \n                            });\n                    //picture+af\n                }\n            }\n        }\n        msg.payload = test ;\n        context.global.sequence2 = test ;\n        return msg;   \n    }\n   \n}\ncatch(error){}\n","outputs":1,"noerr":0,"x":430,"y":1460,"wires":[["ab5e2022.212cc"]]},{"id":"bb59d88c.6e6ed8","type":"function","z":"5805ee3f.7d54f","name":"","func":"msg.payload = context.global.camGrab ;\nif(context.global.camGrab !== context.global.camGrabOld){\n    context.global.camGrabOld = context.global.camGrab ;\n    return msg;\n}\n","outputs":1,"noerr":0,"x":290,"y":180,"wires":[["54bb76a9.814a48"]]},{"id":"7cf30c8c.9d6a94","type":"OlympusIx81","z":"5805ee3f.7d54f","name":"","x":1010,"y":860,"wires":[["bc7cdb2d.115398","f98cce8f.09cd","13b85ff6.4b75f","882fdb4d.2c9878"]]},{"id":"e55d6e46.0a55a","type":"file","z":"5805ee3f.7d54f","name":"","filename":"testMDA.txt","appendNewline":true,"createDir":true,"overwriteFile":"true","x":1630,"y":560,"wires":[[]]},{"id":"355fbd5a.adc732","type":"debug","z":"5805ee3f.7d54f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1630,"y":460,"wires":[]},{"id":"f5b7424b.763b7","type":"function","z":"5805ee3f.7d54f","name":"live","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\n//msg.action = 'setChannel';\nmsg.action = 'setWheelFilter';\n/*msg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 5000\n}*/\nmsg.update = {\n    \"wheelFilter\" : 3\n}\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":900,"wires":[["7cf30c8c.9d6a94"]]},{"id":"2e438bde.27e574","type":"inject","z":"5805ee3f.7d54f","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":560,"y":900,"wires":[["f5b7424b.763b7"]]},{"id":"ce439721.774368","type":"function","z":"cb80149c.966208","name":"protocole N","func":"var mda = msg.payload ;\nvar output = {} ;\n\ntry {\n    if(mda['type'] === 'mda'){\n        if(mda.children[0].data.algo === 'algo1'){\n            output = algo1(mda);\n        }\n        msg.payload = \"MDA-START\" ;\n        context.global.sequence2 = output ;\n        return msg;   \n    }\n   \n}\ncatch(error){}\n\nfunction algo1(mda){\n    \n    var test = {} ;\n    /*Algo 1\n    sequence\n    ----position\n\n        ----light\n        ----zs ou camera\n        ----light\n        ----zs ou came\n            ....\n    ----position\n        ....\n    */    \n    //repeat sequence\n        for(var i=0; i<parseInt(mda.children[0].children[0].data.repeat);i++){\n            test[String(i*parseInt(mda.children[0].children[0].data.time))] = [] ;\n\n            //position\n            for(var ii=0; ii<mda.children[0].children[0].children.length;ii++){\n                var titlePisition = mda.children[0].children[0].children[ii].title ;\n                var inject = [] ;           \n                //go to position x et y \n                inject.push({\n                    'payload' :  context.global.MotionStage1,\n                    'topic' : 'MotionStage1',\n                    'device' :  context.global.MotionStage1,\n                    'mode' : 'MDA',\n                    'action' : 'set',\n                    'update' : {\n                        \"xPosition\" : parseInt(mda.children[0].children[0].children[ii].data.xPosition),\n                        \"yPosition\" : parseInt(mda.children[0].children[0].children[ii].data.yPosition),\n                        \"moveType\" : \"G\"\n                        }\n                    });\n                //go to z position\n                /*inject.push({\n                    'topic' : 'Microscope1',\n                    'device' : context.global.Microscope1,\n                    'action' : 'setZposition',\n                    'mode' : 'MDA',\n                    'update' : {\n                        'zPosition': parseInt(mda.children[0].children[0].children[ii].data.zPosition),\n                        }\n                    });\n                */\n                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                var useAF = false ;\n                //in the position\n                for(var iii=0; iii<mda.children[0].children[0].children[ii].children.length;iii++){\n                    //filter\n                    var limit = 1 ;\n                    var keep = false ;\n                    var zPosition =parseInt(mda.children[0].children[0].children[ii].data.zPosition);\n                    var active = 0 ;\n                    //var option1 = false ;\n                    if(mda.children[0].children[0].children[ii].children[iii].type === 'AF'){\n                        inject = [] ;\n                        inject.push({\n                            'topic' : 'Microscope1',\n                            'device' : context.global.Microscope1,\n                            'action' : 'AF',\n                            'mode' : 'MDA',\n                            'update':{\n                                'AF': 'auto'\n                                }\n                            });\n                        test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                        useAF = true ;\n                        //option1 = mda.children[0].children[0].children[ii].children[iii].data.option1 ;\n                        //node.warn(option1);\n                        \n                    }\n                    if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT'){\n                        inject = [] ;\n                        inject.push({\n                            'topic' : 'Microscope1',\n                            'device' : context.global.Microscope1,\n                            'action' : 'setWheelFilter',\n                            'mode' : 'MDA',\n                            'update':{\n                                'wheelFilter': parseInt(mda.children[0].children[0].children[ii].children[iii].data.wheel)\n                                }\n                            });\n                        test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                    \n                        //if(option1===false){\n                            // detect image or zstack AND set limit for the repeat loop\n                            if(mda.children[0].children[0].children[ii].children[iii+1].type === 'CAMERA'){\n                                limit = 1 ;\n                                keep = false ;\n                                active = 0 ;\n                            }\n                            if(mda.children[0].children[0].children[ii].children[iii+1].type === 'ZS'){\n                                var zstart = parseInt(mda.children[0].children[0].children[ii].children[iii+1].data.zstart);\n                                var zend = parseInt(mda.children[0].children[0].children[ii].children[iii+1].data.zend);\n                                var zstep = parseInt(mda.children[0].children[0].children[ii].children[iii+1].data.zstep);\n                                var progress = parseInt(Math.abs(zstart-zend) / zstep) + 1 ;\n                                limit = progress ;\n                                keep = mda.children[0].children[0].children[ii].children[iii+1].data.shutter ;\n                                active = 1 ;\n                            }\n                        //}\n                        /*else {\n                            var nb = 0 ;\n                            for(var t=1;t<10000;t++){\n                                if((mda.children[0].children[0].children[ii].children[iii+t].type === 'CAMERA')|| (mda.children[0].children[0].children[ii].children[iii+t].type === 'ZS')) ;\n                                else {nb = t ;break;}\n                            }\n                            node.warn(\"WILL\");\n                            node.warn(nb);\n                        }*/\n                    }\n                       \n                     \n                        //////////////////////////////////////\n                    if(true) {\n                        for(var r=0;r<limit;r++){\n                            inject = [] ;\n                            inject.push({\n                                'topic' : 'Microscope1',\n                                'device' : context.global.Microscope1,\n                                'action' : 'setZposition',\n                                'mode' : 'MDA',\n                                'update' : {\n                                    'zPosition': zPosition + active * 100*(zstart + zstep * r)\n                                    }\n                                });\n                            if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT'){\n                                if(iii>0){\n                                    if((mda.children[0].children[0].children[ii].children[iii-1].type !== 'AF'))\n                                        test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                }\n                                if(iii===0) test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                            }\n                            //set Ligth\n                            if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT'){\n                                for(var l=1; l<context.global.settingChannels.length; l++){\n                                    if(context.global.settingChannels[l].name === mda.children[0].children[0].children[ii].children[iii].data.title2){\n                                        inject = [];\n                                        //BF\n                                        var titleChannel = mda.children[0].children[0].children[ii].children[iii].data.title2 ;\n                                        if(context.global.settingChannels[l].device === \"OLYMPUS-IX-81\"){\n                                            inject.push({\n                                                'topic' : context.global.settingChannels[l].topic,\n                                                'device' : context.global.settingChannels[l].device,\n                                                'action' : 'setChannel',\n                                                'mode' : 'MDA',\n                                                'update' : {\n                                                    'lamp' : true,\n                                                    'intensity': parseInt(context.global.settingChannels[l].update.A[1]),\n                                                    'shutter': true,\n                                                    'keep' : keep ,\n                                                    'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time)\n                                                } \n                                            });\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                        }\n                                        //COOLLED\n                                        if(context.global.settingChannels[l].device === \"CoolLed-PE-4000\"){\n                                            inject.push({\n                                                'topic' : context.global.settingChannels[l].topic,\n                                                'device' : context.global.settingChannels[l].device,\n                                                'action' : 'setChannel',\n                                                'mode' : 'MDA',\n                                                'update' : {\n                                                    \"A\" :[parseInt(context.global.settingChannels[l].update.A[0]),parseInt(context.global.settingChannels[l].update.A[1]),context.global.settingChannels[l].update.A[2] == \"ON\" ? false : true],\n                                                    \"B\" :[parseInt(context.global.settingChannels[l].update.B[0]),parseInt(context.global.settingChannels[l].update.B[1]),context.global.settingChannels[l].update.B[2] == \"ON\" ? false : true],\n                                                    \"C\" :[parseInt(context.global.settingChannels[l].update.C[0]),parseInt(context.global.settingChannels[l].update.C[1]),context.global.settingChannels[l].update.C[2] == \"ON\" ? false : true],\n                                                    \"D\" :[parseInt(context.global.settingChannels[l].update.D[0]),parseInt(context.global.settingChannels[l].update.D[1]),context.global.settingChannels[l].update.D[2] == \"ON\" ? false : true],\n                                                    'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time),\n                                                    'keep': keep\n                                                    }\n                                            });\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                        }\n                                    }\n                                }\n                            }\n                            if(mda.children[0].children[0].children[ii].children[iii].type === 'CAMERA'){\n                                inject = [];\n                                inject.push({\n                                    'topic' : 'Camera1',\n                                    'device' : context.global.Camera1,\n                                    'action' : 'GRAB',\n                                    'prefixe' : mda.children[0].data.prefixe,\n                                    'channel': titleChannel,\n                                    'position' : titlePisition    \n                                    });\n                                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                            }\n                            if((limit > 1)&&(mda.children[0].children[0].children[ii].children[iii].type !== 'ZS')){\n                                inject = [];\n                                inject.push({\n                                    'topic' : 'Camera1',\n                                    'device' : context.global.Camera1,\n                                    'action' : 'GRAB',\n                                    'prefixe' : mda.children[0].data.prefixe,\n                                    'channel': titleChannel,\n                                    'position' : titlePisition    \n                                    });\n                                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                            }\n                        \n                        }\n                    }\n                    if (mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT') useAF = false ;\n                }\n            }\n        \n            if(i === parseInt(mda.children[0].children[0].data.repeat)-1){\n                inject =\n                [{\n                'payload' : 'MDA-FINISH',\n                }];\n                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n            }            \n        }\n        return test ;    \n}","outputs":1,"noerr":0,"x":390,"y":600,"wires":[["e381bc1c.e5ad8","3b7f670a.f340d8"]]},{"id":"e7edb993.338178","type":"debug","z":"cb80149c.966208","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2970,"y":420,"wires":[]},{"id":"f83a8755.6ebcb8","type":"LdynamicsXCite","z":"cb80149c.966208","name":"X-Cite-120PC","topic":"drive the X-Cite-120PC","x":2360,"y":380,"wires":[["ac0464d2.d7a6a8","6e87ad65.84c384","af45d040.35ff9"]]},{"id":"bbe6e97a.dffed8","type":"link in","z":"cb80149c.966208","name":"","links":["3b7f670a.f340d8"],"x":1955,"y":240,"wires":[["da5842e.3c5aac","4eb85c6a.d927e4"]]},{"id":"a096bb80.0929c8","type":"link in","z":"cb80149c.966208","name":"","links":["753f8664.351ae8"],"x":2135,"y":280,"wires":[["bace8a16.5d18c8","657c5962.be6f98"]]},{"id":"4989917b.b7a27","type":"file in","z":"cb80149c.966208","name":"","filename":"C:\\Users\\Williams\\.node-red\\lib\\mda\\list.txt","format":"utf8","chunk":false,"sendError":false,"x":440,"y":400,"wires":[["926c9dd8.a064b"]]},{"id":"926c9dd8.a064b","type":"function","z":"cb80149c.966208","name":"Initialisation","func":"context.global.listConfigMda = msg.payload.split(\";\");\n//context.global.initialize = false ;\n//context.global.ressources = [] ;\n\n//context.global.test = [];\n","outputs":1,"noerr":0,"x":730,"y":400,"wires":[[]]},{"id":"8a14bd8a.cd608","type":"function","z":"cb80149c.966208","name":"save config mda","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\";\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\nvar output = {} ;\nif(order[0] === 'saveMDA'){\n    if(order[1]===''){\n        output.filename = context.global.saveConfigMda ;\n    }\n    else {\n        context.global.saveConfigMda = 'C:/Users/Williams/.node-red/lib/mda/'+order[1]+'.json';\n        output.filename = context.global.saveConfigMda ;\n        context.global.listConfigMda.push(order[1]+\".json\");\n    }\n    output.payload = order[2];\n    node.send(output);\n}","outputs":1,"noerr":0,"x":2000,"y":960,"wires":[["a975f35f.b8fed"]]},{"id":"a975f35f.b8fed","type":"file","z":"cb80149c.966208","name":"","filename":"","appendNewline":true,"createDir":true,"overwriteFile":"true","x":2350,"y":960,"wires":[[]]},{"id":"214c2af.76f8ad6","type":"function","z":"cb80149c.966208","name":"extend config mda","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\";\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\nvar output = {} ;\nif((order[0] === 'saveMDA')&&(order[1]!=='')){\n    output.payload = \";\"+order[1]+\".json\";\n    node.send(output);\n}","outputs":1,"noerr":0,"x":2010,"y":1000,"wires":[["ae5a2734.ec91f8"]]},{"id":"ae5a2734.ec91f8","type":"file","z":"cb80149c.966208","name":"","filename":"C:\\Users\\Williams\\.node-red\\lib\\mda\\list.txt","appendNewline":false,"createDir":true,"overwriteFile":"false","x":2460,"y":1000,"wires":[[]]},{"id":"2bab3a9e.e33206","type":"function","z":"cb80149c.966208","name":"filter Tree","func":"if(msg.payload.substr(0,11) === '{\"expanded\"') return msg;","outputs":1,"noerr":0,"x":100,"y":640,"wires":[["65d3917.0dcdf7","e381bc1c.e5ad8"]]},{"id":"3b7f670a.f340d8","type":"link out","z":"cb80149c.966208","name":"MDA-START","links":["bbe6e97a.dffed8"],"x":515,"y":680,"wires":[]},{"id":"da5842e.3c5aac","type":"delay","z":"cb80149c.966208","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2100,"y":240,"wires":[["657c5962.be6f98","c9c2d993.9b2278"]]},{"id":"753f8664.351ae8","type":"link out","z":"cb80149c.966208","name":"MDA-FINISH","links":["a096bb80.0929c8","32a465e5.ebab3a"],"x":655,"y":980,"wires":[]},{"id":"65b25a9e.990344","type":"websocket out","z":"cb80149c.966208","name":"","server":"da7e8f9b.c87dc","client":"","x":2940,"y":480,"wires":[]},{"id":"59e19566.4a551c","type":"function","z":"cb80149c.966208","name":"name GRAB","func":"if(msg.payload !== 'STOP'){\n    msg.payload = msg.update.name;\n    node.send(msg);\n}","outputs":1,"noerr":0,"x":2670,"y":480,"wires":[["65b25a9e.990344","f3aada68.2ffea8"]]},{"id":"f3aada68.2ffea8","type":"debug","z":"cb80149c.966208","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2670,"y":440,"wires":[]},{"id":"ad1b264.f7a68d8","type":"function","z":"cb80149c.966208","name":"MODIF1","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\n\n    \nif((order[0] === 'posLigth')&&(order.length === 5)){\n    \n    if (!isNaN(parseInt(order[4])))\n        context.global.settingChannels[parseInt(order[1])]['update'][order[2]][parseInt(order[3])] = parseInt(order[4]) ;\n    else \n        context.global.settingChannels[parseInt(order[1])]['update'][order[2]][parseInt(order[3])] = (order[4]) ;\n    msg.payload =  context.global.settingChannels;\n    if(context.global.saveConfigChannel !== '' ) msg.filename = context.global.saveConfigChannel;\n    myObject = context.global.settingChannels[parseInt(order[1])]['update'];\n    lettrine = String.fromCharCode(64+Object.keys(myObject).length);\n    msg.topic = 'mappingcolor'+context.global.settingChannels[parseInt(order[1])]['update'][lettrine][0] ;\n    msg.topic = msg.topic.replace('#','');\n    return msg ;\n}\nif((order[0] === 'posLigth')&&(parseInt(order[1])!==-1)&&(order.length===2)){\n    msg.payload =  context.global.settingChannels;\n    if(context.global.saveConfigChannel !== '' ) msg.filename = context.global.saveConfigChannel;\n    myObject = context.global.settingChannels[parseInt(order[1])]['update'];\n    lettrine = String.fromCharCode(64+Object.keys(myObject).length);\n    msg.topic = 'mappingcolor'+context.global.settingChannels[parseInt(order[1])]['update'][lettrine][0] ;\n    msg.topic = msg.topic.replace('#','');\n    return msg ;\n}\nif((order[0] === 'posLigth')&&(parseInt(order[1])===-1)){\n    msg.payload =  context.global.settingChannels;\n    if(context.global.saveConfigChannel !== '' ) msg.filename = context.global.saveConfigChannel;\n    msg.topic = 'mappingcolor808080' ;\n    return msg ;\n}","outputs":1,"noerr":0,"x":640,"y":1560,"wires":[["958e58ce.90a3f8","3ba95c06.a74dd4","dbf4833.ea2c38"]]},{"id":"af1cb922.66af28","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"http://127.0.0.1:5000/mappingcolor00FF80","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":930,"y":1220,"wires":[["635e66f8.2b59a8","7b9a8543.bd829c","229e3f4.30256c"]]},{"id":"635e66f8.2b59a8","type":"http request","z":"cb80149c.966208","name":"","method":"GET","ret":"txt","url":"","tls":"","x":1140,"y":1220,"wires":[[]]},{"id":"7b9a8543.bd829c","type":"http response","z":"cb80149c.966208","name":"","statusCode":"","headers":{},"x":1180,"y":1140,"wires":[]},{"id":"229e3f4.30256c","type":"multipart-encoder","z":"cb80149c.966208","name":"","statusCode":"","ignoreMessages":true,"outputOneNew":false,"outputIfSingle":false,"outputIfAll":false,"globalHeaders":{"Content-Type":"multipart/x-mixed-replace;boundary=--myboundary","Connection":"keep-alive","Expires":"Fri, 01 Jan 1990 00:00:00 GMT","Cache-Control":"no-cache, no-store, max-age=0, must-revalidate","Pragma":"no-cache"},"partHeaders":{"Content-Type":"image/jpeg"},"destination":"single","highWaterMark":16384,"x":1220,"y":1060,"wires":[[]]},{"id":"dbf4833.ea2c38","type":"http request","z":"cb80149c.966208","name":"","method":"GET","ret":"txt","url":"http://192.168.1.7:5000/{{{topic}}}","tls":"","x":810,"y":1560,"wires":[["958e58ce.90a3f8"]]},{"id":"f17e8051.a9b65","type":"inject","z":"cb80149c.966208","name":"replay","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":280,"y":1720,"wires":[["538df9c0.1052c8"]]},{"id":"538df9c0.1052c8","type":"change","z":"cb80149c.966208","name":"","rules":[{"t":"set","p":"cacheControl","pt":"msg","to":"REPLAY","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":1720,"wires":[[]]},{"id":"77f36e6c.ef5fa","type":"pythonshell in","z":"cb80149c.966208","pyfile":"C:/Users/Williams/Desktop/node-red-contrib-photometrics-evolv-512/PhotometricsEvolv512/app.py","x":360,"y":200,"wires":[["58f193c0.a2be3c"]],"icon":"node-red/camera.png"},{"id":"3d8d029c.94e0de","type":"comment","z":"cb80149c.966208","name":"MODFI 1","info":"","x":420,"y":180,"wires":[]},{"id":"4eb85c6a.d927e4","type":"function","z":"cb80149c.966208","name":"MODIF1","func":"msg.payload =  'quit';\nmsg.topic   = 'quit';\nreturn msg ;","outputs":1,"noerr":0,"x":2100,"y":140,"wires":[["f2b71e21.05c14"]]},{"id":"f2b71e21.05c14","type":"http request","z":"cb80149c.966208","name":"","method":"GET","ret":"txt","url":"http://192.168.1.7:5000/{{{topic}}}","tls":"","x":2370,"y":100,"wires":[[]]},{"id":"58f193c0.a2be3c","type":"debug","z":"cb80149c.966208","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":570,"y":220,"wires":[]},{"id":"a0026845.d77168","type":"function","z":"cb80149c.966208","name":"MODIF1","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\n\n    \nif((order[0] === 'posInvert')){\n    msg.payload =  \"\";\n    msg.topic = 'invert'+ order[1] ;\n    return msg ;\n}\nif((order[0] === 'posExposure')){\n    msg.payload =  \"\";\n    msg.topic = 'exposure'+ parseInt(order[1]) ;\n    return msg ;\n}\nif((order[0] === 'posMap')){\n    msg.payload =  \"\";\n    msg.topic = 'map'+ (order[1]) ;\n    return msg ;\n}\nif((order[0] === 'mappingcolor')){\n    msg.payload =  \"\";\n    msg.topic = 'mappingcolor'+ (order[1]) ;\n    return msg ;\n}","outputs":1,"noerr":0,"x":640,"y":1600,"wires":[["dbf4833.ea2c38"]]},{"id":"860c0e33.38f85","type":"debug","z":"cb80149c.966208","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2650,"y":800,"wires":[]},{"id":"3a28cc28.82ee24","type":"function","z":"cb80149c.966208","name":"protocole N MODIF","func":"var mda = msg.payload ;\nvar output = {} ;\n\ntry {\n    if(mda['type'] === 'mda'){\n        if(mda.children[0].data.algo === 'algo1'){\n            output = algo1(mda);\n        }\n        msg.payload = \"MDA-START\" ;\n        context.global.sequence2 = output ;\n        return msg;   \n    }\n   \n}\ncatch(error){}\n\nfunction algo1(mda){\n    \n    var test = {} ;\n    /*Algo 1\n    sequence\n    ----position\n        ----light\n        ----zs ou camera\n        ----light\n        ----zs ou came\n            ....\n    ----position\n        ....\n    */    \n    //repeat sequence\n        for(var i=0; i<parseInt(mda.children[0].children[0].data.repeat);i++){\n            test[String(i*parseInt(mda.children[0].children[0].data.time))] = [] ;\n\n            //position\n            for(var ii=0; ii<mda.children[0].children[0].children.length;ii++){\n                var titlePisition = mda.children[0].children[0].children[ii].title ;\n                var inject = [] ;           \n                //go to position x et y \n                inject.push({\n                    'payload' :  context.global.MotionStage1,\n                    'topic' : 'MotionStage1',\n                    'device' :  context.global.MotionStage1,\n                    'mode' : 'MDA',\n                    'action' : 'set',\n                    'update' : {\n                        \"xPosition\" : parseInt(mda.children[0].children[0].children[ii].data.xPosition),\n                        \"yPosition\" : parseInt(mda.children[0].children[0].children[ii].data.yPosition),\n                        \"moveType\" : \"G\"\n                        }\n                    });\n                //go to z position\n                /*inject.push({\n                    'topic' : 'Microscope1',\n                    'device' : context.global.Microscope1,\n                    'action' : 'setZposition',\n                    'mode' : 'MDA',\n                    'update' : {\n                        'zPosition': parseInt(mda.children[0].children[0].children[ii].data.zPosition),\n                        }\n                    });\n                */\n                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                //in the position\n                for(var iii=0; iii<mda.children[0].children[0].children[ii].children.length;iii++){\n                    //filter\n                    var limit = 1 ;\n                    var keep = false ;\n                    var zPosition =parseInt(mda.children[0].children[0].children[ii].data.zPosition);\n                    node.warn(zPosition);\n                    var active = 0 ;\n                    if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT'){\n                        inject = [] ;\n                        inject.push({\n                            'topic' : 'Microscope1',\n                            'device' : context.global.Microscope1,\n                            'action' : 'setWheelFilter',\n                            'mode' : 'MDA',\n                            'update':{\n                                'wheelFilter': parseInt(mda.children[0].children[0].children[ii].children[iii].data.wheel)\n                                }\n                            });\n                        test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                    \n                        // detect image or zstack AND set limit for the repeat loop\n                        if(mda.children[0].children[0].children[ii].children[iii+1].type === 'CAMERA'){\n                            limit = 1 ;\n                            keep = false ;\n                            active = 0 ;\n                        }\n                        if(mda.children[0].children[0].children[ii].children[iii+1].type === 'ZS'){\n                            var zstart = parseInt(mda.children[0].children[0].children[ii].children[iii+1].data.zstart);\n                            var zend = parseInt(mda.children[0].children[0].children[ii].children[iii+1].data.zend);\n                            var zstep = parseInt(mda.children[0].children[0].children[ii].children[iii+1].data.zstep);\n                            var progress = parseInt(Math.abs(zstart-zend) / zstep) + 1 ;\n                            limit = progress ;\n                            keep = mda.children[0].children[0].children[ii].children[iii+1].data.shutter ;\n                            active = 1 ;\n                        }\n                    }\n                        \n                        //////////////////////////////////////\n                    if(true) {\n                        for(var r=0;r<limit;r++){\n                            \n                            //if((r!==0)){\n                            inject = [] ;\n                            inject.push({\n                                'topic' : 'Microscope1',\n                                'device' : context.global.Microscope1,\n                                'action' : 'setZposition',\n                                'mode' : 'MDA',\n                                'update' : {\n                                    'zPosition': zPosition + active * 100*(zstart + zstep * r)\n                                    }\n                                });\n                            if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT')\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                            //}\n                       \n                            //set Ligth\n                            if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT'){\n                                for(var l=1; l<context.global.settingChannels.length; l++){\n                                    if(context.global.settingChannels[l].name === mda.children[0].children[0].children[ii].children[iii].data.title2){\n                                        inject = [];\n                                        //BF\n                                        var titleChannel = mda.children[0].children[0].children[ii].children[iii].data.title2 ;\n                                        if(context.global.settingChannels[l].device === \"OLYMPUS-IX-81\"){\n                                            inject.push({\n                                                'topic' : context.global.settingChannels[l].topic,\n                                                'device' : context.global.settingChannels[l].device,\n                                                'action' : 'setChannel',\n                                                'mode' : 'MDA',\n                                                'update' : {\n                                                    'lamp' : true,\n                                                    'intensity': parseInt(context.global.settingChannels[l].update.A[1]),\n                                                    'shutter': true,\n                                                    'keep' : keep ,\n                                                    'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time)\n                                                } \n                                            });\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                        }\n                                        //COOLLED\n                                        if(context.global.settingChannels[l].device === \"CoolLed-PE-4000\"){\n                                            inject.push({\n                                                'topic' : context.global.settingChannels[l].topic,\n                                                'device' : context.global.settingChannels[l].device,\n                                                'action' : 'setChannel',\n                                                'mode' : 'MDA',\n                                                'update' : {\n                                                    \"A\" :[parseInt(context.global.settingChannels[l].update.A[0]),parseInt(context.global.settingChannels[l].update.A[1]),context.global.settingChannels[l].update.A[2] == \"ON\" ? false : true],\n                                                    \"B\" :[parseInt(context.global.settingChannels[l].update.B[0]),parseInt(context.global.settingChannels[l].update.B[1]),context.global.settingChannels[l].update.B[2] == \"ON\" ? false : true],\n                                                    \"C\" :[parseInt(context.global.settingChannels[l].update.C[0]),parseInt(context.global.settingChannels[l].update.C[1]),context.global.settingChannels[l].update.C[2] == \"ON\" ? false : true],\n                                                    \"D\" :[parseInt(context.global.settingChannels[l].update.D[0]),parseInt(context.global.settingChannels[l].update.D[1]),context.global.settingChannels[l].update.D[2] == \"ON\" ? false : true],\n                                                    'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time),\n                                                    'keep': keep\n                                                    }\n                                            });\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                        }\n                                    }\n                                }\n                            }\n                            if(mda.children[0].children[0].children[ii].children[iii].type === 'CAMERA'){\n                                inject = [];\n                                inject.push({\n                                    'topic' : 'Camera1',\n                                    'device' : context.global.Camera1,\n                                    'action' : 'GRAB',\n                                    'prefixe' : mda.children[0].data.prefixe,\n                                    'channel': titleChannel,\n                                    'position' : titlePisition    \n                                    });\n                                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                            }\n                            if((limit > 1)&&(mda.children[0].children[0].children[ii].children[iii].type !== 'ZS')){\n                                inject = [];\n                                inject.push({\n                                    'topic' : 'Camera1',\n                                    'device' : context.global.Camera1,\n                                    'action' : 'GRAB',\n                                    'prefixe' : mda.children[0].data.prefixe,\n                                    'channel': titleChannel,\n                                    'position' : titlePisition    \n                                    });\n                                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                            }\n                        \n                        }\n                        ////////////////////////////\n                    }//picture+af\n                    //faire el stop\n                    //af et zs\n                }\n            }\n        \n            if(i === parseInt(mda.children[0].children[0].data.repeat)-1){\n              //  node.warn(\"TR\");\n                inject =\n                [{\n                'payload' : 'MDA-FINISH',\n                }];\n                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n            }            \n        }\n        return test ;    \n}","outputs":1,"noerr":0,"x":1890,"y":1760,"wires":[[]]},{"id":"1e88aa94.fbce05","type":"inject","z":"34847536.cbb3ea","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":690,"y":300,"wires":[["b3cc782f.148998","3f882c61.e40184","a102512d.c671c","6dd8ff64.c7dbd","e63a1898.be8e58","ff4c62bc.e86c"]]},{"id":"75d402bd.85f05c","type":"inject","z":"34847536.cbb3ea","name":"STOP","topic":"","payload":"MDA-FINISH","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":610,"y":660,"wires":[["4265f253.30799c","827a258f.2eedf8"]]},{"id":"4265f253.30799c","type":"function","z":"34847536.cbb3ea","name":"stop MDA time Order","func":"if(msg.payload === 'MDA-FINISH'){\n    context.global.startMDA = 0 ;\n    node.status ({fill:\"red\",shape:\"dot\", text: \"STOP\"});\n    var msg = {} ;\n    msg.payload = \"STOP,\"+Date.now();\n    node.send(msg);\n}\nif(msg.payload === 'MDA-START'){\n    context.global.startMDA = 1 ;\n    node.status ({text: \"waiting stop ...\"});\n}","outputs":1,"noerr":0,"x":920,"y":640,"wires":[["32b74b91.fc95b4"]]},{"id":"a102512d.c671c","type":"function","z":"34847536.cbb3ea","name":"Initialisation","func":"context.global.startMDA = 0 ;\n\ncontext.global.sync = 0 ;\ncontext.global.sync2 = 0 ;\ncontext.global.sync3 = 0 ;\ncontext.global.sync4 = 0 ;\n\ncontext.global.settingChannels = [];\ncontext.global.saveConfigChannel = '' ;\ncontext.global.saveConfigMda = '' ;\n\n\n\ncontext.global.camGrab = \"\";\ncontext.global.camGrabOld = \"\" ;\n\n//context.global.Fluorescence1 = 'CoolLed-PE4000';\n//context.global.listConfigChannel = ['williams1.json'] ;\n//context.global.initialize = false ;\n//context.global.ressources = [] ;\n\n//context.global.test = [];\n","outputs":1,"noerr":0,"x":890,"y":240,"wires":[[]]},{"id":"f573342c.345a58","type":"http in","z":"34847536.cbb3ea","name":"","url":"/missmarple","method":"get","upload":false,"swaggerDoc":"","x":2340,"y":1120,"wires":[["7c31b23.d05d34c"]]},{"id":"63dc746f.f69a5c","type":"http response","z":"34847536.cbb3ea","name":"","x":2810,"y":1120,"wires":[]},{"id":"7c31b23.d05d34c","type":"template","z":"34847536.cbb3ea","name":"MissMarpleHTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->\n    <meta name=\"description\" content=\"\">\n    <meta name=\"author\" content=\"\">\n    <link rel=\"icon\" href=\"bootstrap/favicon.ico\">\n\n    <title>Miss Marple | Bootstrap</title>\n\n    <script>\n    </script>\n\n    <link href=\"bootstrap/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link href=\"bootstrap/assets/css/ie10-viewport-bug-workaround.css\" rel=\"stylesheet\">\n    <link href=\"bootstrap/dashboard.css\" rel=\"stylesheet\">\n    <link href=\"css/style1.css\" rel=\"stylesheet\">\n    <script src=\"bootstrap/assets/js/ie-emulation-modes-warning.js\"></script>\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js\"></script>\n    <script src=\"js/js1.js\"></script>\n    \n    <script src=\"//code.jquery.com/jquery-3.3.1.min.js\"></script>\n    \n    <!-- This demo uses an 3rd-party, jQuery UI based context menu -->\n    <link href=\"//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css\" rel=\"stylesheet\">\n    <script src=\"//code.jquery.com/ui/1.12.1/jquery-ui.min.js\"></script>\n    <!-- jquery-contextmenu (https://github.com/mar10/jquery-ui-contextmenu/) -->\n    <script src=\"//cdn.jsdelivr.net/npm/ui-contextmenu/jquery.ui-contextmenu.min.js\"></script>\n    \n    <link href=\"fancytree-master/src/skin-win8/ui.fancytree.css\" rel=\"stylesheet\">\n    <script src=\"fancytree-master/src/jquery.fancytree.js\"></script>\n    <script src=\"fancytree-master/src/jquery.fancytree.dnd5.js\"></script>\n    <script src=\"fancytree-master/src/jquery.fancytree.edit.js\"></script>\n    <script src=\"fancytree-master/src/jquery.fancytree.gridnav.js\"></script>\n    <script src=\"fancytree-master/src/jquery.fancytree.table.js\"></script>\n    <script src=\"fancytree-master/src/jquery.fancytree.multi.js\"></script>\n    \n    <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.css\">\n    <script src=\"//cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.js\"></script>\n  \n    <style type=\"text/css\">\n      .ui-menu {\n        width: 200px;\n        height: 30px;\n        font-size: 63%;\n      }\n      .ui-menu kbd { /* Keyboard shortcuts for ui-contextmenu titles */\n        float: right;\n      }\n      /* custom alignment (set by 'renderColumns'' event) */\n      td.alignRight {\n         text-align: right;\n      }\n      td.alignCenter {\n         text-align: center;\n      }\n      td input[type=input] {\n        width: 40px;\n      }\n       span.drag-source {\n    border: 1px solid lightgray;\n    border-radius: 3px;\n    padding: 2px;\n    background-color: silver\n  }\n\n  ul.fancytree-container {\n    max-height: 200px;\n    overflow-y: scroll;\n  }\n\n  span.fancytree-node.fancytree-drag-source {\n    outline: 1px dotted grey;\n  }\n  span.fancytree-node.fancytree-drop-accept {\n    outline: 1px dotted green;\n  }\n  span.fancytree-node.fancytree-drop-reject {\n    outline: 1px dotted red;\n  }\n\n    </style>\n\n\n  </head>\n\n  <body  onload=\"wsConnect();\" onunload=\"ws.onclose();\">\n    \n     <div id=\"wait\" style=\"text-align: center;\" >\n        <img style=\"margin: 0 auto;\" src='media/Audit.png'><img style=\"margin: 0 auto;\" src='media/loading.gif'>\n        <br>\n        <h2>Loading parameters, please wait a few seconds</h2>\n     </div>\n    \n     <div id=\"main\">\n         <nav class=\"navbar navbar-inverse navbar-fixed-top\">\n          <div class=\"container-fluid\">\n            <div class=\"navbar-header\">\n              <button type=\"button\" class=\"navbar-toggle collapsed\" data-toggle=\"collapse\" data-target=\"#navbar\" aria-expanded=\"false\" aria-controls=\"navbar\">\n                <span class=\"sr-only\">Toggle navigation</span>\n                <span class=\"icon-bar\"></span>\n                <span class=\"icon-bar\"></span>\n                <span class=\"icon-bar\"></span>\n              </button>\n              <a class=\"navbar-brand\" href=\"#\"><img src=\"e475238aca49b9f6bb53cc4138fbdb27--funny-caricatures-celebrity-caricatures.jpg\" style=\"width: 40px; height: 50px\"></a>\n              <a class=\"navbar-brand\" href=\"#\">Miss Marple</a>\n              <a class=\"navbar-brand\" href=\"#\"><div id=\"status\"></div></a>\n              <a class=\"navbar-brand\" href=\"#\"><div id=\"name_user\"></div></a>\n            </div>\n            \n            <div id=\"navbar\" class=\"navbar-collapse collapse\">\n              <ul class=\"nav navbar-nav navbar-right\">\n                <li><a href=\"#\"><!--<img src=\"user.png\" style=\"width: 40px; height: 50px\">--></a></li>\n              </ul>\n            </div>\n          </div>\n        </nav>\n    \n    \n        <div class=\"container-fluid\">\n          <div class=\"row\">\n            <div class=\"col-sm-3 col-md-2 sidebar\">\n              <ul class=\"nav nav-sidebar\">\n                <li><a href=\"#\"></a></li>\n                <li id='livemodeli'><a href=\"javascript: live_mode();\">Live mode<span class=\"sr-only\" ></span></a></li>\n                <li id='settingschannelsli'><a href=\"javascript: setting();\">Settings Channels<span class=\"sr-only\"></span></a></li>\n                <li id='mdali'><a href=\"javascript: mda();\">MDA<span class=\"sr-only\" ></span></a></li>\n              </ul>\n            </div>\n            <div class=\"col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main\">    \n    \n            \n            <br>\n            <div id=\"receive\"></div>\n            <hr/>\n            <div id=\"alert-success\" class=\"alert alert-success\" role=\"alert\"></div>\n            <!--<div id=\"alert-warning\"  class=\"alert alert-warning\" role=\"alert\"></div>          -->\n\n          <div id=\"live_mode\">\n            <h2 class=\"sub-header\">Live mode</h2>\n<!--            -->\n            <div id=\"live_div\" class=\"table-responsive\">\n                <!--<span class=\"drag-source\" draggable=\"true\" id=\"live_olympusix81\"><img src='icons/OlympusIx81.png'>&nbsp;OLYMPUS-IX-81</span>-->\n                <img src='icons/work_in_progress.jpg'>\n            </div>    \n          </div>\n  \n          <div id=\"settings\">\n              <h2 class=\"sub-header\">Settings channels</h2>\n                <div id=\"name_configChannels\">\n                </div>\n                <div id=\"available_configChannels\">\n                </div>\n                <br>\n                <!--<button class='setting_button' alt='load channel' id=\"setting_button_load_channel\"><img src='icons/arrow_up.png'> Load a new setting channel configuration</button>-->\n                <button class='setting_button' alt='add channel' id=\"setting_button_add_channel\"><img src='icons/add.png'> Add a new setting channel</button>\n                <!--<button class='setting_button' alt='new configuration' id=\"setting_button_new_configChannel\"><img src='icons/add.png'> New configuration</button><br><br>-->\n                <div id='Enlightened'></div><br>\n                <form method=\"post\" id='setting_channel_form' action=\"/formpost\" ajax=\"true\">\n                      <!--<label hidden id='label_config'> Name: &nbsp;&nbsp;</label><input hidden required type='text' id='name_config' name=\"nam_config\" ><br>-->\n                      <div id=\"setting_table_channel\" class=\"table-responsive\"></div>\n                      <button type='submit' alt='save' class='setting_button' id='setting_button_save_channel'><img src='icons/disk.png'> Save the current settings</button>\n                </form>\n                <br>\n                <hr/>\n                \n<!--                Futur<br>\n                <button type='setting_button' alt='export setting' class='setting_button' id=\"setting_button_export_channel\"> Load</button>\n                <button type='setting_button' alt='import setting' class='setting_button' id=\"setting_button_import_channel\"> Save as</button>\n    -->             \n          </div>\n                \n          \n          <div id=\"mda\">\n            <h2 class=\"sub-header\">Multi-dimensional Acquisition</h2>\n                \n                <div id=\"name_configMda\">\n                </div>\n                <div id=\"available_configMda\">\n                </div>\n                <div id=\"available_channels_mda\">\n                </div>\n\n                <div id=\"available_ressources\">\n                    <span>Available resources and functions</span><br>\n                    <span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Simple picture');\"><img src='icons/camera.png'>&nbsp;Simple picture</span>\n                    &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Autofocus');\"><img src='icons/autofocus.png'>&nbsp;Autofocus</span>\n                    &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Z-stack');\"><img src='icons/zstack.png'>&nbsp;Z-stack</span>\n                    &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'XYZ Position');\"><img src='icons/yxz-512.png'>&nbsp;XYZ-position</span>\n                    &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Sequence');\"><img src='icons/arrow_rotate_clockwise.png'>&nbsp;Sequence</span>\n                          &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Group Position');\"><img src='icons/plugin.png'>&nbsp;Group-position</span>\n             </div>\n                <h3>Definition of the experimental protocol</h3><hr/>\n\n                <table id=\"\" class=\"table table-striped\">\n                    <tbody>\n                        <tr>\n                            <th style=\"width:50%;\">                \n                                <!--<button class='' alt='load' id=\"\"><img src='icons/arrow_up.png'> Load a existing protocol</button>-->\n                                <button class='' alt='new' id=\"\"><img src='icons/add.png'> New protocol</button><br><br>\n                                <table id=\"tree\">\n                                    <colgroup>\n                                        <col width=\"1%\">\n                                        <col width=\"1%\">\n                                        <col width=\"38%\">\n                                        <col width=\"10%\">\n                                    </colgroup>\n                                    <thead>\n                                        <tr> <th></th> <th></th> <th></th> <th></th> <!--<th>Z-stacks</th> <th>Autofocus</th> <th>Save Images</th> <th>Comment</th> <th>Color</th>--> </tr>\n                                    </thead>\n                                    <tbody>\n                                      <tr>\n                                        <td class=\"alignCenter\"></td>\n                                        <td></td>\n                                        <td></td>\n                                        <td class=\"alignCenter\"></td>\n                                      </tr>\n                                    </tbody>\n                                </table>\n                            </th>\n                            <th style=\"width:50%;\">                \n                                <!--<label>PDMS chip:</label> <select><option>1</option><option>2</option></select><br>\n                                <img width=\"100%\" src='icons/test_uf.png'><br>\n                                <hr/>-->\n                                <button class='setting_button' alt='save' id='setting_button_save_configMda'><img src='icons/disk.png'>Save the protocol</button>\n                                <hr/>\n                                <p>Active: <span id=\"lblActive\">-</span></p>\n                                <hr/>\n                                <button onclick=test();>TEST</button>\n                                \n                            </th>\n                        </tr>\n                    </tbody>\n                </table>\n  <!-- (Irrelevant source removed.) -->\n  \n  <script>\n  </script>\n\n            </div>\n            <!--</strong>-->\n            \n          </div>\n    \n              \n        </div>\n      </div>\n    </div>\n<!-- Bootstrap core JavaScript Placed at the end of the document so the pages load faster -->\n    <script>window.jQuery || document.write('<script src=\"bootstrap/assets/js/vendor/jquery.min.js\"><\\/script>')</script>\n    <script src=\"bootstrap/dist/js/bootstrap.min.js\"></script>\n    <script src=\"bootstrap/assets/js/vendor/holder.min.js\"></script>\n    <script src=\"bootstrap/assets/js/ie10-viewport-bug-workaround.js\"></script>\n    <script type=\"text/javascript\">\n    /*$.confirm({\n    title: 'WELCOME !',\n    theme: \"supervan\",\n    content: '' +\n    '<form action=\"\" class=\"formName\">' +\n    '<div class=\"form-group\">' +\n    '<label>Enter your name</label>' +\n    '<input type=\"text\" placeholder=\"Your name\" class=\"name form-control\" required />' +\n    '</div>' +\n    '</form>',\n    buttons: {\n        formSubmit: {\n            text: 'Submit',\n            btnClass: 'btn-blue',\n            action: function () {\n                var name = this.$content.find('.name').val();\n                if(!name){\n                    $.alert('provide a valid name');\n                    return false;\n                }\n                document.getElementById('name_user').innerHTML = \"USER:\"+name;\n                }\n        }\n    },\n    onContentReady: function () {\n        // bind to events\n        var jc = this;\n        this.$content.find('form').on('submit', function (e) {\n            // if the user submits the form by pressing enter in the field.\n            e.preventDefault();\n            jc.$$formSubmit.trigger('click'); // reference the button and click it\n        });\n    }\n});*/\ndocument.getElementById('name_user').innerHTML = \"UserName\";\n    </script>\n</body>\n</html>\n","x":2550,"y":1120,"wires":[["63dc746f.f69a5c"]]},{"id":"aec18596.0ef018","type":"http in","z":"34847536.cbb3ea","name":"","url":"/formpost","method":"post","upload":false,"swaggerDoc":"","x":2340,"y":1080,"wires":[["34c2f53c.4bbb4a"]]},{"id":"34c2f53c.4bbb4a","type":"function","z":"34847536.cbb3ea","name":"return msg.payload to client","func":"var obj = msg.payload;\n\nif(obj['topicpost']==='setting_channel_form'){\n    context.global.settingChannels = [] ;\n    var index = '' ;                    \n    var old_index = '' ;\n    var indexation = -1 ;\n    var namechannel = '' ;\n    var oldlid = '';\n    var oldnid = '';\n    \n    for(var key in obj){\n        if(key !== 'topicpost'){\n            var str = key.split(\"_\");\n            index = str[0];\n            if(index != old_index){ indexation = indexation + 1 ; oldlid = '';}\n            old_index = parseInt(str[0]);    \n            if(key === (index + \"_channel\")){namechannel = obj[key];}\n            if(key === (index + \"_devices\")) {\n                context.global.settingChannels[indexation] = {};   \n                context.global.settingChannels[indexation]['id'] = indexation + 1;\n                context.global.settingChannels[indexation]['name'] = namechannel;\n                var obj2 = context.global.ressources[obj[key]] ;\n                for (var key2 in obj2) if(key!=='update')context.global.settingChannels[indexation][''+key2] = obj2[key2];\n                context.global.settingChannels[indexation]['update'] = {} ;\n            }\n            if((key !== (index + \"_channel\")) && (key !== (index + \"_devices\"))){    \n                var balise = str[1];\n                var lid = balise.substr(0,1) ; //a modifier expression régulière\n                var nid = parseInt(balise.substr(1,1)) ; //a modifier expression régulière\n                if (lid !== oldlid) context.global.settingChannels[indexation]['update'][lid] = [] ;\n                oldlid = lid ;\n                context.global.settingChannels[indexation]['update'][lid][nid] = obj[key]; // = obj[key];//settingChannel = name.concat(settingChannel);\n            }\n        }\n    }\n    //msg.payload = context.global.settingChannels;\n    msg.payload = 'The settings channels data was submitted and available';\n    return [msg];\n}","outputs":1,"noerr":0,"x":2580,"y":1080,"wires":[["63dc746f.f69a5c","16062d21.bf6873","166ba568.2cd99b"]]},{"id":"b2ae2c51.a775b","type":"function","z":"34847536.cbb3ea","name":"get ? set ?","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\"=\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n  // expected output: ReferenceError: nonExistantFunction is not defined\n  // Note - error messages will vary depending on browser\n}\n\nif(order[0] === 'MDA-FINISH') msg.payload = 'MDA-FINISH' ;\nif(order[0] === 'getSettingChannels') msg.payload = context.global.settingChannels;\nif(order[0] === 'getSettingChannels2') msg.payload = context.global.settingChannels;\nif(order[0] === 'listConfigChannel') msg.payload = context.global.listConfigChannel;\nif(order[0] === 'listConfigMda') msg.payload = context.global.listConfigMda;\nif(order[0] === 'updateSettingChannels') msg.payload = context.global.settingChannels;\nif(order[0] === 'getSettingChannels-MDA') msg.payload = context.global.settingChannels;\nif(order[0] === 'getRessources') msg.payload = context.global.ressources;\n\nif(order[0] === 'getMDA-mdazs_zstart_set') msg.payload = \"123\";\n\nif(order[0] === 'setMDATimepointUse') context.global.mda['timepoints']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDATimepointNumber') context.global.mda['timepoints']['number'] = parseInt(order[1]) ;\nif(order[0] === 'setMDATimepointInterval') context.global.mda['timepoints']['interval'] = parseInt(order[1]) ;\nif(order[0] === 'setMDATimepointUnity') context.global.mda['timepoints']['unity'] = (order[1]) ;\n\nif(order[0] === 'setMDAMultiplespositionsUse') context.global.mda['multiplespositions']['use'] = parseInt(order[1]) ;\n\nif(order[0] === 'setMDAZstacksUse') context.global.mda['zstacks']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAZstacksZstart') context.global.mda['zstacks']['zstart'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAZstacksZend') context.global.mda['zstacks']['zend'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAZstacksZstep') context.global.mda['zstacks']['zstep'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAZstacksType') context.global.mda['zstacks']['type'] = (order[1]) ;\nif(order[0] === 'setMDAZstacksShutter') context.global.mda['zstacks']['shutteropen'] = parseInt(order[1]) ;\n\nif(order[0] === 'setMDAAutofocusUse') context.global.mda['autofocus']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAAutofocusSkip') context.global.mda['autofocus']['skip'] = parseInt(order[1]) ;\n\nif(order[0] === 'setMDAChannelsUse') context.global.mda['channels']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAChannelsConfiguration'){\n    var config = order[1].split(\",\");\n    var id = context.global.mda['channels']['config'].length;\n    context.global.mda['channels']['config'][id] = {} ;\n    context.global.mda['channels']['config'][id]['use'] = parseInt(config[0]);\n    context.global.mda['channels']['config'][id]['exposure'] = parseInt(config[1]);\n    context.global.mda['channels']['config'][id]['zoffset'] = parseInt(config[2]);\n    context.global.mda['channels']['config'][id]['channel'] = (config[3]);\n    context.global.mda['channels']['config'][id]['zstack'] = parseInt(config[4]);\n    context.global.mda['channels']['config'][id]['skipframe'] = parseInt(config[5]);\n    context.global.mda['channels']['config'][id]['refHTML'] = parseInt(config[6]);\n}\n\nif(order[0] === 'setMDAChannelsConfigurationUse'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['use'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationExposure'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['exposure'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationZoffset'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['zoffset'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationChannel'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['channel'] = config[0];\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationZstack'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['zstack'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationSkipframe'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['skipframe'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'MDAChannelsConfigurationRemove'){\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(order[1])){\n            context.global.mda['channels']['config'].splice(i, 1);\n        }\n    }\n}\n\n\n\n\n\nif(order[0] === 'setMDASaveimagesUse') context.global.mda['saveimages']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDASaveimagesDirectory') context.global.mda['saveimages']['directory'] = (order[1]) ;\nif(order[0] === 'setMDASaveimagesPrefix') context.global.mda['saveimages']['prefix'] = (order[1]) ;\nif(order[0] === 'setMDASaveimagesFormat') context.global.mda['saveimages']['format'] = (order[1]) ;\n\nif(order[0] === 'setMDAAcquisitioncommentComment') context.global.mda['acquisitioncomment'] = (order[1]) ;\n\n\nreturn msg ;\n\n","outputs":1,"noerr":0,"x":2330,"y":1020,"wires":[["16062d21.bf6873","411047a4.cf81e8"]]},{"id":"16062d21.bf6873","type":"websocket out","z":"34847536.cbb3ea","name":"","server":"b1d0bce3.0ecdd","client":"","x":2880,"y":1020,"wires":[]},{"id":"b3cc782f.148998","type":"function","z":"34847536.cbb3ea","name":"Object MDA","func":"context.global.mda = {\n    \"timepoints\": {\n        \"use\" : 0,\n        \"number\" : 1,\n        \"interval\" : 1,\n        \"unity\" : \"ms\"\n    },\n    \"multiplespositions\": {\n        \"use\" : 0,\n        \"param\" : []\n    },\n    \"zstacks\": {\n        \"use\" : 0 ,\n        \"zstart\" : 0,\n        \"zend\" : 10,\n        \"zstep\" : 1,\n        \"type\" : \"relative Z\",\n        \"shutteropen\" : 0\n    },\n    \"autofocus\": {\n        \"use\" : 0,\n        \"skip\" : 0\n    },\n    \"channels\": {\n        \"use\" : 0,\n        \"config\" : []\n    },\n    \"saveimages\": {\n        \"use\" : 0,\n        \"directory\" : \"\",\n        \"prefix\" : \"\",\n        \"format\" : \"separate images files\"\n    },\n    \"acquisitioncomment\" : \"\"\n};\n","outputs":1,"noerr":0,"x":890,"y":320,"wires":[[]]},{"id":"166ba568.2cd99b","type":"function","z":"34847536.cbb3ea","name":"save settingChannels","func":"var test = [\n  {\n      \"id\" : 0,\n      \"name\": \"channelA\",\n      \"device\" : \"CoolLed-PE-4000\",\n      \"type\" : \"ligth-source\",\n      \"topic\" : \"fluo1\",\n      \"update\" :{\n          \"A\" : [120,100,true],\n          \"B\" : [200,40,false],\n          \"C\" : [330,80,false],\n          \"D\" : [410,10,false]\n      },\n      \"config\":{\n          \"A\" : [\"<select name='0A0' id='0A0'><option name='0A00' id='0A00' value=100>100</option>          <option name='0A01' id='0A01' value=110>110</option>           <option name='0A02' id='0A02' selected value=120>120</option>   <option name='0A03' id='0A03' value=130>130</option></select>\",          \"<input name='0A1' id='0A1' type='number' min='0' max='100' step='1' value='100'/>\",    \"<input name='0A2'  id='0A2' checked type='checkbox'/>\"],\n          \"B\" : [\"<select name='0B0' id='0B0'><option name='0B00' id='0B00' selected value=200>200</option> <option name='0B01' id='0B01' value=210>210</option>           <option name='0B02' id='0B02' value=220>220</option>            <option name='0B03' id='0B03' value=230>230</option></select>\",          \"<input name='0B1' id='0B1' type='number' min='0' max='100' step='1' value='40'/>\",     \"<input name='0B2'  id='0B2' type='checkbox'/>\"],\n          \"C\" : [\"<select name='0C0' id='0C0'><option name='0C00' id='0C00' value=300>300</option>          <option name='0C01' id='0C01' value=310>310</option>           <option name='0C02' id='0C02' value=320>320</option>            <option name='0C03' id='0C03' selected value=330>330</option></select>\", \"<input name='0C1' id='0C1' type='number' min='0' max='100' step='1' value='80'/>\",     \"<input name='0C2'  id='0C2' type='checkbox'/>\"],\n          \"D\" : [\"<select name='0D0' id='0D0'><option name='0D00' id='0D00' value=400>400</option>          <option name='0D01' id='0D01' selected value=410>410</option>  <option name='0D02' id='tD02' value=420>420</option>            <option name='0D03' id='0D03' value=430>430</option></select>\",          \"<input name='0D1' id='0D1' type='number' min='0' max='100' step='1' value='10'/>\",     \"<input name='0D2'  id='0D2' type='checkbox'/>\"]\n        }\n  }\n ];\nmsg.payload =  test.concat(context.global.settingChannels);\n//msg.payload =  context.global.settingChannels;\nif(context.global.saveConfigChannel !== '' ) msg.filename = context.global.saveConfigChannel;\n\nreturn msg ;\n\n","outputs":1,"noerr":0,"x":2860,"y":1080,"wires":[["11ded569.e0d70b"]]},{"id":"11ded569.e0d70b","type":"file","z":"34847536.cbb3ea","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","x":3030,"y":1080,"wires":[[]]},{"id":"bdb52574.42f818","type":"file in","z":"34847536.cbb3ea","name":"","filename":"","format":"utf8","chunk":false,"sendError":false,"x":2450,"y":940,"wires":[["18aa0f6a.6aa8c1"]]},{"id":"18aa0f6a.6aa8c1","type":"function","z":"34847536.cbb3ea","name":"parseJSON","func":"msg.payload = JSON.parse(msg.payload);\ncontext.global.settingChannels = msg.payload ;\n//msg.payload = context.global.settingChannels;\nreturn msg;","outputs":1,"noerr":0,"x":2590,"y":940,"wires":[["16062d21.bf6873"]]},{"id":"89aa95b5.1591f8","type":"function","z":"34847536.cbb3ea","name":"load","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\n\nif(order[0] === 'LoadSettingChannelsConfiguration') {\n    context.global.saveConfigChannel = 'C:/Users/labo/.node-red/lib2/config/'+context.global.listConfigChannel[parseInt(order[1])];\n    msg.filename = context.global.saveConfigChannel ;\n    return msg ;\n}\n\n\nif(order[0] === 'LoadSettingMda') {\n    context.global.saveConfigMda = 'C:/Users/labo/.node-red/lib2/mda/'+context.global.listConfigMda[parseInt(order[1])];\n    msg.filename = context.global.saveConfigMda ;\n    return msg ;\n}\n\n\n","outputs":1,"noerr":0,"x":2310,"y":940,"wires":[["bdb52574.42f818"]]},{"id":"4953818e.96e22","type":"link out","z":"34847536.cbb3ea","name":"output_cam","links":["4df9151a.b2c97c","66fdc750.1163a8"],"x":1555,"y":720,"wires":[]},{"id":"4df9151a.b2c97c","type":"link in","z":"34847536.cbb3ea","name":"input_cam","links":["4953818e.96e22"],"x":715,"y":760,"wires":[["4265f253.30799c","827a258f.2eedf8","c3d76d36.8db0a","37ad6f0f.48ce1","9bac1453.e0c028","8ebef5c8.2ae828"]]},{"id":"c81bbb99.9a3ed8","type":"function","z":"34847536.cbb3ea","name":"wait for all devices are initilized","func":"function verifyIsTopicExists(ressources,topic){\n    if(ressources.length !==0){\n        var verify = false ;\n        for(var i=0; i<ressources.length;i++){\n            if(ressources[i]['topic']===topic){ verify = true ; return i;}\n        }\n        if(verify ===false) return (-1);\n    }\n    else return (-1) ;\n}\n\n\nif(msg.mode === 'init'){\n    \n    context.data = context.data || new Object();\n    context.global.ressources = context.global.ressources || [];\n    \n    var verify = verifyIsTopicExists(context.global.ressources,msg.topic) ;\n    \n    switch (msg.topic) {\n        case \"Fluorescence1\":\n            context.data.task1 = msg.device;\n            context.global.Fluorescence1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;\n        case \"MotionStage1\":\n            context.data.task2 = msg.device;\n            context.global.MotionStage1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;\n        case \"Microscope1\":\n            context.data.task3 = msg.device;\n            context.global.Microscope1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;\n        /*case \"Mosaic1\":\n            context.data.task4 = msg.device;\n            context.global.Mosaic1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;*/\n        case \"Camera1\":\n            context.data.task5 = msg.device;\n            context.global.Camera1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;\n       /* case \"Fluorescence2\":\n            context.data.task6 = msg.device;\n            context.global.Fluorescence2 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;*/\n        default:\n            msg = null;\n        \tbreak;\n    \n    }\n    \n    if(context.data.task1 != null && context.data.task2 != null && context.data.task3 != null ){//&& context.data.task4 != null && context.data.task5 != null && context.data.task6 != null) {\n    \tmsg2 = new Object();\n        msg2 = context.data;\n        msg2.payload = \"Initialisation >>> DONE :-)\";\n        context.global.initialize = true ;\n        context.data=null;\n    \treturn msg2;\n    } else return msg;\n}","outputs":1,"noerr":0,"x":1370,"y":940,"wires":[[]]},{"id":"1ca44733.70b299","type":"inject","z":"34847536.cbb3ea","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":340,"y":1040,"wires":[["a2a924ec.8abb08"]]},{"id":"a2a924ec.8abb08","type":"function","z":"34847536.cbb3ea","name":"live","func":"msg.payload =  context.global.Fluorescence1;\nmsg.topic = 'Fluorescence1';\nmsg.device =  context.global.Fluorescence1;\nmsg.mode = 'live';\nmsg.action = 'setChannel';\nmsg.update = {\n  \"A\" : [385,10,true],\n  \"B\" : [490,100,true],\n  \"C\" : [580,45,false],\n  \"D\" : [740,100,true],\n  'timeout' : 5000,\n  'keep' : false\n}    \nreturn msg;","outputs":1,"noerr":0,"x":470,"y":1040,"wires":[["37ad6f0f.48ce1"]]},{"id":"2cda3d26.812962","type":"function","z":"34847536.cbb3ea","name":"live","func":"msg.payload =  context.global.MotionStage1;\nmsg.topic = 'MotionStage1';\nmsg.device =  context.global.MotionStage1;\nmsg.mode = 'live';\nmsg.action = 'set';\nmsg.update = {\n    \"xPosition\" : 0,\n    \"yPosition\" : 0,\n    \"moveType\" : \"G\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":940,"wires":[["c3d76d36.8db0a"]]},{"id":"a7fb5453.6819f8","type":"inject","z":"34847536.cbb3ea","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":360,"y":940,"wires":[["2cda3d26.812962"]]},{"id":"edb7becd.3f6c4","type":"function","z":"34847536.cbb3ea","name":"live","func":"msg.payload =  context.global.Mosaic1;\nmsg.topic = 'Mosaic1';\nmsg.device =  context.global.Mosaic1;\nmsg.mode = 'live';\nmsg.update = {\n  \"matrice\" : 2324\n}    \nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":380,"wires":[[]]},{"id":"549ec03e.4f80b","type":"inject","z":"34847536.cbb3ea","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2060,"y":380,"wires":[["edb7becd.3f6c4"]]},{"id":"7baebb85.938524","type":"function","z":"34847536.cbb3ea","name":"live","func":"msg.payload =  context.global.Fluorescence2;\nmsg.topic = 'Fluorescence2';\nmsg.device =  context.global.Fluorescence2;\nmsg.mode = 'live';\nmsg.action = 'set' ;\nmsg.update = {\n  \"shutter\" : true,\n  \"intensity\" : 40\n}    \nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":340,"wires":[[]]},{"id":"63d9a29a.6fc39c","type":"inject","z":"34847536.cbb3ea","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2060,"y":340,"wires":[["7baebb85.938524"]]},{"id":"f3fbf9d7.25ddd8","type":"function","z":"34847536.cbb3ea","name":"live","func":"msg.device = 'PHOTOMETRICS-EVOLV-512';\nmsg.topic = 'Camera1';\nmsg.action = 'GRAB';\nmsg.prefixe = \"prefix\";\nmsg.channel = \"ch\";\nmsg.position = \"pos\";\nmsg.exposure = 500;\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":840,"wires":[["8ebef5c8.2ae828"]]},{"id":"fce216d9.832958","type":"inject","z":"34847536.cbb3ea","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":380,"y":840,"wires":[["f3fbf9d7.25ddd8"]]},{"id":"3f882c61.e40184","type":"function","z":"34847536.cbb3ea","name":"Object sequencer 2","func":"/*context.global.sequence2 = {\n    \"0\" : \n        [\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : context.global.Fluorescence1,\n            'mode' : 'MDA',\n            \"update\" :\n                {\n                \"A\" : [120,100,\"ON\"],\n                \"B\" : [200,100,\"ON\"],\n                \"C\" : [330,100,\"ON\"],\n                \"D\" : [410,100,\"ON\"]\n                }    \n            },\n            {\n            'topic' : 'MotionStage1',\n            'device' : context.global.MotionStage1,\n            'action' : 'set',\n            'mode' : 'MDA',\n            'x': 100,\n            'y': 100,\n            'fonction': 'moveToPositionXY'    \n            }],\n            [{\n                'topic' : 'Camera1',\n                'device' : context.global.Camera1,\n                'mode' : 'MDA',\n                'exposure': 20,\n                'fonction' : 'getFrame'\n            }],\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : context.global.Fluorescence1,\n            'mode' : 'MDA',\n            \"update\" :\n                {\n                \"A\" : [120,100,\"ON\"],\n                \"B\" : [200,100,\"ON\"],\n                \"C\" : [330,100,\"ON\"],\n                \"D\" : [410,100,\"ON\"]\n                }    \n            },\n            {\n            'topic' : 'MotionStage1',\n            'device' : context.global.MotionStage1,\n            'mode' : 'MDA',\n            'action' : 'setAll',\n            'x': 1365,\n            'y': 3420,\n            'fonction': 'moveToPositionXY'    \n            }],\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : context.global.Fluorescence1,\n            'mode' : 'MDA',\n            \"update\" :\n                {\n                \"A\" : [120,100,\"ON\"],\n                \"B\" : [200,100,\"ON\"],\n                \"C\" : [330,100,\"ON\"],\n                \"D\" : [410,100,\"ON\"]\n                }    \n            },\n            {\n            'topic' : 'MotionStage1',\n            'device' : context.global.MotionStage1,\n            'mode' : 'MDA',\n            'action' : 'setAll',\n            'x': 1365,\n            'y': 3420,\n            'fonction': 'moveToPositionXY'    \n            }]\n        ],\n    \"10\" : \n        [\n            [{\n            'topic' : 'Camera1',\n            'device' : context.global.Camera1,\n            'mode' : 'MDA',\n            'exposure': 200,\n            'fonction' : 'getFrame'\n            }],\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : context.global.Fluorescence1,\n            'mode' : 'MDA',\n            \"update\" :\n                {\n                \"A\" : [120,100,\"ON\"],\n                \"B\" : [200,100,\"ON\"],\n                \"C\" : [330,100,\"ON\"],\n                \"D\" : [410,100,\"ON\"]\n                }    \n            },\n            {\n            'topic' : 'MotionStage1',\n            'device' : context.global.MotionStage1,\n            'mode' : 'MDA',\n            'action' : 'setAll',\n            'x': 1365,\n            'y': 3420,\n            'fonction': 'moveToPositionXY'    \n            }]\n        ],\n    \"20\" : \n        [{\n        'topic' : 'MotionStage1',\n        'device' : context.global.MotionStage1,\n        'mode' : 'MDA',\n        'action' : 'setAll',\n        'x': 1365,\n        'y': 3420,\n        'fonction': 'moveToPositionXY'\n        }],\n    \"40\" : \n        [\n            [{\n            'topic' : 'Camera1',\n            'device' : context.global.Camera1,\n            'mode' : 'MDA',\n            'exposure': 20,\n            'fonction' : 'getFrame'\n            }],\n            [{\n            'payload' : 'MDA-FINISH',\n            }]\n        ]\n}*/\n\n\ncontext.global.sequence2 = {\n    \"0\" : \n        [\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : 'CoolLed-PE4000',\n            'mode' : 'MDA',\n            'action' : 'set',\n            \"update\" :\n                {\n                \"A\" : [435,70,true],\n                \"B\" : [470,100,true],\n                \"C\" : [580,100,true],\n                \"D\" : [660,100,true]\n                }    \n            },\n            {\n            'topic' : 'MotionStage1',\n            'device' : 'PRIOR-PRO-SCAN',\n            'action' : 'set',\n            'mode' : 'MDA',\n            'update' : {\n                'xPosition': 10000,\n                'yPosition': 10000,\n                'moveType': 'GR'    \n                }\n            }],\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : 'CoolLed-PE4000',\n            'mode' : 'MDA',\n            'action' : 'set',\n            \"update\" :\n                {\n                \"A\" : [435,100,true],\n                \"B\" : [470,2,false],\n                \"C\" : [580,100,true],\n                \"D\" : [660,2,false]\n                }    \n            }]\n        ],\n    \"10\" : \n        [\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : 'CoolLed-PE4000',\n            'mode' : 'MDA',\n            'action' : 'set',\n            \"update\" :\n                {\n                \"A\" : [435,100,false],\n                \"B\" : [470,100,false],\n                \"C\" : [580,100,false],\n                \"D\" : [660,100,false]\n                }    \n            }\n            ]\n        ],\n    \"20\" : \n        [\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : 'CoolLed-PE4000',\n            'mode' : 'MDA',\n            'action' : 'set',\n            \"update\" :\n                {\n                \"A\" : [435,100,true],\n                \"B\" : [470,100,true],\n                \"C\" : [580,100,true],\n                \"D\" : [660,100,true]\n                }    \n            },\n            {\n            'topic' : 'MotionStage1',\n            'device' : 'PRIOR-PRO-SCAN',\n            'action' : 'set',\n            'mode' : 'MDA',\n            'update' : {\n                'xPosition': 2000,\n                'yPosition': 2000,\n                'moveType': 'GR'    \n                }\n            }]\n        ],\n    \"30\" : \n        [\n            [{\n                'topic' : 'MotionStage1',\n            'device' : 'PRIOR-PRO-SCAN',\n            'action' : 'set',\n            'mode' : 'MDA',\n            'update' : {\n                'xPosition': 0,\n                'yPosition': 0,\n                'moveType': 'G'    \n                }\n            }],\n            [{\n            'payload' : 'MDA-FINISH',\n            }]\n        ]\n    }","outputs":1,"noerr":0,"x":910,"y":280,"wires":[[]]},{"id":"7aaa9f74.06de4","type":"function","z":"34847536.cbb3ea","name":"Sequencer 2 Miss Marple - MDA","func":"    \n    node.status ({fill:\"green\",shape:\"dot\", text: \"request\"});\n    \n    if( (context.global.startMDA === 1) && (context.global.initialize === true)){\n        node.status ({fill:\"yellow\",shape:\"dot\", text: context.global.sync2+\"-\"+context.global.sync3});\n    \n        var lengt = context.global.sequence2[context.global.sync2].length ;\n        \n        if( lengt  !== context.global.sync3 ){\n        \n            var order = context.global.sequence2[context.global.sync2];\n        \n            if(msg.payload === 'done'){\n        //\n        //\n        //\n                context.global.checkFinish = context.global.checkFinish + 1 ;\n        \n                node.status ({fill:\"yellow\",shape:\"dot\", text: context.global.sync2+\"-\"+context.global.sync3+\" - \"+context.global.finish+\"-\"+context.global.checkFinish});\n            \n        \n                if(context.global.checkFinish === context.global.finish){\n                    context.global.checkFinish = 0 ;\n                    if(order[context.global.sync3][0].action !== '_waiting_'){\n                            if(order.length !==1) {\n                            context.global.finish = order[context.global.sync3].length ; // nombre d'instructions dans la branche la plus profonde de l'object sequencer\n                            for(var i=0;i<order[context.global.sync3].length;i++){ node.send(order[context.global.sync3][i]);}\n                            //if(order[context.global.sync3][i]['payload'] === 'MDA-FINISH') node.status ({fill:\"red\",shape:\"dot\", text: \"finished and waiting order ...\"});\n            //                node.warn(\"ZFZ\");\n                        }\n                        else{ \n                            node.send(order[context.global.sync3]) ;\n                            context.global.finish = 1 ;\n            //                node.warn(\"ZZZ\");\n                        }\n                        context.global.sync3 = context.global.sync3 + 1 ;\n                    } else context.global.sync3 = context.global.sync3 + 1 ;\n                } \n            }\n            else{//start mda trigger\n                if(order[context.global.sync3][0].action !== '_waiting_'){\n                    if(order.length !==1) {\n                        context.global.finish = order[context.global.sync3].length ; // nombre d'instructions dans la branche la plus profonde de l'object sequencer\n                        for(var i=0;i<order[context.global.sync3].length;i++){ node.send(order[context.global.sync3][i]);}\n                    }\n                    else { \n                        context.global.finish = 1 ;\n                        node.send(order[context.global.sync3]) ;\n                    }\n                    context.global.sync3 = context.global.sync3 + 1 ;\n                }else context.global.sync3 = context.global.sync3 + 1 ;\n            }\n        }\n    } \n","outputs":1,"noerr":0,"x":1370,"y":720,"wires":[["4953818e.96e22","7be4eb90.5e32b4"]]},{"id":"827a258f.2eedf8","type":"function","z":"34847536.cbb3ea","name":"start MDA time Order","func":"if(msg.payload === 'MDA-START'){\n    context.global.startMDA = 1 ;\n    context.global.checkFinish = 0 ;\n    global.set('scanTime',0);\n    context.global.sync2 = String(0);\n    context.global.sync3 = 0;\n    msg.payload = context.global.sequence2[String(0)];\n    node.send(msg);\n    node.status ({fill:\"green\",shape:\"dot\", text: \"START: timeOrder@0min\"});\n    var mdaSync = setInterval(function(){\n        scanTime = global.get('scanTime') + 1;\n        global.set('scanTime',scanTime);\n        for(var key in context.global.sequence2){\n            if(key===String(scanTime)){\n                context.global.sync2 = key;\n                msg.payload = context.global.sequence2[key];\n                context.global.sync3 = 0;\n                node.send(msg);\n                node.status ({fill:\"green\",shape:\"dot\", text: \"START: timeOrder@\"+scanTime+\"min\"});\n            }\n        }\n    },60000);\n    global.set('mdaSync',mdaSync);\n    \n}\nif(msg.payload === 'MDA-FINISH'){\n    context.global.startMDA = 0 ;\n    node.status ({text: \"waiting start ...\"});\n    clearTimeout(global.get('mdaSync'));\n}","outputs":1,"noerr":0,"x":920,"y":600,"wires":[["7aaa9f74.06de4"]]},{"id":"72755f15.d8bde","type":"inject","z":"34847536.cbb3ea","name":"START","topic":"","payload":"MDA-START","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":610,"y":540,"wires":[["827a258f.2eedf8","4265f253.30799c","847e756.b54f488"]]},{"id":"845aa4e9.26f228","type":"websocket in","z":"34847536.cbb3ea","name":"","server":"b1d0bce3.0ecdd","client":"","x":2050,"y":740,"wires":[["5f8d9953.e4a598","c99a9072.0986f","7b322808.112958","89aa95b5.1591f8","12c3afc7.a73bb","92a4241.718cad8","968bad3a.4e0d2","b2ae2c51.a775b","dfdb56cc.2679c8","33164001.a85e7","f4a04d96.a69f7"]]},{"id":"5f8d9953.e4a598","type":"function","z":"34847536.cbb3ea","name":"fancyTree switch","func":"context.global.sendDataLive = {} ;\nvar order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\ncontext.global.fancyTreeOrder = order[0] ;\nvar output = {} ;\n\nif(order[0] === 'getValueXYZ'){\n    context.global.sendDataLiveLg = 12 ;\n    output.payload =  context.global.MotionStage1;\n    output.topic = 'MotionStage1';\n    output.device =  context.global.MotionStage1;\n    output.mode = 'live';\n    output.action = 'get';\n    node.send(output);\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'getZPosition';\n    node.send(output);\n}\n\nif(order[0] === 'getValueZ'){\n    context.global.sendDataLiveLg = 1 ;\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'getZPosition';\n    node.send(output);\n}\n\nif(order[0] === 'tryAutoFocus'){\n    context.global.sendDataLiveLg = 13;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'af';\n    output.update = {\n        \"farLimit\" : 1,\n        \"nearLimit\" : 3000000,\n        \"affLimit\": parseInt(order[1])-(100*parseInt(order[2])),\n        \"afnLimit\":parseInt(order[1])+(100*parseInt(order[3])),\n        \"objective\":parseInt(order[4])\n    }\n    node.send(output);\n}\n\nif(order[0] === 'moveX'){\n    context.global.sendDataLiveLg = 3 ;\n    output.payload =  context.global.MotionStage1;\n    output.topic = 'MotionStage1';\n    output.device =  context.global.MotionStage1;\n    output.mode = 'live';\n    output.action = 'set';\n    output.update = {} ;\n    output.update = {\n        \"xPosition\" : 0,\n        \"yPosition\" : parseInt(order[2]) * (order[1] ==\"UP\" ? 1 : -1),\n        \"moveType\" : \"GR\"\n    } ;\n    node.send(output);\n}\n\nif(order[0] === 'moveY'){\n    context.global.sendDataLiveLg = 3 ;\n    output.payload =  context.global.MotionStage1;\n    output.topic = 'MotionStage1';\n    output.device =  context.global.MotionStage1;\n    output.mode = 'live';\n    output.action = 'set';\n    output.update = {} ;\n    output.update = {\n        \"xPosition\" : parseInt(order[2]) * (order[1] ==\"RG\" ? 1 : -1)  ,\n        \"yPosition\" : 0,\n        \"moveType\" : \"GR\"\n    } ;\n    node.send(output);\n}\n\nif(order[0] === 'moveZ'){\n    //context.global.sendDataLiveLg = 9 ;\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'setZPosition';\n    output.update = {\n        \"zPosition\" : parseInt(order[2]),\n        \"moveType\": order[1]\n    };\n    node.send(output);\n}\n\nif(order[0] === 'goToPosition'){\n    //context.global.sendDataLiveLg = 3 ;\n    output.payload =  context.global.MotionStage1;\n    output.topic = 'MotionStage1';\n    output.device =  context.global.MotionStage1;\n    output.mode = 'live';\n    output.action = 'set';\n    output.update = {} ;\n    output.update = {\n        \"xPosition\" : parseInt(order[1]),\n        \"yPosition\" : parseInt(order[2]),\n        \"moveType\" : \"G\"\n    } ;\n    node.send(output);\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'setZPosition';\n    output.update = {\n        \"zPosition\" : parseInt(order[3]),\n        \"moveType\": \"d\"\n    };\n    node.send(output);\n}\n\nif(order[0] === 'posLigth'){\n  setTimeout(function(){\n    var olympus = false ;\n    var coolled = false ;\n\n\n        if(order[1] === -1 ){\n            output = {} ;\n            output.payload =  context.global.Fluorescence1;\n            output.topic = 'Fluorescence1';\n            output.device =  context.global.Fluorescence1;\n            output.mode = 'live';\n            output.action = 'setOFF';\n            node.send(output);\n            output = {} ;\n            output.payload =  context.global.Microscope1;\n            output.topic = 'Microscope1';\n            output.device =  context.global.Microscope1;\n            output.mode = 'live';\n            output.action = 'setOFF';\n            node.send(output);\n    \n        }else {\n        for(var i=1 ; i<context.global.settingChannels.length; i++){\n           \n            \n            if(i === parseInt(order[1])){\n                node.warn(i+\",\"+parseInt(order[1]));\n                if((context.global.settingChannels[i]['device'] === 'OLYMPUS-IX-81')){\n                    olympus = true ;\n                    output = {} ;\n                    output.payload =  context.global.Microscope1;\n                    output.topic = 'Microscope1';\n                    output.device =  context.global.Microscope1;\n                    output.mode = 'live';\n                    output.action = 'setChannel';\n                    output.update = {\n                        \"lamp\" : context.global.settingChannels[i]['update']['A'][0] == \"OFF\" ? false : true ,\n                        \"intensity\": parseFloat(context.global.settingChannels[i]['update']['A'][1]) ,\n                        \"shutter\":context.global.settingChannels[i]['update']['A'][2] == \"OFF\" ? false : true ,\n                        \"timeout\" : -1\n                        };\n                    node.send(output);\n                }\n                \n                if((context.global.settingChannels[i]['device'] === 'CoolLed-PE4000')){\n                    coolled = true ;\n                    output = {} ;\n                    output.payload =  context.global.Fluorescence1;\n                    output.topic = 'Fluorescence1';\n                    output.device =  context.global.Fluorescence1;\n                    output.mode = 'live';\n                    output.action = 'set';\n                    output.update = {\n                        \"A\" : [context.global.settingChannels[i]['update']['A'][0],context.global.settingChannels[i]['update']['A'][1],context.global.settingChannels[i]['update']['A'][2] == \"OFF\" ? false : true] ,\n                        \"B\" : [context.global.settingChannels[i]['update']['B'][0],context.global.settingChannels[i]['update']['B'][1],context.global.settingChannels[i]['update']['B'][2] == \"OFF\" ? false : true] ,\n                        \"C\" : [context.global.settingChannels[i]['update']['C'][0],context.global.settingChannels[i]['update']['C'][1],context.global.settingChannels[i]['update']['C'][2] == \"OFF\" ? false : true] ,\n                        \"D\" : [context.global.settingChannels[i]['update']['D'][0],context.global.settingChannels[i]['update']['D'][1],context.global.settingChannels[i]['update']['D'][2] == \"OFF\" ? false : true] ,\n                        \"timeout\" : -1\n                    };\n                    node.send(output);\n                }\n            }\n            else {\n                if((context.global.settingChannels[i]['device'] === 'CoolLed-PE4000')&&(coolled === false)){\n                    //coolled = true ;\n                    output = {} ;\n                    output.payload =  context.global.Fluorescence1;\n                    output.topic = 'Fluorescence1';\n                    output.device =  context.global.Fluorescence1;\n                    output.mode = 'live';\n                    output.action = 'setOFF';\n                    node.send(output);\n                }\n                if((context.global.settingChannels[i]['device'] === 'OLYMPUS-IX-81')&&(olympus === false)){\n                    //olympus = true ;\n                    output = {} ;\n                    output.payload =  context.global.Microscope1;\n                    output.topic = 'Microscope1';\n                    output.device =  context.global.Microscope1;\n                    output.mode = 'live';\n                    output.action = 'setOFF';\n                    node.send(output);\n                }\n                \n            }\n        }}\n    },1000);\n}\n\nif(order[0] === 'EnlightenedOFF'){\n    output = {} ;\n    output.payload =  context.global.Fluorescence1;\n    output.topic = 'Fluorescence1';\n    output.device =  context.global.Fluorescence1;\n    output.mode = 'live';\n    output.action = 'setOFF';\n    node.send(output);\n    \n     output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'setOFF';\n    node.send(output);\n}\n\nif(order[0] === 'updatefilter'){\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'setWheelFilter';\n    output.update = {\n        \"wheelFilter\" : order[1]\n    }\n    node.send(output);\n}\nif(order[0] === 'getAutofocus'){\n    context.global.sendDataLiveLg = 10 ;\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'get';\n    node.send(output);\n}\nif(order[0] === 'posWheel'){\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'setWheelFilter';\n    output.update = {'wheelFilter' : parseInt(order[1])};\n    node.send(output);\n}\n\n","outputs":1,"noerr":0,"x":2350,"y":740,"wires":[["a3551847.f88518","a291fa06.557888"]]},{"id":"61a98d75.9c10d4","type":"websocket out","z":"34847536.cbb3ea","name":"","server":"b1d0bce3.0ecdd","client":"","x":1560,"y":1080,"wires":[]},{"id":"90daf55e.6d21e8","type":"function","z":"34847536.cbb3ea","name":"if mode === live","func":"\n    if(msg.mode === 'live'){\n\n        if((context.global.fancyTreeOrder === 'getValueXYZ')||(context.global.fancyTreeOrder === 'getValueZ')||(context.global.fancyTreeOrder === 'tryAutoFocus')||(context.global.fancyTreeOrder === 'getAutofocus')){\n        \n            if(msg.topic === 'Microscope1') {\n                for(var key in msg.update['A']){\n                    context.global.sendDataLive[key] = msg.update['A'][key];\n                }\n                if(context.global.fancyTreeOrder === 'tryAutoFocus'){\n                    for(var key in msg.status){\n                    context.global.sendDataLive[key] = msg.status[key];\n                     }\n                }\n            }\n            else{\n                for(var key in msg.update){\n                    context.global.sendDataLive[key] = msg.update[key];\n                }\n            }\n                //var msg={};\n            node.warn(Object.keys(context.global.sendDataLive).length);\n            //msg.payload = context.global.fancyTreeOrder+\"-\"+context.global.sendDataLiveLg+\"-\"+Object.keys(context.global.sendDataLive).length;\n            node.send(msg);\n            if(Object.keys(context.global.sendDataLive).length === context.global.sendDataLiveLg){\n                var msg = {};\n                msg.payload = context.global.sendDataLive ;\n                node.send(msg);\n                context.global.sendDataLive = {} ;\n                context.global.fancyTreeOrder = \"\";\n            } \n        }\n    }","outputs":1,"noerr":0,"x":1320,"y":1080,"wires":[["61a98d75.9c10d4","cc378163.edc34"]]},{"id":"c99a9072.0986f","type":"function","z":"34847536.cbb3ea","name":"create config channel","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\nvar output = {} ;\nif(order[0] === 'configChannels'){\n    context.global.saveConfigChannel = 'C:/Users/labo/.node-red/lib2/config/'+order[1]+\".json\" ;\n    output.filename =  context.global.saveConfigChannel;\n    output.payload =  \"create\";\n    context.global.listConfigChannel.push(order[1]+\".json\");\n    node.send(output);\n}","outputs":1,"noerr":0,"x":2360,"y":780,"wires":[["1658da9f.1acd65"]]},{"id":"1658da9f.1acd65","type":"file","z":"34847536.cbb3ea","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","x":2830,"y":780,"wires":[[]]},{"id":"6dd8ff64.c7dbd","type":"file in","z":"34847536.cbb3ea","name":"","filename":"C:\\Users\\labo\\.node-red\\lib2\\config\\list.txt","format":"utf8","chunk":false,"sendError":false,"x":980,"y":360,"wires":[["152cc6de.449129"]]},{"id":"152cc6de.449129","type":"function","z":"34847536.cbb3ea","name":"Initialisation","func":"context.global.listConfigChannel = msg.payload.split(\";\");\n//context.global.initialize = false ;\n//context.global.ressources = [] ;\n\n//context.global.test = [];\n","outputs":1,"noerr":0,"x":1270,"y":360,"wires":[[]]},{"id":"7b322808.112958","type":"function","z":"34847536.cbb3ea","name":"extend config channel","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\nvar output = {} ;\nif(order[0] === 'configChannels'){\n    output.payload = \";\"+order[1]+\".json\";\n    node.send(output);\n}","outputs":1,"noerr":0,"x":2360,"y":820,"wires":[["fbaa9d2b.6cdf2"]]},{"id":"fbaa9d2b.6cdf2","type":"file","z":"34847536.cbb3ea","name":"","filename":"C:\\Users\\labo\\.node-red\\lib2\\config\\list.txt","appendNewline":false,"createDir":true,"overwriteFile":"false","x":2720,"y":820,"wires":[[]]},{"id":"a3551847.f88518","type":"debug","z":"34847536.cbb3ea","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2810,"y":740,"wires":[]},{"id":"c3d76d36.8db0a","type":"PriorProScan","z":"34847536.cbb3ea","name":"","x":910,"y":940,"wires":[["7aaa9f74.06de4","c81bbb99.9a3ed8","90daf55e.6d21e8"]]},{"id":"ba6ec1b6.1e9aa","type":"function","z":"34847536.cbb3ea","name":"live","func":"msg.payload =  context.global.Fluorescence2;\nmsg.topic = 'Fluorescence2';\nmsg.device =  context.global.Fluorescence2;\nmsg.mode = 'live';\nmsg.action = 'set' ;\nmsg.update = {\n  \"shutter\" : false,\n  \"intensity\" : 40\n}    \nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":300,"wires":[[]]},{"id":"3d5b148a.87aedc","type":"inject","z":"34847536.cbb3ea","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2060,"y":300,"wires":[["ba6ec1b6.1e9aa"]]},{"id":"8db61e15.795b5","type":"json","z":"34847536.cbb3ea","name":"","property":"payload","action":"","pretty":false,"x":2450,"y":980,"wires":[["37dbc90c.46bf06"]]},{"id":"37ad6f0f.48ce1","type":"CoolLedPe4000","z":"34847536.cbb3ea","name":"PE4000","topic":"drive the PE-4000","x":900,"y":1040,"wires":[["7aaa9f74.06de4","c81bbb99.9a3ed8","90daf55e.6d21e8"]]},{"id":"85c9b280.1f731","type":"function","z":"34847536.cbb3ea","name":"Camera rec.","func":"if(msg.payload !== 'STOP'){\n    data = msg.payload ;\n    var msg = {};\n    msg.topic = 'Camera1'\n    msg.payload = \"done\";\n    msg.action = 'GRAB';\n    msg.device = 'PHOTOMETRICS-EVOLV-512';\n    msg.update = {'name' : data};\n    msg.status = {\"SUCCESS\" : Date.now()};\n    node.send(msg);\n}\n","outputs":1,"noerr":0,"x":910,"y":800,"wires":[["7aaa9f74.06de4","749e65e7.0c3fbc"]],"icon":"node-red/camera.png"},{"id":"37dbc90c.46bf06","type":"function","z":"34847536.cbb3ea","name":"protocole N","func":"var mda = msg.payload ;\nvar output = {} ;\n\ntry {\n    if(mda['type'] === 'mda'){\n        if(mda.children[0].data.algo === 'algo1'){\n            output = algo1(mda);\n        }\n        msg.payload = \"MDA-START\" ;\n        context.global.sequence2 = output ;\n        return msg;   \n    }\n   \n}\ncatch(error){}\n\nfunction algo1(mda){\n    var test = {} ;\n    var inject = [] ;           \n    /*inject.push({\n        'payload' :  context.global.Fluorescence1,\n        'topic' : 'Fluorescence1',\n        'device' :  context.global.Fluorescence1,\n        'mode' : 'mda',\n        'action' : 'setOFF'\n    });\n    inject.push({\n        'payload' :  context.global.Microscope1,\n        'topic' : 'Microscope1',\n        'device' :  context.global.Microscope1,\n        'mode' : 'mda',\n        'action' : 'setOFF'\n    });\n    test[String(0)].push(inject);\n    inject = [] ;\n    inject.push({\n        'topic' : 'Microscope1',\n        'device' : context.global.Microscope1,\n        'action' : 'setChannel',\n        'mode' : 'MDA',\n        'update' : {\n            'lamp' : true,\n            'intensity': parseInt(context.global.settingChannels[l].update.A[1]),\n            'shutter': false,\n            'timeout' : -1\n        } \n    });\n    test[String(0)].push(inject);*/\n    //repeat sequence\n        for(var i=0; i<parseInt(mda.children[0].children[0].data.repeat);i++){\n            test[String(i*parseInt(mda.children[0].children[0].data.time))] = [] ;\n            //position\n            for(var ii=0; ii<mda.children[0].children[0].children.length;ii++){\n                var limit = 1;\n                var zs = false ;\n                var keep = false;\n                // if(mda.children[0].children[0].children[ii].children[iii].type === 'ZS'){\n                    //zs = true ;\n                    //keep = true ;\n                    //var zstart = parseInt(mda.children[0].children[0].children[ii].children[iii].data.zstart);\n                    //var zend = parseInt(mda.children[0].children[0].children[ii].children[iii].data.zend);\n                    //var zstep = parseInt(mda.children[0].children[0].children[ii].children[iii].data.zstep);\n                    //var inc = zstart - zend ;\n                    //if (inc<0) inc = inc * (-1) ;\n                    //var stepping =  (inc / zstep) ;\n                    //var zPosition = parseInt(mda.children[0].children[0].children[ii].data.zPosition);\n                    //limit = stepping;\n                    //node.warn(stepping);\n                // }    \n                for(var r=0;r<limit;r++){\n                    var titlePisition = mda.children[0].children[0].children[ii].title ;\n                    if(zs===false){\n                        inject = [] ;           \n                        //go to position x et y \n                        inject.push({\n                            'payload' :  context.global.MotionStage1,\n                            'topic' : 'MotionStage1',\n                            'device' :  context.global.MotionStage1,\n                            'mode' : 'MDA',\n                            'action' : 'set',\n                            'update' : {\n                                \"xPosition\" : parseInt(mda.children[0].children[0].children[ii].data.xPosition),\n                                \"yPosition\" : parseInt(mda.children[0].children[0].children[ii].data.yPosition),\n                                \"moveType\" : \"G\"\n                                }\n                            });\n                    }\n                    //go to z position\n                    var z = 0;\n                    if(zs===false) z = parseInt(mda.children[0].children[0].children[ii].data.zPosition);\n                    else z = parseInt(mda.children[0].children[0].children[ii].data.zPosition) + 100*(zstart + zstep * r);\n                    inject.push({\n                        'topic' : 'Microscope1',\n                        'device' : context.global.Microscope1,\n                        'action' : 'setZposition',\n                        'mode' : 'MDA',\n                        'update' : {\n                            'zPosition': z,\n                            'moveType' : 'd'\n                            }\n                        });\n                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                    //in the position\n                    for(var iii=0; iii<mda.children[0].children[0].children[ii].children.length;iii++){\n                        //filter\n                        if(r===0){\n                            if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT'){\n                                inject = [] ;\n                                inject.push({\n                                    'topic' : 'Microscope1',\n                                    'device' : context.global.Microscope1,\n                                    'action' : 'setWheelFilter',\n                                    'mode' : 'MDA',\n                                    'update':{\n                                        'wheelFilter': parseInt(mda.children[0].children[0].children[ii].children[iii].data.wheel)\n                                        }\n                                    });\n                                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                            }\n                        }\n                        //set Ligth\n                        for(var l=1; l<context.global.settingChannels.length; l++){\n                            if(context.global.settingChannels[l].name === mda.children[0].children[0].children[ii].children[iii].data.title2){\n                                var exposure = -1 ;\n                                inject = [];\n                                //BF\n                                var titleChannel = mda.children[0].children[0].children[ii].children[iii].data.title2 ;\n                                if(context.global.settingChannels[l].device === \"OLYMPUS-IX-81\"){\n                                    inject.push({\n                                        'topic' : context.global.settingChannels[l].topic,\n                                        'device' : context.global.settingChannels[l].device,\n                                        'action' : 'setChannel',\n                                        'mode' : 'MDA',\n                                        'update' : {\n                                            'lamp' : true,\n                                            'intensity': parseInt(context.global.settingChannels[l].update.A[1]),\n                                            'shutter': true,\n                                            'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time),\n                                            'keep' : keep\n                                        } \n                                    });\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                    exposure = 100;//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                }\n                                //COOLLED\n                                if(context.global.settingChannels[l].device === \"CoolLed-PE4000\"){\n                                    inject.push({\n                                        'topic' : context.global.settingChannels[l].topic,\n                                        'device' : context.global.settingChannels[l].device,\n                                        'action' : 'setChannel',\n                                        'mode' : 'MDA',\n                                        'update' : {\n                                            \"A\" :[parseInt(context.global.settingChannels[l].update.A[0]),parseInt(context.global.settingChannels[l].update.A[1]),context.global.settingChannels[l].update.A[2] == \"ON\" ? false : true],\n                                            \"B\" :[parseInt(context.global.settingChannels[l].update.B[0]),parseInt(context.global.settingChannels[l].update.B[1]),context.global.settingChannels[l].update.B[2] == \"ON\" ? false : true],\n                                            \"C\" :[parseInt(context.global.settingChannels[l].update.C[0]),parseInt(context.global.settingChannels[l].update.C[1]),context.global.settingChannels[l].update.C[2] == \"ON\" ? false : true],\n                                            \"D\" :[parseInt(context.global.settingChannels[l].update.D[0]),parseInt(context.global.settingChannels[l].update.D[1]),context.global.settingChannels[l].update.D[2] == \"ON\" ? false : true],\n                                            'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time),\n                                            'keep' : keep\n                                        }\n                                    });\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                    exposure = 10;//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                }\n                            }\n                        }\n                        if((mda.children[0].children[0].children[ii].children[iii].type === 'CAMERA')||(zs===true)){\n                            inject = [];\n                            inject.push({\n                                'topic' : 'Camera1',\n                                'device' : context.global.Camera1,\n                                'action' : 'GRAB',\n                                'prefixe' : mda.children[0].data.prefixe,\n                                'channel': titleChannel,\n                                'position' : titlePisition,  \n                                'exposure' : exposure \n                                });\n                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                            if(exposure !== -1){\n                                if(ii!==mda.children[0].children[0].children.length-1){\n                                    inject = [];\n                                    inject.push({\n                                        'action' : '_waiting_',\n                                        });\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                    exposure = -1 ;\n                                }\n                            }\n                        }\n                        \n                        //picture+af\n                        //faire el stop\n                        //af et zs\n                \n                    }    \n                }\n            }\n        \n            if(i === parseInt(mda.children[0].children[0].data.repeat)-1){\n                inject =\n                [{\n                'payload' : 'MDA-FINISH',\n                }];\n                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n            }            \n        }\n        return test ;    \n}","outputs":1,"noerr":0,"x":2590,"y":980,"wires":[["3e6b34fd.819b6c","a3551847.f88518"]]},{"id":"9bac1453.e0c028","type":"OlympusIx81","z":"34847536.cbb3ea","name":"","x":890,"y":1240,"wires":[["90daf55e.6d21e8","c81bbb99.9a3ed8","7aaa9f74.06de4","2bdcc62d.52b16a"]]},{"id":"4b49a3cf.31076c","type":"function","z":"34847536.cbb3ea","name":"filter 3","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\n//msg.action = 'setChannel';\nmsg.action = 'setWheelFilter';\n/*msg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 5000\n}*/\nmsg.update = {\n    \"wheelFilter\" : 3\n}\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":1260,"wires":[["9bac1453.e0c028"]]},{"id":"e1218a63.a789a8","type":"inject","z":"34847536.cbb3ea","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":300,"y":1260,"wires":[["4b49a3cf.31076c"]]},{"id":"e63a1898.be8e58","type":"file in","z":"34847536.cbb3ea","name":"","filename":"C:\\Users\\labo\\.node-red\\lib2\\mda\\list.txt","format":"utf8","chunk":false,"sendError":false,"x":980,"y":400,"wires":[["17a53022.659da"]]},{"id":"17a53022.659da","type":"function","z":"34847536.cbb3ea","name":"Initialisation","func":"context.global.listConfigMda = msg.payload.split(\";\");\n//context.global.initialize = false ;\n//context.global.ressources = [] ;\n\n//context.global.test = [];\n","outputs":1,"noerr":0,"x":1270,"y":400,"wires":[[]]},{"id":"12c3afc7.a73bb","type":"function","z":"34847536.cbb3ea","name":"save config mda","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\";\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\nvar output = {} ;\nif(order[0] === 'saveMDA'){\n    if(order[1] ===''){\n        output.filename = context.global.saveConfigMda;\n    }\n    else {\n        context.global.saveConfigMda = 'C:/Users/labo/.node-red/lib2/mda/'+order[1]+'.json';\n        output.filename = context.global.saveConfigMda ;\n        context.global.listConfigMda.push(order[1]+\".json\");\n    }\n    output.payload =  order[2];\n    node.send(output);\n}","outputs":1,"noerr":0,"x":2340,"y":860,"wires":[["3bd4a27e.28a9ae"]]},{"id":"3bd4a27e.28a9ae","type":"file","z":"34847536.cbb3ea","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","x":2830,"y":860,"wires":[[]]},{"id":"92a4241.718cad8","type":"function","z":"34847536.cbb3ea","name":"extend config channel","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\";\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\nvar output = {} ;\nif((order[0] === 'saveMDA')&&(order[1]!=='')){\n    output.payload = \";\"+order[1]+\".json\";\n    node.send(output);\n}","outputs":1,"noerr":0,"x":2360,"y":900,"wires":[["9a320551.ffc618"]]},{"id":"9a320551.ffc618","type":"file","z":"34847536.cbb3ea","name":"","filename":"C:\\Users\\labo\\.node-red\\lib2\\mda\\list.txt","appendNewline":false,"createDir":true,"overwriteFile":"false","x":2720,"y":900,"wires":[[]]},{"id":"411047a4.cf81e8","type":"link out","z":"34847536.cbb3ea","name":"MDA-FINISH","links":["732cfb9.1a8ec04"],"x":2435,"y":1020,"wires":[]},{"id":"732cfb9.1a8ec04","type":"link in","z":"34847536.cbb3ea","name":"","links":["411047a4.cf81e8"],"x":515,"y":620,"wires":[["827a258f.2eedf8","4265f253.30799c"]]},{"id":"4739d802.efac38","type":"delay","z":"34847536.cbb3ea","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":480,"y":580,"wires":[["827a258f.2eedf8","4265f253.30799c","847e756.b54f488"]]},{"id":"3e6b34fd.819b6c","type":"link out","z":"34847536.cbb3ea","name":"MDA-START","links":["3412d09b.4beeb"],"x":2695,"y":980,"wires":[]},{"id":"3412d09b.4beeb","type":"link in","z":"34847536.cbb3ea","name":"","links":["3e6b34fd.819b6c"],"x":375,"y":580,"wires":[["4739d802.efac38","29ec4ccb.071ec4"]]},{"id":"968bad3a.4e0d2","type":"function","z":"34847536.cbb3ea","name":"filter tree","func":"if(msg.payload.substr(0,11) === '{\"expanded\"')return msg;","outputs":1,"noerr":0,"x":2320,"y":980,"wires":[["8db61e15.795b5"]]},{"id":"847e756.b54f488","type":"pythonshell in","z":"34847536.cbb3ea","pyfile":"C:\\Users\\labo\\customizeNode\\node-red-contrib-photometrics-evolv-512\\PhotometricsEvolv512\\test2.py","x":900,"y":560,"wires":[[]],"icon":"node-red/camera.png"},{"id":"9e223c02.3e4fd","type":"websocket in","z":"34847536.cbb3ea","name":"","server":"61a4f449.1f741c","client":"","x":460,"y":800,"wires":[["85c9b280.1f731"]]},{"id":"19fc7520.19ce3b","type":"websocket out","z":"34847536.cbb3ea","name":"","server":"b1d0bce3.0ecdd","client":"","x":1540,"y":800,"wires":[]},{"id":"749e65e7.0c3fbc","type":"function","z":"34847536.cbb3ea","name":"name GRAB","func":"if(msg.payload !== 'STOP'){\n    msg.payload = msg.update.name;\n    node.send(msg);\n}\n","outputs":1,"noerr":0,"x":1310,"y":800,"wires":[["19fc7520.19ce3b"]]},{"id":"8ebef5c8.2ae828","type":"function","z":"34847536.cbb3ea","name":"Camera send","func":"if(msg.device === 'PHOTOMETRICS-EVOLV-512'){\n    if(msg.action === 'GRAB'){\n    msg.payload = \"GRAB,\"+msg.prefixe+','+msg.position+','+msg.channel+','+Date.now()+','+msg.exposure;\n    node.send(msg);\n    }\n}\n","outputs":1,"noerr":0,"x":920,"y":840,"wires":[["32b74b91.fc95b4"]],"icon":"node-red/camera.png"},{"id":"32b74b91.fc95b4","type":"websocket out","z":"34847536.cbb3ea","name":"","server":"35215fcb.75dd2","client":"","x":1350,"y":840,"wires":[]},{"id":"7be4eb90.5e32b4","type":"debug","z":"34847536.cbb3ea","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1650,"y":720,"wires":[]},{"id":"35e09efa.305402","type":"inject","z":"34847536.cbb3ea","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2060,"y":260,"wires":[["601f0e5c.d6993"]]},{"id":"601f0e5c.d6993","type":"function","z":"34847536.cbb3ea","name":"","func":"msg.payload = context.global.sequence2;\nreturn msg;","outputs":1,"noerr":0,"x":2190,"y":260,"wires":[["fa8dcd5e.ea606"]]},{"id":"fa8dcd5e.ea606","type":"debug","z":"34847536.cbb3ea","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2370,"y":180,"wires":[]},{"id":"4ffe81ab.88213","type":"PhotometricsEvolv512","z":"34847536.cbb3ea","name":"","x":910,"y":880,"wires":[["c81bbb99.9a3ed8"]]},{"id":"2835293b.644996","type":"function","z":"34847536.cbb3ea","name":"filter 2","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\n//msg.action = 'setChannel';\nmsg.action = 'setWheelFilter';\n/*msg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 5000\n}*/\nmsg.update = {\n    \"wheelFilter\" : 2\n}\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":1300,"wires":[["9bac1453.e0c028"]]},{"id":"e4ae9106.e5666","type":"inject","z":"34847536.cbb3ea","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":280,"y":1300,"wires":[["2835293b.644996"]]},{"id":"e22c0ef9.bcd1d","type":"function","z":"34847536.cbb3ea","name":"filter 1","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\n//msg.action = 'setChannel';\nmsg.action = 'setWheelFilter';\n/*msg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 5000\n}*/\nmsg.update = {\n    \"wheelFilter\" : 1\n}\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":1340,"wires":[["9bac1453.e0c028"]]},{"id":"34fd0bce.358974","type":"inject","z":"34847536.cbb3ea","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":300,"y":1340,"wires":[["e22c0ef9.bcd1d"]]},{"id":"b4f4a6c4.969c78","type":"function","z":"34847536.cbb3ea","name":"filter 6","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\n//msg.action = 'setChannel';\nmsg.action = 'setWheelFilter';\n/*msg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 5000\n}*/\nmsg.update = {\n    \"wheelFilter\" : 6\n}\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":1140,"wires":[["9bac1453.e0c028"]]},{"id":"8bad3a17.be0128","type":"inject","z":"34847536.cbb3ea","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":360,"y":1140,"wires":[["b4f4a6c4.969c78"]]},{"id":"44e8ecf8.1df664","type":"function","z":"34847536.cbb3ea","name":"filter 5","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\n//msg.action = 'setChannel';\nmsg.action = 'setWheelFilter';\n/*msg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 5000\n}*/\nmsg.update = {\n    \"wheelFilter\" : 5\n}\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":1180,"wires":[["9bac1453.e0c028"]]},{"id":"9e1f80a3.16446","type":"inject","z":"34847536.cbb3ea","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":340,"y":1180,"wires":[["44e8ecf8.1df664"]]},{"id":"43946d33.834404","type":"function","z":"34847536.cbb3ea","name":"filter 4","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\n//msg.action = 'setChannel';\nmsg.action = 'setWheelFilter';\n/*msg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 5000\n}*/\nmsg.update = {\n    \"wheelFilter\" : 4\n}\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":1220,"wires":[["9bac1453.e0c028"]]},{"id":"e3f9c27d.0088b","type":"inject","z":"34847536.cbb3ea","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":320,"y":1220,"wires":[["43946d33.834404"]]},{"id":"a291fa06.557888","type":"link out","z":"34847536.cbb3ea","name":"fancyTree","links":["1b49dab5.283ac5"],"x":2475,"y":740,"wires":[]},{"id":"1b49dab5.283ac5","type":"link in","z":"34847536.cbb3ea","name":"","links":["a291fa06.557888"],"x":695,"y":1460,"wires":[["8ebef5c8.2ae828","c3d76d36.8db0a","37ad6f0f.48ce1","9bac1453.e0c028"]]},{"id":"dfdb56cc.2679c8","type":"debug","z":"34847536.cbb3ea","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2310,"y":700,"wires":[]},{"id":"10e32da9.d2a422","type":"function","z":"34847536.cbb3ea","name":"timeout","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\nmsg.action = 'setChannel';\n//msg.action = 'setWheelFilter';\nmsg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 1000,\n    'keep' : false\n}\n/*msg.update = {\n    \"wheelFilter\" : 6\n}*/\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":1380,"wires":[["9bac1453.e0c028"]]},{"id":"6d086f44.f3df","type":"inject","z":"34847536.cbb3ea","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":300,"y":1380,"wires":[["10e32da9.d2a422"]]},{"id":"cc378163.edc34","type":"debug","z":"34847536.cbb3ea","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1510,"y":1180,"wires":[]},{"id":"ff4c62bc.e86c","type":"pythonshell in","z":"34847536.cbb3ea","pyfile":"C:\\Users\\labo\\customizeNode\\node-red-contrib-photometrics-evolv-512\\PhotometricsEvolv512\\app.py","x":900,"y":200,"wires":[[]],"icon":"node-red/camera.png"},{"id":"33164001.a85e7","type":"function","z":"34847536.cbb3ea","name":"MODIF1","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\n\n    \nif((order[0] === 'posLigth')&&(order.length === 5)){\n    \n    if (!isNaN(parseInt(order[4])))\n        context.global.settingChannels[parseInt(order[1])]['update'][order[2]][parseInt(order[3])] = parseInt(order[4]) ;\n    else \n        context.global.settingChannels[parseInt(order[1])]['update'][order[2]][parseInt(order[3])] = (order[4]) ;\n    msg.payload =  context.global.settingChannels;\n    if(context.global.saveConfigChannel !== '' ) msg.filename = context.global.saveConfigChannel;\n    myObject = context.global.settingChannels[parseInt(order[1])]['update'];\n    lettrine = String.fromCharCode(64+Object.keys(myObject).length);\n    msg.topic = 'mappingcolor'+context.global.settingChannels[parseInt(order[1])]['update'][lettrine][0] ;\n    msg.topic = msg.topic.replace('#','');\n    return msg ;\n}\nif((order[0] === 'posLigth')&&(parseInt(order[1])!==-1)&&(order.length===2)){\n    msg.payload =  context.global.settingChannels;\n    if(context.global.saveConfigChannel !== '' ) msg.filename = context.global.saveConfigChannel;\n    myObject = context.global.settingChannels[parseInt(order[1])]['update'];\n    lettrine = String.fromCharCode(64+Object.keys(myObject).length);\n    msg.topic = 'mappingcolor'+context.global.settingChannels[parseInt(order[1])]['update'][lettrine][0] ;\n    msg.topic = msg.topic.replace('#','');\n    return msg ;\n}\nif((order[0] === 'posLigth')&&(parseInt(order[1])===-1)){\n    msg.payload =  context.global.settingChannels;\n    if(context.global.saveConfigChannel !== '' ) msg.filename = context.global.saveConfigChannel;\n    msg.topic = 'mappingcolor808080' ;\n    return msg ;\n}","outputs":1,"noerr":0,"x":2320,"y":620,"wires":[["cfb8d82.3696a28","b854a280.65e86"]]},{"id":"cfb8d82.3696a28","type":"http request","z":"34847536.cbb3ea","name":"","method":"GET","ret":"txt","url":"http://127.0.0.1:5000/{{{topic}}}","tls":"","x":2510,"y":660,"wires":[[]]},{"id":"f4a04d96.a69f7","type":"function","z":"34847536.cbb3ea","name":"MODIF1","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\n\n    \nif((order[0] === 'posInvert')){\n    msg.payload =  \"\";\n    msg.topic = 'invert'+ order[1] ;\n    return msg ;\n}\nif((order[0] === 'posExposure')){\n    msg.payload =  \"\";\n    msg.topic = 'exposure'+ parseInt(order[1]) ;\n    return msg ;\n}\nif((order[0] === 'posMap')){\n    msg.payload =  \"\";\n    msg.topic = 'map'+ (order[1]) ;\n    return msg ;\n}\nif((order[0] === 'mappingcolor')){\n    msg.payload =  \"\";\n    msg.topic = 'mappingcolor'+ (order[1]) ;\n    return msg ;\n}","outputs":1,"noerr":0,"x":2320,"y":660,"wires":[["cfb8d82.3696a28"]]},{"id":"b854a280.65e86","type":"file","z":"34847536.cbb3ea","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","x":2490,"y":620,"wires":[[]]},{"id":"29ec4ccb.071ec4","type":"function","z":"34847536.cbb3ea","name":"stop live","func":"msg.payload =  'quit';\nmsg.topic   = 'quit';\nreturn msg ;","outputs":1,"noerr":0,"x":600,"y":500,"wires":[["140fd30c.5adb4d"]]},{"id":"140fd30c.5adb4d","type":"http request","z":"34847536.cbb3ea","name":"","method":"GET","ret":"txt","url":"http://127.0.0.1:5000/{{{topic}}}","tls":"","x":890,"y":500,"wires":[[]]},{"id":"2bdcc62d.52b16a","type":"debug","z":"34847536.cbb3ea","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1170,"y":1180,"wires":[]},{"id":"f426d197.f78fd","type":"function","z":"34847536.cbb3ea","name":"timeout","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\nmsg.action = 'setChannel';\n//msg.action = 'setWheelFilter';\nmsg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 1000,\n    'keep' : true\n}\n/*msg.update = {\n    \"wheelFilter\" : 6\n}*/\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":1420,"wires":[["9bac1453.e0c028"]]},{"id":"aa7760eb.6fb9c","type":"inject","z":"34847536.cbb3ea","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":320,"y":1420,"wires":[["f426d197.f78fd"]]},{"id":"5a442e08.d11cb","type":"function","z":"34847536.cbb3ea","name":"timeout","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\nmsg.action = 'setChannel';\n//msg.action = 'setWheelFilter';\nmsg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 1,\n    'keep' : false\n}\n/*msg.update = {\n    \"wheelFilter\" : 6\n}*/\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":1460,"wires":[["9bac1453.e0c028"]]},{"id":"92d0e0c6.34db7","type":"inject","z":"34847536.cbb3ea","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":340,"y":1460,"wires":[["5a442e08.d11cb"]]},{"id":"db40f827.cd6408","type":"inject","z":"34847536.cbb3ea","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":360,"y":1000,"wires":[["731e09e.3c871f8"]]},{"id":"731e09e.3c871f8","type":"function","z":"34847536.cbb3ea","name":"live","func":"msg.payload =  context.global.Fluorescence1;\nmsg.topic = 'Fluorescence1';\nmsg.device =  context.global.Fluorescence1;\nmsg.mode = 'live';\nmsg.action = 'setChannel';\nmsg.update = {\n  \"A\" : [385,10,false],\n  \"B\" : [490,100,false],\n  \"C\" : [580,45,false],\n  \"D\" : [740,100,false],\n  'timeout' : 1,\n  'keep' : false\n}    \nreturn msg;","outputs":1,"noerr":0,"x":490,"y":1000,"wires":[["37ad6f0f.48ce1"]]},{"id":"e54c2472.9559b8","type":"inject","z":"34847536.cbb3ea","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":360,"y":1080,"wires":[["7f1c453b.44c55c"]]},{"id":"7f1c453b.44c55c","type":"function","z":"34847536.cbb3ea","name":"live","func":"msg.payload =  context.global.Fluorescence1;\nmsg.topic = 'Fluorescence1';\nmsg.device =  context.global.Fluorescence1;\nmsg.mode = 'live';\nmsg.action = 'setChannel';\nmsg.update = {\n  \"A\" : [385,10,true],\n  \"B\" : [490,100,true],\n  \"C\" : [580,45,false],\n  \"D\" : [740,100,true],\n  'timeout' : 5000,\n  'keep' : true\n}    \nreturn msg;","outputs":1,"noerr":0,"x":490,"y":1080,"wires":[["37ad6f0f.48ce1"]]},{"id":"a8f9922.b4db17","type":"function","z":"34847536.cbb3ea","name":"protocole N","func":"var mda = msg.payload ;\nvar output = {} ;\n\ntry {\n    if(mda['type'] === 'mda'){\n        if(mda.children[0].data.algo === 'algo1'){\n            output = algo1(mda);\n        }\n        msg.payload = \"MDA-START\" ;\n        context.global.sequence2 = output ;\n        return msg;   \n    }\n   \n}\ncatch(error){}\n\nfunction algo1(mda){\n    var test = {} ;\n    var inject = [] ;           \n    /*inject.push({\n        'payload' :  context.global.Fluorescence1,\n        'topic' : 'Fluorescence1',\n        'device' :  context.global.Fluorescence1,\n        'mode' : 'mda',\n        'action' : 'setOFF'\n    });\n    inject.push({\n        'payload' :  context.global.Microscope1,\n        'topic' : 'Microscope1',\n        'device' :  context.global.Microscope1,\n        'mode' : 'mda',\n        'action' : 'setOFF'\n    });\n    test[String(0)].push(inject);\n    inject = [] ;\n    inject.push({\n        'topic' : 'Microscope1',\n        'device' : context.global.Microscope1,\n        'action' : 'setChannel',\n        'mode' : 'MDA',\n        'update' : {\n            'lamp' : true,\n            'intensity': parseInt(context.global.settingChannels[l].update.A[1]),\n            'shutter': false,\n            'timeout' : -1\n        } \n    });\n    test[String(0)].push(inject);*/\n    //repeat sequence\n        for(var i=0; i<parseInt(mda.children[0].children[0].data.repeat);i++){\n            test[String(i*parseInt(mda.children[0].children[0].data.time))] = [] ;\n            //position\n            for(var ii=0; ii<mda.children[0].children[0].children.length;ii++){\n                \n                if(mda.children[0].children[0].children[ii].children[iii].type === 'ZS'){\n                    var zstart = parseInt(mda.children[0].children[0].children[ii].children[iii].data.zstart);\n                    var zend = parseInt(mda.children[0].children[0].children[ii].children[iii].data.zend);\n                    var zstep = parseInt(mda.children[0].children[0].children[ii].children[iii].data.zstep);\n                    var inc = zstart - zend ;\n                    if (inc<0) inc = inc * (-1) ;\n                    var stepping =  (inc / zstep) ;\n                    var zPosition = parseInt(mda.children[0].children[0].children[ii].data.zPosition);\n                }    \n                \n                var limit = 1 ;\n                for(var r=0;r<limit;r++){    \n                    var titlePisition = mda.children[0].children[0].children[ii].title ;\n                    inject = [] ;           \n                    //go to position x et y \n                    inject.push({\n                        'payload' :  context.global.MotionStage1,\n                        'topic' : 'MotionStage1',\n                        'device' :  context.global.MotionStage1,\n                        'mode' : 'MDA',\n                        'action' : 'set',\n                        'update' : {\n                            \"xPosition\" : parseInt(mda.children[0].children[0].children[ii].data.xPosition),\n                            \"yPosition\" : parseInt(mda.children[0].children[0].children[ii].data.yPosition),\n                            \"moveType\" : \"G\"\n                            }\n                        });\n                    //go to z position\n                    inject.push({\n                        'topic' : 'Microscope1',\n                        'device' : context.global.Microscope1,\n                        'action' : 'setZposition',\n                        'mode' : 'MDA',\n                        'update' : {\n                            'zPosition': parseInt(mda.children[0].children[0].children[ii].data.zPosition),\n                            'moveType' : 'd'\n                            }\n                        });\n                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                    //in the position\n                    for(var iii=0; iii<mda.children[0].children[0].children[ii].children.length;iii++){\n                        //filter\n                        if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT'){\n                            inject = [] ;\n                            inject.push({\n                                'topic' : 'Microscope1',\n                                'device' : context.global.Microscope1,\n                                'action' : 'setWheelFilter',\n                                'mode' : 'MDA',\n                                'update':{\n                                    'wheelFilter': parseInt(mda.children[0].children[0].children[ii].children[iii].data.wheel)\n                                    }\n                                });\n                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                        }\n                        //set Ligth\n                        for(var l=1; l<context.global.settingChannels.length; l++){\n                            if(context.global.settingChannels[l].name === mda.children[0].children[0].children[ii].children[iii].data.title2){\n                                var exposure = -1 ;\n                                inject = [];\n                                //BF\n                                var titleChannel = mda.children[0].children[0].children[ii].children[iii].data.title2 ;\n                                if(context.global.settingChannels[l].device === \"OLYMPUS-IX-81\"){\n                                    inject.push({\n                                        'topic' : context.global.settingChannels[l].topic,\n                                        'device' : context.global.settingChannels[l].device,\n                                        'action' : 'setChannel',\n                                        'mode' : 'MDA',\n                                        'update' : {\n                                            'lamp' : true,\n                                            'intensity': parseInt(context.global.settingChannels[l].update.A[1]),\n                                            'shutter': true,\n                                            'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time),\n                                            'keep' : false\n                                        } \n                                    });\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                    exposure = 100;//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                }\n                                //COOLLED\n                                if(context.global.settingChannels[l].device === \"CoolLed-PE4000\"){\n                                    inject.push({\n                                        'topic' : context.global.settingChannels[l].topic,\n                                        'device' : context.global.settingChannels[l].device,\n                                        'action' : 'setChannel',\n                                        'mode' : 'MDA',\n                                        'update' : {\n                                            \"A\" :[parseInt(context.global.settingChannels[l].update.A[0]),parseInt(context.global.settingChannels[l].update.A[1]),context.global.settingChannels[l].update.A[2] == \"ON\" ? false : true],\n                                            \"B\" :[parseInt(context.global.settingChannels[l].update.B[0]),parseInt(context.global.settingChannels[l].update.B[1]),context.global.settingChannels[l].update.B[2] == \"ON\" ? false : true],\n                                            \"C\" :[parseInt(context.global.settingChannels[l].update.C[0]),parseInt(context.global.settingChannels[l].update.C[1]),context.global.settingChannels[l].update.C[2] == \"ON\" ? false : true],\n                                            \"D\" :[parseInt(context.global.settingChannels[l].update.D[0]),parseInt(context.global.settingChannels[l].update.D[1]),context.global.settingChannels[l].update.D[2] == \"ON\" ? false : true],\n                                            'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time),\n                                            'keep' : false\n                                        }\n                                    });\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                    exposure = 10;//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                }\n                            }\n                        }\n                        \n                        if(mda.children[0].children[0].children[ii].children[iii].type === 'CAMERA'){\n                            inject = [];\n                            inject.push({\n                                'topic' : 'Camera1',\n                                'device' : context.global.Camera1,\n                                'action' : 'GRAB',\n                                'prefixe' : mda.children[0].data.prefixe,\n                                'channel': titleChannel,\n                                'position' : titlePisition,  \n                                'exposure' : exposure \n                                });\n                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                            if(exposure !== -1){\n                                if(ii!==mda.children[0].children[0].children.length-1){\n                                    inject = [];\n                                    inject.push({\n                                        'action' : '_waiting_',\n                                        });\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                    exposure = -1 ;\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        \n            if(i === parseInt(mda.children[0].children[0].data.repeat)-1){\n                inject =\n                [{\n                'payload' : 'MDA-FINISH',\n                }];\n                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n            }            \n        }\n        return test ;    \n}","outputs":1,"noerr":0,"x":2650,"y":360,"wires":[[]]},{"id":"9a4aee00.02c65","type":"function","z":"34847536.cbb3ea","name":"protocole N MODIF","func":"var mda = msg.payload ;\nvar output = {} ;\n\ntry {\n    if(mda['type'] === 'mda'){\n        if(mda.children[0].data.algo === 'algo1'){\n            output = algo1(mda);\n        }\n        msg.payload = \"MDA-START\" ;\n        context.global.sequence2 = output ;\n        return msg;   \n    }\n   \n}\ncatch(error){}\n\nfunction algo1(mda){\n    \n    var test = {} ;\n    /*Algo 1\n    sequence\n    ----position\n        ----light\n        ----zs ou camera\n        ----light\n        ----zs ou came\n            ....\n    ----position\n        ....\n    */    \n    //repeat sequence\n        for(var i=0; i<parseInt(mda.children[0].children[0].data.repeat);i++){\n            test[String(i*parseInt(mda.children[0].children[0].data.time))] = [] ;\n\n            //position\n            for(var ii=0; ii<mda.children[0].children[0].children.length;ii++){\n                var titlePisition = mda.children[0].children[0].children[ii].title ;\n                var inject = [] ;           \n                //go to position x et y \n                inject.push({\n                    'payload' :  context.global.MotionStage1,\n                    'topic' : 'MotionStage1',\n                    'device' :  context.global.MotionStage1,\n                    'mode' : 'MDA',\n                    'action' : 'set',\n                    'update' : {\n                        \"xPosition\" : parseInt(mda.children[0].children[0].children[ii].data.xPosition),\n                        \"yPosition\" : parseInt(mda.children[0].children[0].children[ii].data.yPosition),\n                        \"moveType\" : \"G\"\n                        }\n                    });\n                //go to z position\n                /*inject.push({\n                    'topic' : 'Microscope1',\n                    'device' : context.global.Microscope1,\n                    'action' : 'setZposition',\n                    'mode' : 'MDA',\n                    'update' : {\n                        'zPosition': parseInt(mda.children[0].children[0].children[ii].data.zPosition),\n                        }\n                    });\n                */\n                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                //in the position\n                for(var iii=0; iii<mda.children[0].children[0].children[ii].children.length;iii++){\n                    //filter\n                    var limit = 1 ;\n                    var keep = false ;\n                    var zPosition =parseInt(mda.children[0].children[0].children[ii].data.zPosition);\n                    node.warn(zPosition);\n                    var active = 0 ;\n                    if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT'){\n                        inject = [] ;\n                        inject.push({\n                            'topic' : 'Microscope1',\n                            'device' : context.global.Microscope1,\n                            'action' : 'setWheelFilter',\n                            'mode' : 'MDA',\n                            'update':{\n                                'wheelFilter': parseInt(mda.children[0].children[0].children[ii].children[iii].data.wheel)\n                                }\n                            });\n                        test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                    \n                        // detect image or zstack AND set limit for the repeat loop\n                        if(mda.children[0].children[0].children[ii].children[iii+1].type === 'CAMERA'){\n                            limit = 1 ;\n                            keep = false ;\n                            active = 0 ;\n                        }\n                        if(mda.children[0].children[0].children[ii].children[iii+1].type === 'ZS'){\n                            var zstart = parseInt(mda.children[0].children[0].children[ii].children[iii+1].data.zstart);\n                            var zend = parseInt(mda.children[0].children[0].children[ii].children[iii+1].data.zend);\n                            var zstep = parseInt(mda.children[0].children[0].children[ii].children[iii+1].data.zstep);\n                            var progress = parseInt(Math.abs(zstart-zend) / zstep) + 1 ;\n                            limit = progress ;\n                            keep = mda.children[0].children[0].children[ii].children[iii+1].data.shutter ;\n                            active = 1 ;\n                        }\n                    }\n                        \n                        //////////////////////////////////////\n                    if(true) {\n                        for(var r=0;r<limit;r++){\n                            \n                            //if((r!==0)){\n                            inject = [] ;\n                            inject.push({\n                                'topic' : 'Microscope1',\n                                'device' : context.global.Microscope1,\n                                'action' : 'setZposition',\n                                'mode' : 'MDA',\n                                'update' : {\n                                    'zPosition': zPosition + active * 100*(zstart + zstep * r)\n                                    }\n                                });\n                            if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT')\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                            //}\n                       \n                            //set Ligth\n                            if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT'){\n                                for(var l=1; l<context.global.settingChannels.length; l++){\n                                    if(context.global.settingChannels[l].name === mda.children[0].children[0].children[ii].children[iii].data.title2){\n                                        inject = [];\n                                        //BF\n                                        var titleChannel = mda.children[0].children[0].children[ii].children[iii].data.title2 ;\n                                        if(context.global.settingChannels[l].device === \"OLYMPUS-IX-81\"){\n                                            inject.push({\n                                                'topic' : context.global.settingChannels[l].topic,\n                                                'device' : context.global.settingChannels[l].device,\n                                                'action' : 'setChannel',\n                                                'mode' : 'MDA',\n                                                'update' : {\n                                                    'lamp' : true,\n                                                    'intensity': parseInt(context.global.settingChannels[l].update.A[1]),\n                                                    'shutter': true,\n                                                    'keep' : keep ,\n                                                    'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time)\n                                                } \n                                            });\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                        }\n                                        //COOLLED\n                                        if(context.global.settingChannels[l].device === \"CoolLed-PE-4000\"){\n                                            inject.push({\n                                                'topic' : context.global.settingChannels[l].topic,\n                                                'device' : context.global.settingChannels[l].device,\n                                                'action' : 'setChannel',\n                                                'mode' : 'MDA',\n                                                'update' : {\n                                                    \"A\" :[parseInt(context.global.settingChannels[l].update.A[0]),parseInt(context.global.settingChannels[l].update.A[1]),context.global.settingChannels[l].update.A[2] == \"ON\" ? false : true],\n                                                    \"B\" :[parseInt(context.global.settingChannels[l].update.B[0]),parseInt(context.global.settingChannels[l].update.B[1]),context.global.settingChannels[l].update.B[2] == \"ON\" ? false : true],\n                                                    \"C\" :[parseInt(context.global.settingChannels[l].update.C[0]),parseInt(context.global.settingChannels[l].update.C[1]),context.global.settingChannels[l].update.C[2] == \"ON\" ? false : true],\n                                                    \"D\" :[parseInt(context.global.settingChannels[l].update.D[0]),parseInt(context.global.settingChannels[l].update.D[1]),context.global.settingChannels[l].update.D[2] == \"ON\" ? false : true],\n                                                    'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time),\n                                                    'keep': keep\n                                                    }\n                                            });\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                        }\n                                    }\n                                }\n                            }\n                            if(mda.children[0].children[0].children[ii].children[iii].type === 'CAMERA'){\n                                inject = [];\n                                inject.push({\n                                    'topic' : 'Camera1',\n                                    'device' : context.global.Camera1,\n                                    'action' : 'GRAB',\n                                    'prefixe' : mda.children[0].data.prefixe,\n                                    'channel': titleChannel,\n                                    'position' : titlePisition    \n                                    });\n                                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                            }\n                            if((limit > 1)&&(mda.children[0].children[0].children[ii].children[iii].type !== 'ZS')){\n                                inject = [];\n                                inject.push({\n                                    'topic' : 'Camera1',\n                                    'device' : context.global.Camera1,\n                                    'action' : 'GRAB',\n                                    'prefixe' : mda.children[0].data.prefixe,\n                                    'channel': titleChannel,\n                                    'position' : titlePisition    \n                                    });\n                                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                            }\n                        \n                        }\n                        ////////////////////////////\n                    }//picture+af\n                    //faire el stop\n                    //af et zs\n                }\n            }\n        \n            if(i === parseInt(mda.children[0].children[0].data.repeat)-1){\n              //  node.warn(\"TR\");\n                inject =\n                [{\n                'payload' : 'MDA-FINISH',\n                }];\n                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n            }            \n        }\n        return test ;    \n}","outputs":1,"noerr":0,"x":3130,"y":880,"wires":[[]]},{"id":"4c492f96.4ff0b","type":"function","z":"34847536.cbb3ea","name":"transfert","func":"var mda = msg.payload ;\nvar output = {} ;\n\ntry {\n    if(mda['type'] === 'mda'){\n        if(mda.children[0].data.algo === 'algo1'){\n            output = algo1(mda);\n        }\n        msg.payload = \"MDA-START\" ;\n        context.global.sequence2 = output ;\n        return msg;   \n    }\n   \n}\ncatch(error){}\n\nfunction algo1(mda){\n    \n    var test = {} ;\n    /*Algo 1\n    sequence\n    ----position\n        ----light\n        ----zs ou camera\n        ----light\n        ----zs ou came\n            ....\n    ----position\n        ....\n    */    \n    //repeat sequence\n        for(var i=0; i<parseInt(mda.children[0].children[0].data.repeat);i++){\n            test[String(i*parseInt(mda.children[0].children[0].data.time))] = [] ;\n\n            //position\n            for(var ii=0; ii<mda.children[0].children[0].children.length;ii++){\n                var titlePisition = mda.children[0].children[0].children[ii].title ;\n                var inject = [] ;           \n                //go to position x et y \n                inject.push({\n                    'payload' :  context.global.MotionStage1,\n                    'topic' : 'MotionStage1',\n                    'device' :  context.global.MotionStage1,\n                    'mode' : 'MDA',\n                    'action' : 'set',\n                    'update' : {\n                        \"xPosition\" : parseInt(mda.children[0].children[0].children[ii].data.xPosition),\n                        \"yPosition\" : parseInt(mda.children[0].children[0].children[ii].data.yPosition),\n                        \"moveType\" : \"G\"\n                        }\n                    });\n                //go to z position\n                /*inject.push({\n                    'topic' : 'Microscope1',\n                    'device' : context.global.Microscope1,\n                    'action' : 'setZposition',\n                    'mode' : 'MDA',\n                    'update' : {\n                        'zPosition': parseInt(mda.children[0].children[0].children[ii].data.zPosition),\n                        }\n                    });\n                */\n                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                //in the position\n                for(var iii=0; iii<mda.children[0].children[0].children[ii].children.length;iii++){\n                    //filter\n                    var limit = 1 ;\n                    var keep = false ;\n                    var zPosition =parseInt(mda.children[0].children[0].children[ii].data.zPosition);\n                    node.warn(zPosition);\n                    var active = 0 ;\n                    if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT'){\n                        inject = [] ;\n                        inject.push({\n                            'topic' : 'Microscope1',\n                            'device' : context.global.Microscope1,\n                            'action' : 'setWheelFilter',\n                            'mode' : 'MDA',\n                            'update':{\n                                'wheelFilter': parseInt(mda.children[0].children[0].children[ii].children[iii].data.wheel)\n                                }\n                            });\n                        test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                    \n                        // detect image or zstack AND set limit for the repeat loop\n                        if(mda.children[0].children[0].children[ii].children[iii+1].type === 'CAMERA'){\n                            limit = 1 ;\n                            keep = false ;\n                            active = 0 ;\n                        }\n                        if(mda.children[0].children[0].children[ii].children[iii+1].type === 'ZS'){\n                            var zstart = parseInt(mda.children[0].children[0].children[ii].children[iii+1].data.zstart);\n                            var zend = parseInt(mda.children[0].children[0].children[ii].children[iii+1].data.zend);\n                            var zstep = parseInt(mda.children[0].children[0].children[ii].children[iii+1].data.zstep);\n                            var progress = parseInt(Math.abs(zstart-zend) / zstep) + 1 ;\n                            limit = progress ;\n                            keep = mda.children[0].children[0].children[ii].children[iii+1].data.shutter ;\n                            active = 1 ;\n                        }\n                    }\n                        \n                    if(true) {\n                        for(var r=0;r<limit;r++){\n                            \n                            inject = [] ;\n                            inject.push({\n                                'topic' : 'Microscope1',\n                                'device' : context.global.Microscope1,\n                                'action' : 'setZposition',\n                                'mode' : 'MDA',\n                                'update' : {\n                                    'zPosition': zPosition + active * 100*(zstart + zstep * r),\n                                    'moveType' : 'd'\n                                    }\n                                });\n                           if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT')\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                       \n                            //set Ligth\n                            if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT'){\n                                for(var l=1; l<context.global.settingChannels.length; l++){\n                                    if(context.global.settingChannels[l].name === mda.children[0].children[0].children[ii].children[iii].data.title2){\n                                        var exposure = -1 ;\n                                        inject = [];\n                                        //BF\n                                        var titleChannel = mda.children[0].children[0].children[ii].children[iii].data.title2 ;\n                                        if(context.global.settingChannels[l].device === \"OLYMPUS-IX-81\"){\n                                            inject.push({\n                                                'topic' : context.global.settingChannels[l].topic,\n                                                'device' : context.global.settingChannels[l].device,\n                                                'action' : 'setChannel',\n                                                'mode' : 'MDA',\n                                                'update' : {\n                                                    'lamp' : true,\n                                                    'intensity': parseInt(context.global.settingChannels[l].update.A[1]),\n                                                    'shutter': true,\n                                                    'keep' : keep ,\n                                                    'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time)\n                                                } \n                                            });\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                            exposure = 100;//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                        }\n                                        //COOLLED\n                                        if(context.global.settingChannels[l].device === \"CoolLed-PE-4000\"){\n                                            inject.push({\n                                                'topic' : context.global.settingChannels[l].topic,\n                                                'device' : context.global.settingChannels[l].device,\n                                                'action' : 'setChannel',\n                                                'mode' : 'MDA',\n                                                'update' : {\n                                                    \"A\" :[parseInt(context.global.settingChannels[l].update.A[0]),parseInt(context.global.settingChannels[l].update.A[1]),context.global.settingChannels[l].update.A[2] == \"ON\" ? false : true],\n                                                    \"B\" :[parseInt(context.global.settingChannels[l].update.B[0]),parseInt(context.global.settingChannels[l].update.B[1]),context.global.settingChannels[l].update.B[2] == \"ON\" ? false : true],\n                                                    \"C\" :[parseInt(context.global.settingChannels[l].update.C[0]),parseInt(context.global.settingChannels[l].update.C[1]),context.global.settingChannels[l].update.C[2] == \"ON\" ? false : true],\n                                                    \"D\" :[parseInt(context.global.settingChannels[l].update.D[0]),parseInt(context.global.settingChannels[l].update.D[1]),context.global.settingChannels[l].update.D[2] == \"ON\" ? false : true],\n                                                    'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time),\n                                                    'keep': keep\n                                                    }\n                                            });\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                            exposure = 10;//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                        }\n                                    }\n                                }\n                            }\n                            if(mda.children[0].children[0].children[ii].children[iii].type === 'CAMERA'){\n                                inject = [];\n                                inject.push({\n                                    'topic' : 'Camera1',\n                                    'device' : context.global.Camera1,\n                                    'action' : 'GRAB',\n                                    'prefixe' : mda.children[0].data.prefixe,\n                                    'channel': titleChannel,\n                                    'position' : titlePisition,  \n                                    'exposure' : exposure \n                                    });\n                                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                if(exposure !== -1){\n                                    if(ii!==mda.children[0].children[0].children.length-1){\n                                            inject = [];\n                                            inject.push({'action' : '_waiting_',});\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                            exposure = -1 ;\n                                        }\n                                }\n\n                            }\n                            if((limit > 1)&&(mda.children[0].children[0].children[ii].children[iii].type !== 'ZS')){\n                                inject = [];\n                                inject.push({\n                                    'topic' : 'Camera1',\n                                    'device' : context.global.Camera1,\n                                    'action' : 'GRAB',\n                                    'prefixe' : mda.children[0].data.prefixe,\n                                    'channel': titleChannel,\n                                    'position' : titlePisition,  \n                                    'exposure' : exposure \n                                    });\n                                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                if(exposure !== -1){\n                                    if(ii!==mda.children[0].children[0].children.length-1){\n                                            inject = [];\n                                            inject.push({'action' : '_waiting_'});\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                            exposure = -1 ;\n                                        }\n                                }\n                            }\n                        \n                        }\n                    }\n                }\n            }\n        \n            if(i === parseInt(mda.children[0].children[0].data.repeat)-1){\n                inject =[{'payload' : 'MDA-FINISH'}];\n                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n            }            \n        }\n        return test ;    \n}","outputs":1,"noerr":0,"x":3090,"y":820,"wires":[[]]},{"id":"5441704e.daab1","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1420,"y":400,"wires":[["942d61d0.aa911","ce09c46f.3114d8"]]},{"id":"942d61d0.aa911","type":"function","z":"cb80149c.966208","name":"sim temp","func":"var test = {} ;\ntest.payload = msg.payload; //\"f_temporisation\"; //context.global.MotionStage1,\ntest.topic = 'f_temporisation';\ntest.device = 'f_temporisation' ; // context.global.MotionStage1,\ntest.action = 'timeout';\ntest.update = {\n    \"t\" : 2\n}\nreturn test;","outputs":1,"noerr":0,"x":1570,"y":400,"wires":[["b8786156.d751d"]]},{"id":"b8786156.d751d","type":"function","z":"cb80149c.966208","name":"Timer","func":"if(msg.device === 'f_temporisation'){\n    setTimeout(function(){\n        msg.payload = Date.now();\n        node.send(msg);    \n    },parseInt(msg.update.t));\n}\n","outputs":1,"noerr":0,"x":1730,"y":400,"wires":[["ce09c46f.3114d8"]],"icon":"node-red/time.png"},{"id":"ce09c46f.3114d8","type":"debug","z":"cb80149c.966208","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1610,"y":480,"wires":[]},{"id":"e48b7373.7cc5d","type":"comment","z":"cb80149c.966208","name":"","info":"Initialisation  // a revoir\nTimer // ok\nZ Stack AutoFocus// A FAIRE\nFInalisation // AFAIRE\n\n","x":1400,"y":360,"wires":[]},{"id":"d2b91574.3f8eb8","type":"create dataset","z":"8bcc9762.886108","name":"","path":"test/iris.data","saveFolder":"test/datasets","saveName":"iris","input":"0,1,2,3","output":"4","trainingPartition":"","shuffle":true,"seed":"","x":480,"y":220,"wires":[["5cd108ab.e69f58"]]},{"id":"54240b6b.ba2e64","type":"load dataset","z":"8bcc9762.886108","name":"","datasetFolder":"test/datasets","datasetName":"iris","partition":"train.csv","input":true,"output":true,"x":430,"y":340,"wires":[["9baed0a0.5071b"],["2afef071.fcdf7"]]},{"id":"6d2607d8.098f18","type":"inject","z":"8bcc9762.886108","name":"start","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":250,"y":220,"wires":[["d2b91574.3f8eb8"]]},{"id":"47ccaafe.55a904","type":"inject","z":"8bcc9762.886108","name":"start","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":250,"y":340,"wires":[["54240b6b.ba2e64"]]},{"id":"4ebc1ec9.5e90e","type":"inject","z":"8bcc9762.886108","name":"start","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":250,"y":580,"wires":[["9c252331.4b36b","cd32db9e.121778"]]},{"id":"5cd108ab.e69f58","type":"debug","z":"8bcc9762.886108","name":"print","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":710,"y":220,"wires":[]},{"id":"2afef071.fcdf7","type":"debug","z":"8bcc9762.886108","name":"error","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":910,"y":380,"wires":[]},{"id":"f685fb01.5deb88","type":"debug","z":"8bcc9762.886108","name":"print","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":890,"y":300,"wires":[]},{"id":"22dd51fe.298bbe","type":"predictor","z":"8bcc9762.886108","name":"decision tree classifier predictor","modelPath":"test/models","modelName":"dtc.b","x":690,"y":560,"wires":[["9ff85c4d.770b"],["320fc6c6.fe1dda"]]},{"id":"9baed0a0.5071b","type":"decision tree classifier","z":"8bcc9762.886108","name":"decision tree classifier trainer","savePath":"test/models","saveName":"dtc.b","maxDepth":"","criterion":"entropy","splitter":"best","x":680,"y":340,"wires":[["f685fb01.5deb88"],["2afef071.fcdf7"]]},{"id":"9ff85c4d.770b","type":"assessment","z":"8bcc9762.886108","name":"","score":"accuracy_score","x":730,"y":500,"wires":[["31141b9d.21de84"],["320fc6c6.fe1dda"]]},{"id":"9c252331.4b36b","type":"load dataset","z":"8bcc9762.886108","name":"","datasetFolder":"test/datasets","datasetName":"iris","partition":"test.csv","input":false,"output":true,"x":430,"y":500,"wires":[["9ff85c4d.770b"],["320fc6c6.fe1dda"]]},{"id":"cd32db9e.121778","type":"load dataset","z":"8bcc9762.886108","name":"","datasetFolder":"test/datasets","datasetName":"iris","partition":"test.csv","input":true,"output":false,"x":430,"y":620,"wires":[["22dd51fe.298bbe"],["320fc6c6.fe1dda"]]},{"id":"320fc6c6.fe1dda","type":"debug","z":"8bcc9762.886108","name":"error","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":930,"y":620,"wires":[]},{"id":"31141b9d.21de84","type":"debug","z":"8bcc9762.886108","name":"print","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":930,"y":500,"wires":[]},{"id":"6d1d46dc.a016b8","type":"predictor","z":"8bcc9762.886108","name":"decision tree classifier predictor","modelPath":"test/models","modelName":"dtc.b","x":590,"y":720,"wires":[["c31bef3e.621cd"],["1bcff1d2.6b62be"]]},{"id":"c31bef3e.621cd","type":"mqtt out","z":"8bcc9762.886108","name":"","topic":"predictions","qos":"","retain":"","broker":"331a47c7.c6e0c8","x":870,"y":680,"wires":[]},{"id":"1bcff1d2.6b62be","type":"debug","z":"8bcc9762.886108","name":"error","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":850,"y":760,"wires":[]},{"id":"b55758f4.51edc8","type":"mqtt in","z":"8bcc9762.886108","name":"","topic":"classification","qos":"2","broker":"331a47c7.c6e0c8","x":280,"y":720,"wires":[["6d1d46dc.a016b8"]]},{"id":"7cbc172e.ba3e68","type":"brain","z":"8bcc9762.886108","name":"brain","learningRate":0.3,"errorThresh":0.005,"iterations":20000,"log":false,"logPeriod":10,"x":100,"y":480,"wires":[[]]},{"id":"ce771927.8de8c8","type":"comment","z":"cd751f4f.c3b7b","name":"Read me","info":"This charting example extends node-red-dashboard and the work by Colin Law here:\nhttp://flows.nodered.org/flow/c3dc75c47323a2754f5285225bce64b5\n\nView the chart at http://localhost:1880/ui\n\nBoth the dashboard chart and Colin's example uses time as the X-axis. The example\nhere uses an integer as the x-axis. Colin's example uses Chart.js inside a\nnode-red-dashboard template node. The example here leaves Colin's code almost \nunchanged except that the chart.js XAxis is changed from:\n\n                xAxes: [{\n                    type: 'time',\n                    time: {\n                        unit: 'minute',\n                        unitStepSize: 1,\n                        displayFormats: {\n                            minute: 'HH:mm'\n                        }\n                    }\n                }],\n\nto this:\n              xAxes: [{\n                    type: 'linear',\n                    position: 'bottom'\n                    }\n                ],\n                \nI also adjusted the way the nodes are rendered.\n\nThis example pre-prepares the data object and uses the msg.action = \"load\" \nmethod to ask the template code to render the data. \n\nA dashboard button on the UI page generates fresh data with a different \nscale each time.\n\n\n","x":320,"y":220,"wires":[]},{"id":"8a417348.55437","type":"ui_template","z":"cd751f4f.c3b7b","group":"ba00a4f5.035c08","name":"Chart.js example","order":9,"width":"8","height":"8","format":"<!-- See the read me comment node. Colin Law's original notes follow -->\n\n<!--\nA node-red Dashboard UI template to draw charts using chart.js\nBefore use download the file Chart.bundle.min.js from chartjs.org and \nsave in an appropriate folder (e.g. .node-red/static). \nIn settings.js set httpStatic to the full path of that folder and restart node-red.\nMake sure that the options for 'Pass through messages' and 'Add output messages' \nin this node are cleared.\nFor basic use set the id and size you want in the canvas tag and set chartID to the id\nSetup chartDef as required for your chart (see the chart.js docs)\nIn addition, for each dataset specify in chartDef the message topic that you will use for that channel.\nTo (optionally) provide the chart with a one-off set of data send the node a message with:\nmsg.action = \"load\"\nmsg.payload = [\n{topic: \"mytopic1\", data: [{x: x1,y:y2},{x:x2,y:y2},...]},\n{topic: \"mytopic2\", data: [{x: x1,y:y2},{x:x2,y:y2},...]},\n...]\nWhere mytopic1 and mytopic2 are the the topics specified in the chartDef\n\nTo provide the chart with data incrementally (for a time series for example)\nsend it messages of the form\n{topic: \"mytopic1\", payload: {x:xvalue,y:yvalue}}\nThe chart will be updated as each sample is provided.\nTo limit the growth of the chart set chartMaxPoints and/or chartTimeSpan in the Chart Helper node\nas described at the head of that node.\nIf you find that chart seems to flicker and scroll bars come and go then try \nsetting a size other than auto in the Size specification for this node.\n\nFor Bar charts the x value is the label for the bar and the y value is the bar value\n\nNote that since the chart samples are stored in the browser then the chart will be cleared each\ntime the browser is refreshed (and will be clear on initially opening the view). In order to \nprovided persistency over browser opening and refresh this node may be used in conjunction with\nthe Chart Helper function node.  Details for its use are in the source of that node.\n\nIf your flow includes more that one instance of this script then the line fetching \nChart.bundle.min.js need only be included in one of them\n-->\n\n<script src=\"/Chart.bundle.min.js\"></script>\n<canvas id=\"myChartSimple1\" width=\"500\" height=\"500\"></canvas>\n<script>\n(function() {\n    var chartID = \"myChartSimple1\";           // set this to the id you have specified in the canvas tag above\n    // setup the chart definition as defined in the chart.js documentation, in addition setting up the topic\n    // for each channel\n    var chartDef = {\n        type: 'line',\n        data: {\n            datasets: [{\n                topic: \"Sin\",    // used here not by chart.js\n                label: \"Sin\",\n                yAxisID: \"1\",\n                fill: false,\n                lineTension: 0,\n                borderColor: \"#0000ff\",\n                pointRadius: 5,\n                pointHoverRadius: 5,\n                pointBorderColor: \"#0000ff\",\n                pointBackgroundColor: \"#0000ff\",\n                backgroundColor:  \"#0000ff\",\n                borderWidth: 1,\n                data: []  // data is written here later\n            }, {\n                topic: \"Triangle\",    // used here not by chart.js\n                label: \"Triangle\",\n                yAxisID: \"2\",\n                fill: false,\n                lineTension: 0,\n                borderColor: \"#ff0000\",\n                pointRadius: 5,\n                pointHoverRadius: 5,\n                pointBorderColor: \"#ff0000\",\n                pointBackgroundColor: \"#ff0000\",\n                backgroundColor:  \"#ff0000\",\n                borderWidth: 1,\n                data: []  // data is written here later\n            }]\n        },\n        options: {\n            scales: {\n                xAxes: [{\n                    type: 'linear',\n                    position: 'bottom'\n                    }\n                ],\n                yAxes: [{\n                    id: \"1\",\n                    ticks: {\n                        min: -10,\n                        max: 10,\n                        stepSize: 0.2\n                    }\n                }, {\n                    id: \"2\",\n                    ticks: {\n                        min: -10,\n                        max: 10,\n                        stepSize: 2\n                    }\n                }]\n            },\n            animation: {\n                duration: 0\n            }\n        }\n    }\n        \n/***** You shouldn't normally need to change anything below here *****/    \n    var myChart = null;\n    var loaded = false;     // indicates whether we have already had a load action\n    var chartTimeSpan;\n    var chartMaxPoints;\n\n    function doChart(msg, scope) {\n        if (!myChart) {\n            // chart does not exist so load the data and create it\n            var ctx = document.getElementById(chartID);\n            myChart = new Chart(ctx, chartDef);     \n        }\n        // chart already exists, update it\n        var datasets = myChart.data.datasets;\n        // is this a load or preload action?\n        if (msg.action === \"load\" || msg.action === \"preload\") {\n            // yes, do not allow preload if we have already had a load\n            // so do it if this is a load or we have not previously had a load\n            if (msg.action === \"load\" || !loaded) {\n                // pick up chartTimeSpan and chartMaxPoints if they have been provided\n                if (typeof msg.chartTimeSpan != 'undefined') {\n                    chartTimeSpan = msg.chartTimeSpan;\n                }\n                if (typeof msg.chartMaxPoints != 'undefined') {\n                    chartMaxPoints = msg.chartMaxPoints;\n                }\n                    \n                // replace existing data for matching topics\n                for (var j = 0; j < msg.payload.length; j++) {\n                    var topic = msg.payload[j].topic;\n                    // find it in the chart\n                    for (var i = 0; i < datasets.length; i++) {\n                        if (datasets[i].topic == topic) {\n                            // if stripping old samples by time is required then ensure the x value is Date\n                            if (chartTimeSpan > 0 ) {\n                                var data = msg.payload[j].data;\n                                for (var k = 0; k < data.length; k++) {\n                                    if (typeof data[k].x === \"string\") {\n                                        data[k].x = new Date(data[k].x);\n                                    }\n                                }\n                            }\n                            if (chartDef.type !== \"bar\") {\n                                datasets[i].data = msg.payload[j].data;\n                            } else {\n                                // bar chart so x values must go to labels and y values to dataset\n                                datasets[i].data = [];\n                                myChart.data.labels = [];\n                                var data = msg.payload[j].data;\n                                for (var k = 0; k < data.length; k++) {\n                                    datasets[i].data.push(data[k].y);\n                                    myChart.data.labels.push(data[k].x);\n                                }\n                            }\n                            break;\n                        }\n                    }\n                }\n            }\n            if (msg.action === \"load\") loaded = true;\n            myChart.update();\n        } else {\n            // does the topic match one of the datasets?\n            for (var i = 0; i < datasets.length; i++) {\n                if (datasets[i].topic == msg.topic) {\n                    // if stripping old samples by time is required then ensure the x value is Date\n                    if (chartTimeSpan > 0 && typeof msg.payload.x === \"string\") {\n                        msg.payload.x = new Date(msg.payload.x);\n                    }\n                    if (chartDef.type !== \"bar\") {\n                        datasets[i].data.push(msg.payload);\n                    } else {\n                         // bar chart so x value must go to labels and y value to dataset\n                        datasets[i].data.push(msg.payload.y);\n                        myChart.data.labels.push(msg.payload.x);\n                    }\n                    myChart.update();\n                    break;\n                }\n            }\n        }\n        // strip off samples older than now\n        // charTimeSpan == 0 implies don't do it\n        var shifted = true;\n        if (chartTimeSpan > 0) {\n            var now = new Date();\n            var oldestTimeAllowed = now - chartTimeSpan;\n            for (var i = 0; i < datasets.length; i++) {\n                dataset = datasets[i];\n                while(dataset.data[0] && getTime(dataset.data[0].x) < oldestTimeAllowed) {\n                    dataset.data.shift();\n                    shifted = true;\n                }\n            }\n        }\n        // strip samples off the front if there are now too many\n        // charTimeSpan == 0 implies don't do it\n        if (chartMaxPoints > 0) {\n            for (var i = 0; i < datasets.length; i++) {\n                dataset = datasets[i];\n                while(dataset.data.length > chartMaxPoints) {\n                    dataset.data.shift();\n                    shifted = true;\n                }\n            }\n        }\n        if (shifted) {\n            myChart.update();\n        }\n    };\n\n    // gets the time of an x value, works for strings or Date types\n    function getTime(x) {\n        if (typeof x === \"string\") x = new Date(x);\n        return x.getTime();\n    }\n    \n    // builds the preload message for sending back to the chart helper\n    function preloadMsg() {\n        var preMsg = {action: \"preload\", payload: \"preload\"};\n        // build array of topics in chart\n        var topics = [];\n        for (var i=0; i<chartDef.data.datasets.length; i++) {\n            topics.push(chartDef.data.datasets[i].topic);\n        }\n        preMsg.topics = topics;\n        // has the chart already been created\n        if (myChart) {\n            preMsg.lastXValue = 1;\n        } else {\n            preMsg.lastXValue = 0;\n        }\n        return preMsg;\n    }\n\n    (function(scope) {\n        // this code gets run when the a view is opened on the node in the browser\n        // send a preload message back to node red to ask it send\n        // us a complete set of data. Pass down max points and time span to the helper node for it to use\n        // plus an array of the topics of interest\n        scope.send( preloadMsg() );\n        \n        scope.$watch('msg', function(msg) {\n            if (msg) {\n                doChart(msg, scope);\n            }\n        });\n    })(scope);\n})();\n</script>\n","storeOutMessages":false,"fwdInMessages":false,"x":1210,"y":280,"wires":[[]]},{"id":"48735b7.ea3eea4","type":"debug","z":"cd751f4f.c3b7b","name":"View data object","active":true,"console":"false","complete":"true","x":814.0000305175781,"y":403.1333312988281,"wires":[]},{"id":"b5510e60.72714","type":"inject","z":"cd751f4f.c3b7b","name":"Load Data Set","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":353.99998474121094,"y":288.3833312988281,"wires":[["d52804ca.27a7a8"]]},{"id":"d52804ca.27a7a8","type":"function","z":"cd751f4f.c3b7b","name":"Pre-load test data","func":"\n/* This function creates a two data sets, with different topics,\n   the same x values and different y values*/\n\n// Change the scale factor each time.\nvar scale = context.get('scale') || 0;\nif (msg.topic == \"Reset\") {\n    scale = 0;\n}\nscale++;\ncontext.set('scale', scale);\n\nmsg.payload = [];       // This will be an array of {topic, data} objects\nvar dataPoints1 = [];   // These will be the first array of data points \nvar dataPoints2 = [];   // These will be the second array of data points \nvar numPoints = 20;     // We will create one more than this.\n\n// For the first data set create a sine wave\nfor (var i=0; i<=numPoints; i++) {\n    var point = {};\n    point.x = i;\n    point.y = Math.sin(2 * 3.14 * (i/numPoints)) * scale/10;\n    // build the data array    \n    dataPoints1.push(point);\n}\n\n// For the second data set create a triangle\nfor (var i=0; i<=numPoints; i++) {\n    var point = {};\n    point.x = i;\n    if (i<(numPoints/2)) {\n        // ramp up\n        point.y = i * scale/10;\n    }\n    else {\n        // ramp down\n        point.y = (numPoints - i) * scale/10;\n    }\n    dataPoints2.push(point);    // add to the array\n}\n\nmsg.action = \"load\";    // This instructs the chart node to paint the data\n\n// The payload is an array of two {topic, data} objects\nmsg.payload = [{topic: \"Sin\", data: dataPoints1},\n                {topic: \"Triangle\", data: dataPoints2}];\n\nmsg.chartMaxPoints = 10 ;\nreturn msg;","outputs":1,"noerr":0,"x":595,"y":344.5333251953125,"wires":[["8a417348.55437","48735b7.ea3eea4"]]},{"id":"5ff14cc.065dbb4","type":"ui_button","z":"cd751f4f.c3b7b","name":"New Data Button","group":"ba00a4f5.035c08","order":0,"width":0,"height":0,"label":"New Data","color":"","icon":"","payload":"","payloadType":"str","topic":"","x":341.99998474121094,"y":346.18333435058594,"wires":[["d52804ca.27a7a8"]]},{"id":"773a4950.6327f8","type":"ui_button","z":"cd751f4f.c3b7b","name":"Reset","group":"ba00a4f5.035c08","order":0,"width":0,"height":0,"label":"Reset","color":"","icon":"","payload":"","payloadType":"str","topic":"Reset","x":378,"y":401.1833190917969,"wires":[["d52804ca.27a7a8"]]},{"id":"c654cd5a.5374e","type":"inject","z":"cd751f4f.c3b7b","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":320,"y":480,"wires":[["bb9ef180.8feba"]]},{"id":"bb9ef180.8feba","type":"function","z":"cd751f4f.c3b7b","name":"","func":"\n/* This function creates a two data sets, with different topics,\n   the same x values and different y values*/\n\n// Change the scale factor each time.\nvar scale = context.get('scale') || 0;\nif (msg.topic == \"Reset\") {\n    scale = 0;\n}\nscale++;\ncontext.set('scale', scale);\n\nmsg.payload = [];       // This will be an array of {topic, data} objects\nvar dataPoints1 = [];   // These will be the first array of data points \nvar dataPoints2 = [];   // These will be the second array of data points \nvar numPoints = 2;     // We will create one more than this.\n\n// For the first data set create a sine wave\nfor (var i=0; i<=numPoints; i++) {\n    var point = {};\n    point.x = i;\n    point.y = Math.sin(2 * 3.14 * (i/numPoints)) * scale/10;\n    // build the data array    \n    dataPoints1.push(point);\n}\n\nmsg.action = \"load\";    // This instructs the chart node to paint the data\n\n// The payload is an array of two {topic, data} objects\nmsg.payload = [{topic: \"Sin\", data: dataPoints1}];\n\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":480,"wires":[["8a417348.55437"]]},{"id":"37f3ff30.74a5a","type":"inject","z":"a52b5017.4b5dd","name":"","topic":"Pierre-Louis","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":200,"wires":[["b9343d5d.f3123","758207cf.404118"]]},{"id":"758207cf.404118","type":"function","z":"a52b5017.4b5dd","name":"test 1","func":"var output = {} ;\noutput.payload = msg.payload ;\noutput.topic = msg.topic ;\noutput.toto = \"Coucou\" ;\noutput.tata = {} ;\noutput.tata.n1 = 10 ;\noutput.tata.n2 = [10,\"ZZZ\",30] ;\nreturn output;","outputs":1,"noerr":0,"x":410,"y":200,"wires":[["a2c09e77.5bb39"]]},{"id":"b9343d5d.f3123","type":"debug","z":"a52b5017.4b5dd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":430,"y":240,"wires":[]},{"id":"a2c09e77.5bb39","type":"debug","z":"a52b5017.4b5dd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":530,"y":200,"wires":[]},{"id":"4db718e.e7c9ce8","type":"function","z":"a52b5017.4b5dd","name":"Wait for all tasks to finish","func":"context.data = context.data || new Object();\n\nswitch (msg.topic) {\n    case \"task1\":\n        context.data.task1 = msg.payload;\n        msg = null;\n        break;\n    case \"task2\":\n        context.data.task2 = msg.payload;\n        msg = null;\n        break;\n    case \"task3\":\n        context.data.task3 = msg.payload;\n        msg = null;\n        break;\n        \n    default:\n        msg = null;\n    \tbreak;\n\n}\n\nif(context.data.task1 != null && context.data.task2 != null && context.data.task3 != null) {\n\tmsg2 = new Object();\n    msg2 = context.data;\n    context.data=null;\n\treturn msg2;\n} else return msg;","outputs":1,"noerr":0,"x":610,"y":340,"wires":[["83b32ece.7497f"]]},{"id":"83b32ece.7497f","type":"debug","z":"a52b5017.4b5dd","name":"","active":false,"console":"false","complete":"true","x":790,"y":340,"wires":[]},{"id":"61f3b03.e83065","type":"function","z":"a52b5017.4b5dd","name":"Task1","func":"msg.topic=\"task1\";\nmsg.payload=\"task1 payload's\"\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":300,"wires":[["d4d9fb11.9aa8c8"]]},{"id":"8ea77416.879e98","type":"function","z":"a52b5017.4b5dd","name":"Task2","func":"msg.topic=\"task2\";\nmsg.payload=\"Task2's payload\"\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":340,"wires":[["ff64a8ee.c84ac8"]]},{"id":"7aa57be4.c03b94","type":"function","z":"a52b5017.4b5dd","name":"Task3","func":"msg.topic=\"task3\";\nmsg.payload=\"Task3's payload\"\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":380,"wires":[["8f76b0.f76a895"]]},{"id":"cb9ef27f.6d703","type":"inject","z":"a52b5017.4b5dd","name":"Start","topic":"","payload":"","payloadType":"none","repeat":"","crontab":"","once":false,"x":130,"y":340,"wires":[["61f3b03.e83065","8ea77416.879e98","7aa57be4.c03b94"]]},{"id":"d4d9fb11.9aa8c8","type":"delay","z":"a52b5017.4b5dd","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":400,"y":300,"wires":[["4db718e.e7c9ce8"]]},{"id":"ff64a8ee.c84ac8","type":"delay","z":"a52b5017.4b5dd","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":400,"y":340,"wires":[["4db718e.e7c9ce8"]]},{"id":"8f76b0.f76a895","type":"delay","z":"a52b5017.4b5dd","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":400,"y":380,"wires":[["4db718e.e7c9ce8"]]},{"id":"b5d06208.d25db","type":"http in","z":"a52b5017.4b5dd","name":"","url":"/mysite2","method":"get","swaggerDoc":"","x":130,"y":800,"wires":[["e5485a50.e31048"]]},{"id":"78fc7280.e56dfc","type":"http in","z":"a52b5017.4b5dd","name":"","url":"/mysitepost","method":"post","swaggerDoc":"","x":120,"y":840,"wires":[["3fd53c0b.e23354"]]},{"id":"e5485a50.e31048","type":"function","z":"a52b5017.4b5dd","name":"msg.url = \"mysitepost\";","func":"msg.url = \"mysitepost\";\nmsg.name = \"Test node red control\";\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":800,"wires":[["7edef74d.242858"]]},{"id":"53506745.553d98","type":"template","z":"a52b5017.4b5dd","name":"CSS","field":"payload.style","fieldType":"msg","format":"css","syntax":"mustache","template":"input[type=text], select {\n    width: 100%;\n    padding: 12px 20px;\n    margin: 8px 0;\n    display: inline-block;\n    border: 1px solid #ccc;\n    border-radius: 4px;\n    box-sizing: border-box;\n}\n\ninput[type=submit] {\n    width: 100%;\n    background-color: #4CAF50;\n    color: white;\n    padding: 14px 20px;\n    margin: 8px 0;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n}\n\ninput[type=submit]:hover {\n    background-color: #45a049;\n}\n\ndiv {\n    border-radius: 5px;\n    background-color: #f2f2f2;\n    padding: 20px;\n}","x":650,"y":800,"wires":[["ef9e4b10.1f4078"]]},{"id":"ad0b01c9.8539f","type":"http response","z":"a52b5017.4b5dd","name":"","x":1010,"y":800,"wires":[]},{"id":"f3a27e1b.ff2ca","type":"template","z":"a52b5017.4b5dd","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<html>\n    <head>\n        <title>My Site</title>\n        <meta name=\"viewport\" content=\"initial-scale=1.0, user-scalable=no\">\n        <meta charset=\"utf-8\">\n        <script src=\"http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js\"></script>\n        <style>{{{payload.style}}}</style>\n    </head>\n    <body>\n        <h1>{{name}}</h1>\n        <div>\n            <form method=\"post\" action=\"/{{url}}\" ajax=\"true\">\n                <label for=\"lname\">Testing</label>\n                <input type=\"text\" value=\"RRRRR\" id=\"test\" name=\"testing\">\n                <input type=\"submit\" value=\"Submit\">\n            </form>\n        </div>\n        <div>\n            <span id=\"result\"></span>\n        </div>\n    </body>\n</html>\n<script>{{{payload.script}}}</script>","x":890,"y":800,"wires":[["ad0b01c9.8539f"]]},{"id":"466ff432.46d91c","type":"comment","z":"a52b5017.4b5dd","name":"Login Form","info":"","x":990,"y":760,"wires":[]},{"id":"763cc6eb.0b9f18","type":"comment","z":"a52b5017.4b5dd","name":"Form Submission","info":"","x":140,"y":760,"wires":[]},{"id":"402738b.89c82c8","type":"comment","z":"a52b5017.4b5dd","name":"To JSON","info":"This Flow demonstrates how to create\na simple frontend webpage with Node-RED.\n\nThe public facing page consists of the \nclient side JavaScript, CSS and HTML. \n\nThe important technique is how the mustache \ntemplates are used. Each template will set the\n\"property\" relative to the content. \n\nThe CSS node sets the \"msg.payload.style\" property.\nThe JavaScript node sets the \"msg.payload.script\" property.\nThe HTML node then includes these properties \n<script>{{{payload.script}}}</script>\n<style>{{{payload.style}}}</style>\n\n\nThis example was created by http://www.InternetofLEGO.com\n\n","x":720,"y":100,"wires":[]},{"id":"ee6d9538.b7c4e8","type":"inject","z":"a52b5017.4b5dd","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":150,"y":140,"wires":[["a070f294.9e516"]]},{"id":"a070f294.9e516","type":"function","z":"a52b5017.4b5dd","name":"","func":"\nvar x ={ip : 92};\nmsg.payload = x;\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":140,"wires":[["5088443d.d9811c"]]},{"id":"5088443d.d9811c","type":"json","z":"a52b5017.4b5dd","name":"","property":"payload","action":"","pretty":false,"x":410,"y":140,"wires":[["37115390.9c293c"]]},{"id":"37115390.9c293c","type":"debug","z":"a52b5017.4b5dd","name":"","active":true,"console":"false","complete":"false","x":550,"y":140,"wires":[]},{"id":"ef9e4b10.1f4078","type":"template","z":"a52b5017.4b5dd","name":"essai","field":"payload.essai","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{{ip}}","x":770,"y":800,"wires":[["f3a27e1b.ff2ca"]]},{"id":"7edef74d.242858","type":"template","z":"a52b5017.4b5dd","name":"JavaScript","field":"payload.script","fieldType":"msg","format":"javascript","syntax":"plain","template":"$(document).ready(function(e) {\n    \n    $(\"form[ajax=true]\").submit(function(e) {\n        \n        e.preventDefault();\n        \n        var form_data = $(this).serialize();\n        var form_url = $(this).attr(\"action\");\n        var form_method = $(this).attr(\"method\").toUpperCase();\n        \n        $(\"#loadingimg\").show();\n        \n        $.ajax({\n            url: form_url, \n            type: form_method,      \n            data: form_data,     \n            cache: false,\n            success: function(returnhtml){                          \n                $(\"#result\").html(returnhtml); \n                $(\"#loadingimg\").show();                    \n            }           \n        });    \n        \n    });\n    \n});","x":510,"y":800,"wires":[["53506745.553d98"]]},{"id":"10b3d38e.33e08c","type":"inject","z":"a52b5017.4b5dd","name":"Tick every 5 secs","topic":"test","payload":"","payloadType":"date","repeat":"5","crontab":"","once":false,"onceDelay":"","x":170,"y":580,"wires":[["5cd11a8.38a20e4"]]},{"id":"323fb93d.ff49c6","type":"websocket out","z":"a52b5017.4b5dd","name":"","server":"bc14f821.ddffa8","client":"","x":560,"y":580,"wires":[]},{"id":"6fdebc9b.35b004","type":"http response","z":"a52b5017.4b5dd","name":"","x":530,"y":540,"wires":[]},{"id":"7ffe6c44.be8fa4","type":"http in","z":"a52b5017.4b5dd","name":"","url":"/simple","method":"get","swaggerDoc":"","x":190,"y":540,"wires":[["a9ac2173.70472"]]},{"id":"a9ac2173.70472","type":"template","z":"a52b5017.4b5dd","name":"Simple Web Page","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE HTML>\n<html>\n    <head>\n    <title>Simple Live Display</title>\n    <script type=\"text/javascript\">\n        var ws;\n        var wsUri = \"ws:\";\n        var loc = window.location;\n        console.log(loc);\n        if (loc.protocol === \"https:\") { wsUri = \"wss:\"; }\n        // This needs to point to the web socket in the Node-RED flow\n        // ... in this case it's ws/simple\n        wsUri += \"//\" + loc.host + loc.pathname.replace(\"simple\",\"ws/simple\");\n\n        function wsConnect() {\n            console.log(\"connect\",wsUri);\n            ws = new WebSocket(wsUri);\n            //var line = \"\";    // either uncomment this for a building list of messages\n            ws.onmessage = function(msg) {\n                var line = \"\";  // or uncomment this to overwrite the existing message\n                // parse the incoming message as a JSON object\n                var data = msg.data;\n                //console.log(data);\n                // build the output from the topic and payload parts of the object\n                line += \"<p>\"+data+\"</p>\";\n                // replace the messages div with the new \"line\"\n                document.getElementById('messages').innerHTML = line;\n                //ws.send(JSON.stringify({data:data}));\n            }\n            ws.onopen = function() {\n                // update the status div with the connection status\n                document.getElementById('status').innerHTML = \"connected\";\n                //ws.send(\"Open for data\");\n                console.log(\"connected\");\n            }\n            ws.onclose = function() {\n                // update the status div with the connection status\n                document.getElementById('status').innerHTML = \"not connected\";\n                // in case of lost connection tries to reconnect every 3 secs\n                setTimeout(wsConnect,3000);\n            }\n        }\n        \n        function doit(m) {\n            if (ws) { ws.send(m); }\n        }\n    </script>\n    </head>\n    <body onload=\"wsConnect();\" onunload=\"ws.disconnect();\">\n        <font face=\"Arial\">\n        <h1>Simple Live Display</h1>\n        <div id=\"messages\"></div>\n        <button type=\"button\" onclick='doit(\"click\");'>Click to send message</button>\n        <hr/>\n        <div id=\"status\">unknown</div>\n        </font>\n    </body>\n</html>\n","x":369,"y":540,"wires":[["6fdebc9b.35b004"]]},{"id":"5cd11a8.38a20e4","type":"function","z":"a52b5017.4b5dd","name":"format time nicely","func":"msg.payload = Date(msg.payload).toString();\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":580,"wires":[["323fb93d.ff49c6"]]},{"id":"60ac339a.39febc","type":"websocket in","z":"a52b5017.4b5dd","name":"","server":"bc14f821.ddffa8","client":"","x":180,"y":620,"wires":[["a085118c.277d2"]]},{"id":"a085118c.277d2","type":"debug","z":"a52b5017.4b5dd","name":"","active":true,"console":"false","complete":"false","x":350,"y":620,"wires":[]},{"id":"ef8f5f1f.1f95c","type":"http response","z":"a52b5017.4b5dd","name":"","statusCode":"","headers":{"location":"www.google.fr"},"x":530,"y":440,"wires":[]},{"id":"ae0b2281.cd2fc","type":"http in","z":"a52b5017.4b5dd","name":"","url":"/williams","method":"get","upload":false,"swaggerDoc":"","x":121,"y":440,"wires":[["3c58ea3c.0a3f46","83bcbf5a.6f8b3"]]},{"id":"3c58ea3c.0a3f46","type":"debug","z":"a52b5017.4b5dd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":270,"y":480,"wires":[]},{"id":"ef3c089b.ef3578","type":"delay","z":"a52b5017.4b5dd","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":400,"y":440,"wires":[["ef8f5f1f.1f95c"]]},{"id":"83bcbf5a.6f8b3","type":"function","z":"a52b5017.4b5dd","name":"","func":"var output = {} ;\noutput.payload = \"payload\" ;\noutput.test1 = \"test1\" ;\n\nreturn output;","outputs":1,"noerr":0,"x":270,"y":440,"wires":[["ef3c089b.ef3578"]]},{"id":"81f3f29d.3e7b2","type":"http response","z":"a52b5017.4b5dd","name":"","statusCode":"","headers":{},"x":710,"y":880,"wires":[]},{"id":"3fd53c0b.e23354","type":"function","z":"a52b5017.4b5dd","name":"return msg.payload to client","func":"//if(isAutorized()){//msg.req.client._peername.address)){\n    //request.connection.remoteAddress\n    var data = msg.payload ;\n    if(data.testing == 'CoolLed-PE-4000'){\n        msg.payload = 'CoolLed-PE-4000';\n        msg.topic = 'Fluorescence1';\n        msg.device = 'CoolLed-PE-4000';\n        msg.type = 'ligth-source';\n        msg.action = 'setChannel';\n    }\n    else{\n        if(data.testing == 'EVOLV-512'){\n        }\n        else msg.payload = 'Unknow device' ;\n    }\n//} \n//else {\n//    msg.payload = 'Denied' ;\n//} \nnode.send(msg);\n    \nfunction isAutorized(ip){\n    var ipAutorized = ['127.0.0.1','172.27.0.58'] ;\n    var detect = false ;\n    for(var i=0;i<ipAutorized.length;i++) \n        if(ip===ipAutorized[i]){\n            detect = true ;\n            break;\n        }\n    if(detect) return true ;\n    else return false ;\n\n    return true;\n}\n","outputs":1,"noerr":0,"x":340,"y":840,"wires":[["baae2fa9.bd0a5","e68711d1.e7f04"]]},{"id":"baae2fa9.bd0a5","type":"CoolLedPe4000","z":"a52b5017.4b5dd","name":"PE-4000","topic":"drive the PE-4000","x":560,"y":880,"wires":[[]]},{"id":"e68711d1.e7f04","type":"function","z":"a52b5017.4b5dd","name":"unknow","func":"if(msg.payload === 'Unknow device'){\n  msg.payload+='<br><a href=http://127.0.0.1:1880/mysite2>back</a>';\n  return msg;  \n} ","outputs":1,"noerr":0,"x":560,"y":840,"wires":[["81f3f29d.3e7b2"]]},{"id":"44bba86.ae39658","type":"ui_dropdown","z":"b195bb21.61fb38","name":"","label":"Type","group":"d790a61c.487ea8","order":1,"width":0,"height":0,"passthru":true,"options":[{"label":"Constant","value":"Constant","type":"str"},{"label":"Profil","value":"Profil","type":"str"}],"payload":"","topic":"t","x":310,"y":200,"wires":[["29aa57f1.c802c8","4fa0f2d2.cf493c"]]},{"id":"a7e5c4f7.8ca4a8","type":"ui_dropdown","z":"b195bb21.61fb38","name":"","label":"Fonction","group":"d790a61c.487ea8","order":2,"width":0,"height":0,"passthru":true,"options":[{"label":"Linéaire","value":"Linéaire","type":"str"},{"label":"Logarithime","value":"Logarithime","type":"str"}],"payload":"","topic":"f","x":660,"y":80,"wires":[["44959849.d86858"]]},{"id":"709973a6.fe1edc","type":"ui_numeric","z":"b195bb21.61fb38","name":"","label":"Nombre de points","group":"d790a61c.487ea8","order":3,"width":0,"height":0,"passthru":true,"topic":"np","format":"{{value}}","min":0,"max":"1000000","x":690,"y":120,"wires":[["9e5402c6.1624f"]]},{"id":"7e695752.acade8","type":"ui_numeric","z":"b195bb21.61fb38","name":"","label":"Temps par points","group":"d790a61c.487ea8","order":4,"width":0,"height":0,"passthru":true,"topic":"tp","format":"{{value}}","min":0,"max":"1000000","x":690,"y":160,"wires":[["ebbe359b.f83b48"]]},{"id":"e6c7a02.2a46a6","type":"ui_text_input","z":"b195bb21.61fb38","name":"","label":"Nom de la sauvearde","group":"d790a61c.487ea8","order":8,"width":"6","height":"2","passthru":true,"mode":"text","delay":300,"topic":"s","x":700,"y":360,"wires":[["6b3c52b5.d2178c"]]},{"id":"20b21ca2.4d61c4","type":"ui_text","z":"b195bb21.61fb38","group":"b99bc98f.8d5338","order":1,"width":0,"height":0,"name":"","label":"Mesure arduino","format":"{{msg.payload}} rad/s (exemple)","layout":"row-spread","x":900,"y":700,"wires":[]},{"id":"dffc13e2.64c83","type":"ui_text","z":"b195bb21.61fb38","group":"b99bc98f.8d5338","order":3,"width":0,"height":0,"name":"","label":"Vitesse de consigne","format":"{{msg.payload}} rad/s (exemple)","layout":"row-spread","x":700,"y":620,"wires":[]},{"id":"3e1ead83.639bf2","type":"ui_numeric","z":"b195bb21.61fb38","name":"","label":"Vitesse initiale","group":"d790a61c.487ea8","order":5,"width":0,"height":0,"passthru":true,"topic":"vi","format":"{{value}}","min":0,"max":"1000","x":680,"y":200,"wires":[["8e986ff7.562c5"]]},{"id":"c5c43dc.70be3c","type":"ui_numeric","z":"b195bb21.61fb38","name":"","label":"Vitesse finale","group":"d790a61c.487ea8","order":6,"width":0,"height":0,"passthru":true,"topic":"vf","format":"{{value}}","min":0,"max":"1000","x":670,"y":240,"wires":[["148c0ce4.403c63"]]},{"id":"ce36f1f9.19d61","type":"ui_numeric","z":"b195bb21.61fb38","name":"","label":"Vitesse de consigne","group":"d790a61c.487ea8","order":7,"width":0,"height":0,"passthru":true,"topic":"vc","format":"{{value}}","min":0,"max":"1000","x":700,"y":300,"wires":[["252eef7f.5053d"]]},{"id":"26b8f81.004db08","type":"ui_chart","z":"b195bb21.61fb38","name":"","group":"33fcd40d.811aac","order":0,"width":"20","height":"12","label":"","chartType":"line","legend":"true","xformat":"%H:%M:%S","interpolate":"step-after","nodata":"","ymin":"","ymax":"","removeOlder":"2","removeOlderUnit":"60","x":650,"y":660,"wires":[[],[]]},{"id":"d3b9663f.f54368","type":"ui_text","z":"b195bb21.61fb38","group":"52d4306f.12102","order":0,"width":0,"height":0,"name":"","label":"Auteur: ","format":"Williams Brett | MSC | Mars 2019","layout":"row-center","x":140,"y":80,"wires":[]},{"id":"29aa57f1.c802c8","type":"function","z":"b195bb21.61fb38","name":"en.","func":"var msg2 = {};\nif(msg.payload=='Constant'){ msg.enabled = false ; msg2.enabled = true ; }\nelse{ msg.enabled = true ; msg2.enabled = false ; }\nreturn [msg,msg2];","outputs":2,"noerr":0,"x":430,"y":200,"wires":[["a7e5c4f7.8ca4a8","3e1ead83.639bf2","c5c43dc.70be3c","709973a6.fe1edc","7e695752.acade8"],["ce36f1f9.19d61"]]},{"id":"21df5.22a0520be","type":"inject","z":"b195bb21.61fb38","name":"","topic":"","payload":"Constant","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":160,"y":440,"wires":[["44bba86.ae39658","48696424.f1723c"]]},{"id":"54292efb.aeb72","type":"function","z":"b195bb21.61fb38","name":"","func":"if(context.global.run === true){\n    var msg2 = {};\n    msg.payload = context.global.vitesse;\n    msg2.payload = 'top';\n//    msg3.payload = context.global.run ;\n    msg.topic = 'Vitesse de consigne';\n    msg2.topic = 'Vitesse mesurée';\n//    msg3.topic = 'Run';\n    return [msg,msg2];\n}","outputs":2,"noerr":0,"x":430,"y":640,"wires":[["26b8f81.004db08","dffc13e2.64c83"],[]]},{"id":"3b12fa5d.326d16","type":"random","z":"b195bb21.61fb38","name":"","low":"1","high":"20","inte":"true","x":660,"y":700,"wires":[["20b21ca2.4d61c4"]]},{"id":"10275cd5.60e3e3","type":"inject","z":"b195bb21.61fb38","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":640,"wires":[["54292efb.aeb72"]]},{"id":"220d0aa2.2b6246","type":"ui_button","z":"b195bb21.61fb38","name":"","group":"8ba9b4f1.0a9cb8","order":0,"width":0,"height":0,"label":"START/UPDATE","color":"","icon":"","payload":"START","payloadType":"str","topic":"","x":770,"y":440,"wires":[["857a8f50.dd632","5a1cce28.c28d1"]]},{"id":"857a8f50.dd632","type":"function","z":"b195bb21.61fb38","name":"en!","func":"var msg2 = {};\nif(msg.payload=='STOP'){ \n    context.global.vitesse = 0 ;\n    clearInterval(context.global.repeat);\n    if(context.global.t === 'Constant'){msg.enabled = true ; msg2.enabled = true ; }\n    else {msg.enabled = false ; msg2.enabled = true ; }\n    context.global.run = false ;\n    node.warn(context.global.run);\n}\nelse{ \n    context.global.run = true ; \n    if(context.global.t === 'Constant'){msg.enabled = true ; msg2.enabled = true ; }\n    else {msg.enabled = true ; msg2.enabled = false ; }\n}\nreturn [msg,msg2];","outputs":2,"noerr":0,"x":950,"y":460,"wires":[["fa305e56.5bcb1"],["d28c7bcb.2b6ca8"]]},{"id":"54604423.30624c","type":"function","z":"b195bb21.61fb38","name":"en.","func":"var msg2 = {};\nif(msg.payload=='START'){ msg.enabled = false ; msg2.enabled = true ; }\nelse{ msg.enabled = true ; msg2.enabled = true ; }\nreturn [msg,msg2];","outputs":2,"noerr":0,"x":550,"y":460,"wires":[["220d0aa2.2b6246"],["2667aefa.53e692"]]},{"id":"fa305e56.5bcb1","type":"link out","z":"b195bb21.61fb38","name":"stop","links":["cdc2c2c7.575c8"],"x":1035,"y":440,"wires":[]},{"id":"cdc2c2c7.575c8","type":"link in","z":"b195bb21.61fb38","name":"","links":["fa305e56.5bcb1"],"x":635,"y":500,"wires":[["2667aefa.53e692"]]},{"id":"d28c7bcb.2b6ca8","type":"link out","z":"b195bb21.61fb38","name":"Start","links":["b297ad5b.ff9fd"],"x":1035,"y":480,"wires":[]},{"id":"b297ad5b.ff9fd","type":"link in","z":"b195bb21.61fb38","name":"","links":["d28c7bcb.2b6ca8"],"x":635,"y":420,"wires":[["220d0aa2.2b6246"]]},{"id":"44959849.d86858","type":"link out","z":"b195bb21.61fb38","name":"","links":["b81bd89c.7b1158","bf2d08.4e2bc2f8"],"x":855,"y":80,"wires":[]},{"id":"9e5402c6.1624f","type":"link out","z":"b195bb21.61fb38","name":"","links":["b81bd89c.7b1158","bf2d08.4e2bc2f8"],"x":855,"y":120,"wires":[]},{"id":"ebbe359b.f83b48","type":"link out","z":"b195bb21.61fb38","name":"","links":["b81bd89c.7b1158","bf2d08.4e2bc2f8"],"x":855,"y":160,"wires":[]},{"id":"8e986ff7.562c5","type":"link out","z":"b195bb21.61fb38","name":"","links":["b81bd89c.7b1158","bf2d08.4e2bc2f8"],"x":855,"y":200,"wires":[]},{"id":"148c0ce4.403c63","type":"link out","z":"b195bb21.61fb38","name":"","links":["b81bd89c.7b1158","bf2d08.4e2bc2f8"],"x":855,"y":240,"wires":[]},{"id":"252eef7f.5053d","type":"link out","z":"b195bb21.61fb38","name":"","links":["b81bd89c.7b1158","bf2d08.4e2bc2f8"],"x":855,"y":300,"wires":[]},{"id":"6b3c52b5.d2178c","type":"link out","z":"b195bb21.61fb38","name":"","links":["b81bd89c.7b1158","bf2d08.4e2bc2f8"],"x":855,"y":360,"wires":[]},{"id":"5a1cce28.c28d1","type":"link out","z":"b195bb21.61fb38","name":"run_pg","links":["22b5a628.078eca","7fe62218.df04dc"],"x":915,"y":420,"wires":[]},{"id":"4fa0f2d2.cf493c","type":"link out","z":"b195bb21.61fb38","name":"","links":["b81bd89c.7b1158","bf2d08.4e2bc2f8"],"x":395,"y":160,"wires":[]},{"id":"48696424.f1723c","type":"function","z":"b195bb21.61fb38","name":"ini.","func":"var msg1 = {} ;\nvar msg2 = {} ;\nvar msg3 = {} ;\n\nmsg.payload = 'Linéaire' ;\nmsg1.payload = 10 ;\nmsg2.payload = 'test n°4 ....' ;\nmsg3.payload = 'STOP' ;\n\ncontext.global.run = false ;\n\nreturn [msg,msg1,msg2,msg3];","outputs":4,"noerr":0,"x":430,"y":440,"wires":[["a7e5c4f7.8ca4a8"],["709973a6.fe1edc","7e695752.acade8","3e1ead83.639bf2","c5c43dc.70be3c","ce36f1f9.19d61"],["e6c7a02.2a46a6"],["54604423.30624c"]]},{"id":"2667aefa.53e692","type":"ui_button","z":"b195bb21.61fb38","name":"","group":"8ba9b4f1.0a9cb8","order":0,"width":0,"height":0,"label":"STOP","color":"","icon":"","payload":"STOP","payloadType":"str","topic":"STOP","x":770,"y":480,"wires":[["857a8f50.dd632"]]},{"id":"3fa91f57.b3fc6","type":"link in","z":"b195bb21.61fb38","name":"autoStop","links":["f4fae87b.1c5f08","44539e1e.289ca"],"x":855,"y":500,"wires":[["857a8f50.dd632"]]},{"id":"7376437b.f0909c","type":"function","z":"b195bb21.61fb38","name":"vg","func":"if(msg.topic === 'f') context.global.f = msg.payload ;\nif(msg.topic === 't') context.global.t = msg.payload ;\nif(msg.topic === 'np') context.global.np = parseInt(msg.payload) ;\nif(msg.topic === 'tp') context.global.tp = parseFloat(msg.payload) ;\nif(msg.topic === 'vi') context.global.vi = parseFloat(msg.payload) ;\nif(msg.topic === 'vf') context.global.vf = parseFloat(msg.payload) ;\nif(msg.topic === 'vc') context.global.vc = parseFloat(msg.payload) ;\nif(msg.topic === 's') context.global.s = msg.payload ;\n","outputs":1,"noerr":0,"x":190,"y":800,"wires":[[]]},{"id":"bf2d08.4e2bc2f8","type":"link in","z":"b195bb21.61fb38","name":"vg","links":["44959849.d86858","9e5402c6.1624f","ebbe359b.f83b48","8e986ff7.562c5","148c0ce4.403c63","252eef7f.5053d","6b3c52b5.d2178c","7cfcd0b4.4cc","4fa0f2d2.cf493c"],"x":95,"y":800,"wires":[["7376437b.f0909c"]]},{"id":"7fe62218.df04dc","type":"link in","z":"b195bb21.61fb38","name":"","links":["5a1cce28.c28d1"],"x":95,"y":860,"wires":[["b289dc6a.54bb2"]]},{"id":"f86c1f0e.71f32","type":"function","z":"b195bb21.61fb38","name":"pg","func":"\nif(context.global.t === 'Constant'){\n    if(context.global.run) node.warn(context.global.vitesse) ;\n    else {node.send({'payload':'STOP'});}\n}\nif(context.global.t === 'Profil'){\n    if(context.global.run) {\n\n        node.warn(context.global.vitesse) ;\n        if(context.global.f === 'Linéaire'){\n            context.global.repeat = setInterval(function(){\n                context.global.loop = context.global.loop + 1 ;\n                if(context.global.loop - 1 === context.global.np){\n                    clearTimeout(context.global.repeat);\n                    node.send({'payload':'STOP'});\n                }else { \n                    context.global.vitesse = context.global.vitesse + context.global.delta\n                    node.warn('= '+context.global.vitesse) ;\n                }\n            },context.global.tp * 1000);\n        }\n        if(context.global.f === 'Logarithime'){\n            context.global.repeat = setInterval(function(){\n                context.global.loop = context.global.loop + 1 ;\n                if(context.global.loop -1 === context.global.np){\n                    clearTimeout(context.global.repeat);\n                    node.send({'payload':'STOP'});\n                }else { \n                    //context.global.vitesse = context.global.vi + (context.global.vf - context.global.vi) * \n                    context.global.vitesse = Math.round(Math.log10(context.global.loopLog),2); \n                    context.global.loopLog = context.global.loopLog + context.global.delta ;\n                    node.warn(context.global.vitesse) ;\n                }\n            },context.global.tp * 1000);\n        \n        }\n    }//send vc    \n    else{\n        clearTimeout(context.global.repeat); //send vc = 0  \n            node.send({'payload':'STOP'});\n        } \n}\n\n//return msg;","outputs":1,"noerr":0,"x":330,"y":860,"wires":[["44539e1e.289ca"]]},{"id":"b289dc6a.54bb2","type":"function","z":"b195bb21.61fb38","name":"calcul","func":"if(context.global.t === 'Constant'){\n    context.global.vitesse = context.global.vc;\n}\nif(context.global.t === 'Profil'){\n    if(context.global.f === 'Linéaire'){\n        context.global.delta = (context.global. vf - context.global.vi) / context.global.np ;         \n        node.warn(context.global.delta);\n        context.global.loop = 0 ;         \n        context.global.vitesse = context.global.vi ;\n    }\n    if(context.global.f === 'Logarithime'){ //\n        context.global.delta =  Math.abs((context.global. vf - context.global.vi) / (context.global.np)) ; //Math.pow(10, 1/(context.global.np-1)); //10.0 / (context.global.np-1) ;         \n        context.global.loop = 0 ;         \n        context.global.loopLog = 1;\n        context.global.vitesse = context.global.vi ;\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":190,"y":860,"wires":[["f86c1f0e.71f32"]]},{"id":"44539e1e.289ca","type":"link out","z":"b195bb21.61fb38","name":"","links":["3fa91f57.b3fc6"],"x":415,"y":860,"wires":[]},{"id":"cba2dfe5.c3b84","type":"inject","z":"b195bb21.61fb38","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":700,"wires":[["1b25b3df.51d0bc"]]},{"id":"1b25b3df.51d0bc","type":"function","z":"b195bb21.61fb38","name":"","func":"msg.payload = [];\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":700,"wires":[["26b8f81.004db08"]]},{"id":"5d56c41d.948acc","type":"http in","z":"a52b5017.4b5dd","name":"testNode","url":"/testNode","method":"get","upload":false,"swaggerDoc":"","x":100,"y":1100,"wires":[["9556a3b7.bbb7d"]]},{"id":"6c1a99a7.cc7768","type":"http response","z":"a52b5017.4b5dd","name":"testResponse","statusCode":"200","headers":{},"x":980,"y":1100,"wires":[]},{"id":"9556a3b7.bbb7d","type":"function","z":"a52b5017.4b5dd","name":"hasOwnProperty","func":"node.send({payload : \"OSS 117\", res : msg.res, req : msg.req});\n","outputs":1,"noerr":0,"x":270,"y":1100,"wires":[["ef4aba6e.91a948"]]},{"id":"1b9c5289.7ac17d","type":"http in","z":"a52b5017.4b5dd","name":"","url":"/williams2","method":"get","upload":false,"swaggerDoc":"","x":140,"y":40,"wires":[["9c5c5733.3443f8"]]},{"id":"9c5c5733.3443f8","type":"http response","z":"a52b5017.4b5dd","name":"","statusCode":"","headers":{},"x":350,"y":40,"wires":[]},{"id":"7af6d01.d6a783","type":"inject","z":"a52b5017.4b5dd","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":80,"wires":[["9c5c5733.3443f8"]]},{"id":"c6cbf39f.99f56","type":"function","z":"a52b5017.4b5dd","name":"hasOwnProperty","func":"if(msg.hasOwnProperty(\"payload\"))\n    if(msg.hasOwnProperty(\"res\"))\n        if(msg.hasOwnProperty(\"req\"))\n            return msg;","outputs":1,"noerr":0,"x":770,"y":1100,"wires":[["6c1a99a7.cc7768"]]},{"id":"6bfafc71.773184","type":"http in","z":"a52b5017.4b5dd","name":"list-device-connected","url":"/list-device-connected","method":"get","upload":false,"swaggerDoc":"","x":140,"y":1780,"wires":[["e602c30b.8c4a8"]]},{"id":"93672a2.eca2ed8","type":"inject","z":"a52b5017.4b5dd","name":"low","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":1160,"wires":[["7b6b9c15.4feb94"]]},{"id":"7b6b9c15.4feb94","type":"function","z":"a52b5017.4b5dd","name":"","func":"msg.payload = {} ;\nmsg.payload = {'action' : 'low'};\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":1160,"wires":[["ef4aba6e.91a948"]]},{"id":"3e5c9ec7.170b72","type":"inject","z":"a52b5017.4b5dd","name":"high","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":1200,"wires":[["22f7f99c.21da86"]]},{"id":"22f7f99c.21da86","type":"function","z":"a52b5017.4b5dd","name":"","func":"msg.payload = {};\nmsg.payload  = {'action': 'high'};\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":1200,"wires":[["ef4aba6e.91a948"]]},{"id":"bcb934c7.9cad48","type":"inject","z":"a52b5017.4b5dd","name":"blink 3","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":1240,"wires":[["cbb00166.9bcde"]]},{"id":"cbb00166.9bcde","type":"function","z":"a52b5017.4b5dd","name":"","func":"msg.payload = {};\nmsg.payload  = {'action': 'blink'};\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":1240,"wires":[["ef4aba6e.91a948"]]},{"id":"5e543e89.c865d","type":"function","z":"a52b5017.4b5dd","name":"Wait for all devices are connected","func":"var nbDevice = 6 ;\ncontext.data = context.data || new Object();\ncontext.data[msg.payload.device] = msg.payload.connected ? 'connected' : 'disconnected';\nif(Object.keys(context.data).length === nbDevice){\n\tmsg = new Object();\n    msg = context.data\n    context.global.listDeviceConnected = msg ;\n    context.data=null;\n\treturn msg;\n}","outputs":1,"noerr":0,"x":800,"y":1380,"wires":[["91ab38ba.c18ce8"]]},{"id":"91ab38ba.c18ce8","type":"debug","z":"a52b5017.4b5dd","name":"","active":false,"console":"false","complete":"true","x":1030,"y":1380,"wires":[]},{"id":"688c60e.f7af7a","type":"debug","z":"a52b5017.4b5dd","name":"","active":false,"console":"false","complete":"true","x":730,"y":1140,"wires":[]},{"id":"734eb887.e946b8","type":"inject","z":"a52b5017.4b5dd","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":130,"y":1540,"wires":[["df8bdbb6.3094a8"]]},{"id":"df8bdbb6.3094a8","type":"function","z":"a52b5017.4b5dd","name":"Simu","func":"var msg1 = {} ;\nvar msg2 = {} ;\nvar msg3 = {} ;\nvar msg4 = {} ;\n\nmsg.payload = {} ;\nmsg.payload.device = 'CoolLed-pE4000' ;\nmsg.payload.topic = 'Fluo1' ;\nmsg.payload.connected = false ;\n\nmsg1.payload = {} ;\nmsg1.payload.device = 'X-Cite-120PC' ;\nmsg1.payload.topic = 'Fluo2' ;\nmsg1.payload.connected = false ;\n\nmsg2.payload = {} ;\nmsg2.payload.device = 'Evolv512' ;\nmsg2.payload.topic = 'Camera1' ;\nmsg2.payload.connected = false ;\n\nmsg3.payload = {} ;\nmsg3.payload.device = 'Prio-Motion-Stage' ;\nmsg3.payload.topic = 'Motion1' ;\nmsg3.payload.connected = false ;\n\nmsg4.payload = {} ;\nmsg4.payload.device = 'Andor-Mosaic-3' ;\nmsg4.payload.topic = 'Mosaic1' ;\nmsg4.payload.connected = false ;\n\nreturn [msg,msg1,msg2,msg3,msg4];","outputs":5,"noerr":0,"x":290,"y":1540,"wires":[["1c3bfc3f.b1de34"],["b2b0f4f.8f99408"],["b1a67415.f01cc8"],["1de0a74f.bd2249"],["e2dbae9d.577c1"]]},{"id":"1c3bfc3f.b1de34","type":"delay","z":"a52b5017.4b5dd","name":"","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":460,"y":1460,"wires":[["5e543e89.c865d"]]},{"id":"b2b0f4f.8f99408","type":"delay","z":"a52b5017.4b5dd","name":"","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":460,"y":1500,"wires":[["5e543e89.c865d"]]},{"id":"b1a67415.f01cc8","type":"delay","z":"a52b5017.4b5dd","name":"","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":460,"y":1540,"wires":[["5e543e89.c865d"]]},{"id":"1de0a74f.bd2249","type":"delay","z":"a52b5017.4b5dd","name":"","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":460,"y":1580,"wires":[["5e543e89.c865d"]]},{"id":"e2dbae9d.577c1","type":"delay","z":"a52b5017.4b5dd","name":"","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":460,"y":1620,"wires":[["5e543e89.c865d"]]},{"id":"e602c30b.8c4a8","type":"function","z":"a52b5017.4b5dd","name":"","func":"msg.payload = context.global.listDeviceConnected ;\nmsg.res = msg.res ;\nmsg.req = msg.req ;\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":1780,"wires":[["5b53db40.c586c4"]]},{"id":"5b53db40.c586c4","type":"http response","z":"a52b5017.4b5dd","name":"","statusCode":"","headers":{},"x":530,"y":1780,"wires":[]},{"id":"ef4aba6e.91a948","type":"CooLLED-pE4000","z":"a52b5017.4b5dd","serial":"631e9d92.6b2024","x":520,"y":1100,"wires":[["c6cbf39f.99f56","688c60e.f7af7a"]]},{"id":"add18a61.3ba5b8","type":"CooLLED-pE4000","z":"a52b5017.4b5dd","serial":"631e9d92.6b2024","x":130,"y":1380,"wires":[["5e543e89.c865d"]]},{"id":"8549bc92.7387","type":"comment","z":"a52b5017.4b5dd","name":"","info":"https://github.com/justadudewhohacks/opencv4nodejs","x":980,"y":1500,"wires":[]},{"id":"7c63806f.f49ff","type":"CooLLED","z":"a52b5017.4b5dd","serial":"3a81dd6a.d56bd2","x":580,"y":1900,"wires":[[]]},{"id":"547da79c.094068","type":"debug","z":"a52b5017.4b5dd","name":"","active":true,"console":"false","complete":"true","x":1570,"y":180,"wires":[]},{"id":"74f51e5b.5cb28","type":"websocket in","z":"a52b5017.4b5dd","name":"","server":"7ce68456.504c4c","client":"","x":940,"y":60,"wires":[["d4d2af39.79d24"]]},{"id":"bebd5888.231ba8","type":"websocket out","z":"a52b5017.4b5dd","name":"","server":"7ce68456.504c4c","client":"","x":1230,"y":80,"wires":[]},{"id":"37a4bfba.70c68","type":"inject","z":"a52b5017.4b5dd","name":"","topic":"","payload":"will","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1030,"y":100,"wires":[["bebd5888.231ba8"]]},{"id":"d4d2af39.79d24","type":"debug","z":"a52b5017.4b5dd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1110,"y":40,"wires":[]},{"id":"a0300b97.97f0f8","type":"CooLLED","z":"a52b5017.4b5dd","name":"","model":"CooLLed-pE4000","number":"1","serial":"870a98b6.ef94e8","x":1420,"y":300,"wires":[["547da79c.094068"]]},{"id":"f31f299e.79a3a8","type":"websocket ine","z":"a52b5017.4b5dd","name":"","x":760,"y":460,"wires":[[]]},{"id":"cc1ae731.df76b8","type":"websocket ine","z":"dbe04189.6c773","name":"","server":"79f90969.395868","client":"","x":160,"y":320,"wires":[["ed457d85.c8ec3","cf13b23b.7e492"]]},{"id":"bce48f56.7f5fb","type":"websocket oute","z":"dbe04189.6c773","name":"","server":"79f90969.395868","client":"","x":1560,"y":320,"wires":[]},{"id":"2a0eef6c.45972","type":"inject","z":"dbe04189.6c773","name":"Tick every 1 secs","topic":"test","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":"","x":930,"y":500,"wires":[["bb08c773.78cad8"]]},{"id":"81223187.9cc2d","type":"http response","z":"dbe04189.6c773","name":"","x":1030,"y":100,"wires":[]},{"id":"8d47ccca.01c14","type":"http in","z":"dbe04189.6c773","name":"","url":"/simple","method":"get","upload":false,"swaggerDoc":"","x":150,"y":100,"wires":[["8fd6e307.d659d"]]},{"id":"8fd6e307.d659d","type":"template","z":"dbe04189.6c773","name":"Simple Web Page","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE HTML>\n<html>\n    <head>\n    <style type=\"text/css\">\n        img:hover {\n          box-shadow: 0 0 2px 1px rgba(0, 140, 186, 0.5);\n        }\n    </style>\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js\"></script>\n    <script type=\"text/javascript\">\n        var ws;\n        var wsUri = \"ws:\";\n        var loc = window.location;\n        var firstPosition = false ;\n        var navig = {} ;\n        console.log(loc);\n        if (loc.protocol === \"https:\") { wsUri = \"wss:\"; }\n        // This needs to point to the web socket in the Node-RED flow\n        // ... in this case it's ws/simple\n        wsUri += \"//\" + loc.host + loc.pathname.replace(\"simple\",\"ws/simple\");\n        function wsConnect() {\n            console.log(\"connect\",wsUri);\n            ws = new WebSocket(wsUri);\n            ws.onmessage = function(msg) {\n                var line = \"\";  // or uncomment this to overwrite the existing message\n                var data = msg.data;\n                data = JSON.parse(data);\n                if(data.type === 'date'){\n                    line += \"<p>\"+data.valeur+\"</p>\";\n                    //document.getElementById('messages').innerHTML = line;\n                }\n                if(data.type === 'img2'){\n                    document.getElementById('image2').src = data.valeur;\n                }                \n                if(data.type === 'img-curve'){\n                    document.getElementById('image-hist')\n                        .setAttribute(\n                            'src', 'data:image/png;base64, '+data.src \n                        );\n\n                }                \n                if(data.type === 'img'){\n                    document.getElementById('image').src = data.valeur;\n                    document.getElementById('image')\n                        .setAttribute(\n                            'src', 'data:image/png;base64, '+data.src \n                        );\n                    var split = data.valeur.split('-');\n                    \n                    if(split[1] in navig){\n                        if(split[2] in navig[split[1]]){\n                            navig[split[1]][split[2]][split[3]] = !firstPosition ;\n                        } else {\n                            navig[split[1]][split[2]] = {} ;\n                            if(split[3] in navig[split[1]][split[2]]){\n                                console.log('unknow key');\n                            } else { \n                                navig[split[1]][split[2]][split[3]] = !firstPosition ;\n                            }\n                        }\n                    } else { \n                        navig[split[1]] = {} ;\n                        if(split[2] in navig[split[1]]){\n                            navig[split[1]][split[2]][split[3]] = !firstPosition ;\n                        } else { \n                            navig[split[1]][split[2]] = {} ;\n                            if(split[3] in navig[split[1]][split[2]]){\n                                console.log('unknow key');\n                            } else { \n                                navig[split[1]][split[2]][split[3]] = !firstPosition ;\n                            }\n                        }    \n                    }\n                    if(firstPosition === false){\n                       // $('#data').append(\"<select id='Name'></select><hr/>\");\n                    //    $('#data').append(\"<select id='Position'></select><select id='Channel'></select><select id='Z'></select><select id='Time'></select><button type='button' onclick='updateImg();'>Click to visualize</button><hr/>\");\n                        firstPosition = true ;\n                    }\n                    \n                    console.log(navig);\n                    /*$('#Name').append(\"<option value='\"+data.valeur+\"'>\"+data.valeur+\"</option>\");\n                    if ($(\"#data option[value=\"+split[3]+\"]\").length == 0 ){\n                        $('#Position').append(\"<option value='\"+split[3]+\"'>\"+split[3]+\"</option>\");\n                    }\n                    if ($(\"#data option[value=\"+split[4]+\"]\").length == 0 ){\n                        $('#Channel').append(\"<option value='\"+split[4]+\"'>\"+split[4]+\"</option>\");\n                    }\n                    if ($(\"#data option[value=\"+split[5].substr(0,13)+\"]\").length == 0 ){\n                        $('#Time').append(\"<option value='\"+split[5].substr(0,13)+\"'>\"+split[5].substr(0,13)+\"</option>\");\n                    }*/\n                    upDateP();\n                }\n            }\n            ws.onopen = function() {\n                // update the status div with the connection status\n                document.getElementById('status').innerHTML = \"connected\";\n                //ws.send(\"Open for data\");\n                console.log(\"connected\");\n            }\n            ws.onclose = function() {\n                // update the status div with the connection status\n                document.getElementById('status').innerHTML = \"not connected\";\n                // in case of lost connection tries to reconnect every 3 secs\n                setTimeout(wsConnect,3000);\n            }\n        }\n        \n\n        function doit(m) {\n            if (ws) { ws.send(m); }\n        }\n        function updateImg(){\n            if(ws){\n                ws.send('media/test2/AgarPad1-'+$(\"#Position\").val()+'-'+$(\"#Channel\").val()+'-'+$(\"#Time\").val());\n            }\n        }\n        function download(){\n            \n                var cal = 0 ;\n                for(p in navig) \n                    if(cal === parseInt($(\"#position\").val())) {var pos = p ; break;}\n                    else cal = cal + 1 ;\n                cal = 0;\n            \n                for(c in navig[pos]) \n                    if(cal === parseInt($(\"#channel\").val())) {var chan = c ; break;}\n                    else cal = cal + 1 ;\n            \n                cal = 0;\n                for(t in navig[pos][chan]) \n                    if(cal === parseInt($(\"#time\").val())) {var tim = t ; break;}\n                    else cal = cal + 1 ;\n\n                   window.location = \"http://127.0.0.1:1880/get-image?img=\"+(pos+'-'+chan+'-'+tim);\n\n        }\n        function upDateP(){\n            if(ws){\n                var nbPosition = Object.keys(navig).length ;\n                var cal = 0 ;\n                for(p in navig) \n                    if(cal === parseInt($(\"#position\").val())) {var pos = p ; break;}\n                    else cal = cal + 1 ;\n                cal = 0;\n                $('#position').attr('max',nbPosition-1);\n                \n                var nbChannel = Object.keys(navig[pos]).length ;\n                $('#channel').attr('max',nbChannel-1);\n                cal = 0;\n                for(c in navig[pos]) \n                    if(cal === parseInt($(\"#channel\").val())) {var chan = c ; break;}\n                    else cal = cal + 1 ;\n                cal = 0;\n                var nbTime = Object.keys(navig[pos][chan]).length ;\n                $('#time').attr('max',nbTime-1);\n                for(t in navig[pos][chan]) \n                    if(cal === parseInt($(\"#time\").val())) {var tim = t ; break;}\n                    else cal = cal + 1 ;\n//              \n//                var nbTime = Object.keys(navig[pos][split[4]]).length ;\n  //              $('#time').attr('max',nbTime-1);\n\n                $('#positionL').html(pos+\" (\"+nbPosition+\" position(s))\");\n                $('#channelL').html(chan+\" (\"+nbChannel+\" channel(s))\");\n                $('#timeL').html(new Date(parseInt(tim.substr(0,tim.length-4)))+\" (\"+nbTime+\")\");\n                /*if((nbPosition===0)||(nbPosition===1)) $(\"#position\" ).prop( \"disabled\", true );\n                else $(\"#position\" ).prop( \"disabled\", false );\n                if((nbChannel===0)||(nbChannel===1))$(\"#channel\" ).prop( \"disabled\", true );\n                $(\"#channel\" ).prop( \"disabled\", false );\n                if((nbTime===0)||(nbTime===1))$(\"#time\" ).prop( \"disabled\", true );\n                $(\"#time\" ).prop( \"disabled\", false );*/\n                ws.send('media/test2/AgarPad1-'+pos+'-'+chan+'-'+tim);\n            }\n            \n        }\n    </script>\n    </head>\n    <body onload=\"wsConnect();\" onunload=\"ws.disconnect();\">\n        <font face=\"Arial\">\n        <!--<div id=\"messages\"></div>\n        <button type=\"button\" onclick='doit(\"click\");'>Click to send message</button>\n        <hr/>\n        <div id=\"data\"></div>-->\n        <div  style=\"position:absolute; \"><h3>Live</h3><img style=\"border-radius: 3px; border: 1px solid #ddd; padding: 5px;\" id=\"image\"/></div>\n        <div style=\"position:absolute; margin-left:525px;\" ><h3>Histogramm</h3><img style=\"border-radius: 3px; border: 1px solid #ddd; padding: 5px;\" id=\"image-hist\" src='data:image/jpeg;base64,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'></div>\n        <div style=\"position:absolute; margin-left:820px;\"><h3>Navigation</h3><img style=\"border-radius: 3px;  border: 1px solid #ddd; padding: 5px;\" id=\"image2\"/></div>\n        <div style=\"position:absolute; margin-left:1345px;\"><h3>Histogramm</h3><img style=\"border-radius: 3px;  border: 1px solid #ddd; padding: 5px;\" id=\"image2-hist\" src='data:image/jpeg;base64,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'/></div>\n        <!--<hr/>-->\n        <div  style=\"position:absolute;  margin-top:620px; \">\n            <!--<div id=\"status\">unknown</div>-->\n            <label id='positionL' style='display: inline-block; width:600px;'>Position:</label>\n            <input onmousemove='upDateP();' onchange='upDateP();' style='width:800px' id='position' step='1' min='0' max='0' type='range'/><br>\n            <label id='channelL' style='display: inline-block; width:600px;'>Channel:</label><input onmousemove='upDateP();' onchange='upDateP();' style='width:800px' id='channel' step='1' min='0' max='0' type='range'/><br>\n            <label id='zL' style='display: inline-block; width:600px;'>Z axis</label><input onmousemove='upDateP();' onchange='upDateP();' style='width:800px' id='z' step='1' min='0' max='0' type='range'/><br>\n            <label id='timeL' style='display: inline-block; width:600px;'>Time:</label><input onmousemove='upDateP();' onchange='upDateP();' style='width:800px' id='time' step='1' min='0' max='0' type='range'/>\n            <br>\n            <button onclick='download();'>Download the picture :-)</button>\n        </div>\n        </font>\n    </body>\n</html>\n","x":530,"y":100,"wires":[["81223187.9cc2d"]]},{"id":"bb08c773.78cad8","type":"function","z":"dbe04189.6c773","name":"format time nicely","func":"msg.payload = {};\nmsg.payload.type = 'date';\nmsg.payload.valeur = Date(msg.payload).toString();\nreturn msg;","outputs":1,"noerr":0,"x":1210,"y":560,"wires":[["bce48f56.7f5fb"]]},{"id":"ad0b51e8.a52de","type":"serial in","z":"cb80149c.966208","name":"","serial":"3a81dd6a.d56bd2","x":1270,"y":680,"wires":[[]]},{"id":"8b694ecb.f7102","type":"file in","z":"ab1796ad.d3dd28","name":"","filename":"","format":"utf8","chunk":false,"sendError":false,"x":1250,"y":220,"wires":[["72403e5a.35573"]]},{"id":"72403e5a.35573","type":"json","z":"ab1796ad.d3dd28","name":"","property":"payload","action":"","pretty":false,"x":1370,"y":220,"wires":[["22cc92d7.b9966e"]]},{"id":"22cc92d7.b9966e","type":"function","z":"ab1796ad.d3dd28","name":"device","func":"var config_hardware =  msg.payload ;\nvar device = [Object.keys(config_hardware).length] ;\nvar cpt = 0 ;\nfor(var key in config_hardware){\n    device[cpt] = {'name':'TEST', 'payload':{'device' : key}};\n    for(var key2 in config_hardware[key]) if(key2 !== 'settings') device[cpt].payload[key2] = config_hardware[key][key2];\n    for(var key3 in config_hardware[key]['settings']) device[cpt].payload[key3] = config_hardware[key]['settings'][key3];\n    cpt++ ;\n}\nreturn device;//.send([{'payload' : 'done'}],[{'payload2' : 'done2'}]);\n","outputs":10,"noerr":0,"x":1530,"y":220,"wires":[["1cd7b1b2.2766fe"],["779724da.029e2c"],["960dd98f.fd9b88"],["6c7df29b.2ba48c"],["b7a1222.a9483e"],["d1c07c39.c34bb"],["b9a3a8a2.85db98"],["37ce86a4.a5872a"],["446f8455.50012c"],["e584de10.27866"]]},{"id":"f45989a8.cdcab8","type":"ui_toast","z":"ab1796ad.d3dd28","position":"top right","displayTime":"3","name":"","x":1160,"y":180,"wires":[]},{"id":"c2c6aa4a.9dd9e8","type":"function","z":"ab1796ad.d3dd28","name":"","func":"var param = [];\n\nparam[0] = {'payload' : msg.payload.device};\nparam[1] = {'payload' : msg.payload.link};\nparam[2] = {'payload' : msg.payload.activate};\nparam[3] = {'payload' : msg.payload.serialPort};\nparam[4] = {'payload' : msg.payload.baudRate};\nparam[5] = {'payload' : msg.payload.dataBits};\nparam[6] = {'payload' : msg.payload.parity};\nparam[7] = {'payload' : msg.payload.stopBits};\n\nreturn param;\n","outputs":8,"noerr":0,"x":450,"y":820,"wires":[["8c31c79a.716488"],["3d82d52b.c0f32a"],["9a06e762.561c18"],["e0ba4902.6a6758"],["2f19325a.6fce5e"],["d419f5c.6023508"],["1a30d007.98353"],["d25c88af.557248"]]},{"id":"3d82d52b.c0f32a","type":"ui_dropdown","z":"ab1796ad.d3dd28","name":"","label":"Link: ","group":"be0f5ba9.41a6f8","order":2,"width":"6","height":"1","passthru":true,"options":[{"label":"fluorescence","value":"fluorescence","type":"str"},{"label":"mosaic","value":"mosaic","type":"str"}],"payload":"","topic":"link","x":670,"y":760,"wires":[["22ae15c0.91a6ea"]]},{"id":"9a06e762.561c18","type":"ui_switch","z":"ab1796ad.d3dd28","name":"","label":"Activate","group":"be0f5ba9.41a6f8","order":3,"width":"4","height":"1","passthru":true,"topic":"activate","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":680,"y":680,"wires":[["8d36e3c2.01c7f","b6d1fffb.20d35"]]},{"id":"2f19325a.6fce5e","type":"ui_dropdown","z":"ab1796ad.d3dd28","name":"","label":"","group":"be0f5ba9.41a6f8","order":9,"width":"3","height":"1","passthru":true,"options":[{"label":"115200","value":"115200","type":"str"},{"label":"57600","value":"57600","type":"str"},{"label":"38400","value":"38400","type":"str"},{"label":"19200","value":"19200","type":"str"},{"label":"9600","value":"9600","type":"str"},{"label":"4800","value":"4800","type":"str"},{"label":"2400","value":"2400","type":"str"},{"label":"1200","value":"1200","type":"str"},{"label":"600","value":"600","type":"str"},{"label":"300","value":"300","type":"str"}],"payload":"","topic":"baudRate","x":680,"y":840,"wires":[["36487ab3.873fc6"]]},{"id":"d419f5c.6023508","type":"ui_dropdown","z":"ab1796ad.d3dd28","name":"","label":"","group":"be0f5ba9.41a6f8","order":10,"width":"2","height":"1","passthru":true,"options":[{"label":"8","value":"8","type":"str"},{"label":"7","value":"7","type":"str"},{"label":"6","value":"6","type":"str"},{"label":"5","value":"5","type":"str"}],"payload":"","topic":"dataBits","x":680,"y":880,"wires":[["16961b90.ce3814"]]},{"id":"1a30d007.98353","type":"ui_dropdown","z":"ab1796ad.d3dd28","name":"","label":"","group":"be0f5ba9.41a6f8","order":11,"width":"3","height":"1","passthru":true,"options":[{"label":"None","value":"None","type":"str"},{"label":"Even","value":"Even","type":"str"},{"label":"Mark","value":"Mark","type":"str"},{"label":"Odd","value":"Odd","type":"str"},{"label":"Space","value":"Space","type":"str"}],"payload":"","topic":"parity","x":680,"y":920,"wires":[["554704eb.dda46c"]]},{"id":"d25c88af.557248","type":"ui_dropdown","z":"ab1796ad.d3dd28","name":"","label":"","group":"be0f5ba9.41a6f8","order":12,"width":"2","height":"1","passthru":true,"options":[{"label":"2","value":"2","type":"str"},{"label":"1","value":"1","type":"str"}],"payload":"","topic":"stopBits","x":680,"y":960,"wires":[["30426ae7.f66686"]]},{"id":"7b294eb3.38bfa","type":"ui_text","z":"ab1796ad.d3dd28","group":"be0f5ba9.41a6f8","order":5,"width":"3","height":"1","name":"","label":"Baud Rate","format":"{{msg.payload}}","layout":"row-left","x":690,"y":520,"wires":[]},{"id":"25d10064.80654","type":"ui_text","z":"ab1796ad.d3dd28","group":"be0f5ba9.41a6f8","order":6,"width":"2","height":"1","name":"","label":"Data Bits","format":"{{msg.payload}}","layout":"row-left","x":680,"y":560,"wires":[]},{"id":"3c1c031f.f83ebc","type":"ui_text","z":"ab1796ad.d3dd28","group":"be0f5ba9.41a6f8","order":7,"width":"3","height":"1","name":"","label":"Parity","format":"{{msg.payload}}","layout":"row-left","x":670,"y":600,"wires":[]},{"id":"4b440c65.fdc434","type":"ui_text","z":"ab1796ad.d3dd28","group":"be0f5ba9.41a6f8","order":8,"width":"2","height":"1","name":"","label":"Stop Bits","format":"{{msg.payload}}","layout":"row-left","x":680,"y":640,"wires":[]},{"id":"a6cf1ba4.92f838","type":"function","z":"ab1796ad.d3dd28","name":"path","func":"msg.filename = 'C:/Users/Williams/.node-red/lib/config/config_hardware.json';\nreturn msg;","outputs":1,"noerr":0,"x":1130,"y":220,"wires":[["8b694ecb.f7102"]]},{"id":"2c51627f.4829fe","type":"function","z":"ab1796ad.d3dd28","name":"","func":"var param = [];\n\nparam[0] = {'payload' : msg.payload.device};\nparam[1] = {'payload' : msg.payload.link};\nparam[2] = {'payload' : msg.payload.activate};\nparam[3] = {'payload' : msg.payload.serialPort};\nparam[4] = {'payload' : msg.payload.baudRate};\nparam[5] = {'payload' : msg.payload.dataBits};\nparam[6] = {'payload' : msg.payload.parity};\nparam[7] = {'payload' : msg.payload.stopBits};\n\nreturn param;\n","outputs":8,"noerr":0,"x":1390,"y":860,"wires":[["8928d67e.2bcf78"],["da44e4e3.6c84d8"],["67916a75.5e9e74"],["32d6171e.d4b8d8"],["39a3f4da.8fa23c"],["26aca05c.8bdfb"],["895ee92d.1a0558"],["e620dc93.bf639"]]},{"id":"da44e4e3.6c84d8","type":"ui_dropdown","z":"ab1796ad.d3dd28","name":"","label":"Link: ","group":"fe8ba4c0.c72178","order":3,"width":"6","height":"1","passthru":true,"options":[{"label":"fluorescence","value":"fluorescence","type":"str"},{"label":"mosaic","value":"mosaic","type":"str"}],"payload":"","topic":"","x":1610,"y":800,"wires":[["64a1a5c4.727e5c"]]},{"id":"67916a75.5e9e74","type":"ui_switch","z":"ab1796ad.d3dd28","name":"","label":"Activate","group":"fe8ba4c0.c72178","order":4,"width":"4","height":"1","passthru":true,"topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":1620,"y":720,"wires":[["f749806d.cca3d"]]},{"id":"32d6171e.d4b8d8","type":"ui_text_input","z":"ab1796ad.d3dd28","name":"","label":"Serial Port","group":"fe8ba4c0.c72178","order":5,"width":0,"height":0,"passthru":true,"mode":"text","delay":300,"topic":"","x":1630,"y":840,"wires":[["77857875.0f41d8"]]},{"id":"39a3f4da.8fa23c","type":"ui_dropdown","z":"ab1796ad.d3dd28","name":"","label":"","group":"fe8ba4c0.c72178","order":10,"width":"3","height":"1","passthru":true,"options":[{"label":"115200","value":"115200","type":"str"},{"label":"57600","value":"57600","type":"str"},{"label":"38400","value":"38400","type":"str"},{"label":"19200","value":"19200","type":"str"},{"label":"9600","value":"9600","type":"str"},{"label":"4800","value":"4800","type":"str"},{"label":"2400","value":"2400","type":"str"},{"label":"1200","value":"1200","type":"str"},{"label":"600","value":"600","type":"str"},{"label":"300","value":"300","type":"str"}],"payload":"","topic":"","x":1620,"y":880,"wires":[["471fc6a9.2f0558"]]},{"id":"26aca05c.8bdfb","type":"ui_dropdown","z":"ab1796ad.d3dd28","name":"","label":"","group":"fe8ba4c0.c72178","order":11,"width":"2","height":"1","passthru":true,"options":[{"label":"8","value":"8","type":"str"},{"label":"7","value":"7","type":"str"},{"label":"6","value":"6","type":"str"},{"label":"5","value":"5","type":"str"}],"payload":"","topic":"","x":1620,"y":920,"wires":[["8b754f78.545e9"]]},{"id":"895ee92d.1a0558","type":"ui_dropdown","z":"ab1796ad.d3dd28","name":"","label":"","group":"fe8ba4c0.c72178","order":12,"width":"3","height":"1","passthru":true,"options":[{"label":"None","value":"None","type":"str"},{"label":"Even","value":"Even","type":"str"},{"label":"Mark","value":"Mark","type":"str"},{"label":"Odd","value":"Odd","type":"str"},{"label":"Space","value":"Space","type":"str"}],"payload":"","topic":"","x":1620,"y":960,"wires":[["6cf50f41.d2cc"]]},{"id":"e620dc93.bf639","type":"ui_dropdown","z":"ab1796ad.d3dd28","name":"","label":"","group":"fe8ba4c0.c72178","order":13,"width":"2","height":"1","passthru":true,"options":[{"label":"2","value":"2","type":"str"},{"label":"1","value":"1","type":"str"}],"payload":"","topic":"","x":1620,"y":1000,"wires":[["e2a6e00a.6b00e"]]},{"id":"84e3a7d7.b66828","type":"ui_text","z":"ab1796ad.d3dd28","group":"fe8ba4c0.c72178","order":6,"width":"3","height":"1","name":"","label":"Baud Rate","format":"{{msg.payload}}","layout":"row-left","x":1630,"y":540,"wires":[]},{"id":"7579d82f.ffaa78","type":"ui_text","z":"ab1796ad.d3dd28","group":"fe8ba4c0.c72178","order":7,"width":"2","height":"1","name":"","label":"Data Bits","format":"{{msg.payload}}","layout":"row-left","x":1620,"y":580,"wires":[]},{"id":"7f441ed.d4993e","type":"ui_text","z":"ab1796ad.d3dd28","group":"fe8ba4c0.c72178","order":8,"width":"3","height":"1","name":"","label":"Parity","format":"{{msg.payload}}","layout":"row-left","x":1610,"y":620,"wires":[]},{"id":"c941dd77.cfba","type":"ui_text","z":"ab1796ad.d3dd28","group":"fe8ba4c0.c72178","order":9,"width":"2","height":"1","name":"","label":"Stop Bits","format":"{{msg.payload}}","layout":"row-left","x":1620,"y":660,"wires":[]},{"id":"6ee0791.b10ab88","type":"ui_button","z":"ab1796ad.d3dd28","name":"","group":"fe8ba4c0.c72178","order":14,"width":"10","height":"1","label":"UPDATE","color":"","icon":"","payload":"config","payloadType":"str","topic":"action","x":1780,"y":1040,"wires":[["5ab78101.3cc92"]]},{"id":"474ee547.ee2efc","type":"ui_button","z":"ab1796ad.d3dd28","name":"","group":"335417ac.ce8778","order":5,"width":"10","height":"1","label":"Load the parameters","color":"","icon":"","payload":"Loading configuration ...","payloadType":"str","topic":"","x":920,"y":180,"wires":[["a6cf1ba4.92f838","f45989a8.cdcab8"]]},{"id":"86bad488.79a148","type":"ui_text","z":"ab1796ad.d3dd28","group":"335417ac.ce8778","order":2,"width":"10","height":"1","name":"","label":"Name of µScope: ","format":"Miss Marple","layout":"row-left","x":470,"y":320,"wires":[]},{"id":"44d61cf4.e11934","type":"ui_text","z":"ab1796ad.d3dd28","group":"335417ac.ce8778","order":1,"width":"10","height":"1","name":"","label":"Date / hour: ","format":"{{msg.payload}}","layout":"row-left","x":1350,"y":260,"wires":[]},{"id":"c7c13274.662b6","type":"ui_text","z":"ab1796ad.d3dd28","group":"335417ac.ce8778","order":4,"width":"10","height":"1","name":"","label":"Devices installed: ","format":"6","layout":"row-left","x":670,"y":320,"wires":[]},{"id":"f6b6ee2b.fd2b3","type":"inject","z":"ab1796ad.d3dd28","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":970,"y":260,"wires":[["c70f2b12.ed0548"]]},{"id":"c70f2b12.ed0548","type":"function","z":"ab1796ad.d3dd28","name":"","func":"msg.payload = new Date() ;\nreturn msg;","outputs":1,"noerr":0,"x":1130,"y":260,"wires":[["44d61cf4.e11934"]]},{"id":"21dfd9f8.29eef6","type":"ui_text","z":"ab1796ad.d3dd28","group":"335417ac.ce8778","order":3,"width":"10","height":"1","name":"","label":"Software version : ","format":"1.3.5","layout":"row-left","x":870,"y":320,"wires":[]},{"id":"b1e1a08a.06671","type":"ui_text","z":"ab1796ad.d3dd28","group":"335417ac.ce8778","order":3,"width":"10","height":"1","name":"","label":"Author : ","format":"Williams BRETT | CNRS | MSC | LAB513","layout":"row-left","x":1040,"y":320,"wires":[]},{"id":"9c1e51aa.cd8ca","type":"function","z":"ab1796ad.d3dd28","name":"","func":"if(msg.payload === false) msg.enabled = false ;\nelse msg.enabled = true ;\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":520,"wires":[["2f19325a.6fce5e","d419f5c.6023508","1a30d007.98353","d25c88af.557248","3d82d52b.c0f32a","7b294eb3.38bfa","25d10064.80654","3c1c031f.f83ebc","4b440c65.fdc434","e0ba4902.6a6758","8c31c79a.716488"]]},{"id":"d15ad2b2.5c669","type":"inject","z":"ab1796ad.d3dd28","name":"","topic":"","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":true,"onceDelay":"2","x":450,"y":680,"wires":[["9a06e762.561c18"]]},{"id":"5b2ae33d.ec97ac","type":"inject","z":"ab1796ad.d3dd28","name":"","topic":"","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":true,"onceDelay":"5","x":450,"y":180,"wires":[["3a1321fc.3feebe"]]},{"id":"b3b0cb45.8d26c8","type":"inject","z":"ab1796ad.d3dd28","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":true,"onceDelay":"0.1","x":450,"y":220,"wires":[["e64c5c3a.8591a"]]},{"id":"e64c5c3a.8591a","type":"delay","z":"ab1796ad.d3dd28","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":580,"y":220,"wires":[["3a1321fc.3feebe","1b960cd1.a0a083"]]},{"id":"65eb4edb.9f54a","type":"ui_toast","z":"ab1796ad.d3dd28","position":"top right","displayTime":"3","name":"","x":740,"y":100,"wires":[]},{"id":"f17f40e5.bea85","type":"inject","z":"ab1796ad.d3dd28","name":"","topic":"","payload":"Please wait ....","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"5","x":470,"y":100,"wires":[["65eb4edb.9f54a"]]},{"id":"3a1321fc.3feebe","type":"function","z":"ab1796ad.d3dd28","name":"enabled","func":"if(msg.payload === false) msg.enabled = false ;\nelse msg.enabled = true ;\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":180,"wires":[["474ee547.ee2efc"]]},{"id":"1b960cd1.a0a083","type":"function","z":"ab1796ad.d3dd28","name":"load","func":"msg.payload = 'Configuration loaded sussceffuly !';\nreturn msg;","outputs":1,"noerr":0,"x":970,"y":220,"wires":[["a6cf1ba4.92f838","f45989a8.cdcab8"]]},{"id":"1cd7b1b2.2766fe","type":"link out","z":"ab1796ad.d3dd28","name":"1","links":["3c6cc016.7a3a1"],"x":1655,"y":40,"wires":[]},{"id":"3c6cc016.7a3a1","type":"link in","z":"ab1796ad.d3dd28","name":"","links":["1cd7b1b2.2766fe"],"x":355,"y":820,"wires":[["c2c6aa4a.9dd9e8"]]},{"id":"779724da.029e2c","type":"link out","z":"ab1796ad.d3dd28","name":"2","links":["b5acb713.2fe2d8"],"x":1655,"y":80,"wires":[]},{"id":"b5acb713.2fe2d8","type":"link in","z":"ab1796ad.d3dd28","name":"","links":["779724da.029e2c"],"x":1295,"y":860,"wires":[["2c51627f.4829fe"]]},{"id":"960dd98f.fd9b88","type":"link out","z":"ab1796ad.d3dd28","name":"3","links":["9ceddf46.92f06"],"x":1655,"y":120,"wires":[]},{"id":"a67a50da.5ec52","type":"inject","z":"ab1796ad.d3dd28","name":"","topic":"","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":true,"onceDelay":"5","x":1350,"y":720,"wires":[["67916a75.5e9e74"]]},{"id":"6c7df29b.2ba48c","type":"link out","z":"ab1796ad.d3dd28","name":"4","links":["b3c6372.1af12c8"],"x":1655,"y":160,"wires":[]},{"id":"432f6c3b.af21c4","type":"comment","z":"ab1796ad.d3dd28","name":"COOL-LED-PE-4000","info":"","x":440,"y":480,"wires":[]},{"id":"b7a1222.a9483e","type":"link out","z":"ab1796ad.d3dd28","name":"5","links":["44c4e029.2fff3"],"x":1655,"y":200,"wires":[]},{"id":"d1c07c39.c34bb","type":"link out","z":"ab1796ad.d3dd28","name":"6","links":["71b7fbee.37f524"],"x":1655,"y":240,"wires":[]},{"id":"b9a3a8a2.85db98","type":"link out","z":"ab1796ad.d3dd28","name":"7","links":["35286209.9149ae"],"x":1655,"y":280,"wires":[]},{"id":"37ce86a4.a5872a","type":"link out","z":"ab1796ad.d3dd28","name":"8","links":["c3e06da9.0422f"],"x":1655,"y":320,"wires":[]},{"id":"446f8455.50012c","type":"link out","z":"ab1796ad.d3dd28","name":"9","links":["c45ed6f.914fb28"],"x":1655,"y":360,"wires":[]},{"id":"e584de10.27866","type":"link out","z":"ab1796ad.d3dd28","name":"10","links":["76aa15b1.797f4c"],"x":1655,"y":400,"wires":[]},{"id":"53b0e5cc.29bb8c","type":"comment","z":"ab1796ad.d3dd28","name":"COOL-LED-PE-4000","info":"","x":1380,"y":480,"wires":[]},{"id":"8d36e3c2.01c7f","type":"link out","z":"ab1796ad.d3dd28","name":"activate1","links":["5f9bf0cc.21bec"],"x":795,"y":680,"wires":[]},{"id":"5f9bf0cc.21bec","type":"link in","z":"ab1796ad.d3dd28","name":"","links":["8d36e3c2.01c7f"],"x":355,"y":520,"wires":[["9c1e51aa.cd8ca"]]},{"id":"b6d1fffb.20d35","type":"function","z":"ab1796ad.d3dd28","name":"","func":"context.data1 = context.data1 || {} ;\ncontext.data1[msg.topic] = msg.payload ;\nif((Object.keys(context.data1).length > 8)&& (msg.topic === 'action')){\n    msg.payload = context.data1 ;\n    delete msg.topic;\n    return msg;\n}","outputs":1,"noerr":0,"x":1010,"y":680,"wires":[[]]},{"id":"3037a2c2.58094e","type":"ui_button","z":"ab1796ad.d3dd28","name":"","group":"be0f5ba9.41a6f8","order":13,"width":"10","height":"1","label":"UPDATE","color":"","icon":"","payload":"config","payloadType":"str","topic":"action","x":840,"y":1000,"wires":[["b6d1fffb.20d35"]]},{"id":"ae339372.622ed","type":"delay","z":"ab1796ad.d3dd28","name":"","pauseType":"random","timeout":"0.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"2","randomUnits":"seconds","drop":false,"x":840,"y":720,"wires":[["b6d1fffb.20d35"]]},{"id":"22ae15c0.91a6ea","type":"delay","z":"ab1796ad.d3dd28","name":"","pauseType":"random","timeout":"0.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"2","randomUnits":"seconds","drop":false,"x":840,"y":760,"wires":[["b6d1fffb.20d35"]]},{"id":"e72c6e9b.8a677","type":"delay","z":"ab1796ad.d3dd28","name":"","pauseType":"random","timeout":"0.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"2","randomUnits":"seconds","drop":false,"x":840,"y":800,"wires":[["b6d1fffb.20d35"]]},{"id":"36487ab3.873fc6","type":"delay","z":"ab1796ad.d3dd28","name":"","pauseType":"random","timeout":"0.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"2","randomUnits":"seconds","drop":false,"x":840,"y":840,"wires":[["b6d1fffb.20d35"]]},{"id":"16961b90.ce3814","type":"delay","z":"ab1796ad.d3dd28","name":"","pauseType":"random","timeout":"0.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"2","randomUnits":"seconds","drop":false,"x":840,"y":880,"wires":[["b6d1fffb.20d35"]]},{"id":"554704eb.dda46c","type":"delay","z":"ab1796ad.d3dd28","name":"","pauseType":"random","timeout":"0.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"2","randomUnits":"seconds","drop":false,"x":840,"y":920,"wires":[["b6d1fffb.20d35"]]},{"id":"30426ae7.f66686","type":"delay","z":"ab1796ad.d3dd28","name":"","pauseType":"random","timeout":"0.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"2","randomUnits":"seconds","drop":false,"x":840,"y":960,"wires":[["b6d1fffb.20d35"]]},{"id":"e0ba4902.6a6758","type":"ui_dropdown","z":"ab1796ad.d3dd28","name":"","label":"Serial Port","group":"be0f5ba9.41a6f8","order":4,"width":0,"height":0,"passthru":true,"options":[{"label":"COM1","value":"COM1","type":"str"},{"label":"COM2","value":"COM2","type":"str"},{"label":"COM3","value":"COM3","type":"str"},{"label":"COM4","value":"COM4","type":"str"},{"label":"COM5","value":"COM5","type":"str"},{"label":"COM6","value":"COM6","type":"str"},{"label":"COM7","value":"COM7","type":"str"},{"label":"COM8","value":"COM8","type":"str"},{"label":"COM9","value":"COM9","type":"str"},{"label":"COM10","value":"COM10","type":"str"}],"payload":"","topic":"serialPort","x":690,"y":800,"wires":[["e72c6e9b.8a677"]]},{"id":"8c31c79a.716488","type":"ui_dropdown","z":"ab1796ad.d3dd28","name":"","label":"Device","group":"be0f5ba9.41a6f8","order":1,"width":"10","height":"1","passthru":true,"options":[{"label":"CoolLed_pE4000","value":"CoolLed_pE4000","type":"str"},{"label":"CoolLed_pE300","value":"CoolLed_pE300","type":"str"},{"label":"CoolLed_pE100","value":"CoolLed_pE100","type":"str"},{"label":"XCite-Exact","value":"XCite-Exact","type":"str"},{"label":"XCite-120PC","value":"XCite-120PC","type":"str"},{"label":"Olympus-IX-71","value":"Olympus-IX-71","type":"str"},{"label":"Olympus-IX-81","value":"Olympus-IX-81","type":"str"},{"label":"Olympus-IX-83","value":"Olympus-IX-83","type":"str"}],"payload":"","topic":"device","x":670,"y":720,"wires":[["ae339372.622ed"]]},{"id":"6efd8e19.d9d2f","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2740,"y":920,"wires":[["af485675.4380c8","860c0e33.38f85"]]},{"id":"af485675.4380c8","type":"function","z":"cb80149c.966208","name":"","func":"msg.payload = 'test-image--Position1-BF-1548009385951.png';\nreturn msg;","outputs":1,"noerr":0,"x":2930,"y":940,"wires":[["2deca699.f8b0fa","860c0e33.38f85"]]},{"id":"ed457d85.c8ec3","type":"function","z":"dbe04189.6c773","name":"","func":"if(msg.payload === 'click') return msg;","outputs":1,"noerr":0,"x":230,"y":180,"wires":[["db847c20.6e0a7","1f8c70ca.13f4df"]]},{"id":"cf13b23b.7e492","type":"function","z":"dbe04189.6c773","name":"","func":"if(msg.payload !== 'click') {\n    var name = msg.payload ;\n    msg.payload = {};\n    msg.payload.valeur = name;\n    msg.payload.type = 'img2';\n    return msg;\n}","outputs":1,"noerr":0,"x":330,"y":320,"wires":[["bce48f56.7f5fb"]]},{"id":"21f8562e.cabf4a","type":"http in","z":"dbe04189.6c773","name":"","url":"/get-image","method":"get","upload":false,"swaggerDoc":"","x":160,"y":400,"wires":[["de37ffeb.2d774"]]},{"id":"210f71c1.40d53e","type":"file in","z":"dbe04189.6c773","name":"","filename":"","format":"","sendError":true,"x":470,"y":400,"wires":[["475b2034.b07b5"]]},{"id":"dc1087b9.f32fb8","type":"change","z":"dbe04189.6c773","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"image/tiff","tot":"str"},{"t":"set","p":"headers.content-disposition","pt":"msg","to":"payload.name","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":750,"y":400,"wires":[["f7a2ba15.82c2e8"]]},{"id":"f7a2ba15.82c2e8","type":"http response","z":"dbe04189.6c773","name":"","statusCode":"","headers":{"location":"http://127.0.0.1:1880/simple"},"x":910,"y":400,"wires":[]},{"id":"de37ffeb.2d774","type":"function","z":"dbe04189.6c773","name":"","func":"msg.filename = 'C:/Users/Williams/.node-red/lib/media/test2/AgarPad1-'+msg.payload.img;\ncontext.global.att = 'AgarPad1-'+msg.payload.img ;\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":400,"wires":[["210f71c1.40d53e"]]},{"id":"475b2034.b07b5","type":"function","z":"dbe04189.6c773","name":"","func":"msg.payload.name = 'attachment; filename='+context.global.att;\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":400,"wires":[["dc1087b9.f32fb8"]]},{"id":"554502c3.df3bfc","type":"inject","z":"dbe04189.6c773","name":"","topic":"","payload":"click","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"3","x":90,"y":180,"wires":[["ed457d85.c8ec3"]]},{"id":"f430ef87.f63d7","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":510,"y":100,"wires":[["adc12a53.1fc9b8","2ea778c6.371638","3c78fb68.31e124","39cc38ea.c58ef8","2cf53b34.e4a944","42c9f8b6.f7e7f8"]]},{"id":"3218074f.0da568","type":"inject","z":"2f633666.5f0b8a","name":"STOP","topic":"","payload":"MDA-FINISH","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":370,"y":440,"wires":[["bdd796f8.4062a8","dd4b3010.4c452"]]},{"id":"bdd796f8.4062a8","type":"function","z":"2f633666.5f0b8a","name":"stop MDA time Order","func":"if(msg.payload === 'MDA-FINISH'){\n    context.global.startMDA = 0 ;\n    node.status ({fill:\"red\",shape:\"dot\", text: \"STOP\"});\n    var msg = {} ;\n    msg.payload = \"STOP,\"+Date.now();\n    node.send(msg);\n}\nif(msg.payload === 'MDA-START'){\n    context.global.startMDA = 1 ;\n    node.status ({text: \"waiting stop ...\"});\n}","outputs":1,"noerr":0,"x":740,"y":440,"wires":[["487f01a8.1123f"]]},{"id":"3c78fb68.31e124","type":"function","z":"2f633666.5f0b8a","name":"Initialisation","func":"context.global.startMDA = 0 ;\n\ncontext.global.sync = 0 ;\ncontext.global.sync2 = 0 ;\ncontext.global.sync3 = 0 ;\ncontext.global.sync4 = 0 ;\n\ncontext.global.settingChannels = [];\ncontext.global.saveConfigChannel = '' ;\ncontext.global.saveConfigMda = '' ;\n\n\n\ncontext.global.camGrab = \"\";\ncontext.global.camGrabOld = \"\" ;\n\n//context.global.Fluorescence1 = 'CoolLed-PE4000';\n//context.global.listConfigChannel = ['williams1.json'] ;\n//context.global.initialize = false ;\n//context.global.ressources = [] ;\n\n//context.global.test = [];\n","outputs":1,"noerr":0,"x":710,"y":40,"wires":[[]]},{"id":"88a65012.8a546","type":"http in","z":"2f633666.5f0b8a","name":"","url":"/missmarple","method":"get","upload":false,"swaggerDoc":"","x":2160,"y":920,"wires":[["994d6e37.bc66e"]]},{"id":"a41a57e.3466da8","type":"http response","z":"2f633666.5f0b8a","name":"","x":2650,"y":920,"wires":[]},{"id":"994d6e37.bc66e","type":"template","z":"2f633666.5f0b8a","name":"MissMarpleHTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->\n    <meta name=\"description\" content=\"\">\n    <meta name=\"author\" content=\"\">\n    <link rel=\"icon\" href=\"bootstrap/favicon.ico\">\n\n    <title>Miss Marple | Bootstrap</title>\n\n    <script>\n    </script>\n\n    <link href=\"bootstrap/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link href=\"bootstrap/assets/css/ie10-viewport-bug-workaround.css\" rel=\"stylesheet\">\n    <link href=\"bootstrap/dashboard.css\" rel=\"stylesheet\">\n    <link href=\"css/style1.css\" rel=\"stylesheet\">\n    <script src=\"bootstrap/assets/js/ie-emulation-modes-warning.js\"></script>\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js\"></script>\n    <script src=\"js/js1.js\"></script>\n    \n    <script src=\"//code.jquery.com/jquery-3.3.1.min.js\"></script>\n    \n    <!-- This demo uses an 3rd-party, jQuery UI based context menu -->\n    <link href=\"//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css\" rel=\"stylesheet\">\n    <script src=\"//code.jquery.com/ui/1.12.1/jquery-ui.min.js\"></script>\n    <!-- jquery-contextmenu (https://github.com/mar10/jquery-ui-contextmenu/) -->\n    <script src=\"//cdn.jsdelivr.net/npm/ui-contextmenu/jquery.ui-contextmenu.min.js\"></script>\n    \n    <link href=\"fancytree-master/src/skin-win8/ui.fancytree.css\" rel=\"stylesheet\">\n    <script src=\"fancytree-master/src/jquery.fancytree.js\"></script>\n    <script src=\"fancytree-master/src/jquery.fancytree.dnd5.js\"></script>\n    <script src=\"fancytree-master/src/jquery.fancytree.edit.js\"></script>\n    <script src=\"fancytree-master/src/jquery.fancytree.gridnav.js\"></script>\n    <script src=\"fancytree-master/src/jquery.fancytree.table.js\"></script>\n    <script src=\"fancytree-master/src/jquery.fancytree.multi.js\"></script>\n    \n    <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.css\">\n    <script src=\"//cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.js\"></script>\n  \n \n      \n    <style type=\"text/css\">\n      .ui-menu {\n        width: 200px;\n        height: 30px;\n        font-size: 63%;\n      }\n      .ui-menu kbd { /* Keyboard shortcuts for ui-contextmenu titles */\n        float: right;\n      }\n      /* custom alignment (set by 'renderColumns'' event) */\n      td.alignRight {\n         text-align: right;\n      }\n      td.alignCenter {\n         text-align: center;\n      }\n      td input[type=input] {\n        width: 40px;\n      }\n       span.drag-source {\n    border: 1px solid lightgray;\n    border-radius: 3px;\n    padding: 2px;\n    background-color: silver\n  }\n\n  ul.fancytree-container {\n    max-height: 200px;\n    overflow-y: scroll;\n  }\n\n  span.fancytree-node.fancytree-drag-source {\n    outline: 1px dotted grey;\n  }\n  span.fancytree-node.fancytree-drop-accept {\n    outline: 1px dotted green;\n  }\n  span.fancytree-node.fancytree-drop-reject {\n    outline: 1px dotted red;\n  }\n\n    </style>\n\n\n  </head>\n\n  <body  onload=\"wsConnect();\" onunload=\"ws.onclose();\">\n    \n     <div id=\"wait\" style=\"text-align: center;\" >\n        <img style=\"margin: 0 auto;\" src='media/Audit.png'><img style=\"margin: 0 auto;\" src='media/loading.gif'>\n        <br>\n        <h2>Loading parameters, please wait a few seconds</h2>\n     </div>\n    \n     <div id=\"main\">\n         <nav class=\"navbar navbar-inverse navbar-fixed-top\">\n          <div class=\"container-fluid\">\n            <div class=\"navbar-header\">\n              <button type=\"button\" class=\"navbar-toggle collapsed\" data-toggle=\"collapse\" data-target=\"#navbar\" aria-expanded=\"false\" aria-controls=\"navbar\">\n                <span class=\"sr-only\">Toggle navigation</span>\n                <span class=\"icon-bar\"></span>\n                <span class=\"icon-bar\"></span>\n                <span class=\"icon-bar\"></span>\n              </button>\n              <a class=\"navbar-brand\" href=\"#\"><img src=\"e475238aca49b9f6bb53cc4138fbdb27--funny-caricatures-celebrity-caricatures.jpg\" style=\"width: 40px; height: 50px\"></a>\n              <a class=\"navbar-brand\" href=\"#\">Miss Marple</a>\n              <a class=\"navbar-brand\" href=\"#\"><div id=\"status\"></div></a>\n              <a class=\"navbar-brand\" href=\"#\"><div id=\"name_user\"></div></a>\n            </div>\n            \n            <div id=\"navbar\" class=\"navbar-collapse collapse\">\n              <ul class=\"nav navbar-nav navbar-right\">\n                <li><a href=\"#\"><!--<img src=\"user.png\" style=\"width: 40px; height: 50px\">--></a></li>\n              </ul>\n            </div>\n          </div>\n        </nav>\n    \n    \n        <div class=\"container-fluid\">\n          <div class=\"row\">\n            <div class=\"col-sm-3 col-md-2 sidebar\">\n              <ul class=\"nav nav-sidebar\">\n                <li><a href=\"#\"></a></li>\n                <li id='livemodeli'><a href=\"javascript: live_mode();\">Live mode<span class=\"sr-only\" ></span></a></li>\n                <li id='settingschannelsli'><a href=\"javascript: setting();\">Settings Channels<span class=\"sr-only\"></span></a></li>\n                <li id='mdali'><a href=\"javascript: mda();\">MDA<span class=\"sr-only\" ></span></a></li>\n              </ul>\n            </div>\n            <div class=\"col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main\">    \n    \n            \n            <br>\n            <div id=\"receive\"></div>\n            <hr/>\n            <div id=\"alert-success\" class=\"alert alert-success\" role=\"alert\"></div>\n            <!--<div id=\"alert-warning\"  class=\"alert alert-warning\" role=\"alert\"></div>          -->\n\n          <div id=\"live_mode\">\n            <h2 class=\"sub-header\">Live mode</h2>\n<!--            -->\n            <div id=\"live_div\" class=\"table-responsive\">\n                <!--<span class=\"drag-source\" draggable=\"true\" id=\"live_olympusix81\"><img src='icons/OlympusIx81.png'>&nbsp;OLYMPUS-IX-81</span>-->\n                <img src='icons/work_in_progress.jpg'>\n            </div>    \n          </div>\n  \n          <div id=\"settings\">\n              <h2 class=\"sub-header\">Settings channels</h2>\n                <div id=\"name_configChannels\">\n                </div>\n                <div id=\"available_configChannels\">\n                </div>\n                <br>\n                <!--<button class='setting_button' alt='load channel' id=\"setting_button_load_channel\"><img src='icons/arrow_up.png'> Load a new setting channel configuration</button>-->\n                <button class='setting_button' alt='add channel' id=\"setting_button_add_channel\"><img src='icons/add.png'> Add a new setting channel</button>\n                <!--<button class='setting_button' alt='new configuration' id=\"setting_button_new_configChannel\"><img src='icons/add.png'> New configuration</button><br><br>-->\n                <div id='Enlightened'></div><br>\n                <form method=\"post\" id='setting_channel_form' action=\"/formpost\" ajax=\"true\">\n                      <!--<label hidden id='label_config'> Name: &nbsp;&nbsp;</label><input hidden required type='text' id='name_config' name=\"nam_config\" ><br>-->\n                      <div id=\"setting_table_channel\" class=\"table-responsive\"></div>\n                      <button type='submit' alt='save' class='setting_button' id='setting_button_save_channel'><img src='icons/disk.png'> Save the current settings</button>\n                </form>\n                <br>\n                <hr/>\n                \n<!--                Futur<br>\n                <button type='setting_button' alt='export setting' class='setting_button' id=\"setting_button_export_channel\"> Load</button>\n                <button type='setting_button' alt='import setting' class='setting_button' id=\"setting_button_import_channel\"> Save as</button>\n    -->             \n          </div>\n                \n          \n          <div id=\"mda\">\n            <h2 class=\"sub-header\">Multi-dimensional Acquisition</h2>\n                \n                <div id=\"name_configMda\">\n                </div>\n                <div id=\"available_configMda\">\n                </div>\n                <div id=\"available_channels_mda\">\n                </div>\n\n                <div id=\"available_ressources\">\n                    <span>Available resources and functions</span><br>\n                    <span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Simple picture');\"><img src='icons/camera.png'>&nbsp;Simple picture</span>\n                    &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Autofocus');\"><img src='icons/autofocus.png'>&nbsp;Autofocus</span>\n                    &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Z-stack');\"><img src='icons/zstack.png'>&nbsp;Z-stack</span>\n                    &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'XYZ Position');\"><img src='icons/yxz-512.png'>&nbsp;XYZ-position</span>\n                    &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Sequence');\"><img src='icons/arrow_rotate_clockwise.png'>&nbsp;Sequence</span>\n                          &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Group Position');\"><img src='icons/plugin.png'>&nbsp;Group-position</span>\n             &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Mosaic');\"><img src='icons/mosaic.png'>&nbsp;Mosaic</span>\n             &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'End Mosaic');\"><img src='icons/nmosaic.png'>&nbsp;End Mosaic</span>\n                   \n             </div>\n                <h3>Definition of the experimental protocol</h3><hr/>\n\n                <table id=\"\" class=\"table table-striped\">\n                    <tbody>\n                        <tr>\n                            <th style=\"width:50%;\">                \n                                <!--<button class='' alt='load' id=\"\"><img src='icons/arrow_up.png'> Load a existing protocol</button>-->\n                                <button class='' alt='new' id=\"\"><img src='icons/add.png'> New protocol</button><br><br>\n                                <table id=\"tree\">\n                                    <colgroup>\n                                        <col width=\"1%\">\n                                        <col width=\"1%\">\n                                        <col width=\"38%\">\n                                        <col width=\"10%\">\n                                    </colgroup>\n                                    <thead>\n                                        <tr> <th></th> <th></th> <th></th> <th></th> <!--<th>Z-stacks</th> <th>Autofocus</th> <th>Save Images</th> <th>Comment</th> <th>Color</th>--> </tr>\n                                    </thead>\n                                    <tbody>\n                                      <tr>\n                                        <td class=\"alignCenter\"></td>\n                                        <td></td>\n                                        <td></td>\n                                        <td class=\"alignCenter\"></td>\n                                      </tr>\n                                    </tbody>\n                                </table>\n                            </th>\n                            <th style=\"width:50%;\">                \n                                <!--<label>PDMS chip:</label> <select><option>1</option><option>2</option></select><br>\n                                <img width=\"100%\" src='icons/test_uf.png'><br>\n                                <hr/>-->\n                                <button class='setting_button' alt='save' id='setting_button_save_configMda'><img src='icons/disk.png'>Save the protocol</button>\n                                <hr/>\n                                <p>Active: <span id=\"lblActive\">-</span></p>\n                                <hr/>\n                                <button onclick=test();>Start the protocol</button>\n                                \n                            </th>\n                        </tr>\n                    </tbody>\n                </table>\n  <!-- (Irrelevant source removed.) -->\n  \n  <script>\n  </script>\n\n            </div>\n            <!--</strong>-->\n            \n          </div>\n    \n              \n        </div>\n      </div>\n    </div>\n<!-- Bootstrap core JavaScript Placed at the end of the document so the pages load faster -->\n    <script>window.jQuery || document.write('<script src=\"bootstrap/assets/js/vendor/jquery.min.js\"><\\/script>')</script>\n    <script src=\"bootstrap/dist/js/bootstrap.min.js\"></script>\n    <script src=\"bootstrap/assets/js/vendor/holder.min.js\"></script>\n    <script src=\"bootstrap/assets/js/ie10-viewport-bug-workaround.js\"></script>\n    <script type=\"text/javascript\">\n    /*$.confirm({\n    title: 'WELCOME !',\n    theme: \"supervan\",\n    content: '' +\n    '<form action=\"\" class=\"formName\">' +\n    '<div class=\"form-group\">' +\n    '<label>Enter your name</label>' +\n    '<input type=\"text\" placeholder=\"Your name\" class=\"name form-control\" required />' +\n    '</div>' +\n    '</form>',\n    buttons: {\n        formSubmit: {\n            text: 'Submit',\n            btnClass: 'btn-blue',\n            action: function () {\n                var name = this.$content.find('.name').val();\n                if(!name){\n                    $.alert('provide a valid name');\n                    return false;\n                }\n                document.getElementById('name_user').innerHTML = \"USER:\"+name;\n                }\n        }\n    },\n    onContentReady: function () {\n        // bind to events\n        var jc = this;\n        this.$content.find('form').on('submit', function (e) {\n            // if the user submits the form by pressing enter in the field.\n            e.preventDefault();\n            jc.$$formSubmit.trigger('click'); // reference the button and click it\n        });\n    }\n});*/\ndocument.getElementById('name_user').innerHTML = \"UserName\";\n    </script>\n</body>\n</html>\n","x":2370,"y":920,"wires":[["a41a57e.3466da8"]]},{"id":"7c735bdf.833f04","type":"http in","z":"2f633666.5f0b8a","name":"","url":"/formpost","method":"post","upload":false,"swaggerDoc":"","x":2160,"y":880,"wires":[["506d356b.5676cc"]]},{"id":"506d356b.5676cc","type":"function","z":"2f633666.5f0b8a","name":"return msg.payload to client","func":"var obj = msg.payload;\n\nif(obj['topicpost']==='setting_channel_form'){\n    context.global.settingChannels = [] ;\n    var index = '' ;                    \n    var old_index = '' ;\n    var indexation = -1 ;\n    var namechannel = '' ;\n    var oldlid = '';\n    var oldnid = '';\n    \n    for(var key in obj){\n        if(key !== 'topicpost'){\n            var str = key.split(\"_\");\n            index = str[0];\n            if(index != old_index){ indexation = indexation + 1 ; oldlid = '';}\n            old_index = parseInt(str[0]);    \n            if(key === (index + \"_channel\")){namechannel = obj[key];}\n            if(key === (index + \"_devices\")) {\n                context.global.settingChannels[indexation] = {};   \n                context.global.settingChannels[indexation]['id'] = indexation + 1;\n                context.global.settingChannels[indexation]['name'] = namechannel;\n                var obj2 = context.global.ressources[obj[key]] ;\n                for (var key2 in obj2) if(key!=='update')context.global.settingChannels[indexation][''+key2] = obj2[key2];\n                context.global.settingChannels[indexation]['update'] = {} ;\n            }\n            if((key !== (index + \"_channel\")) && (key !== (index + \"_devices\"))){    \n                var balise = str[1];\n                var lid = balise.substr(0,1) ; //a modifier expression régulière\n                var nid = parseInt(balise.substr(1,1)) ; //a modifier expression régulière\n                if (lid !== oldlid) context.global.settingChannels[indexation]['update'][lid] = [] ;\n                oldlid = lid ;\n                context.global.settingChannels[indexation]['update'][lid][nid] = obj[key]; // = obj[key];//settingChannel = name.concat(settingChannel);\n            }\n        }\n    }\n    //msg.payload = context.global.settingChannels;\n    msg.payload = 'The settings channels data was submitted and available';\n    return [msg];\n}","outputs":1,"noerr":0,"x":2400,"y":880,"wires":[["a41a57e.3466da8","ddbfb3a9.b7795","35fee68b.ca8fda"]]},{"id":"59181eea.b3b46","type":"function","z":"2f633666.5f0b8a","name":"get ? set ?","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\"=\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n  // expected output: ReferenceError: nonExistantFunction is not defined\n  // Note - error messages will vary depending on browser\n}\n\nif(order[0] === 'MDA-FINISH') msg.payload = 'MDA-FINISH' ;\nif(order[0] === 'getSettingChannels') msg.payload = context.global.settingChannels;\nif(order[0] === 'getSettingChannels2') msg.payload = context.global.settingChannels;\nif(order[0] === 'listConfigChannel') msg.payload = context.global.listConfigChannel;\nif(order[0] === 'listConfigMda') msg.payload = context.global.listConfigMda;\nif(order[0] === 'updateSettingChannels') msg.payload = context.global.settingChannels;\nif(order[0] === 'getSettingChannels-MDA') msg.payload = context.global.settingChannels;\nif(order[0] === 'getRessources') msg.payload = context.global.ressources;\n\nif(order[0] === 'getMDA-mdazs_zstart_set') msg.payload = \"123\";\n\nif(order[0] === 'setMDATimepointUse') context.global.mda['timepoints']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDATimepointNumber') context.global.mda['timepoints']['number'] = parseInt(order[1]) ;\nif(order[0] === 'setMDATimepointInterval') context.global.mda['timepoints']['interval'] = parseInt(order[1]) ;\nif(order[0] === 'setMDATimepointUnity') context.global.mda['timepoints']['unity'] = (order[1]) ;\n\nif(order[0] === 'setMDAMultiplespositionsUse') context.global.mda['multiplespositions']['use'] = parseInt(order[1]) ;\n\nif(order[0] === 'setMDAZstacksUse') context.global.mda['zstacks']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAZstacksZstart') context.global.mda['zstacks']['zstart'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAZstacksZend') context.global.mda['zstacks']['zend'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAZstacksZstep') context.global.mda['zstacks']['zstep'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAZstacksType') context.global.mda['zstacks']['type'] = (order[1]) ;\nif(order[0] === 'setMDAZstacksShutter') context.global.mda['zstacks']['shutteropen'] = parseInt(order[1]) ;\n\nif(order[0] === 'setMDAAutofocusUse') context.global.mda['autofocus']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAAutofocusSkip') context.global.mda['autofocus']['skip'] = parseInt(order[1]) ;\n\nif(order[0] === 'setMDAChannelsUse') context.global.mda['channels']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDAChannelsConfiguration'){\n    var config = order[1].split(\",\");\n    var id = context.global.mda['channels']['config'].length;\n    context.global.mda['channels']['config'][id] = {} ;\n    context.global.mda['channels']['config'][id]['use'] = parseInt(config[0]);\n    context.global.mda['channels']['config'][id]['exposure'] = parseInt(config[1]);\n    context.global.mda['channels']['config'][id]['zoffset'] = parseInt(config[2]);\n    context.global.mda['channels']['config'][id]['channel'] = (config[3]);\n    context.global.mda['channels']['config'][id]['zstack'] = parseInt(config[4]);\n    context.global.mda['channels']['config'][id]['skipframe'] = parseInt(config[5]);\n    context.global.mda['channels']['config'][id]['refHTML'] = parseInt(config[6]);\n}\n\nif(order[0] === 'setMDAChannelsConfigurationUse'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['use'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationExposure'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['exposure'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationZoffset'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['zoffset'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationChannel'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['channel'] = config[0];\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationZstack'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['zstack'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'setMDAChannelsConfigurationSkipframe'){\n    var config = order[1].split(\",\");\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(config[1])){\n            context.global.mda['channels']['config'][i]['skipframe'] = parseInt(config[0]);\n        }\n    }\n}\nif(order[0] === 'MDAChannelsConfigurationRemove'){\n    for(var i=0;i<context.global.mda['channels']['config'].length;i++){\n        if (parseInt(context.global.mda['channels']['config'][i]['refHTML']) === parseInt(order[1])){\n            context.global.mda['channels']['config'].splice(i, 1);\n        }\n    }\n}\n\n\n\n\n\nif(order[0] === 'setMDASaveimagesUse') context.global.mda['saveimages']['use'] = parseInt(order[1]) ;\nif(order[0] === 'setMDASaveimagesDirectory') context.global.mda['saveimages']['directory'] = (order[1]) ;\nif(order[0] === 'setMDASaveimagesPrefix') context.global.mda['saveimages']['prefix'] = (order[1]) ;\nif(order[0] === 'setMDASaveimagesFormat') context.global.mda['saveimages']['format'] = (order[1]) ;\n\nif(order[0] === 'setMDAAcquisitioncommentComment') context.global.mda['acquisitioncomment'] = (order[1]) ;\n\n\nreturn msg ;\n\n","outputs":1,"noerr":0,"x":2150,"y":820,"wires":[["ddbfb3a9.b7795","ef272d04.5f5c"]]},{"id":"ddbfb3a9.b7795","type":"websocket out","z":"2f633666.5f0b8a","name":"","server":"5ddbe829.05e198","client":"","x":2700,"y":820,"wires":[]},{"id":"adc12a53.1fc9b8","type":"function","z":"2f633666.5f0b8a","name":"Object MDA","func":"context.global.mda = {\n    \"timepoints\": {\n        \"use\" : 0,\n        \"number\" : 1,\n        \"interval\" : 1,\n        \"unity\" : \"ms\"\n    },\n    \"multiplespositions\": {\n        \"use\" : 0,\n        \"param\" : []\n    },\n    \"zstacks\": {\n        \"use\" : 0 ,\n        \"zstart\" : 0,\n        \"zend\" : 10,\n        \"zstep\" : 1,\n        \"type\" : \"relative Z\",\n        \"shutteropen\" : 0\n    },\n    \"autofocus\": {\n        \"use\" : 0,\n        \"skip\" : 0\n    },\n    \"channels\": {\n        \"use\" : 0,\n        \"config\" : []\n    },\n    \"saveimages\": {\n        \"use\" : 0,\n        \"directory\" : \"\",\n        \"prefix\" : \"\",\n        \"format\" : \"separate images files\"\n    },\n    \"acquisitioncomment\" : \"\"\n};\n","outputs":1,"noerr":0,"x":710,"y":120,"wires":[[]]},{"id":"35fee68b.ca8fda","type":"function","z":"2f633666.5f0b8a","name":"save settingChannels","func":"var test = [\n  {\n      \"id\" : 0,\n      \"name\": \"channelA\",\n      \"device\" : \"CoolLed-PE-4000\",\n      \"type\" : \"ligth-source\",\n      \"topic\" : \"fluo1\",\n      \"update\" :{\n          \"A\" : [120,100,true],\n          \"B\" : [200,40,false],\n          \"C\" : [330,80,false],\n          \"D\" : [410,10,false]\n      },\n      \"config\":{\n          \"A\" : [\"<select name='0A0' id='0A0'><option name='0A00' id='0A00' value=100>100</option>          <option name='0A01' id='0A01' value=110>110</option>           <option name='0A02' id='0A02' selected value=120>120</option>   <option name='0A03' id='0A03' value=130>130</option></select>\",          \"<input name='0A1' id='0A1' type='number' min='0' max='100' step='1' value='100'/>\",    \"<input name='0A2'  id='0A2' checked type='checkbox'/>\"],\n          \"B\" : [\"<select name='0B0' id='0B0'><option name='0B00' id='0B00' selected value=200>200</option> <option name='0B01' id='0B01' value=210>210</option>           <option name='0B02' id='0B02' value=220>220</option>            <option name='0B03' id='0B03' value=230>230</option></select>\",          \"<input name='0B1' id='0B1' type='number' min='0' max='100' step='1' value='40'/>\",     \"<input name='0B2'  id='0B2' type='checkbox'/>\"],\n          \"C\" : [\"<select name='0C0' id='0C0'><option name='0C00' id='0C00' value=300>300</option>          <option name='0C01' id='0C01' value=310>310</option>           <option name='0C02' id='0C02' value=320>320</option>            <option name='0C03' id='0C03' selected value=330>330</option></select>\", \"<input name='0C1' id='0C1' type='number' min='0' max='100' step='1' value='80'/>\",     \"<input name='0C2'  id='0C2' type='checkbox'/>\"],\n          \"D\" : [\"<select name='0D0' id='0D0'><option name='0D00' id='0D00' value=400>400</option>          <option name='0D01' id='0D01' selected value=410>410</option>  <option name='0D02' id='tD02' value=420>420</option>            <option name='0D03' id='0D03' value=430>430</option></select>\",          \"<input name='0D1' id='0D1' type='number' min='0' max='100' step='1' value='10'/>\",     \"<input name='0D2'  id='0D2' type='checkbox'/>\"]\n        }\n  }\n ];\nmsg.payload =  test.concat(context.global.settingChannels);\n//msg.payload =  context.global.settingChannels;\nif(context.global.saveConfigChannel !== '' ) msg.filename = context.global.saveConfigChannel;\n\nreturn msg ;\n\n","outputs":1,"noerr":0,"x":2700,"y":880,"wires":[["f3b7acd7.1ca08"]]},{"id":"f3b7acd7.1ca08","type":"file","z":"2f633666.5f0b8a","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","x":2870,"y":880,"wires":[[]]},{"id":"983226bd.5dedc8","type":"file in","z":"2f633666.5f0b8a","name":"","filename":"","format":"utf8","chunk":false,"sendError":false,"x":2270,"y":740,"wires":[["d30ffb71.4179f8","80a28df6.4981c"]]},{"id":"d30ffb71.4179f8","type":"function","z":"2f633666.5f0b8a","name":"parseJSON","func":"msg.payload = JSON.parse(msg.payload);\ncontext.global.settingChannels = msg.payload ;\n//msg.payload = context.global.settingChannels;\nreturn msg;","outputs":1,"noerr":0,"x":2410,"y":740,"wires":[["ddbfb3a9.b7795"]]},{"id":"b73655f8.6024d8","type":"function","z":"2f633666.5f0b8a","name":"load","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\n\nif(order[0] === 'LoadSettingChannelsConfiguration') {\n    context.global.saveConfigChannel = 'C:/Users/labo/.node-red/lib2/config/'+context.global.listConfigChannel[parseInt(order[1])];\n    msg.filename = context.global.saveConfigChannel ;\n    return msg ;\n}\n\n\nif(order[0] === 'LoadSettingMda') {\n    context.global.saveConfigMda = 'C:/Users/labo/.node-red/lib2/mda/'+context.global.listConfigMda[parseInt(order[1])];\n    msg.filename = context.global.saveConfigMda ;\n    return msg ;\n}\n\n\n","outputs":1,"noerr":0,"x":2130,"y":740,"wires":[["983226bd.5dedc8"]]},{"id":"d74e5167.184d6","type":"link out","z":"2f633666.5f0b8a","name":"output_cam","links":["fb3f7b36.935fc8","66fdc750.1163a8"],"x":1355,"y":560,"wires":[]},{"id":"fb3f7b36.935fc8","type":"link in","z":"2f633666.5f0b8a","name":"input_cam","links":["d74e5167.184d6"],"x":535,"y":560,"wires":[["bdd796f8.4062a8","dd4b3010.4c452","7d9ddb59.dc6b44","f5d40759.d17968","eb35d7cf.72f8b8","804222bb.362d4","e9d15400.a1a968","4d541c1b.299ac4","4557a939.b19118","948dd2a4.b3835","144185b9.e543ca"]]},{"id":"4db784c4.3fb99c","type":"function","z":"2f633666.5f0b8a","name":"wait for all devices are initilized","func":"function verifyIsTopicExists(ressources,topic){\n    if(ressources.length !==0){\n        var verify = false ;\n        for(var i=0; i<ressources.length;i++){\n            if(ressources[i]['topic']===topic){ verify = true ; return i;}\n        }\n        if(verify ===false) return (-1);\n    }\n    else return (-1) ;\n}\n\n\nif(msg.mode === 'init'){\n    \n    context.data = context.data || new Object();\n    context.global.ressources = context.global.ressources || [];\n    \n    var verify = verifyIsTopicExists(context.global.ressources,msg.topic) ;\n    \n    switch (msg.topic) {\n        case \"Fluorescence1\":\n            context.data.task1 = msg.device;\n            context.global.Fluorescence1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;\n        case \"MotionStage1\":\n            context.data.task2 = msg.device;\n            context.global.MotionStage1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;\n        case \"Microscope1\":\n            context.data.task3 = msg.device;\n            context.global.Microscope1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;\n        /*case \"Mosaic1\":\n            context.data.task4 = msg.device;\n            context.global.Mosaic1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;*/\n        case \"Camera1\":\n            context.data.task5 = msg.device;\n            context.global.Camera1 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;\n        case \"Fluorescence2\":\n            context.data.task6 = msg.device;\n            context.global.Fluorescence2 = msg.device ;\n            if(verify === -1) context.global.ressources.push(msg);\n            else  context.global.ressources[verify] = msg ;\n            msg = null;\n            break;\n        default:\n            msg = null;\n        \tbreak;\n    \n    }\n    \n    if(context.data.task1 != null && context.data.task2 != null && context.data.task3 != null && context.data.task6 != null ){//&& context.data.task4 != null && context.data.task5 != null && context.data.task6 != null) {\n    \tmsg2 = new Object();\n        msg2 = context.data;\n        msg2.payload = \"Initialisation >>> DONE :-)\";\n        context.global.initialize = true ;\n        context.data=null;\n    \treturn msg2;\n    } else return msg;\n}","outputs":1,"noerr":0,"x":1190,"y":680,"wires":[["144185b9.e543ca"]]},{"id":"76248b81.e239b4","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":840,"wires":[["c92831e5.ad1eb"]]},{"id":"c92831e5.ad1eb","type":"function","z":"2f633666.5f0b8a","name":"live","func":"msg.payload =  context.global.Fluorescence1;\nmsg.topic = 'Fluorescence1';\nmsg.device =  context.global.Fluorescence1;\nmsg.mode = 'live';\nmsg.action = 'setOFF';\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":840,"wires":[["f5d40759.d17968"]]},{"id":"63ecdbba.5c8ff4","type":"function","z":"2f633666.5f0b8a","name":"live","func":"msg.payload =  context.global.MotionStage1;\nmsg.topic = 'MotionStage1';\nmsg.device =  context.global.MotionStage1;\nmsg.mode = 'live';\nmsg.action = 'set';\nmsg.update = {\n    \"xPosition\" : 0,\n    \"yPosition\" : 0,\n    \"moveType\" : \"G\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":740,"wires":[["7d9ddb59.dc6b44"]]},{"id":"cd38f0d0.2b66e","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":740,"wires":[["63ecdbba.5c8ff4"]]},{"id":"9c88d865.1cbfb8","type":"function","z":"2f633666.5f0b8a","name":"live","func":"msg.payload =  context.global.Mosaic1;\nmsg.topic = 'Mosaic1';\nmsg.device =  context.global.Mosaic1;\nmsg.mode = 'live';\nmsg.update = {\n  \"matrice\" : 2324\n}    \nreturn msg;","outputs":1,"noerr":0,"x":2310,"y":180,"wires":[[]]},{"id":"a0bee5e2.7d0c78","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2180,"y":180,"wires":[["9c88d865.1cbfb8"]]},{"id":"f5415392.f99ef","type":"function","z":"2f633666.5f0b8a","name":"live","func":"msg.payload =  context.global.Fluorescence2;\nmsg.topic = 'Fluorescence2';\nmsg.device =  context.global.Fluorescence2;\nmsg.mode = 'live';\nmsg.action = 'set' ;\nmsg.update = {\n  \"shutter\" : true,\n  \"intensity\" : 40\n}    \nreturn msg;","outputs":1,"noerr":0,"x":2310,"y":140,"wires":[[]]},{"id":"b0c60fca.c260e","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2180,"y":140,"wires":[["f5415392.f99ef"]]},{"id":"af7f31d6.411f9","type":"function","z":"2f633666.5f0b8a","name":"live","func":"msg.device = 'PHOTOMETRICS-EVOLV-512';\nmsg.topic = 'Camera1';\nmsg.action = 'GRAB';\nmsg.prefixe = \"prefix\";\nmsg.channel = \"ch\";\nmsg.position = \"pos\";\nmsg.exposure = 10;\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":640,"wires":[["804222bb.362d4"]]},{"id":"e36ab1f9.c3957","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":200,"y":640,"wires":[["af7f31d6.411f9"]]},{"id":"2ea778c6.371638","type":"function","z":"2f633666.5f0b8a","name":"Object sequencer 2","func":"/*context.global.sequence2 = {\n    \"0\" : \n        [\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : context.global.Fluorescence1,\n            'mode' : 'MDA',\n            \"update\" :\n                {\n                \"A\" : [120,100,\"ON\"],\n                \"B\" : [200,100,\"ON\"],\n                \"C\" : [330,100,\"ON\"],\n                \"D\" : [410,100,\"ON\"]\n                }    \n            },\n            {\n            'topic' : 'MotionStage1',\n            'device' : context.global.MotionStage1,\n            'action' : 'set',\n            'mode' : 'MDA',\n            'x': 100,\n            'y': 100,\n            'fonction': 'moveToPositionXY'    \n            }],\n            [{\n                'topic' : 'Camera1',\n                'device' : context.global.Camera1,\n                'mode' : 'MDA',\n                'exposure': 20,\n                'fonction' : 'getFrame'\n            }],\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : context.global.Fluorescence1,\n            'mode' : 'MDA',\n            \"update\" :\n                {\n                \"A\" : [120,100,\"ON\"],\n                \"B\" : [200,100,\"ON\"],\n                \"C\" : [330,100,\"ON\"],\n                \"D\" : [410,100,\"ON\"]\n                }    \n            },\n            {\n            'topic' : 'MotionStage1',\n            'device' : context.global.MotionStage1,\n            'mode' : 'MDA',\n            'action' : 'setAll',\n            'x': 1365,\n            'y': 3420,\n            'fonction': 'moveToPositionXY'    \n            }],\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : context.global.Fluorescence1,\n            'mode' : 'MDA',\n            \"update\" :\n                {\n                \"A\" : [120,100,\"ON\"],\n                \"B\" : [200,100,\"ON\"],\n                \"C\" : [330,100,\"ON\"],\n                \"D\" : [410,100,\"ON\"]\n                }    \n            },\n            {\n            'topic' : 'MotionStage1',\n            'device' : context.global.MotionStage1,\n            'mode' : 'MDA',\n            'action' : 'setAll',\n            'x': 1365,\n            'y': 3420,\n            'fonction': 'moveToPositionXY'    \n            }]\n        ],\n    \"10\" : \n        [\n            [{\n            'topic' : 'Camera1',\n            'device' : context.global.Camera1,\n            'mode' : 'MDA',\n            'exposure': 200,\n            'fonction' : 'getFrame'\n            }],\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : context.global.Fluorescence1,\n            'mode' : 'MDA',\n            \"update\" :\n                {\n                \"A\" : [120,100,\"ON\"],\n                \"B\" : [200,100,\"ON\"],\n                \"C\" : [330,100,\"ON\"],\n                \"D\" : [410,100,\"ON\"]\n                }    \n            },\n            {\n            'topic' : 'MotionStage1',\n            'device' : context.global.MotionStage1,\n            'mode' : 'MDA',\n            'action' : 'setAll',\n            'x': 1365,\n            'y': 3420,\n            'fonction': 'moveToPositionXY'    \n            }]\n        ],\n    \"20\" : \n        [{\n        'topic' : 'MotionStage1',\n        'device' : context.global.MotionStage1,\n        'mode' : 'MDA',\n        'action' : 'setAll',\n        'x': 1365,\n        'y': 3420,\n        'fonction': 'moveToPositionXY'\n        }],\n    \"40\" : \n        [\n            [{\n            'topic' : 'Camera1',\n            'device' : context.global.Camera1,\n            'mode' : 'MDA',\n            'exposure': 20,\n            'fonction' : 'getFrame'\n            }],\n            [{\n            'payload' : 'MDA-FINISH',\n            }]\n        ]\n}*/\n\n\ncontext.global.sequence2 = {\n    \"0\" : \n        [\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : 'CoolLed-PE4000',\n            'mode' : 'MDA',\n            'action' : 'set',\n            \"update\" :\n                {\n                \"A\" : [435,70,true],\n                \"B\" : [470,100,true],\n                \"C\" : [580,100,true],\n                \"D\" : [660,100,true]\n                }    \n            },\n            {\n            'topic' : 'MotionStage1',\n            'device' : 'PRIOR-PRO-SCAN',\n            'action' : 'set',\n            'mode' : 'MDA',\n            'update' : {\n                'xPosition': 10000,\n                'yPosition': 10000,\n                'moveType': 'GR'    \n                }\n            }],\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : 'CoolLed-PE4000',\n            'mode' : 'MDA',\n            'action' : 'set',\n            \"update\" :\n                {\n                \"A\" : [435,100,true],\n                \"B\" : [470,2,false],\n                \"C\" : [580,100,true],\n                \"D\" : [660,2,false]\n                }    \n            }]\n        ],\n    \"10\" : \n        [\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : 'CoolLed-PE4000',\n            'mode' : 'MDA',\n            'action' : 'set',\n            \"update\" :\n                {\n                \"A\" : [435,100,false],\n                \"B\" : [470,100,false],\n                \"C\" : [580,100,false],\n                \"D\" : [660,100,false]\n                }    \n            }\n            ]\n        ],\n    \"20\" : \n        [\n            [{\n            'topic' : 'Fluorescence1',\n            'device' : 'CoolLed-PE4000',\n            'mode' : 'MDA',\n            'action' : 'set',\n            \"update\" :\n                {\n                \"A\" : [435,100,true],\n                \"B\" : [470,100,true],\n                \"C\" : [580,100,true],\n                \"D\" : [660,100,true]\n                }    \n            },\n            {\n            'topic' : 'MotionStage1',\n            'device' : 'PRIOR-PRO-SCAN',\n            'action' : 'set',\n            'mode' : 'MDA',\n            'update' : {\n                'xPosition': 2000,\n                'yPosition': 2000,\n                'moveType': 'GR'    \n                }\n            }]\n        ],\n    \"30\" : \n        [\n            [{\n                'topic' : 'MotionStage1',\n            'device' : 'PRIOR-PRO-SCAN',\n            'action' : 'set',\n            'mode' : 'MDA',\n            'update' : {\n                'xPosition': 0,\n                'yPosition': 0,\n                'moveType': 'G'    \n                }\n            }],\n            [{\n            'payload' : 'MDA-FINISH',\n            }]\n        ]\n    }","outputs":1,"noerr":0,"x":730,"y":80,"wires":[[]]},{"id":"fbf8ea6c.6e9288","type":"function","z":"2f633666.5f0b8a","name":"Sequencer 2 Miss Marple - MDA","func":"    \n    node.status ({fill:\"green\",shape:\"dot\", text: \"request\"});\n    \n    if( (context.global.startMDA === 1) && (context.global.initialize === true)){\n        node.status ({fill:\"yellow\",shape:\"dot\", text: context.global.sync2+\"-\"+context.global.sync3});\n        var lengt = context.global.sequence2[context.global.sync2].length ;\n        if( lengt  !== context.global.sync3 ){\n        \n            var order = context.global.sequence2[context.global.sync2];\n        \n            if(msg.payload === 'done'){\n        //\n        //\n        //\n                context.global.checkFinish = context.global.checkFinish + 1 ;\n        \n                node.status ({fill:\"yellow\",shape:\"dot\", text: context.global.sync2+\"-\"+context.global.sync3+\" - \"+context.global.finish+\"-\"+context.global.checkFinish});\n            \n        \n                if(context.global.checkFinish === context.global.finish){\n                    context.global.checkFinish = 0 ;\n                    if(order[context.global.sync3][0].action !== '_waiting_'){\n                            if(order.length !==1) {\n                            context.global.finish = order[context.global.sync3].length ; // nombre d'instructions dans la branche la plus profonde de l'object sequencer\n                            for(var i=0;i<order[context.global.sync3].length;i++){ node.send(order[context.global.sync3][i]);}\n                            //if(order[context.global.sync3][i]['payload'] === 'MDA-FINISH') node.status ({fill:\"red\",shape:\"dot\", text: \"finished and waiting order ...\"});\n            //                node.warn(\"ZFZ\");\n                        }\n                        else{ \n                            node.send(order[context.global.sync3]) ;\n                            context.global.finish = 1 ;\n            //                node.warn(\"ZZZ\");\n                        }\n                        context.global.sync3 = context.global.sync3 + 1 ;\n                    } else context.global.sync3 = context.global.sync3 + 1 ;\n                } \n            }\n            else{//start mda trigger\n                if(order[context.global.sync3][0].action !== '_waiting_'){\n                    if(order.length !==1) {\n                        context.global.finish = order[context.global.sync3].length ; // nombre d'instructions dans la branche la plus profonde de l'object sequencer\n                        for(var i=0;i<order[context.global.sync3].length;i++){ node.send(order[context.global.sync3][i]);}\n                    }\n                    else { \n                        context.global.finish = 1 ;\n                        node.send(order[context.global.sync3]) ;\n                    }\n                    context.global.sync3 = context.global.sync3 + 1 ;\n                }else context.global.sync3 = context.global.sync3 + 1 ;\n            }\n        }\n    } \n","outputs":1,"noerr":0,"x":1190,"y":560,"wires":[["d74e5167.184d6"]]},{"id":"dd4b3010.4c452","type":"function","z":"2f633666.5f0b8a","name":"start MDA time Order","func":"if(msg.payload === 'MDA-START'){\n    context.global.startMDA = 1 ;\n    context.global.checkFinish = 0 ;\n    global.set('scanTime',0);\n    context.global.sync2 = (0);\n    context.global.sync3 = 0;\n    msg.payload = context.global.sequence2[String(0)];\n    node.send(msg);\n    node.status ({fill:\"green\",shape:\"dot\", text: \"START: timeOrder@0min\"});\n    var mdaSync = setInterval(function(){\n        scanTime = global.get('scanTime') + 1;\n        global.set('scanTime',scanTime);\n        for(var key in context.global.sequence2){\n            if(key===String(scanTime)){\n                context.global.sync2 = key;\n                msg.payload = context.global.sequence2[key];\n                context.global.sync3 = 0;\n                node.send(msg);\n                node.status ({fill:\"green\",shape:\"dot\", text: \"START: timeOrder@\"+scanTime+\"min\"});\n            }\n        }\n    },60000);\n    global.set('mdaSync',mdaSync);\n    \n}\nif(msg.payload === 'MDA-FINISH'){\n    context.global.startMDA = 0 ;\n    node.status ({text: \"waiting start ...\"});\n    clearTimeout(global.get('mdaSync'));\n}","outputs":1,"noerr":0,"x":740,"y":400,"wires":[["fbf8ea6c.6e9288"]]},{"id":"3a996639.1ac4ea","type":"inject","z":"2f633666.5f0b8a","name":"START","topic":"","payload":"MDA-START","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":370,"y":400,"wires":[["dd4b3010.4c452","bdd796f8.4062a8","db93f3cc.7882e"]]},{"id":"1bff1df9.3e7142","type":"websocket in","z":"2f633666.5f0b8a","name":"","server":"5ddbe829.05e198","client":"","x":1870,"y":540,"wires":[["723202a7.36a19c","44355165.cdc2e","eb600583.fc44b8","b73655f8.6024d8","8e4d56a6.632ff8","fda9ac66.aaf5f","ca2987f4.e4c0e8","59181eea.b3b46","80a28df6.4981c","9d44bd9d.10c64","a0bbab16.7d67a8"]]},{"id":"723202a7.36a19c","type":"function","z":"2f633666.5f0b8a","name":"fancyTree switch","func":"context.global.sendDataLive = {} ;\nvar order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\ncontext.global.fancyTreeOrder = order[0] ;\nvar output = {} ;\n\nif(order[0] === 'getValueXYZ'){\n    context.global.sendDataLiveLg = 12 ;\n    output.payload =  context.global.MotionStage1;\n    output.topic = 'MotionStage1';\n    output.device =  context.global.MotionStage1;\n    output.mode = 'live';\n    output.action = 'get';\n    node.send(output);\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'getZPosition';\n    node.send(output);\n}\n\nif(order[0] === 'getValueZ'){\n    context.global.sendDataLiveLg = 10 ;\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'getZPosition';\n    node.send(output);\n}\n\nif(order[0] === 'tryAutoFocus'){\n    context.global.sendDataLiveLg = 13;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'af';\n    output.update = {\n        \"farLimit\" : 1,\n        \"nearLimit\" : 3000000,\n        \"affLimit\": parseInt(order[1])-(100*parseInt(order[2])),\n        \"afnLimit\":parseInt(order[1])+(100*parseInt(order[3])),\n        \"objective\":parseInt(order[4]),\n        \"offset\" : parseInt(order[5])\n    }\n    node.send(output);\n}\n\nif(order[0] === 'moveX'){\n    context.global.sendDataLiveLg = 3 ;\n    output.payload =  context.global.MotionStage1;\n    output.topic = 'MotionStage1';\n    output.device =  context.global.MotionStage1;\n    output.mode = 'live';\n    output.action = 'set';\n    output.update = {} ;\n    output.update = {\n        \"xPosition\" : 0,\n        \"yPosition\" : parseInt(order[2]) * (order[1] ==\"UP\" ? 1 : -1),\n        \"moveType\" : \"GR\"\n    } ;\n    node.send(output);\n}\n\nif(order[0] === 'moveY'){\n    context.global.sendDataLiveLg = 3 ;\n    output.payload =  context.global.MotionStage1;\n    output.topic = 'MotionStage1';\n    output.device =  context.global.MotionStage1;\n    output.mode = 'live';\n    output.action = 'set';\n    output.update = {} ;\n    output.update = {\n        \"xPosition\" : parseInt(order[2]) * (order[1] ==\"RG\" ? 1 : -1)  ,\n        \"yPosition\" : 0,\n        \"moveType\" : \"GR\"\n    } ;\n    node.send(output);\n}\n\nif(order[0] === 'moveZ'){\n    //context.global.sendDataLiveLg = 9 ;\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'setZPosition';\n    output.update = {\n        \"zPosition\" : parseInt(order[2]),\n        \"moveType\": order[1]\n    };\n    node.send(output);\n}\n\nif(order[0] === 'goToPosition'){\n    //context.global.sendDataLiveLg = 3 ;\n    output.payload =  context.global.MotionStage1;\n    output.topic = 'MotionStage1';\n    output.device =  context.global.MotionStage1;\n    output.mode = 'live';\n    output.action = 'set';\n    output.update = {} ;\n    output.update = {\n        \"xPosition\" : parseInt(order[1]),\n        \"yPosition\" : parseInt(order[2]),\n        \"moveType\" : \"G\"\n    } ;\n    node.send(output);\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'setZPosition';\n    output.update = {\n        \"zPosition\" : parseInt(order[3]),\n        \"moveType\": \"d\"\n    };\n    node.send(output);\n}\n\nif(order[0] === 'posLigth'){\n  setTimeout(function(){\n    var olympus = false ;\n    var coolled = false ;\n    var xcite = false ;\n\n\n        if(order[1] === -1 ){\n            output = {} ;\n            output.payload =  context.global.Fluorescence1;\n            output.topic = 'Fluorescence1';\n            output.device =  context.global.Fluorescence1;\n            output.mode = 'live';\n            output.action = 'setOFF';\n            node.send(output);\n            output = {} ;\n            output.payload =  context.global.Microscope1;\n            output.topic = 'Microscope1';\n            output.device =  context.global.Microscope1;\n            output.mode = 'live';\n            output.action = 'setOFF';\n            node.send(output);\n            output = {} ;\n            output.payload =  context.global.Fluorescence2;\n            output.topic = 'Fluorescence2';\n            output.device =  context.global.Fluorescence2;\n            output.mode = 'live';\n            output.action = 'setOFF';\n            node.send(output);\n            \n        }else {\n        for(var i=1 ; i<context.global.settingChannels.length; i++){\n           \n            \n            if(i === parseInt(order[1])){\n                node.warn(i+\",\"+parseInt(order[1]));\n                if((context.global.settingChannels[i]['device'] === 'OLYMPUS-IX-81')){\n                    olympus = true ;\n                    output = {} ;\n                    output.payload =  context.global.Microscope1;\n                    output.topic = 'Microscope1';\n                    output.device =  context.global.Microscope1;\n                    output.mode = 'live';\n                    output.action = 'setChannel';\n                    output.update = {\n                        \"lamp\" : context.global.settingChannels[i]['update']['A'][0] == \"OFF\" ? false : true ,\n                        \"intensity\": parseFloat(context.global.settingChannels[i]['update']['A'][1]) ,\n                        \"shutter\":context.global.settingChannels[i]['update']['A'][2] == \"OFF\" ? false : true ,\n                        \"timeout\" : -1\n                        };\n                    node.send(output);\n                }\n                \n                if((context.global.settingChannels[i]['device'] === 'CoolLed-PE4000')){\n                    coolled = true ;\n                    output = {} ;\n                    output.payload =  context.global.Fluorescence1;\n                    output.topic = 'Fluorescence1';\n                    output.device =  context.global.Fluorescence1;\n                    output.mode = 'live';\n                    output.action = 'set';\n                    output.update = {\n                        \"A\" : [context.global.settingChannels[i]['update']['A'][0],context.global.settingChannels[i]['update']['A'][1],context.global.settingChannels[i]['update']['A'][2] == \"OFF\" ? false : true] ,\n                        \"B\" : [context.global.settingChannels[i]['update']['B'][0],context.global.settingChannels[i]['update']['B'][1],context.global.settingChannels[i]['update']['B'][2] == \"OFF\" ? false : true] ,\n                        \"C\" : [context.global.settingChannels[i]['update']['C'][0],context.global.settingChannels[i]['update']['C'][1],context.global.settingChannels[i]['update']['C'][2] == \"OFF\" ? false : true] ,\n                        \"D\" : [context.global.settingChannels[i]['update']['D'][0],context.global.settingChannels[i]['update']['D'][1],context.global.settingChannels[i]['update']['D'][2] == \"OFF\" ? false : true] ,\n                        \"timeout\" : -1\n                    };\n                    node.send(output);\n                }\n                if((context.global.settingChannels[i]['device'] === 'X-Cite-120PC')){\n                    xcite = true ;\n                    output = {} ;\n                    output.payload =  context.global.Fluorescence2;\n                    output.topic = 'Fluorescence2';\n                    output.device =  context.global.Fluorescence2;\n                    output.mode = 'live';\n                    output.action = 'setChannel';\n                    output.update = {\n                        \"A\" : [context.global.settingChannels[i]['update']['A'][0],context.global.settingChannels[i]['update']['A'][1] == \"OFF\" ? false : true]\n                    };\n                    node.send(output);\n                }\n            }\n            else {\n                if((context.global.settingChannels[i]['device'] === 'CoolLed-PE4000')&&(coolled === false)){\n                    //coolled = true ;\n                    output = {} ;\n                    output.payload =  context.global.Fluorescence1;\n                    output.topic = 'Fluorescence1';\n                    output.device =  context.global.Fluorescence1;\n                    output.mode = 'live';\n                    output.action = 'setOFF';\n                    node.send(output);\n                }\n                if((context.global.settingChannels[i]['device'] === 'OLYMPUS-IX-81')&&(olympus === false)){\n                    //olympus = true ;\n                    output = {} ;\n                    output.payload =  context.global.Microscope1;\n                    output.topic = 'Microscope1';\n                    output.device =  context.global.Microscope1;\n                    output.mode = 'live';\n                    output.action = 'setOFF';\n                    node.send(output);\n                }\n                if((context.global.settingChannels[i]['device'] === 'X-Cite-120PC')&&(xcite === false)){\n                    //olympus = true ;\n                    output = {} ;\n                    output.payload =  context.global.Fluorescence2;\n                    output.topic = 'Fluorescence2';\n                    output.device =  context.global.Fluorescence2;\n                    output.mode = 'live';\n                    output.action = 'setOFF';\n                    node.send(output);\n                }\n                \n            }\n        }}\n    },500);\n}\n\nif(order[0] === 'EnlightenedOFF'){\n    output = {} ;\n    output.payload =  context.global.Fluorescence1;\n    output.topic = 'Fluorescence1';\n    output.device =  context.global.Fluorescence1;\n    output.mode = 'live';\n    output.action = 'setOFF';\n    node.send(output);\n    \n     output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'setOFF';\n    node.send(output);\n    \n         output = {} ;\n    output.payload =  context.global.Fluorescence2;\n    output.topic = 'Fluorescence2';\n    output.device =  context.global.Fluorescence2;\n    output.mode = 'live';\n    output.action = 'setOFF';\n    node.send(output);\n    \n}\n\nif(order[0] === 'updatefilter'){\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'setWheelFilter';\n    output.update = {\n        \"wheelFilter\" : order[1]\n    }\n    node.send(output);\n}\nif(order[0] === 'getAutofocus'){\n    context.global.sendDataLiveLg = 10 ;\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'get';\n    node.send(output);\n}\nif(order[0] === 'posWheel'){\n    output = {} ;\n    output.payload =  context.global.Microscope1;\n    output.topic = 'Microscope1';\n    output.device =  context.global.Microscope1;\n    output.mode = 'live';\n    output.action = 'setWheelFilter';\n    output.update = {'wheelFilter' : parseInt(order[1])};\n    node.send(output);\n}\n\n","outputs":1,"noerr":0,"x":2170,"y":540,"wires":[["ace6e674.f50c88","38196947.362266"]]},{"id":"fed3932e.3e9d8","type":"websocket out","z":"2f633666.5f0b8a","name":"","server":"5ddbe829.05e198","client":"","x":1340,"y":840,"wires":[]},{"id":"86e450a.16b74b","type":"function","z":"2f633666.5f0b8a","name":"if mode === live","func":"\n    if(msg.mode === 'live'){\n\n        if((context.global.fancyTreeOrder === 'getValueXYZ')||(context.global.fancyTreeOrder === 'getValueZ')||(context.global.fancyTreeOrder === 'tryAutoFocus')||(context.global.fancyTreeOrder === 'getAutofocus')){\n        \n            if(msg.topic === 'Microscope1') {\n                for(var key in msg.update['A']){\n                    context.global.sendDataLive[key] = msg.update['A'][key];\n                }\n                if(context.global.fancyTreeOrder === 'tryAutoFocus'){\n                    for(var key in msg.status){\n                    context.global.sendDataLive[key] = msg.status[key];\n                     }\n                }\n            }\n            else{\n                for(var key in msg.update){\n                    context.global.sendDataLive[key] = msg.update[key];\n                }\n            }\n                //var msg={};\n            node.warn(Object.keys(context.global.sendDataLive).length);\n            //msg.payload = context.global.fancyTreeOrder+\"-\"+context.global.sendDataLiveLg+\"-\"+Object.keys(context.global.sendDataLive).length;\n            node.send(msg);\n            if(Object.keys(context.global.sendDataLive).length === context.global.sendDataLiveLg){\n                var msg = {};\n                msg.payload = context.global.sendDataLive ;\n                node.send(msg);\n                context.global.sendDataLive = {} ;\n                context.global.fancyTreeOrder = \"\";\n            } \n        }\n    }","outputs":1,"noerr":0,"x":1140,"y":840,"wires":[["fed3932e.3e9d8"]]},{"id":"44355165.cdc2e","type":"function","z":"2f633666.5f0b8a","name":"create config channel","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\nvar output = {} ;\nif(order[0] === 'configChannels'){\n    context.global.saveConfigChannel = 'C:/Users/labo/.node-red/lib2/config/'+order[1]+\".json\" ;\n    output.filename =  context.global.saveConfigChannel;\n    output.payload =  \"create\";\n    context.global.listConfigChannel.push(order[1]+\".json\");\n    node.send(output);\n}","outputs":1,"noerr":0,"x":2180,"y":580,"wires":[["906e28b.b29acd8"]]},{"id":"906e28b.b29acd8","type":"file","z":"2f633666.5f0b8a","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","x":2650,"y":580,"wires":[[]]},{"id":"39cc38ea.c58ef8","type":"file in","z":"2f633666.5f0b8a","name":"","filename":"C:\\Users\\labo\\.node-red\\lib2\\config\\list.txt","format":"utf8","chunk":false,"sendError":false,"x":800,"y":160,"wires":[["135ffa48.171096"]]},{"id":"135ffa48.171096","type":"function","z":"2f633666.5f0b8a","name":"Initialisation","func":"context.global.listConfigChannel = msg.payload.split(\";\");\n//context.global.initialize = false ;\n//context.global.ressources = [] ;\n\n//context.global.test = [];\n","outputs":1,"noerr":0,"x":1190,"y":160,"wires":[[]]},{"id":"eb600583.fc44b8","type":"function","z":"2f633666.5f0b8a","name":"extend config channel","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\nvar output = {} ;\nif(order[0] === 'configChannels'){\n    output.payload = \";\"+order[1]+\".json\";\n    node.send(output);\n}","outputs":1,"noerr":0,"x":2180,"y":620,"wires":[["7dd6510c.55cf8","ace6e674.f50c88"]]},{"id":"7dd6510c.55cf8","type":"file","z":"2f633666.5f0b8a","name":"","filename":"C:\\Users\\labo\\.node-red\\lib2\\config\\list.txt","appendNewline":false,"createDir":true,"overwriteFile":"false","x":2540,"y":620,"wires":[[]]},{"id":"ace6e674.f50c88","type":"debug","z":"2f633666.5f0b8a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2650,"y":540,"wires":[]},{"id":"7d9ddb59.dc6b44","type":"PriorProScan","z":"2f633666.5f0b8a","name":"","x":730,"y":740,"wires":[["fbf8ea6c.6e9288","4db784c4.3fb99c","86e450a.16b74b"]]},{"id":"d3747004.4ad6a","type":"function","z":"2f633666.5f0b8a","name":"live","func":"msg.payload =  context.global.Fluorescence2;\nmsg.topic = 'Fluorescence2';\nmsg.device =  context.global.Fluorescence2;\nmsg.mode = 'live';\nmsg.action = 'set' ;\nmsg.update = {\n  \"shutter\" : false,\n  \"intensity\" : 40\n}    \nreturn msg;","outputs":1,"noerr":0,"x":2310,"y":100,"wires":[[]]},{"id":"83da945a.e2f5e8","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2180,"y":100,"wires":[["d3747004.4ad6a"]]},{"id":"daed1914.acbd58","type":"json","z":"2f633666.5f0b8a","name":"","property":"payload","action":"","pretty":false,"x":2270,"y":780,"wires":[["65aab7f4.902298"]]},{"id":"f5d40759.d17968","type":"CoolLedPe4000","z":"2f633666.5f0b8a","name":"PE4000","topic":"drive the PE-4000","x":720,"y":840,"wires":[["fbf8ea6c.6e9288","4db784c4.3fb99c","86e450a.16b74b"]]},{"id":"f94ec1ac.f641c","type":"function","z":"2f633666.5f0b8a","name":"Camera rec.","func":"if(msg.payload !== 'STOP'){\n    data = msg.payload ;\n    var msg = {};\n    msg.topic = 'Camera1'\n    msg.payload = \"done\";\n    msg.action = 'GRAB';\n    msg.device = 'PHOTOMETRICS-EVOLV-512';\n    msg.update = {'name' : data};\n    msg.status = {\"SUCCESS\" : Date.now()};\n    node.send(msg);\n}\n","outputs":1,"noerr":0,"x":730,"y":600,"wires":[["fbf8ea6c.6e9288","1b91bfae.4f986"]],"icon":"node-red/camera.png"},{"id":"eb35d7cf.72f8b8","type":"OlympusIx81","z":"2f633666.5f0b8a","name":"","x":710,"y":1100,"wires":[["86e450a.16b74b","4db784c4.3fb99c","fbf8ea6c.6e9288","a0cf872b.f8f8a8","144185b9.e543ca"]]},{"id":"c615a3a9.1763f","type":"function","z":"2f633666.5f0b8a","name":"filter 3","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\n//msg.action = 'setChannel';\nmsg.action = 'setWheelFilter';\n/*msg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 5000\n}*/\nmsg.update = {\n    \"wheelFilter\" : 3\n}\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":1060,"wires":[["eb35d7cf.72f8b8"]]},{"id":"70e80cbc.1ff4e4","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":1060,"wires":[["c615a3a9.1763f"]]},{"id":"2cf53b34.e4a944","type":"file in","z":"2f633666.5f0b8a","name":"","filename":"C:\\Users\\labo\\.node-red\\lib2\\mda\\list.txt","format":"utf8","chunk":false,"sendError":false,"x":800,"y":200,"wires":[["f040bd58.cb08e"]]},{"id":"f040bd58.cb08e","type":"function","z":"2f633666.5f0b8a","name":"Initialisation","func":"context.global.listConfigMda = msg.payload.split(\";\");\n//context.global.initialize = false ;\n//context.global.ressources = [] ;\n\n//context.global.test = [];\n","outputs":1,"noerr":0,"x":1130,"y":200,"wires":[[]]},{"id":"8e4d56a6.632ff8","type":"function","z":"2f633666.5f0b8a","name":"save config mda","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\";\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\nvar output = {} ;\nif(order[0] === 'saveMDA'){\n    if(order[1] ===''){\n        output.filename = context.global.saveConfigMda;\n    }\n    else {\n        context.global.saveConfigMda = 'C:/Users/labo/.node-red/lib2/mda/'+order[1]+'.json';\n        output.filename = context.global.saveConfigMda ;\n        context.global.listConfigMda.push(order[1]+\".json\");\n    }\n    output.payload =  order[2];\n    node.send(output);\n}","outputs":1,"noerr":0,"x":2160,"y":660,"wires":[["40b0d27e.395c6c"]]},{"id":"40b0d27e.395c6c","type":"file","z":"2f633666.5f0b8a","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","x":2650,"y":660,"wires":[[]]},{"id":"fda9ac66.aaf5f","type":"function","z":"2f633666.5f0b8a","name":"extend config channel","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\";\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\nvar output = {} ;\nif((order[0] === 'saveMDA')&&(order[1]!=='')){\n    output.payload = \";\"+order[1]+\".json\";\n    node.send(output);\n}","outputs":1,"noerr":0,"x":2180,"y":700,"wires":[["90a9f65b.d103e8"]]},{"id":"90a9f65b.d103e8","type":"file","z":"2f633666.5f0b8a","name":"","filename":"C:\\Users\\labo\\.node-red\\lib2\\mda\\list.txt","appendNewline":false,"createDir":true,"overwriteFile":"false","x":2540,"y":700,"wires":[[]]},{"id":"ef272d04.5f5c","type":"link out","z":"2f633666.5f0b8a","name":"MDA-FINISH","links":["3bffbe89.a6b492"],"x":2255,"y":820,"wires":[]},{"id":"3bffbe89.a6b492","type":"link in","z":"2f633666.5f0b8a","name":"","links":["ef272d04.5f5c"],"x":395,"y":240,"wires":[["dd4b3010.4c452","bdd796f8.4062a8","e3dcf6c.873d308"]]},{"id":"d5d26e02.3f5d6","type":"delay","z":"2f633666.5f0b8a","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":360,"y":360,"wires":[["dd4b3010.4c452","bdd796f8.4062a8","db93f3cc.7882e"]]},{"id":"c7ee8b76.5a69e8","type":"link out","z":"2f633666.5f0b8a","name":"MDA-START","links":["f79061b9.c43c8"],"x":2615,"y":780,"wires":[]},{"id":"f79061b9.c43c8","type":"link in","z":"2f633666.5f0b8a","name":"","links":["c7ee8b76.5a69e8"],"x":175,"y":300,"wires":[["d5d26e02.3f5d6","fa4982c0.5b27e"]]},{"id":"ca2987f4.e4c0e8","type":"function","z":"2f633666.5f0b8a","name":"filter tree","func":"if(msg.payload.substr(0,11) === '{\"expanded\"')return msg;","outputs":1,"noerr":0,"x":2140,"y":780,"wires":[["daed1914.acbd58"]]},{"id":"db93f3cc.7882e","type":"pythonshell in","z":"2f633666.5f0b8a","pyfile":"C:\\Users\\labo\\customizeNode\\node-red-contrib-photometrics-evolv-512\\PhotometricsEvolv512\\test2.py","x":720,"y":360,"wires":[["8feea057.c0fee"]],"icon":"node-red/camera.png"},{"id":"bac8835.223d38","type":"websocket in","z":"2f633666.5f0b8a","name":"","server":"5c3438cf.719e38","client":"","x":280,"y":600,"wires":[["f94ec1ac.f641c","8feea057.c0fee"]]},{"id":"c688c42d.a926c8","type":"websocket out","z":"2f633666.5f0b8a","name":"","server":"5ddbe829.05e198","client":"","x":1340,"y":600,"wires":[]},{"id":"1b91bfae.4f986","type":"function","z":"2f633666.5f0b8a","name":"name GRAB","func":"if(msg.payload !== 'STOP'){\n    msg.payload = msg.update.name;\n    node.send(msg);\n}\n","outputs":1,"noerr":0,"x":1130,"y":600,"wires":[["c688c42d.a926c8"]]},{"id":"804222bb.362d4","type":"function","z":"2f633666.5f0b8a","name":"Camera sd.","func":"if(msg.device === 'PHOTOMETRICS-EVOLV-512'){\n    if(msg.action === 'GRAB'){\n    msg.payload = \"GRAB,\"+msg.prefixe+','+msg.position+','+msg.channel+','+Date.now()+','+msg.exposure;\n    node.send(msg);\n    }\n}\n","outputs":1,"noerr":0,"x":730,"y":640,"wires":[["487f01a8.1123f"]],"icon":"node-red/camera.png"},{"id":"487f01a8.1123f","type":"websocket out","z":"2f633666.5f0b8a","name":"","server":"bbb8a174.f32a4","client":"","x":1170,"y":640,"wires":[]},{"id":"144185b9.e543ca","type":"debug","z":"2f633666.5f0b8a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1470,"y":460,"wires":[]},{"id":"5180081c.2bc428","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2180,"y":60,"wires":[["d21bdb2f.e2cd18"]]},{"id":"d21bdb2f.e2cd18","type":"function","z":"2f633666.5f0b8a","name":"","func":"msg.payload = context.global.sequence2;\nreturn msg;","outputs":1,"noerr":0,"x":2310,"y":60,"wires":[["d46b8cb0.0bd13"]]},{"id":"d46b8cb0.0bd13","type":"debug","z":"2f633666.5f0b8a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2650,"y":60,"wires":[]},{"id":"2bc2ac5c.3a2ef4","type":"PhotometricsEvolv512","z":"2f633666.5f0b8a","name":"","x":730,"y":680,"wires":[["4db784c4.3fb99c"]]},{"id":"ae1fe6a3.bf5328","type":"function","z":"2f633666.5f0b8a","name":"filter 2","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\n//msg.action = 'setChannel';\nmsg.action = 'setWheelFilter';\n/*msg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 5000\n}*/\nmsg.update = {\n    \"wheelFilter\" : 2\n}\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":1100,"wires":[["eb35d7cf.72f8b8"]]},{"id":"ffd9faf4.0a0b98","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":1100,"wires":[["ae1fe6a3.bf5328"]]},{"id":"6a0de278.2da00c","type":"function","z":"2f633666.5f0b8a","name":"filter 1","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\n//msg.action = 'setChannel';\nmsg.action = 'setWheelFilter';\n/*msg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 5000\n}*/\nmsg.update = {\n    \"wheelFilter\" : 1\n}\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":1140,"wires":[["eb35d7cf.72f8b8"]]},{"id":"f738d6c5.e1d088","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":1140,"wires":[["6a0de278.2da00c"]]},{"id":"793c77c8.98df38","type":"function","z":"2f633666.5f0b8a","name":"filter 6","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\n//msg.action = 'setChannel';\nmsg.action = 'setWheelFilter';\n/*msg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 5000\n}*/\nmsg.update = {\n    \"wheelFilter\" : 6\n}\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":940,"wires":[["eb35d7cf.72f8b8"]]},{"id":"717fe5ff.8487ec","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":940,"wires":[["793c77c8.98df38"]]},{"id":"251fe65b.93c0ba","type":"function","z":"2f633666.5f0b8a","name":"filter 5","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\n//msg.action = 'setChannel';\nmsg.action = 'setWheelFilter';\n/*msg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 5000\n}*/\nmsg.update = {\n    \"wheelFilter\" : 5\n}\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":980,"wires":[["eb35d7cf.72f8b8"]]},{"id":"839bc1b0.7434a","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":980,"wires":[["251fe65b.93c0ba"]]},{"id":"3452b126.7938ae","type":"function","z":"2f633666.5f0b8a","name":"filter 4","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\n//msg.action = 'setChannel';\nmsg.action = 'setWheelFilter';\n/*msg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 5000\n}*/\nmsg.update = {\n    \"wheelFilter\" : 4\n}\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":1020,"wires":[["eb35d7cf.72f8b8"]]},{"id":"af7c8831.bbca18","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":1020,"wires":[["3452b126.7938ae"]]},{"id":"38196947.362266","type":"link out","z":"2f633666.5f0b8a","name":"fancyTree","links":["425ecbab.3463f4"],"x":2315,"y":500,"wires":[]},{"id":"425ecbab.3463f4","type":"link in","z":"2f633666.5f0b8a","name":"","links":["38196947.362266"],"x":515,"y":1260,"wires":[["804222bb.362d4","7d9ddb59.dc6b44","f5d40759.d17968","eb35d7cf.72f8b8","4d541c1b.299ac4","1bd5d7ac.d30148","144185b9.e543ca"]]},{"id":"80a28df6.4981c","type":"debug","z":"2f633666.5f0b8a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2130,"y":500,"wires":[]},{"id":"80ec596.ddb65a8","type":"function","z":"2f633666.5f0b8a","name":"timeout","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\nmsg.action = 'setChannel';\n//msg.action = 'setWheelFilter';\nmsg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 1000,\n    'keep' : false\n}\n/*msg.update = {\n    \"wheelFilter\" : 6\n}*/\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":1180,"wires":[["eb35d7cf.72f8b8"]]},{"id":"11da6933.daef97","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":1180,"wires":[["80ec596.ddb65a8"]]},{"id":"42c9f8b6.f7e7f8","type":"pythonshell in","z":"2f633666.5f0b8a","pyfile":"C:\\Users\\labo\\customizeNode\\node-red-contrib-photometrics-evolv-512\\PhotometricsEvolv512\\app.py","x":740,"y":240,"wires":[[]],"icon":"node-red/camera.png"},{"id":"9d44bd9d.10c64","type":"function","z":"2f633666.5f0b8a","name":"MODIF1","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\n\n    \nif((order[0] === 'posLigth')&&(order.length === 5)){\n    \n    if (!isNaN(parseInt(order[4])))\n        context.global.settingChannels[parseInt(order[1])]['update'][order[2]][parseInt(order[3])] = parseInt(order[4]) ;\n    else \n        context.global.settingChannels[parseInt(order[1])]['update'][order[2]][parseInt(order[3])] = (order[4]) ;\n    msg.payload =  context.global.settingChannels;\n    if(context.global.saveConfigChannel !== '' ) msg.filename = context.global.saveConfigChannel;\n    myObject = context.global.settingChannels[parseInt(order[1])]['update'];\n    lettrine = String.fromCharCode(64+Object.keys(myObject).length);\n    msg.topic = 'mappingcolor'+context.global.settingChannels[parseInt(order[1])]['update'][lettrine][0] ;\n    msg.topic = msg.topic.replace('#','');\n    return msg ;\n}\nif((order[0] === 'posLigth')&&(parseInt(order[1])!==-1)&&(order.length===2)){\n    msg.payload =  context.global.settingChannels;\n    if(context.global.saveConfigChannel !== '' ) msg.filename = context.global.saveConfigChannel;\n    myObject = context.global.settingChannels[parseInt(order[1])]['update'];\n    lettrine = String.fromCharCode(64+Object.keys(myObject).length);\n    msg.topic = 'mappingcolor'+context.global.settingChannels[parseInt(order[1])]['update'][lettrine][0] ;\n    msg.topic = msg.topic.replace('#','');\n    return msg ;\n}\nif((order[0] === 'posLigth')&&(parseInt(order[1])===-1)){\n    msg.payload =  context.global.settingChannels;\n    if(context.global.saveConfigChannel !== '' ) msg.filename = context.global.saveConfigChannel;\n    msg.topic = 'mappingcolor808080' ;\n    return msg ;\n}","outputs":1,"noerr":0,"x":2140,"y":420,"wires":[["b6f012d3.43802","3ad8dc59.ec0444","ace6e674.f50c88"]]},{"id":"b6f012d3.43802","type":"http request","z":"2f633666.5f0b8a","name":"","method":"GET","ret":"txt","url":"http://172.27.0.183:5000/{{{topic}}}","tls":"","x":2330,"y":440,"wires":[[]]},{"id":"a0bbab16.7d67a8","type":"function","z":"2f633666.5f0b8a","name":"MODIF1","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\n\n    \nif((order[0] === 'posInvert')){\n    msg.payload =  \"\";\n    msg.topic = 'invert'+ order[1] ;\n    return msg ;\n}\nif((order[0] === 'posExposure')){\n    msg.payload =  \"\";\n    msg.topic = 'exposure'+ parseInt(order[1]) ;\n    return msg ;\n}\nif((order[0] === 'posMap')){\n    msg.payload =  \"\";\n    msg.topic = 'map'+ (order[1]) ;\n    return msg ;\n}\nif((order[0] === 'mappingcolor')){\n    msg.payload =  \"\";\n    msg.topic = 'mappingcolor'+ (order[1]) ;\n    return msg ;\n}","outputs":1,"noerr":0,"x":2140,"y":460,"wires":[["b6f012d3.43802"]]},{"id":"3ad8dc59.ec0444","type":"file","z":"2f633666.5f0b8a","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","x":2310,"y":420,"wires":[[]]},{"id":"fa4982c0.5b27e","type":"function","z":"2f633666.5f0b8a","name":"stop live","func":"msg.payload =  'quit';\nmsg.topic   = 'quit';\nreturn msg ;","outputs":1,"noerr":0,"x":360,"y":300,"wires":[["64c5a349.44759c"]]},{"id":"64c5a349.44759c","type":"http request","z":"2f633666.5f0b8a","name":"","method":"GET","ret":"txt","url":"http://127.0.0.1:5000/{{{topic}}}","tls":"","x":710,"y":300,"wires":[[]]},{"id":"b57a4a58.36ceb8","type":"function","z":"2f633666.5f0b8a","name":"timeout","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\nmsg.action = 'setChannel';\n//msg.action = 'setWheelFilter';\nmsg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 1000,\n    'keep' : true\n}\n/*msg.update = {\n    \"wheelFilter\" : 6\n}*/\nreturn msg;","outputs":1,"noerr":0,"x":280,"y":1220,"wires":[["eb35d7cf.72f8b8"]]},{"id":"aaaecaf6.77e768","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":1220,"wires":[["b57a4a58.36ceb8"]]},{"id":"e98ba1ec.d4d17","type":"function","z":"2f633666.5f0b8a","name":"timeout","func":"msg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\nmsg.action = 'setZposition';\n//msg.action = 'setWheelFilter';\nmsg.update = {\n    \"zPostion\" : 786400,\n    'moveType' : 'd'\n}\n/*msg.update = {\n    \"wheelFilter\" : 6\n}*/\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":1260,"wires":[["eb35d7cf.72f8b8"]]},{"id":"849ef78f.f2db78","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":1260,"wires":[["e98ba1ec.d4d17"]]},{"id":"a24adf9f.1d33c","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":800,"wires":[["2b99f61b.70009a"]]},{"id":"2b99f61b.70009a","type":"function","z":"2f633666.5f0b8a","name":"live","func":"msg.payload =  context.global.Fluorescence1;\nmsg.topic = 'Fluorescence1';\nmsg.device =  context.global.Fluorescence1;\nmsg.mode = 'live';\nmsg.action = 'setChannel';\nmsg.update = {\n  \"A\" : [385,10,false],\n  \"B\" : [490,100,true],\n  \"C\" : [580,45,false],\n  \"D\" : [740,100,false],\n  'timeout' : -1,\n  'keep' : false\n}    \nreturn msg;","outputs":1,"noerr":0,"x":310,"y":800,"wires":[["f5d40759.d17968"]]},{"id":"badb3866.55cec8","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":880,"wires":[["25100569.7ff72a"]]},{"id":"25100569.7ff72a","type":"function","z":"2f633666.5f0b8a","name":"live","func":"msg.payload =  context.global.Fluorescence1;\nmsg.topic = 'Fluorescence1';\nmsg.device =  context.global.Fluorescence1;\nmsg.mode = 'live';\nmsg.action = 'setChannel';\nmsg.update = {\n  \"A\" : [385,10,true],\n  \"B\" : [490,100,true],\n  \"C\" : [580,45,false],\n  \"D\" : [740,100,true],\n  'timeout' : 5000,\n  'keep' : true\n}    \nreturn msg;","outputs":1,"noerr":0,"x":310,"y":880,"wires":[["f5d40759.d17968"]]},{"id":"bc215c48.183be","type":"function","z":"2f633666.5f0b8a","name":"protocole N","func":"var mda = msg.payload ;\nvar output = {} ;\n\ntry {\n    if(mda['type'] === 'mda'){\n        if(mda.children[0].data.algo === 'algo1'){\n            output = algo1(mda);\n        }\n        msg.payload = \"MDA-START\" ;\n        context.global.sequence2 = output ;\n        return msg;   \n    }\n   \n}\ncatch(error){}\n\nfunction algo1(mda){\n    var test = {} ;\n    var inject = [] ;           \n    /*inject.push({\n        'payload' :  context.global.Fluorescence1,\n        'topic' : 'Fluorescence1',\n        'device' :  context.global.Fluorescence1,\n        'mode' : 'mda',\n        'action' : 'setOFF'\n    });\n    inject.push({\n        'payload' :  context.global.Microscope1,\n        'topic' : 'Microscope1',\n        'device' :  context.global.Microscope1,\n        'mode' : 'mda',\n        'action' : 'setOFF'\n    });\n    test[String(0)].push(inject);\n    inject = [] ;\n    inject.push({\n        'topic' : 'Microscope1',\n        'device' : context.global.Microscope1,\n        'action' : 'setChannel',\n        'mode' : 'MDA',\n        'update' : {\n            'lamp' : true,\n            'intensity': parseInt(context.global.settingChannels[l].update.A[1]),\n            'shutter': false,\n            'timeout' : -1\n        } \n    });\n    test[String(0)].push(inject);*/\n    //repeat sequence\n        for(var i=0; i<parseInt(mda.children[0].children[0].data.repeat);i++){\n            test[String(i*parseInt(mda.children[0].children[0].data.time))] = [] ;\n            //position\n            for(var ii=0; ii<mda.children[0].children[0].children.length;ii++){\n                \n                if(mda.children[0].children[0].children[ii].children[iii].type === 'ZS'){\n                    var zstart = parseInt(mda.children[0].children[0].children[ii].children[iii].data.zstart);\n                    var zend = parseInt(mda.children[0].children[0].children[ii].children[iii].data.zend);\n                    var zstep = parseInt(mda.children[0].children[0].children[ii].children[iii].data.zstep);\n                    var inc = zstart - zend ;\n                    if (inc<0) inc = inc * (-1) ;\n                    var stepping =  (inc / zstep) ;\n                    var zPosition = parseInt(mda.children[0].children[0].children[ii].data.zPosition);\n                }    \n                \n                var limit = 1 ;\n                for(var r=0;r<limit;r++){    \n                    var titlePisition = mda.children[0].children[0].children[ii].title ;\n                    inject = [] ;           \n                    //go to position x et y \n                    inject.push({\n                        'payload' :  context.global.MotionStage1,\n                        'topic' : 'MotionStage1',\n                        'device' :  context.global.MotionStage1,\n                        'mode' : 'MDA',\n                        'action' : 'set',\n                        'update' : {\n                            \"xPosition\" : parseInt(mda.children[0].children[0].children[ii].data.xPosition),\n                            \"yPosition\" : parseInt(mda.children[0].children[0].children[ii].data.yPosition),\n                            \"moveType\" : \"G\"\n                            }\n                        });\n                    //go to z position\n                    inject.push({\n                        'topic' : 'Microscope1',\n                        'device' : context.global.Microscope1,\n                        'action' : 'setZposition',\n                        'mode' : 'MDA',\n                        'update' : {\n                            'zPosition': parseInt(mda.children[0].children[0].children[ii].data.zPosition),\n                            'moveType' : 'd'\n                            }\n                        });\n                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                    //in the position\n                    for(var iii=0; iii<mda.children[0].children[0].children[ii].children.length;iii++){\n                        //filter\n                        if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT'){\n                            inject = [] ;\n                            inject.push({\n                                'topic' : 'Microscope1',\n                                'device' : context.global.Microscope1,\n                                'action' : 'setWheelFilter',\n                                'mode' : 'MDA',\n                                'update':{\n                                    'wheelFilter': parseInt(mda.children[0].children[0].children[ii].children[iii].data.wheel)\n                                    }\n                                });\n                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                        }\n                        //set Ligth\n                        for(var l=1; l<context.global.settingChannels.length; l++){\n                            if(context.global.settingChannels[l].name === mda.children[0].children[0].children[ii].children[iii].data.title2){\n                                var exposure = -1 ;\n                                inject = [];\n                                //BF\n                                var titleChannel = mda.children[0].children[0].children[ii].children[iii].data.title2 ;\n                                if(context.global.settingChannels[l].device === \"OLYMPUS-IX-81\"){\n                                    inject.push({\n                                        'topic' : context.global.settingChannels[l].topic,\n                                        'device' : context.global.settingChannels[l].device,\n                                        'action' : 'setChannel',\n                                        'mode' : 'MDA',\n                                        'update' : {\n                                            'lamp' : true,\n                                            'intensity': parseInt(context.global.settingChannels[l].update.A[1]),\n                                            'shutter': true,\n                                            'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time),\n                                            'keep' : false\n                                        } \n                                    });\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                    exposure = 100;//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                }\n                                //COOLLED\n                                if(context.global.settingChannels[l].device === \"CoolLed-PE4000\"){\n                                    inject.push({\n                                        'topic' : context.global.settingChannels[l].topic,\n                                        'device' : context.global.settingChannels[l].device,\n                                        'action' : 'setChannel',\n                                        'mode' : 'MDA',\n                                        'update' : {\n                                            \"A\" :[parseInt(context.global.settingChannels[l].update.A[0]),parseInt(context.global.settingChannels[l].update.A[1]),context.global.settingChannels[l].update.A[2] == \"ON\" ? false : true],\n                                            \"B\" :[parseInt(context.global.settingChannels[l].update.B[0]),parseInt(context.global.settingChannels[l].update.B[1]),context.global.settingChannels[l].update.B[2] == \"ON\" ? false : true],\n                                            \"C\" :[parseInt(context.global.settingChannels[l].update.C[0]),parseInt(context.global.settingChannels[l].update.C[1]),context.global.settingChannels[l].update.C[2] == \"ON\" ? false : true],\n                                            \"D\" :[parseInt(context.global.settingChannels[l].update.D[0]),parseInt(context.global.settingChannels[l].update.D[1]),context.global.settingChannels[l].update.D[2] == \"ON\" ? false : true],\n                                            'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time),\n                                            'keep' : false\n                                        }\n                                    });\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                    exposure = 10;//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                }\n                            }\n                        }\n                        \n                        if(mda.children[0].children[0].children[ii].children[iii].type === 'CAMERA'){\n                            inject = [];\n                            inject.push({\n                                'topic' : 'Camera1',\n                                'device' : context.global.Camera1,\n                                'action' : 'GRAB',\n                                'prefixe' : mda.children[0].data.prefixe,\n                                'channel': titleChannel,\n                                'position' : titlePisition,  \n                                'exposure' : exposure \n                                });\n                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                            if(exposure !== -1){\n                                if(ii!==mda.children[0].children[0].children.length-1){\n                                    inject = [];\n                                    inject.push({\n                                        'action' : '_waiting_',\n                                        });\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                    exposure = -1 ;\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        \n            if(i === parseInt(mda.children[0].children[0].data.repeat)-1){\n                inject =\n                [{\n                'payload' : 'MDA-FINISH',\n                }];\n                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n            }            \n        }\n        return test ;    \n}","outputs":1,"noerr":0,"x":2890,"y":280,"wires":[[]]},{"id":"106e3513.add2db","type":"function","z":"2f633666.5f0b8a","name":"Protocol 01022019","func":"var mda = msg.payload ;\nvar output = {} ;\n\ntry {\n    if(mda['type'] === 'mda'){\n        if(mda.children[0].data.algo === 'algo1'){\n            output = algo1(mda);\n        }\n        msg.payload = \"MDA-START\" ;\n        context.global.sequence2 = output ;\n        return msg;   \n    }\n   \n}\ncatch(error){}\n\nfunction algo1(mda){\n    \n    var test = {} ;\n    /*Algo 1\n    sequence\n    ----position\n        ----light\n        ----zs ou camera\n        ----light\n        ----zs ou came\n            ....\n    ----position\n        ....\n    */    \n    //repeat sequence\n        for(var i=0; i<parseInt(mda.children[0].children[0].data.repeat);i++){\n            test[String(i*parseInt(mda.children[0].children[0].data.time))] = [] ;\n\n            //position\n            for(var ii=0; ii<mda.children[0].children[0].children.length;ii++){\n                var titlePisition = mda.children[0].children[0].children[ii].title ;\n                var inject = [] ;           \n                //go to position x et y \n                inject.push({\n                    'payload' :  context.global.MotionStage1,\n                    'topic' : 'MotionStage1',\n                    'device' :  context.global.MotionStage1,\n                    'mode' : 'MDA',\n                    'action' : 'set',\n                    'update' : {\n                        \"xPosition\" : parseInt(mda.children[0].children[0].children[ii].data.xPosition),\n                        \"yPosition\" : parseInt(mda.children[0].children[0].children[ii].data.yPosition),\n                        \"moveType\" : \"G\"\n                        }\n                    });\n                //go to z position\n                /*inject.push({\n                    'topic' : 'Microscope1',\n                    'device' : context.global.Microscope1,\n                    'action' : 'setZposition',\n                    'mode' : 'MDA',\n                    'update' : {\n                        'zPosition': parseInt(mda.children[0].children[0].children[ii].data.zPosition),\n                        }\n                    });\n                */\n                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                //in the position\n                for(var iii=0; iii<mda.children[0].children[0].children[ii].children.length;iii++){\n                    //filter\n                    var limit = 1 ;\n                    var keep = false ;\n                    var zPosition =parseInt(mda.children[0].children[0].children[ii].data.zPosition);\n                    node.warn(zPosition);\n                    var active = 0 ;\n                    if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT'){\n                        inject = [] ;\n                        inject.push({\n                            'topic' : 'Microscope1',\n                            'device' : context.global.Microscope1,\n                            'action' : 'setWheelFilter',\n                            'mode' : 'MDA',\n                            'update':{\n                                'wheelFilter': parseInt(mda.children[0].children[0].children[ii].children[iii].data.wheel)\n                                }\n                            });\n                        test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                    \n                        // detect image or zstack AND set limit for the repeat loop\n                        if(mda.children[0].children[0].children[ii].children[iii+1].type === 'CAMERA'){\n                            limit = 1 ;\n                            keep = false ;\n                            active = 0 ;\n                        }\n                        if(mda.children[0].children[0].children[ii].children[iii+1].type === 'ZS'){\n                            var zstart = parseInt(mda.children[0].children[0].children[ii].children[iii+1].data.zstart);\n                            var zend = parseInt(mda.children[0].children[0].children[ii].children[iii+1].data.zend);\n                            var zstep = parseInt(mda.children[0].children[0].children[ii].children[iii+1].data.zstep);\n                            var progress = parseInt(Math.abs(zstart-zend) / zstep) + 1 ;\n                            limit = progress ;\n                            keep = mda.children[0].children[0].children[ii].children[iii+1].data.shutter ;\n                            active = 1 ;\n                        }\n                    }\n                        \n                    if(true) {\n                        for(var r=0;r<limit;r++){\n                            if(r===limit-1) keep = false ;\n                            inject = [] ;\n                            var a  = (zPosition + active * 100*(zstart + zstep * r));\n                            inject.push({\n                                'topic' : 'Microscope1',\n                                'device' : context.global.Microscope1,\n                                'action' : 'setZposition',\n                                'mode' : 'MDA',\n                                'update' : {\n                                    'zPosition': a,\n                                    'moveType' : 'd'\n                                    }\n                                });\n                           if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT')\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                       \n                            //set Ligth\n                            if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT'){\n                                for(var l=1; l<context.global.settingChannels.length; l++){\n                                    if(context.global.settingChannels[l].name === mda.children[0].children[0].children[ii].children[iii].data.title2){\n                                        var exposure = -1 ;\n                                        inject = [];\n                                        //BF\n                                        var titleChannel = mda.children[0].children[0].children[ii].children[iii].data.title2 ;\n                                        if(context.global.settingChannels[l].device === \"OLYMPUS-IX-81\"){\n                                            inject.push({\n                                                'topic' : context.global.settingChannels[l].topic,\n                                                'device' : context.global.settingChannels[l].device,\n                                                'action' : 'setChannel',\n                                                'mode' : 'MDA',\n                                                'update' : {\n                                                    'lamp' : true,\n                                                    'intensity': parseInt(context.global.settingChannels[l].update.A[1]),\n                                                    'shutter': true,\n                                                    'keep' : keep ,\n                                                    'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time)\n                                                } \n                                            });\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                            exposure = 200; //\n                                            exposure = parseInt(mda.children[0].children[0].children[ii].children[iii].data.time);//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                        }\n                                        //COOLLED\n                                        if(context.global.settingChannels[l].device === \"CoolLed-PE4000\"){\n                                            inject.push({\n                                                'topic' : context.global.settingChannels[l].topic,\n                                                'device' : context.global.settingChannels[l].device,\n                                                'action' : 'setChannel',\n                                                'mode' : 'MDA',\n                                                'update' : {\n                                                    \"A\" :[parseInt(context.global.settingChannels[l].update.A[0]),parseInt(context.global.settingChannels[l].update.A[1]),context.global.settingChannels[l].update.A[2] == \"ON\" ? true : false],\n                                                    \"B\" :[parseInt(context.global.settingChannels[l].update.B[0]),parseInt(context.global.settingChannels[l].update.B[1]),context.global.settingChannels[l].update.B[2] == \"ON\" ? true : false],\n                                                    \"C\" :[parseInt(context.global.settingChannels[l].update.C[0]),parseInt(context.global.settingChannels[l].update.C[1]),context.global.settingChannels[l].update.C[2] == \"ON\" ? true : false],\n                                                    \"D\" :[parseInt(context.global.settingChannels[l].update.D[0]),parseInt(context.global.settingChannels[l].update.D[1]),context.global.settingChannels[l].update.D[2] == \"ON\" ? true : false],\n                                                    'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time),\n                                                    'keep': keep\n                                                    }\n                                            });\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                            exposure = 100; //\n                                            exposure = parseInt(mda.children[0].children[0].children[ii].children[iii].data.time);//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                        }\n                                    }\n                                }\n                            }\n                            if(mda.children[0].children[0].children[ii].children[iii].type === 'CAMERA'){\n                                inject = [];\n                                inject.push({\n                                    'topic' : 'Camera1',\n                                    'device' : context.global.Camera1,\n                                    'action' : 'GRAB',\n                                    'prefixe' : mda.children[0].data.prefixe,\n                                    'channel': titleChannel,\n                                    'position' : titlePisition,  \n                                    'exposure' : exposure \n                                    });\n                                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                if(exposure !== -1){\n                                    if(ii!==mda.children[0].children[0].children.length-1){\n                                            inject = [];\n                                            inject.push({'action' : '_waiting_',});\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                            exposure = -1 ;\n                                        }\n                                }\n\n                            }\n                            if((limit > 1)&&(mda.children[0].children[0].children[ii].children[iii].type !== 'ZS')){\n                                inject = [];\n                                inject.push({\n                                    'topic' : 'Camera1',\n                                    'device' : context.global.Camera1,\n                                    'action' : 'GRAB',\n                                    'prefixe' : mda.children[0].data.prefixe,\n                                    'channel': titleChannel,\n                                    'position' : titlePisition,  \n                                    'exposure' : exposure \n                                    });\n                                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                if(exposure !== -1){\n                                    if(ii!==mda.children[0].children[0].children.length-1){\n                                            inject = [];\n                                            inject.push({'action' : '_waiting_'});\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                            exposure = -1 ;\n                                        }\n                                }\n                            }\n                        \n                        }\n                    }\n                }\n            }\n        \n            if(i === parseInt(mda.children[0].children[0].data.repeat)-1){\n                inject =[{'payload' : 'MDA-FINISH'}];\n                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n            }            \n        }\n        return test ;    \n}","outputs":1,"noerr":0,"x":2870,"y":320,"wires":[[]]},{"id":"8c3e2a41.55ec38","type":"function","z":"2f633666.5f0b8a","name":"protocole N","func":"var mda = msg.payload ;\nvar output = {} ;\n\ntry {\n    if(mda['type'] === 'mda'){\n        if(mda.children[0].data.algo === 'algo1'){\n            output = algo1(mda);\n        }\n        msg.payload = \"MDA-START\" ;\n        context.global.sequence2 = output ;\n        return msg;   \n    }\n   \n}\ncatch(error){}\n\nfunction algo1(mda){\n    var test = {} ;\n    var inject = [] ;           \n    /*inject.push({\n        'payload' :  context.global.Fluorescence1,\n        'topic' : 'Fluorescence1',\n        'device' :  context.global.Fluorescence1,\n        'mode' : 'mda',\n        'action' : 'setOFF'\n    });\n    inject.push({\n        'payload' :  context.global.Microscope1,\n        'topic' : 'Microscope1',\n        'device' :  context.global.Microscope1,\n        'mode' : 'mda',\n        'action' : 'setOFF'\n    });\n    test[String(0)].push(inject);\n    inject = [] ;\n    inject.push({\n        'topic' : 'Microscope1',\n        'device' : context.global.Microscope1,\n        'action' : 'setChannel',\n        'mode' : 'MDA',\n        'update' : {\n            'lamp' : true,\n            'intensity': parseInt(context.global.settingChannels[l].update.A[1]),\n            'shutter': false,\n            'timeout' : -1\n        } \n    });\n    test[String(0)].push(inject);*/\n    //repeat sequence\n        for(var i=0; i<parseInt(mda.children[0].children[0].data.repeat);i++){\n            test[String(i*parseInt(mda.children[0].children[0].data.time))] = [] ;\n            //position\n            for(var ii=0; ii<mda.children[0].children[0].children.length;ii++){\n                var limit = 1;\n                var zs = false ;\n                var keep = false;\n                // if(mda.children[0].children[0].children[ii].children[iii].type === 'ZS'){\n                    //zs = true ;\n                    //keep = true ;\n                    //var zstart = parseInt(mda.children[0].children[0].children[ii].children[iii].data.zstart);\n                    //var zend = parseInt(mda.children[0].children[0].children[ii].children[iii].data.zend);\n                    //var zstep = parseInt(mda.children[0].children[0].children[ii].children[iii].data.zstep);\n                    //var inc = zstart - zend ;\n                    //if (inc<0) inc = inc * (-1) ;\n                    //var stepping =  (inc / zstep) ;\n                    //var zPosition = parseInt(mda.children[0].children[0].children[ii].data.zPosition);\n                    //limit = stepping;\n                    //node.warn(stepping);\n                // }    \n                for(var r=0;r<limit;r++){\n                    var titlePisition = mda.children[0].children[0].children[ii].title ;\n                    if(zs===false){\n                        inject = [] ;           \n                        //go to position x et y \n                        inject.push({\n                            'payload' :  context.global.MotionStage1,\n                            'topic' : 'MotionStage1',\n                            'device' :  context.global.MotionStage1,\n                            'mode' : 'MDA',\n                            'action' : 'set',\n                            'update' : {\n                                \"xPosition\" : parseInt(mda.children[0].children[0].children[ii].data.xPosition),\n                                \"yPosition\" : parseInt(mda.children[0].children[0].children[ii].data.yPosition),\n                                \"moveType\" : \"G\"\n                                }\n                            });\n                    }\n                    //go to z position\n                    var z = 0;\n                    if(zs===false) z = parseInt(mda.children[0].children[0].children[ii].data.zPosition);\n                    else z = parseInt(mda.children[0].children[0].children[ii].data.zPosition) + 100*(zstart + zstep * r);\n                    inject.push({\n                        'topic' : 'Microscope1',\n                        'device' : context.global.Microscope1,\n                        'action' : 'setZposition',\n                        'mode' : 'MDA',\n                        'update' : {\n                            'zPosition': z,\n                            'moveType' : 'd'\n                            }\n                        });\n                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                    //in the position\n                    for(var iii=0; iii<mda.children[0].children[0].children[ii].children.length;iii++){\n                        //filter\n                        if(r===0){\n                            if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT'){\n                                inject = [] ;\n                                inject.push({\n                                    'topic' : 'Microscope1',\n                                    'device' : context.global.Microscope1,\n                                    'action' : 'setWheelFilter',\n                                    'mode' : 'MDA',\n                                    'update':{\n                                        'wheelFilter': parseInt(mda.children[0].children[0].children[ii].children[iii].data.wheel)\n                                        }\n                                    });\n                                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                            }\n                        }\n                        //set Ligth\n                        for(var l=1; l<context.global.settingChannels.length; l++){\n                            if(context.global.settingChannels[l].name === mda.children[0].children[0].children[ii].children[iii].data.title2){\n                                var exposure = -1 ;\n                                inject = [];\n                                //BF\n                                var titleChannel = mda.children[0].children[0].children[ii].children[iii].data.title2 ;\n                                if(context.global.settingChannels[l].device === \"OLYMPUS-IX-81\"){\n                                    inject.push({\n                                        'topic' : context.global.settingChannels[l].topic,\n                                        'device' : context.global.settingChannels[l].device,\n                                        'action' : 'setChannel',\n                                        'mode' : 'MDA',\n                                        'update' : {\n                                            'lamp' : true,\n                                            'intensity': parseInt(context.global.settingChannels[l].update.A[1]),\n                                            'shutter': true,\n                                            'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time),\n                                            'keep' : keep\n                                        } \n                                    });\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                    exposure = 100;//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                }\n                                //COOLLED\n                                if(context.global.settingChannels[l].device === \"CoolLed-PE4000\"){\n                                    inject.push({\n                                        'topic' : context.global.settingChannels[l].topic,\n                                        'device' : context.global.settingChannels[l].device,\n                                        'action' : 'setChannel',\n                                        'mode' : 'MDA',\n                                        'update' : {\n                                            \"A\" :[parseInt(context.global.settingChannels[l].update.A[0]),parseInt(context.global.settingChannels[l].update.A[1]),context.global.settingChannels[l].update.A[2] == \"ON\" ? false : true],\n                                            \"B\" :[parseInt(context.global.settingChannels[l].update.B[0]),parseInt(context.global.settingChannels[l].update.B[1]),context.global.settingChannels[l].update.B[2] == \"ON\" ? false : true],\n                                            \"C\" :[parseInt(context.global.settingChannels[l].update.C[0]),parseInt(context.global.settingChannels[l].update.C[1]),context.global.settingChannels[l].update.C[2] == \"ON\" ? false : true],\n                                            \"D\" :[parseInt(context.global.settingChannels[l].update.D[0]),parseInt(context.global.settingChannels[l].update.D[1]),context.global.settingChannels[l].update.D[2] == \"ON\" ? false : true],\n                                            'timeout' : parseInt(mda.children[0].children[0].children[ii].children[iii].data.time),\n                                            'keep' : keep\n                                        }\n                                    });\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                    exposure = 10;//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                }\n                            }\n                        }\n                        if((mda.children[0].children[0].children[ii].children[iii].type === 'CAMERA')||(zs===true)){\n                            inject = [];\n                            inject.push({\n                                'topic' : 'Camera1',\n                                'device' : context.global.Camera1,\n                                'action' : 'GRAB',\n                                'prefixe' : mda.children[0].data.prefixe,\n                                'channel': titleChannel,\n                                'position' : titlePisition,  \n                                'exposure' : exposure \n                                });\n                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                            if(exposure !== -1){\n                                if(ii!==mda.children[0].children[0].children.length-1){\n                                    inject = [];\n                                    inject.push({\n                                        'action' : '_waiting_',\n                                        });\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                    exposure = -1 ;\n                                }\n                            }\n                        }\n                        \n                        //picture+af\n                        //faire el stop\n                        //af et zs\n                \n                    }    \n                }\n            }\n        \n            if(i === parseInt(mda.children[0].children[0].data.repeat)-1){\n                inject =\n                [{\n                'payload' : 'MDA-FINISH',\n                }];\n                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n            }            \n        }\n        return test ;    \n}","outputs":1,"noerr":0,"x":2890,"y":240,"wires":[[]]},{"id":"65aab7f4.902298","type":"function","z":"2f633666.5f0b8a","name":"Protocol 19022019a","func":"var mda = msg.payload ;\nvar output = {} ;\n\ntry {\n    if(mda['type'] === 'mda'){\n        if(mda.children[0].data.algo === 'algo1'){\n            try{\n                output = algo1(mda);\n            } catch(err){node.warn(\"ERRR\");}\n        }\n        msg.payload = \"MDA-START\" ;\n        context.global.sequence2 = output ;\n        return msg;   \n    }\n   \n}\ncatch(error){}\n\nfunction algo1(mda){\n    \n    var test = {} ;\n    /*Algo 1\n    sequence\n    ----position\n        ----light\n        ----zs ou camera\n        ----light\n        ----zs ou came\n            ....\n    ----position\n        ....\n    */    \n    \n   \n    \n            \n    //repeat sequence\n        for(var i=0; i<parseInt(mda.children[0].children[0].data.repeat);i++){\n            test[String(i*parseInt(mda.children[0].children[0].data.time))] = [] ;\n\n\n\n\n        if(i===0){\n             //BF initialisation car long pour l'instant papramètres statiques\n                /*\n                inject = [];\n                inject.push({\n                    'topic' : 'Microscope1',\n                    'device' : 'OLYMPUS-IX-81',\n                    'action' : 'setChannel',\n                    'mode' : 'MDA',\n                    'update' : {\n                        'lamp' : true,\n                        'intensity':  2,\n                        'shutter': false,\n                        'keep' : false ,\n                        'timeout' : -1///parseInt(mda.children[0].children[0].children[ii].children[iii].data.time)\n                    } \n                });\n                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                */\n                \n                \n                for(var l=1; l<context.global.settingChannels.length; l++){\n//                    if(context.global.settingChannels[l].name === mda.children[0].children[0].children[ii].children[iii].data.title2){\n//                        var exposure = -1 ;\n                        inject = [];\n                        //BF\n                        if(context.global.settingChannels[l].device === \"OLYMPUS-IX-81\"){\n                            device = context.global.settingChannels[l].device ;\n                            topic = context.global.settingChannels[l].topic ;\n                            inject.push({\n                                'topic' : context.global.settingChannels[l].topic,\n                                'device' : context.global.settingChannels[l].device,\n                                'action' : 'setChannel',\n                                'mode' : 'MDA',\n                                'update' : {\n                                    'lamp' : true,\n                                    'intensity': parseInt(context.global.settingChannels[l].update.A[1]),\n                                    'shutter': false,\n                                    'keep' : false ,\n                                    'timeout' : -1///parseInt(mda.children[0].children[0].children[ii].children[iii].data.time)\n                                } \n                            });\n                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                        }\n//                    }\n                }\n                \n                \n                //temporisation\n                inject = [];\n                inject.push({\n                    'topic' : 'f_tempo',\n                    'device' : 'none',\n                    'action' : 'f_tempo',\n                    'update' : {\n                        't' : 1000\n                    }\n                });\n                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n        }\n                \n            //position\n            for(var ii=0; ii<mda.children[0].children[0].children.length;ii++){\n                var titlePisition = mda.children[0].children[0].children[ii].title ;\n                var inject = [] ;           \n                  var q = 1;\n                  //go to position x et y \n                inject.push({\n                    'payload' :  context.global.MotionStage1,\n                    'topic' : 'MotionStage1',\n                    'device' :  context.global.MotionStage1,\n                    'mode' : 'MDA',\n                    'action' : 'set',\n                    'update' : {\n                        \"xPosition\" : parseInt(mda.children[0].children[0].children[ii].data.xPosition),\n                        \"yPosition\" : parseInt(mda.children[0].children[0].children[ii].data.yPosition),\n                        \"moveType\" : \"G\"\n                        }\n                    });\n                //go to z position\n                /*inject.push({\n                    'topic' : 'Microscope1',\n                    'device' : context.global.Microscope1,\n                    'action' : 'setZPosition',\n                    'mode' : 'MDA',\n                    'update' : {\n                        'zPosition': parseInt(mda.children[0].children[0].children[ii].data.zPosition),\n                        }\n                    });\n                */\n                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                //in the position\n                \n                for(var iii=0; iii<mda.children[0].children[0].children[ii].children.length;iii++){\n                    //filter\n                    var zstart = 0;\n                    var zend = 0;\n                    var zstep = 0;\n                          \n                    var limit = 1 ;\n                    //var af = false ; \n                    var keep = false ;\n                    var zPosition =parseInt(mda.children[0].children[0].children[ii].data.zPosition);\n                    var active = 0 ;\n                    if(mda.children[0].children[0].children[ii].children[iii].type === 'AF'){\n                        //af = true ;\n                        inject = [] ;\n                        inject.push({\n                            'topic' : 'Microscope1',\n                            'device' : context.global.Microscope1,\n                            'action' : 'af',\n                            'mode' : 'MDA',\n                            'update' : {\n                                \"farLimit\" : 1,\n                                \"nearLimit\" : 3000000,\n                                \"affLimit\": parseInt(mda.children[0].children[0].children[ii].children[iii].data.zPosition)-(100*parseInt(mda.children[0].children[0].children[ii].children[iii].data.lower)),\n                                \"afnLimit\": parseInt(mda.children[0].children[0].children[ii].children[iii].data.zPosition)+(100*parseInt(mda.children[0].children[0].children[ii].children[iii].data.upper)),\n                                \"objective\": parseInt(mda.children[0].children[0].children[ii].children[iii].data.n),\n                                \"offset\" : parseInt(mda.children[0].children[0].children[ii].children[iii].data.zOffset)\n                                }\n                            });\n                        test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                    \n                    }\n                    if((mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT')){\n                  \n                    \n                                  /*  if(parseInt(mda.children[0].children[0].children[ii].children[iii-1].data.skip!==0))\n                                        q = (i+1)%(parseInt(mda.children[0].children[0].children[ii].children[iii-1].data.skip)) ;\n                                    else\n                                        q = 1 ;*/\n                    if(( q !== 0)){\n                       //          node.warn(i+'-'+parseInt(mda.children[0].children[0].children[ii].children[iii].data.skip)+'-'+ (i+1)%parseInt(mda.children[0].children[0].children[ii].children[iii].data.skip) );\n                        inject = [] ;\n                        inject.push({\n                            'topic' : 'Microscope1',\n                            'device' : context.global.Microscope1,\n                            'action' : 'setWheelFilter',\n                            'mode' : 'MDA',\n                            'update':{\n                                'wheelFilter': parseInt(mda.children[0].children[0].children[ii].children[iii].data.wheel)\n                                }\n                            });\n                        test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                    \n                        // detect image or zstack AND set limit for the repeat loop\n                        if(mda.children[0].children[0].children[ii].children[iii+1].type === 'CAMERA'){\n                            limit = 1 ;\n                            keep = false ;\n                            active = 0 ;\n                        }\n                        if(mda.children[0].children[0].children[ii].children[iii+1].type === 'ZS'){\n                            zstart = parseInt(mda.children[0].children[0].children[ii].children[iii+1].data.zstart);\n                            zend = parseInt(mda.children[0].children[0].children[ii].children[iii+1].data.zend);\n                            zstep = parseInt(mda.children[0].children[0].children[ii].children[iii+1].data.zstep);\n                            progress = parseInt(Math.abs(zstart-zend) / zstep) + 1 ;\n                            limit = progress ;\n                            keep = mda.children[0].children[0].children[ii].children[iii+1].data.shutter ;\n                            active = 1 ;\n                        }\n                    }\n                    }\n                        \n                    if(true) {\n//                        node.warn(\"limit:\"+limit);\n                        for(var r=0;r<limit;r++){\n                            \n                            if(r===limit-1) keep = false ;\n                            inject = [] ;\n                            var a  = (zPosition + active * 100*(zstart + zstep * r));\n                            \n                            \n                            //if(mda.children[0].children[0].children[ii].children[iii].type !== 'AF'){\n                                inject.push({\n                                    'topic' : 'Microscope1',\n                                    'device' : context.global.Microscope1,\n                                    'action' : 'setZPosition',\n                                    'mode' : 'MDA',\n                                    'update' : {\n                                        'zPosition': a,\n                                        'moveType' : 'd'\n                                        }\n                                    });\n                            //}\n                           if(mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT'){\n                            \n                                  /*  if(parseInt(mda.children[0].children[0].children[ii].children[iii-1].data.skip!==0))\n                                        q = (i+1)%(parseInt(mda.children[0].children[0].children[ii].children[iii-1].data.skip)) ;\n                                    else\n                                        q = 1 ;*/\n                    if(( q !== 0)){\n                          try{\n                                    if((mda.children[0].children[0].children[ii].children[iii-1].type !== 'AF')){\n                                        //if((mda.children[0].children[0].children[ii].children[iii-1].type !== 'MOSAIC'))\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                    }\n                                    if((mda.children[0].children[0].children[ii].children[iii+1].type === 'ZS')){\n                                        //if((mda.children[0].children[0].children[ii].children[iii-1].type !== 'MOSAIC'))\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                    }\n                                }\n                                catch(error){\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                }\n                    }\n                        }\n                                \n                            //AF\n                           /* if(mda.children[0].children[0].children[ii].children[iii].type === 'AF'){\n                                af = true ;\n                                inject = [] ;\n                                inject.push({\n                                    'topic' : 'Microscope1',\n                                    'device' : context.global.Microscope1,\n                                    'action' : 'af',\n                                    'mode' : 'MDA',\n                                    'update' : {\n                                        \"farLimit\" : 1,\n                                        \"nearLimit\" : 3000000,\n                                        \"affLimit\": zPosition-(100*parseInt(mda.children[0].children[0].children[ii].children[iii].data.lower)),\n                                        \"afnLimit\": zPosition+(100*parseInt(mda.children[0].children[0].children[ii].children[iii].data.upper)),\n                                        \"objective\": 30,\n                                        \"offset\" : parseInt(mda.children[0].children[0].children[ii].children[iii].data.zOffset)\n                                        }\n                                    });\n                                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                            \n                           }*/\n           \n           \n                   \n        \n                            //set Ligth\n                            if(((mda.children[0].children[0].children[ii].children[iii].type === 'LIGHT'))){\n                                \n                                /*\n                                    if(parseInt(mda.children[0].children[0].children[ii].children[iii-1].data.skip!==0))\n                                        q = (i+1)%(parseInt(mda.children[0].children[0].children[ii].children[iii-1].data.skip)) ;\n                                    else\n                                        q = 1 ;*/\n                    if(( q !== 0)){\n                      \n                                var device ;var topic ;\n                                for(var l=1; l<context.global.settingChannels.length; l++){\n                                    if(context.global.settingChannels[l].name === mda.children[0].children[0].children[ii].children[iii].data.title2){\n                                        var exposure = -1 ;\n                                        inject = [];\n                                        //BF\n                                        var titleChannel = mda.children[0].children[0].children[ii].children[iii].data.title2 ;\n                                        if(context.global.settingChannels[l].device === \"OLYMPUS-IX-81\"){\n                                            device = context.global.settingChannels[l].device ;\n                                            topic = context.global.settingChannels[l].topic ;\n                                            inject.push({\n                                                'topic' : context.global.settingChannels[l].topic,\n                                                'device' : context.global.settingChannels[l].device,\n                                                'action' : 'setChannel',\n                                                'mode' : 'MDA',\n                                                'update' : {\n                                                    'lamp' : true,\n                                                    'intensity': parseInt(context.global.settingChannels[l].update.A[1]),\n                                                    'shutter': true,\n                                                    'keep' : keep ,\n                                                    'timeout' : -1///parseInt(mda.children[0].children[0].children[ii].children[iii].data.time)\n                                                } \n                                            });\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                            //exposure = 200; //\n                                            exposure = parseInt(mda.children[0].children[0].children[ii].children[iii].data.time);//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                        }\n                                        //COOLLED\n                                        if(context.global.settingChannels[l].device === \"CoolLed-PE4000\"){\n                                            device = context.global.settingChannels[l].device ;\n                                            topic = context.global.settingChannels[l].topic ;\n                                            inject.push({\n                                                'topic' : context.global.settingChannels[l].topic,\n                                                'device' : context.global.settingChannels[l].device,\n                                                'action' : 'setChannel',\n                                                'mode' : 'MDA',\n                                                'update' : {\n                                                    \"A\" :[parseInt(context.global.settingChannels[l].update.A[0]),parseInt(context.global.settingChannels[l].update.A[1]),context.global.settingChannels[l].update.A[2] == \"ON\" ? true : false],\n                                                    \"B\" :[parseInt(context.global.settingChannels[l].update.B[0]),parseInt(context.global.settingChannels[l].update.B[1]),context.global.settingChannels[l].update.B[2] == \"ON\" ? true : false],\n                                                    \"C\" :[parseInt(context.global.settingChannels[l].update.C[0]),parseInt(context.global.settingChannels[l].update.C[1]),context.global.settingChannels[l].update.C[2] == \"ON\" ? true : false],\n                                                    \"D\" :[parseInt(context.global.settingChannels[l].update.D[0]),parseInt(context.global.settingChannels[l].update.D[1]),context.global.settingChannels[l].update.D[2] == \"ON\" ? true : false],\n                                                    'timeout' : -1,///parseInt(mda.children[0].children[0].children[ii].children[iii].data.time),\n                                                    'keep': keep\n                                                    }\n                                            });\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                            //exposure = 100; //\n                                            exposure = parseInt(mda.children[0].children[0].children[ii].children[iii].data.time);//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                        }\n                                        //x-cite\n                                        var intxcite = parseInt(context.global.settingChannels[l].update.A[0]) ;\n                                        if(context.global.settingChannels[l].device === \"X-Cite-120PC\"){\n                                            device = context.global.settingChannels[l].device ;\n                                            topic = context.global.settingChannels[l].topic ;\n                                            inject.push({\n                                                'topic' : context.global.settingChannels[l].topic,\n                                                'device' : context.global.settingChannels[l].device,\n                                                'action' : 'setChannel',\n                                                'mode' : 'MDA',\n                                                'update' : {\n                                                    \"A\" :[parseInt(context.global.settingChannels[l].update.A[0]),context.global.settingChannels[l].update.A[1] == \"ON\" ? true : false]\n                                                    }\n                                            });\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                            //exposure = 100; //\n                                            exposure = parseInt(mda.children[0].children[0].children[ii].children[iii].data.time);//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                        }\n                                        \n                                    }\n                                }\n                            }}\n                            if(mda.children[0].children[0].children[ii].children[iii].type === 'MOSAIC'){\n                                inject = [];\n                                inject.push({\n                                    'topic' : 'Mosaic',\n                                    'device' : 'MOSAIC',\n                                    'action' : 'EXP',\n                                    'img' :  mda.children[0].children[0].children[ii].children[iii].data.image\n                                    });\n                                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                             \n                            }\n                            if(mda.children[0].children[0].children[ii].children[iii].type === 'NMOSAIC'){\n                                inject = [];\n                                inject.push({\n                                    'topic' : 'Mosaic',\n                                    'device' : 'MOSAIC',\n                                    'action' : 'NEXP',\n                                    });\n                                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                             \n                            }\n                            if((mda.children[0].children[0].children[ii].children[iii].type === 'CAMERA')){\n                            /*\n                             \n                                    if(parseInt(mda.children[0].children[0].children[ii].children[iii-1].data.skip!==0))\n                                        q = (i+1)%(parseInt(mda.children[0].children[0].children[ii].children[iii-1].data.skip)) ;\n                                    else\n                                        q = 1 ;*/\n                    if(( q !== 0)){\n                      \n                                inject = [];\n                                inject.push({\n                                    'topic' : 'Camera1',\n                                    'device' : context.global.Camera1,\n                                    'action' : 'GRAB',\n                                    'prefixe' : mda.children[0].data.prefixe,\n                                    'channel': titleChannel,\n                                    'position' : titlePisition,  \n                                    'exposure' : exposure \n                                    });\n                                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                             \n                                inject = [];\n                                if(device === \"OLYMPUS-IX-81\"){\n                                    inject.push({\n                                        'topic' : topic,\n                                        'device' : device,\n                                        'action' : 'setOFF'\n                                    });\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                    //exposure = 200; //\n                                    //exposure = parseInt(mda.children[0].children[0].children[ii].children[iii].data.time);//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                } \n                                \n                                if(device === \"CoolLed-PE4000\"){\n                                    inject.push({\n                                        'topic' : topic,\n                                        'device' : device,\n                                        'action' : 'setOFF'\n                                    });\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                    //exposure = 100; //\n                                    //exposure = parseInt(mda.children[0].children[0].children[ii].children[iii].data.time);//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                }\n                                if(device === \"X-Cite-120PC\"){\n                                    inject.push({\n                                        'device' : device ,\n                                            'topic' : topic ,\n                                            'action' : 'setChannel',\n                                            'mode' : 'MDA',\n                                            'update' : {\n                                                \"A\" :[intxcite,\"OFF\"]\n                                                }\n                                        });\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                    //exposure = 100; //\n                                    //exposure = parseInt(mda.children[0].children[0].children[ii].children[iii].data.time);//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                }\n                                \n                                //a régler dynamiquement\n                                inject = [];\n                                inject.push({\n                                    'topic' : 'f_tempo',\n                                    'device' : 'none',\n                                    'action' : 'f_tempo',\n                                    'update' : {\n                                        't' : 600\n                                    }\n                                });\n                                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                            \n                                \n                                \n                               /* if(exposure !== -1){\n                                    if(ii!==mda.children[0].children[0].children.length-1){\n                                            inject = [];\n                                            inject.push({'action' : '_waiting_',});\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                            exposure = -1 ;\n                                        }\n                                }*/\n\n                            }\n                            }\n                            if((limit > 1)&&(mda.children[0].children[0].children[ii].children[iii].type !== 'ZS')){\n                            /*\n                                    if(parseInt(mda.children[0].children[0].children[ii].children[iii-1].data.skip!==0))\n                                        q = (i+1)%(parseInt(mda.children[0].children[0].children[ii].children[iii-1].data.skip)) ;\n                                    else\n                                        q = 1 ;*/\n                                \n                                if(( q !== 0)){\n                      \n                                inject = [];\n                                inject.push({\n                                    'topic' : 'Camera1',\n                                    'device' : context.global.Camera1,\n                                    'action' : 'GRAB',\n                                    'prefixe' : mda.children[0].data.prefixe,\n                                    'channel': titleChannel,\n                                    'position' : titlePisition,  \n                                    'exposure' : exposure \n                                    });\n                                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                \n                                \n                                \n                                /*\n                                here shutter close during the z-stack\n                                */\n                                \n                                if(r===limit-1){ \n                                    inject = [];\n                                    if(device === \"OLYMPUS-IX-81\"){\n                                        inject.push({\n                                            'topic' : topic,\n                                            'device' : device,\n                                            'action' : 'setOFF'\n                                        });\n                                        test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                        //exposure = 200; //\n                                        //exposure = parseInt(mda.children[0].children[0].children[ii].children[iii].data.time);//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                    } \n                                    \n                                    if(device === \"CoolLed-PE4000\"){\n                                        inject.push({\n                                            'topic' : topic,\n                                            'device' : device,\n                                            'action' : 'setOFF'\n                                        });\n                                        test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                        //exposure = 100; //\n                                        //exposure = parseInt(mda.children[0].children[0].children[ii].children[iii].data.time);//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                    }\n\n                                    if(device === \"X-Cite-120PC\"){\n                                    inject.push({\n                                        'device' : device ,\n                                            'topic' : topic ,\n                                            'action' : 'setChannel',\n                                            'mode' : 'MDA',\n                                            'update' : {\n                                                \"A\" :[intxcite,\"OFF\"]\n                                                }\n                                        });\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n\n                                    //a régler dynamiquement\n                                    inject = [];\n                                    inject.push({\n                                        'topic' : 'f_tempo',\n                                        'device' : 'none',\n                                        'action' : 'f_tempo',\n                                        'update' : {\n                                            't' : 300\n                                        }\n                                    });\n                                    test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                    \n                                    //exposure = 100; //\n                                    //exposure = parseInt(mda.children[0].children[0].children[ii].children[iii].data.time);//parseInt(mda.children[0].children[0].children[ii].children[iii].data.time) ;\n                                }\n                                }\n                                \n                                /*if(exposure !== -1){\n                                    if(ii!==mda.children[0].children[0].children.length-1){\n                                            inject = [];\n                                            inject.push({'action' : '_waiting_'});\n                                            test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n                                            exposure = -1 ;\n                                        }\n                                }*/\n                            }}\n                        \n                        }\n                    }\n                }\n            }\n        \n            if(i === parseInt(mda.children[0].children[0].data.repeat)-1){\n                inject =[{'payload' : 'MDA-FINISH'}];\n                test[String(i*parseInt(mda.children[0].children[0].data.time))].push(inject);\n            }            \n        }\n        return test ;    \n}","outputs":1,"noerr":0,"x":2440,"y":780,"wires":[["c7ee8b76.5a69e8"]]},{"id":"e9d15400.a1a968","type":"function","z":"2f633666.5f0b8a","name":"Timer syncro","func":"if(msg.topic === 'f_tempo'){\n    node.status ({fill:\"green\",shape:\"dot\", text: \"request\"});\n    var time = parseInt(msg.update.t) ;\n    setTimeout(function(){\n        var msg = {};\n        msg.topic = 'f_tempo'\n        msg.payload = \"done\";\n        msg.action = 'f_tempo';\n        msg.device = 'none';\n        msg.update = {'t' : time};\n        node.status ({fill:\"yellow\",shape:\"dot\", text: \"send...\"});\n        node.send(msg);\n    },time)\n}","outputs":1,"noerr":0,"x":730,"y":560,"wires":[["fbf8ea6c.6e9288"]],"icon":"node-red/timer.png"},{"id":"481a2989.7afec8","type":"function","z":"2f633666.5f0b8a","name":"","func":"msg.topic =  'f_tempo';\nmsg.device = 'none';\nmsg.action = 'f_tempo';\nmsg.update = {\n    't' : 2000\n    };\n    return msg;","outputs":1,"noerr":0,"x":330,"y":560,"wires":[[]]},{"id":"f3ed06a4.586aa8","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":200,"y":560,"wires":[["481a2989.7afec8"]]},{"id":"e3dcf6c.873d308","type":"function","z":"2f633666.5f0b8a","name":"relunch","func":"if(msg.payload === 'MDA-FINISH'){\n    node.send(msg);\n}","outputs":1,"noerr":0,"x":540,"y":240,"wires":[["42c9f8b6.f7e7f8"]]},{"id":"35309192.8b1cce","type":"function","z":"2f633666.5f0b8a","name":"ON 28","func":"//msg.payload =  context.global.Fluorescence2;\nmsg.topic = 'Fluorescence2';\nmsg.device =  context.global.Fluorescence2;\nmsg.mode = 'live';\nmsg.action = 'setChannel';\nmsg.update = {\n    \"A\" : [28, true]\n}    \nreturn msg;","outputs":1,"noerr":0,"x":290,"y":1420,"wires":[["4d541c1b.299ac4"]]},{"id":"37129619.08983a","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":1420,"wires":[["35309192.8b1cce"]]},{"id":"601982c5.16ef1c","type":"function","z":"2f633666.5f0b8a","name":"OFF 40","func":"//msg.payload =  context.global.Fluorescence2;\nmsg.topic = 'Fluorescence2';\nmsg.device =  context.global.Fluorescence2;\nmsg.mode = 'live';\nmsg.action = 'setChannel';\nmsg.update = {\n    \"A\" : [40, false]\n}    \nreturn msg;","outputs":1,"noerr":0,"x":300,"y":1460,"wires":[["4d541c1b.299ac4"]]},{"id":"7dec8e56.51759","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":1460,"wires":[["601982c5.16ef1c"]]},{"id":"e86e3beb.4e04f8","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":110,"y":2040,"wires":[["6aeaad28.3d6974","c63a412f.92d16","50a749f9.9f4008","66567579.ad4bbc"]]},{"id":"7feda1d5.5ecf8","type":"function","z":"2f633666.5f0b8a","name":"Connect, enables PC control of the unit. ","func":"msg.payload = 'tt' ;\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":2040,"wires":[["75c62952.8315f8"]]},{"id":"c242baab.c093d8","type":"function","z":"2f633666.5f0b8a","name":" enables the extended command set of the X-Cite exacte","func":"msg.payload = 'jj' ;\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":2080,"wires":[["75c62952.8315f8"]]},{"id":"3b7c410e.6a8cde","type":"function","z":"2f633666.5f0b8a","name":"Enable PC Shutter Control,","func":"msg.payload = 'cc' ;\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":2120,"wires":[["75c62952.8315f8"]]},{"id":"6aeaad28.3d6974","type":"delay","z":"2f633666.5f0b8a","name":"","pauseType":"delay","timeout":"0.3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":270,"y":2080,"wires":[["c242baab.c093d8"]]},{"id":"c63a412f.92d16","type":"delay","z":"2f633666.5f0b8a","name":"","pauseType":"delay","timeout":"0.6","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":270,"y":2120,"wires":[["3b7c410e.6a8cde"]]},{"id":"50a749f9.9f4008","type":"delay","z":"2f633666.5f0b8a","name":"","pauseType":"delay","timeout":"0","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":260,"y":2040,"wires":[["7feda1d5.5ecf8"]]},{"id":"56f2bf81.89055","type":"function","z":"2f633666.5f0b8a","name":"Turn CLF Off ","func":"msg.payload = 'gg' ;\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":2160,"wires":[["3664944d.3c079c","75c62952.8315f8"]]},{"id":"66567579.ad4bbc","type":"delay","z":"2f633666.5f0b8a","name":"","pauseType":"delay","timeout":"0.9","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":270,"y":2160,"wires":[["56f2bf81.89055"]]},{"id":"760bdf19.7a04b","type":"serial out","z":"2f633666.5f0b8a","name":"","serial":"a0ff328f.46b28","x":1200,"y":2020,"wires":[]},{"id":"3664944d.3c079c","type":"function","z":"2f633666.5f0b8a","name":"init","func":"msg.payload = 'done' ; \nmsg.topic = \"Fluorescence2\"; \nmsg.device = 'X-Cite-120PC'; \nmsg.type = 'ligth-source' ; \nmsg.mode = 'init' ; \nmsg.action = 'set' ;\nmsg.update = {'A' : [],'B' : []} ;\nmsg.update['A'] = [10,false ];\nmsg.update['B'] = [\"#EE2334\"];\nmsg.config = {'A' : {}} ;\nmsg.config[\"A\"]=[\"Intensity: <input required name='%A0' id='%A0' type='number' min='0' max='100' step='1'/>\",\"Shutter: <select required name='%A1' id='%A1'><option value=ON>ON</option><option value=OFF>OFF</option></select>\"] ;\nmsg.config[\"B\"]=[\"<br>Color mapping: <input required name='%B0' id='%B0' type='color'>\"];\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":2160,"wires":[["66dedb92.867f34"]]},{"id":"4d541c1b.299ac4","type":"function","z":"2f633666.5f0b8a","name":"X-CITE","func":"\nif((msg.device === 'X-Cite-120PC') && (msg.action === 'setChannel')){\n        var msg2 = {};\n        node.warn(msg.update.A[0]);\n        if(parseInt(msg.update.A[0])< 10) msg.payload = 'd00'+msg.update.A[0];\n        if(parseInt(msg.update.A[0])>= 10) msg.payload = 'd0'+msg.update.A[0];\n        if(parseInt(msg.update.A[0])=== 100) msg.payload = 'd'+msg.update.A[0];\n        msg2.payload = msg.update.A[1] === true ? \"mm\" : \"zz\" ; \n        msg2.device = 'X-Cite-120PC';\n    \n    node.send([msg,msg2]);\n}\n\n","outputs":2,"noerr":0,"x":720,"y":1400,"wires":[["ee5a23c7.0a183"],["40720077.44f95"]],"icon":"node-red/camera.png"},{"id":"40720077.44f95","type":"delay","z":"2f633666.5f0b8a","name":"","pauseType":"delay","timeout":"0.5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":890,"y":1420,"wires":[["75c62952.8315f8","5ad2a1a5.ad757","8c250bc4.e15f58"]]},{"id":"ee5a23c7.0a183","type":"delay","z":"2f633666.5f0b8a","name":"","pauseType":"delay","timeout":"0","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":880,"y":1380,"wires":[["75c62952.8315f8","8c250bc4.e15f58"]]},{"id":"66dedb92.867f34","type":"link out","z":"2f633666.5f0b8a","name":"init xcite","links":["bbe4f267.04b7e"],"x":1015,"y":2160,"wires":[]},{"id":"bbe4f267.04b7e","type":"link in","z":"2f633666.5f0b8a","name":"","links":["66dedb92.867f34"],"x":1035,"y":740,"wires":[["4db784c4.3fb99c"]]},{"id":"75c62952.8315f8","type":"function","z":"2f633666.5f0b8a","name":"","func":"console.log(\"X-Cite-Exact>Request:\"+msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":2020,"wires":[["760bdf19.7a04b"]]},{"id":"1bd5d7ac.d30148","type":"function","z":"2f633666.5f0b8a","name":"X-CITE","func":"\nif((msg.device === 'X-Cite-120PC') &&(msg.action === 'setOFF')){\n    msg.payload = 'zz';\n    return msg ;\n}\n","outputs":1,"noerr":0,"x":720,"y":1480,"wires":[["75c62952.8315f8","5ad2a1a5.ad757"]],"icon":"node-red/camera.png"},{"id":"8c250bc4.e15f58","type":"debug","z":"2f633666.5f0b8a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1130,"y":1380,"wires":[]},{"id":"b926725d.f4a56","type":"serial out","z":"2f633666.5f0b8a","name":"","serial":"61377ccf.63db94","x":1030,"y":1140,"wires":[]},{"id":"a0cf872b.f8f8a8","type":"function","z":"2f633666.5f0b8a","name":"Buzzer","func":"if((msg.device === 'OLYMPUS-IX-81') && (msg.status.autofocus === 'ECHEC') ) node.send({\"payload\" : \"1\"});\nif((msg.device === 'OLYMPUS-IX-81') && (msg.status.autofocus === 'SUCCESS') ) node.send({\"payload\" : \"2\"});","outputs":1,"noerr":0,"x":880,"y":1140,"wires":[["b926725d.f4a56"]]},{"id":"1b2de206.6d096e","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"2","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":730,"y":1200,"wires":[["16edcd5b.08fd33"]]},{"id":"16edcd5b.08fd33","type":"delay","z":"2f633666.5f0b8a","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":880,"y":1200,"wires":[["b926725d.f4a56","c8e86b25.fd4498"]]},{"id":"542690b4.794b8","type":"http in","z":"2f633666.5f0b8a","name":"","url":"/saveTest","method":"post","upload":false,"swaggerDoc":"","x":300,"y":1660,"wires":[["6cfd045c.fff47c","fc9f8f88.8b6e9","fcb0e681.813818","74e6273a.0de8c8"]]},{"id":"6cfd045c.fff47c","type":"http response","z":"2f633666.5f0b8a","name":"","statusCode":"200","headers":{},"x":640,"y":1620,"wires":[]},{"id":"fc9f8f88.8b6e9","type":"function","z":"2f633666.5f0b8a","name":"","func":"context.global.saveMask ='saveMask:' + msg.payload.image;\nmsg.payload = 'saveMask:' + msg.payload.image ;\nreturn msg\n","outputs":1,"noerr":0,"x":630,"y":1660,"wires":[["83fe104b.b40a8"]]},{"id":"3b88bb58.996854","type":"function","z":"2f633666.5f0b8a","name":"filter 1","func":"function getRandomInt(max) {\n  return Math.floor(Math.random() * Math.floor(max));\n}\n\nmsg.payload =  context.global.Microscope1;\nmsg.topic = 'Microscope1';\nmsg.device =  context.global.Microscope1;\nmsg.mode = 'live';\n//msg.action = 'setChannel';\nmsg.action = 'setWheelFilter';\n/*msg.update = {\n    \"intensity\" : 2,\n    \"shutter\" : true,\n    \"lamp\" : true,\n    \"timeout\" : 5000\n}*/\nmsg.update = {\n    \"wheelFilter\" : getRandomInt(5)+1\n}\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":1340,"wires":[[]]},{"id":"539d6929.c0df78","type":"inject","z":"2f633666.5f0b8a","name":"","topic":"","payload":"","payloadType":"date","repeat":"30","crontab":"","once":true,"onceDelay":0.1,"x":210,"y":1340,"wires":[["3b88bb58.996854"]]},{"id":"af49958f.099e38","type":"function","z":"2f633666.5f0b8a","name":"","func":"msg.payload = msg.payload.image.substr(7,msg.payload.image.length);\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":1800,"wires":[["de67c445.882578","1695bd02.830253"]]},{"id":"de67c445.882578","type":"file","z":"2f633666.5f0b8a","name":"","filename":"C:\\Users\\labo\\customizeNode\\node-red-contrib-andor-mosaic3\\AndorMosaic3\\base64.txt","appendNewline":false,"createDir":true,"overwriteFile":"true","x":1370,"y":1800,"wires":[[]]},{"id":"483efe72.d8ef3","type":"http in","z":"2f633666.5f0b8a","name":"","url":"/activateMask","method":"post","upload":false,"swaggerDoc":"","x":310,"y":1800,"wires":[["af49958f.099e38","6cfd045c.fff47c"]]},{"id":"1695bd02.830253","type":"delay","z":"2f633666.5f0b8a","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":640,"y":1840,"wires":[["62838878.ef4528"]]},{"id":"62838878.ef4528","type":"exec","z":"2f633666.5f0b8a","command":"python C:\\Users\\labo\\customizeNode\\node-red-contrib-andor-mosaic3\\AndorMosaic3\\convert.py","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1390,"y":1840,"wires":[[],[],[]]},{"id":"228dccae.14f9b4","type":"http in","z":"2f633666.5f0b8a","name":"","url":"/desactivateMask","method":"post","upload":false,"swaggerDoc":"","x":280,"y":1920,"wires":[["f982bd58.2babd","6cfd045c.fff47c"]]},{"id":"771dcc6e.b03394","type":"file","z":"2f633666.5f0b8a","name":"","filename":"C:\\Users\\labo\\customizeNode\\node-red-contrib-andor-mosaic3\\AndorMosaic3\\mosaic_status.txt","appendNewline":false,"createDir":true,"overwriteFile":"true","x":1390,"y":1920,"wires":[[]]},{"id":"f982bd58.2babd","type":"function","z":"2f633666.5f0b8a","name":"","func":"var msg2 = {};\nmsg.payload = 'OFF';\nmsg2.payload = 'WAIT';\n\nreturn [msg,msg2];","outputs":2,"noerr":0,"x":630,"y":1920,"wires":[["20cf5f47.f2893"],["7ac40fe9.3baf4"]]},{"id":"7ac40fe9.3baf4","type":"delay","z":"2f633666.5f0b8a","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":780,"y":1940,"wires":[["771dcc6e.b03394"]]},{"id":"20cf5f47.f2893","type":"delay","z":"2f633666.5f0b8a","name":"","pauseType":"delay","timeout":"0","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":780,"y":1900,"wires":[["771dcc6e.b03394","1e220462.78608c"]]},{"id":"c8e86b25.fd4498","type":"exec","z":"2f633666.5f0b8a","command":" start \"google\" \"c:\\program files (x86)\\Google\\Chrome\\Application\\chrome.exe\" \"http://127.0.0.1:1880/missmarple\"","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1360,"y":1240,"wires":[[],[],[]]},{"id":"74e6273a.0de8c8","type":"function","z":"2f633666.5f0b8a","name":"Man","func":"msg.payload = msg.payload.image.substr(22,msg.payload.image.length);\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":1760,"wires":[["de67c445.882578"]]},{"id":"fcb0e681.813818","type":"debug","z":"2f633666.5f0b8a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":610,"y":1560,"wires":[]},{"id":"5ad2a1a5.ad757","type":"function","z":"2f633666.5f0b8a","name":"X-CITE","func":"if(msg.device === 'X-Cite-120PC'){\n    msg.device = 'X-Cite-120PC';\n    msg.topic = \"Fluorescence2\"; \nmsg.type = 'ligth-source' ; \n        msg.payload = 'done';\n    node.send(msg);\n}\n","outputs":1,"noerr":0,"x":980,"y":1500,"wires":[["fbf8ea6c.6e9288"]],"icon":"node-red/camera.png"},{"id":"83fe104b.b40a8","type":"websocket out","z":"2f633666.5f0b8a","name":"","server":"5ddbe829.05e198","client":"","x":840,"y":1660,"wires":[]},{"id":"4557a939.b19118","type":"function","z":"2f633666.5f0b8a","name":"Auto","func":"if((msg.device === 'MOSAIC')&&(msg.action ==='EXP')){\n    msg.payload = msg.img.substr(7,msg.img.length);\n    return msg;\n}","outputs":1,"noerr":0,"x":590,"y":1720,"wires":[["1695bd02.830253","ba6480d7.c2c28","de67c445.882578"]]},{"id":"948dd2a4.b3835","type":"function","z":"2f633666.5f0b8a","name":"Auto","func":"if((msg.device === 'MOSAIC')&&(msg.action ==='NEXP')){\n    msg.payload = 'done';   \n    return msg;\n}","outputs":1,"noerr":0,"x":630,"y":1880,"wires":[["f982bd58.2babd"]]},{"id":"ba6480d7.c2c28","type":"delay","z":"2f633666.5f0b8a","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":800,"y":1720,"wires":[["1e220462.78608c"]]},{"id":"1e220462.78608c","type":"function","z":"2f633666.5f0b8a","name":"Auto","func":"\n    msg.payload ='done';\n    msg.topic = 'Mosaic';\n    msg.device = 'MOSAIC';\n    return msg;\n","outputs":1,"noerr":0,"x":950,"y":1720,"wires":[["fbf8ea6c.6e9288"]]},{"id":"8feea057.c0fee","type":"debug","z":"2f633666.5f0b8a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":960,"y":360,"wires":[]},{"id":"9ee1929a.a3afd","type":"function","z":"ab1796ad.d3dd28","name":"","func":"if(msg.payload === false) msg.enabled = false ;\nelse msg.enabled = true ;\nreturn msg;","outputs":1,"noerr":0,"x":1390,"y":540,"wires":[["84e3a7d7.b66828","7579d82f.ffaa78","7f441ed.d4993e","c941dd77.cfba","8928d67e.2bcf78","da44e4e3.6c84d8","32d6171e.d4b8d8","39a3f4da.8fa23c","26aca05c.8bdfb","895ee92d.1a0558","e620dc93.bf639"]]},{"id":"296798e7.4ffa48","type":"delay","z":"ab1796ad.d3dd28","name":"","pauseType":"random","timeout":"0.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"2","randomUnits":"seconds","drop":false,"x":1780,"y":760,"wires":[["5ab78101.3cc92"]]},{"id":"64a1a5c4.727e5c","type":"delay","z":"ab1796ad.d3dd28","name":"","pauseType":"random","timeout":"0.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"2","randomUnits":"seconds","drop":false,"x":1780,"y":800,"wires":[["5ab78101.3cc92"]]},{"id":"77857875.0f41d8","type":"delay","z":"ab1796ad.d3dd28","name":"","pauseType":"random","timeout":"0.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"2","randomUnits":"seconds","drop":false,"x":1780,"y":840,"wires":[["5ab78101.3cc92"]]},{"id":"471fc6a9.2f0558","type":"delay","z":"ab1796ad.d3dd28","name":"","pauseType":"random","timeout":"0.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"2","randomUnits":"seconds","drop":false,"x":1780,"y":880,"wires":[["5ab78101.3cc92"]]},{"id":"8b754f78.545e9","type":"delay","z":"ab1796ad.d3dd28","name":"","pauseType":"random","timeout":"0.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"2","randomUnits":"seconds","drop":false,"x":1780,"y":920,"wires":[["5ab78101.3cc92"]]},{"id":"6cf50f41.d2cc","type":"delay","z":"ab1796ad.d3dd28","name":"","pauseType":"random","timeout":"0.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"2","randomUnits":"seconds","drop":false,"x":1780,"y":960,"wires":[["5ab78101.3cc92"]]},{"id":"e2a6e00a.6b00e","type":"delay","z":"ab1796ad.d3dd28","name":"","pauseType":"random","timeout":"0.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"2","randomUnits":"seconds","drop":false,"x":1780,"y":1000,"wires":[["5ab78101.3cc92"]]},{"id":"8928d67e.2bcf78","type":"ui_dropdown","z":"ab1796ad.d3dd28","name":"","label":"Device","group":"fe8ba4c0.c72178","order":2,"width":"10","height":"1","passthru":true,"options":[{"label":"CoolLed_pE4000_2","value":"CoolLed_pE4000_2","type":"str"}],"payload":"","topic":"device","x":1610,"y":760,"wires":[["296798e7.4ffa48"]]},{"id":"5ab78101.3cc92","type":"function","z":"ab1796ad.d3dd28","name":"","func":"context.data2 = context.data2 || {} ;\ncontext.data2[msg.topic] = msg.payload ;\nif((Object.keys(context.data2).length > 8)&& (msg.topic === 'action')){\n    msg.payload = context.dat2 ;\n    delete msg.topic;\n    return msg;\n}","outputs":1,"noerr":0,"x":1930,"y":720,"wires":[[]]},{"id":"f749806d.cca3d","type":"link out","z":"ab1796ad.d3dd28","name":"activate2","links":["73f534e1.0458ec"],"x":1735,"y":720,"wires":[]},{"id":"73f534e1.0458ec","type":"link in","z":"ab1796ad.d3dd28","name":"","links":["f749806d.cca3d"],"x":1295,"y":540,"wires":[["9ee1929a.a3afd"]]},{"id":"bbcdb4a8.fd7e68","type":"debug","z":"dbe04189.6c773","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1070,"y":740,"wires":[]},{"id":"db847c20.6e0a7","type":"exec","z":"dbe04189.6c773","command":"dir","addpay":false,"append":"C:\\Users\\Williams\\.node-red\\lib\\media\\test2\\*.png","useSpawn":"false","timer":"","oldrc":false,"name":"","x":390,"y":180,"wires":[["9cdfe938.97ca28"],[],[]]},{"id":"9cdfe938.97ca28","type":"function","z":"dbe04189.6c773","name":"","func":"msg.payload = msg.payload.toString();\nvar split1 = msg.payload.split('Agar');\nnode.warn('split1'+split1);\nvar split2 = [];\nfor(var i=0;i<split1.length;i++)\n    if(split1[i].substr(0,5)==='Pad1-')\n        split2.push('media/test2/Agar'+split1[i].split('\\n')[0]);\nnode.warn('split2'+split2[0]);\ncontext.global.j = 0 ;\ncontext.global.r = setInterval(function(){\n    if(context.global.j<split2.length){\n        msg.payload = {};\n        /*var l = (('C:/Users/Williams/.node-red/lib/'+split2[context.global.j]).length-1)\n        msg.filename = ('C:/Users/Williams/.node-red/lib/'+split2[context.global.j]).substr(0,l);\n        msg.type = 'img';\n        msg.valeur = split2[context.global.j];*/\n        msg.payload.type = 'img';\n        msg.payload.valeur = split2[context.global.j];\n        context.global.j = context.global.j +1  ;\n        node.send([msg]);\n    } else clearInterval(context.global.r);\n},1000);","outputs":1,"noerr":0,"x":530,"y":180,"wires":[["bce48f56.7f5fb"]]},{"id":"76db7630.488c58","type":"file in","z":"dbe04189.6c773","name":"","filename":"","format":"utf8","chunk":false,"sendError":false,"x":690,"y":140,"wires":[["29341e57.c92f32"]]},{"id":"29341e57.c92f32","type":"change","z":"dbe04189.6c773","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.src","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":180,"wires":[["544a72ea.46bffc"]]},{"id":"544a72ea.46bffc","type":"change","z":"dbe04189.6c773","name":"","rules":[{"t":"move","p":"type","pt":"msg","to":"payload.type","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":180,"wires":[["d37260e7.fa165"]]},{"id":"d37260e7.fa165","type":"change","z":"dbe04189.6c773","name":"","rules":[{"t":"move","p":"valeur","pt":"msg","to":"payload.valeur","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1190,"y":180,"wires":[["fe951eb4.55f44"]]},{"id":"1f8c70ca.13f4df","type":"exec","z":"dbe04189.6c773","command":"dir","addpay":false,"append":"C:\\Users\\Williams\\.node-red\\lib\\media\\test2\\*.png_curve.txt","useSpawn":"false","timer":"","oldrc":false,"name":"","x":390,"y":240,"wires":[["3f90d2e3.bab97e"],[],[]]},{"id":"3f90d2e3.bab97e","type":"function","z":"dbe04189.6c773","name":"","func":"msg.payload = msg.payload.toString();\nvar split1 = msg.payload.split('Agar');\nnode.warn('split1'+split1);\nvar split2 = [];\nfor(var i=0;i<split1.length;i++)\n    if(split1[i].substr(0,5)==='Pad1-')\n        split2.push('media/test2/Agar'+split1[i].split('\\n')[0]);\nnode.warn('split2'+split2[0]);\ncontext.global.j = 0 ;\ncontext.global.r = setInterval(function(){\n    if(context.global.j<split2.length){\n        msg.payload = {};\n        var l = (('C:/Users/Williams/.node-red/lib/'+split2[context.global.j]).length-1)\n        msg.filename = ('C:/Users/Williams/.node-red/lib/'+split2[context.global.j]).substr(0,l);\n        msg.type = 'img-curve';\n        msg.valeur = split2[context.global.j];\n        context.global.j = context.global.j +1  ;\n        node.send([msg]);\n    } else clearInterval(context.global.r);\n},2000);","outputs":1,"noerr":0,"x":530,"y":240,"wires":[["95ea076c.578078"]]},{"id":"95ea076c.578078","type":"file in","z":"dbe04189.6c773","name":"","filename":"","format":"utf8","chunk":false,"sendError":false,"x":650,"y":240,"wires":[["843eb45d.042ad8"]]},{"id":"843eb45d.042ad8","type":"change","z":"dbe04189.6c773","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.src","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":240,"wires":[["eaf393f6.635c8"]]},{"id":"eaf393f6.635c8","type":"change","z":"dbe04189.6c773","name":"","rules":[{"t":"move","p":"type","pt":"msg","to":"payload.type","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":240,"wires":[["976a03f3.b6bc"]]},{"id":"976a03f3.b6bc","type":"change","z":"dbe04189.6c773","name":"","rules":[{"t":"move","p":"valeur","pt":"msg","to":"payload.valeur","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1190,"y":240,"wires":[["bce48f56.7f5fb"]]},{"id":"fe951eb4.55f44","type":"delay","z":"dbe04189.6c773","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1400,"y":180,"wires":[["bce48f56.7f5fb"]]},{"id":"c70be8d1.c00688","type":"inject","z":"dbe04189.6c773","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":300,"y":740,"wires":[["d6684c5b.46d3b"]]},{"id":"d6684c5b.46d3b","type":"exec","z":"dbe04189.6c773","command":"C:\\Users\\Williams\\.node-red\\lib\\media\\test2\\convertToBase64.py","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":670,"y":740,"wires":[["bbcdb4a8.fd7e68"],[],[]]},{"id":"c05ed046.372fe","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"{\"expanded\":true,\"key\":\"root_1\",\"title\":\"root\",\"children\":[{\"expanded\":true,\"key\":\"_2\",\"selected\":false,\"title\":\"Protocol\",\"type\":\"PROT\",\"data\":{\"config\":0,\"comment\":\"\",\"prefix\":\"\"},\"children\":[{\"expanded\":true,\"key\":\"_5\",\"selected\":false,\"title\":\"Group Position\",\"type\":\"GROUP\",\"skeep\":1,\"children\":[{\"expanded\":true,\"key\":\"_6\",\"selected\":false,\"title\":\"List of positions\",\"type\":\"LIST\",\"children\":[{\"expanded\":false,\"key\":\"_5\",\"selected\":false,\"title\":\"XYZ Position -1\",\"type\":\"XYZ\",\"skeep\":1,\"data\":{\"xPosition\":0,\"yPosition\":0,\"zPosition\":0,\"res1\":1,\"res2\":10}},{\"expanded\":false,\"key\":\"_5\",\"selected\":false,\"title\":\"XYZ Position 0\",\"type\":\"XYZ\",\"skeep\":1,\"data\":{\"xPosition\":0,\"yPosition\":0,\"zPosition\":0,\"res1\":1,\"res2\":10}},{\"expanded\":false,\"key\":\"_5\",\"selected\":false,\"title\":\"XYZ Position 1\",\"type\":\"XYZ\",\"skeep\":1,\"data\":{\"xPosition\":0,\"yPosition\":0,\"zPosition\":0,\"res1\":1,\"res2\":10}}]},{\"expanded\":false,\"key\":\"_6\",\"selected\":false,\"title\":\"Autofocus\",\"type\":\"AF\",\"data\":{\"lower\":30,\"upper\":30,\"aftbl\":\"LCPlanFl 40x\"}},{\"expanded\":false,\"key\":\"_7\",\"selected\":false,\"title\":\"SC1 +Picture\",\"type\":\"CAMERA\",\"data\":{\"time\":100,\"skip\":0,\"number\":1,\"zoffset\":0}}]},{\"expanded\":true,\"key\":\"_5\",\"selected\":false,\"title\":\"XYZ Position 2\",\"type\":\"XYZ\",\"skeep\":1,\"data\":{\"xPosition\":0,\"yPosition\":0,\"zPosition\":0,\"res1\":1,\"res2\":10},\"children\":[{\"expanded\":false,\"key\":\"_6\",\"selected\":false,\"title\":\"Autofocus\",\"type\":\"AF\",\"data\":{\"lower\":30,\"upper\":30,\"aftbl\":\"LCPlanFl 40x\"}},{\"expanded\":false,\"key\":\"_7\",\"selected\":false,\"title\":\"SC1 +Picture\",\"type\":\"CAMERA\",\"data\":{\"time\":100,\"skip\":0,\"number\":1,\"zoffset\":0}}]},{\"expanded\":true,\"key\":\"_8\",\"selected\":false,\"title\":\"Sequence 1\",\"type\":\"LOOP\",\"data\":{\"time\":\"10\",\"repeat\":\"4\"},\"children\":[{\"expanded\":true,\"key\":\"_5\",\"selected\":false,\"title\":\"XYZ Position 10\",\"type\":\"XYZ\",\"skeep\":1,\"data\":{\"xPosition\":0,\"yPosition\":0,\"zPosition\":0,\"res1\":1,\"res2\":10},\"children\":[{\"key\":\"_13\",\"selected\":false,\"title\":\"Autofocus\",\"type\":\"AF\",\"data\":{\"lower\":30,\"upper\":30,\"aftbl\":\"LCPlanFl 40x\"}},{\"expanded\":false,\"key\":\"_14\",\"selected\":false,\"title\":\"SC1 + Picture\",\"type\":\"CAMERA\",\"data\":{\"time\":100,\"skip\":0,\"number\":1,\"zoffset\":0}},{\"expanded\":false,\"key\":\"_16\",\"selected\":false,\"title\":\"Mosaic\",\"type\":\"Mosaic\",\"data\":{\"image\":\"\"}},{\"key\":\"_4\",\"selected\":false,\"title\":\"SC4 + ZS\",\"type\":\"ZS\",\"data\":{\"skip\":0,\"zstart\":-5,\"zend\":5,\"zstep\":1,\"shutter\":true}}]},{\"expanded\":true,\"key\":\"_5\",\"selected\":false,\"title\":\"XYZ Position 20\",\"type\":\"XYZ\",\"skeep\":1,\"data\":{\"xPosition\":0,\"yPosition\":0,\"zPosition\":0,\"res1\":1,\"res2\":10},\"children\":[{\"key\":\"_13\",\"selected\":false,\"title\":\"Autofocus\",\"type\":\"AF\",\"data\":{\"lower\":30,\"upper\":30,\"aftbl\":\"LCPlanFl 40x\"}},{\"expanded\":false,\"key\":\"_14\",\"selected\":false,\"title\":\"SC2 + Picture\",\"type\":\"CAMERA\",\"data\":{\"time\":100,\"skip\":0,\"number\":1,\"zoffset\":0}},{\"expanded\":false,\"key\":\"_16\",\"selected\":false,\"title\":\"Mosaic\",\"type\":\"Mosaic\",\"skeep\":0,\"data\":{\"image\":\"\"}},{\"key\":\"_4\",\"selected\":false,\"title\":\"SC3 + ZS\",\"type\":\"ZS\",\"data\":{\"skip\":0,\"zstart\":-5,\"zend\":5,\"zstep\":1,\"shutter\":true}}]},{\"expanded\":true,\"key\":\"_5\",\"selected\":false,\"title\":\"Group Position\",\"type\":\"GROUP\",\"skeep\":2,\"children\":[{\"expanded\":true,\"key\":\"_6\",\"selected\":false,\"title\":\"List of positions\",\"type\":\"LIST\",\"children\":[{\"expanded\":false,\"key\":\"_5\",\"selected\":false,\"title\":\"XYZ Position 30\",\"type\":\"XYZ\",\"skeep\":2,\"data\":{\"xPosition\":0,\"yPosition\":0,\"zPosition\":0,\"res1\":1,\"res2\":10}},{\"expanded\":false,\"key\":\"_5\",\"selected\":false,\"title\":\"XYZ Position 40\",\"type\":\"XYZ\",\"skeep\":1,\"data\":{\"xPosition\":0,\"yPosition\":0,\"zPosition\":0,\"res1\":1,\"res2\":10}},{\"expanded\":false,\"key\":\"_5\",\"selected\":false,\"title\":\"XYZ Position 455\",\"type\":\"XYZ\",\"skeep\":2,\"data\":{\"xPosition\":0,\"yPosition\":0,\"zPosition\":0,\"res1\":1,\"res2\":10}}]},{\"expanded\":false,\"key\":\"_6\",\"selected\":false,\"title\":\"Autofocus\",\"type\":\"AF\",\"data\":{\"lower\":30,\"upper\":30,\"aftbl\":\"LCPlanFl 40x\"}},{\"expanded\":false,\"key\":\"_7\",\"selected\":false,\"title\":\"SC1 +Picture\",\"type\":\"CAMERA\",\"data\":{\"time\":100,\"skip\":0,\"number\":1,\"zoffset\":0}}]},{\"expanded\":true,\"key\":\"_8\",\"selected\":true,\"title\":\"Sequence 2\",\"type\":\"LOOP\",\"data\":{\"time\":\"2\",\"repeat\":\"4\"},\"children\":[{\"expanded\":true,\"key\":\"_5\",\"selected\":false,\"title\":\"XYZ Position 50\",\"type\":\"XYZ\",\"skeep\":1,\"data\":{\"xPosition\":0,\"yPosition\":0,\"zPosition\":0,\"res1\":1,\"res2\":10},\"children\":[{\"key\":\"_13\",\"selected\":false,\"title\":\"Autofocus\",\"type\":\"AF\",\"data\":{\"lower\":30,\"upper\":30,\"aftbl\":\"LCPlanFl 40x\"}},{\"key\":\"_4\",\"selected\":false,\"title\":\"SC4 + ZS\",\"type\":\"ZS\",\"data\":{\"skip\":0,\"zstart\":-5,\"zend\":5,\"zstep\":1,\"shutter\":true}}]},{\"expanded\":true,\"key\":\"_5\",\"selected\":false,\"title\":\"XYZ Position 60\",\"type\":\"XYZ\",\"skeep\":1,\"data\":{\"xPosition\":0,\"yPosition\":0,\"zPosition\":0,\"res1\":1,\"res2\":10},\"children\":[{\"key\":\"_13\",\"selected\":false,\"title\":\"Autofocus\",\"type\":\"AF\",\"data\":{\"lower\":30,\"upper\":30,\"aftbl\":\"LCPlanFl 40x\"}},{\"expanded\":false,\"key\":\"_16\",\"selected\":false,\"title\":\"Mosaic\",\"type\":\"Mosaic\",\"skeep\":1,\"data\":{\"image\":\"\"}},{\"expanded\":false,\"key\":\"_14\",\"selected\":false,\"title\":\"SC6 + Picture\",\"skeep\":1,\"type\":\"CAMERA\",\"data\":{\"time\":100,\"skip\":0,\"number\":1,\"zoffset\":0}}]},{\"expanded\":true,\"key\":\"_5\",\"selected\":false,\"title\":\"Group Position\",\"type\":\"GROUP\",\"skeep\":1,\"children\":[{\"expanded\":true,\"key\":\"_6\",\"selected\":false,\"title\":\"List of positions\",\"type\":\"LIST\",\"children\":[{\"expanded\":false,\"key\":\"_5\",\"selected\":false,\"title\":\"XYZ Position 70\",\"type\":\"XYZ\",\"skeep\":1,\"data\":{\"xPosition\":0,\"yPosition\":0,\"zPosition\":0,\"res1\":1,\"res2\":10}},{\"expanded\":false,\"key\":\"_5\",\"selected\":false,\"title\":\"XYZ Position 80\",\"type\":\"XYZ\",\"skeep\":1,\"data\":{\"xPosition\":0,\"yPosition\":0,\"zPosition\":0,\"res1\":1,\"res2\":10}}]},{\"expanded\":false,\"key\":\"_6\",\"selected\":false,\"title\":\"Autofocus\",\"type\":\"AF\",\"data\":{\"lower\":30,\"upper\":30,\"aftbl\":\"LCPlanFl 40x\"}},{\"expanded\":false,\"key\":\"_7\",\"selected\":false,\"title\":\"SC1 +Picture\",\"type\":\"CAMERA\",\"data\":{\"time\":100,\"skip\":0,\"number\":1,\"zoffset\":0}}]}]}]},{\"expanded\":true,\"key\":\"_5\",\"selected\":false,\"title\":\"XYZ Position 90\",\"type\":\"XYZ\",\"skeep\":1,\"data\":{\"xPosition\":0,\"yPosition\":0,\"zPosition\":0,\"res1\":1,\"res2\":10},\"children\":[{\"key\":\"_6\",\"selected\":false,\"title\":\"Autofocus\",\"type\":\"AF\",\"data\":{\"lower\":30,\"upper\":30,\"aftbl\":\"LCPlanFl 40x\"}},{\"expanded\":false,\"key\":\"_7\",\"selected\":false,\"title\":\"SC1 +Picture\",\"type\":\"CAMERA\",\"data\":{\"time\":100,\"skip\":0,\"number\":1,\"zoffset\":0}}]}]}],\"type\":\"mda\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":3990,"y":140,"wires":[["ff5fe803.8a16f8"]]},{"id":"fc93b1a3.ddfd1","type":"debug","z":"cb80149c.966208","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":4370,"y":80,"wires":[]},{"id":"ff5fe803.8a16f8","type":"function","z":"cb80149c.966208","name":"treeToDictAction","func":"/*\nWilliams BRETT - 12/09/2019\nPrincipe de fonctionnement du code:\n*/\ncontext.global.tableInstruction = {} ; \ncontext.global.tableTimeIndex = 0 ; \ncontext.global.tableInstruction[String(context.global.tableTimeIndex)] = [] ;\n\nnode.status ({fill:\"red\",shape:\"dot\", text: \"Build instructions table\"});\nvar protocol = msg.payload.children;\nbuildChildrenTableInstruction(protocol[0].children,buildBooleanTrueTable(getNbChildren(protocol[0].children),1),'PROT'); /*? pk 100 ?*/\nnode.status ({fill:\"green\",shape:\"dot\", text: \"Generate !\"});\nnode.send({payload : context.global.tableInstruction});\n\n/* cette fonction permet de construire les instructions du séquenceur */\nfunction buildChildrenTableInstruction(obj,enabledChildren,parent){\n    var repeat = getNbChildren(obj); //nbre d'enfant du protocole\n    var iterator = 1 ; //par défaut on itère une fois sauf dans le cas d'une séquence et d'un groupe de positions\n    while(repeat > 0){\n        var childrenN = obj[getNbChildren(obj)-repeat] ; //on récupère l'enfant courant de la boucle d'occurence\n        if(childrenN.type === 'LOOP'){ iterator = parseInt(childrenN.data.repeat) ;} //ici nous sommes en prèsence d'une séquence\n        if(childrenN.type === 'GROUP') {iterator = getNbChildren(childrenN.children[0].children) ;} //ici, nous sommes en présence d'un groupe de positions\n        var iteratorCopy = iterator; //copie de l'itérateur pour balayer l'object JSON\n        while(iterator > 0){\n            if(childrenN.type === 'GROUP'){\n                if(enabledChildren[getNbChildren(obj)-repeat][0]===true){ /* vérification des flags d'activation transmis avant la récurssivité pour un groupe entier de positions*/\n                    //si il n'y a pas de loop, le skip n'a pas d'intéret car il n'y a pas de récurrence\n                    if((parent !== 'LOOP')||(enabledChildren[getNbChildren(obj)-repeat][iteratorCopy-iterator+1]===true)){\n                        buildMdaInstruction(childrenN.children[0].children[iteratorCopy-iterator]);\n                        buildChildrenTableInstruction(childrenN.children,enabledChildren,childrenN.type);\n                    }\n                }\n            }\n            else {\n                if((childrenN.type === 'LOOP')){\n                    enabledChildren = buildBooleanTrueTable(iteratorCopy,1); //tableau de validation des enfants\n                    //i c'est le compteur d'occurence de la boucle\n                    for(i=0;i<getNbChildren(childrenN.children);i++){/*Ici on test pour les positions XYZ s'il y a des fréquences d'itérations > 1 si oui, il faut utiliser la fonction modulos, pour supprimer les positions en fonction de la fréquence d'itération de la boucle, Idem pour les groupes de positions, Idem pour les loop*/\n                        if(childrenN.hasOwnProperty('children')&&childrenN.children[i].hasOwnProperty('skeep')&&(childrenN.children[i].type==='XYZ')) //les positions, marquage des positions a ne pas réaliser\n                            if((iterator%childrenN.children[i].skeep===0)===false)  enabledChildren[i][0] = false;\n                        if(childrenN.hasOwnProperty('children')&&childrenN.children[i].hasOwnProperty('skeep')&&(childrenN.children[i].type==='GROUP')){/*les groupes de positions: idem*/\n                            if((iterator%childrenN.children[i].skeep===0)===false) enabledChildren[i][0] = false; //groupe entier\n                            for(var k=0;k<getNbChildren(childrenN.children[i].children[0].children);k++){ //pour les positions des groupes de positions, on étend le tableau en terme de colonne pour répliquer le même schéma que pour les groupes de positions ou positions simples\n                                if((iterator%childrenN.children[i].children[0].children[k].skeep===0)===false) enabledChildren[i].push(false);\n                                else enabledChildren[i].push(true);\n                            }\n                        } \n                    }\n                    /*après suppression, s'il y a des enfants on construit par récurssivité en transmettant les flags d'activation*/\n                    if(childrenN.hasOwnProperty('children')) buildChildrenTableInstruction(childrenN.children,enabledChildren,childrenN.type);\n                    if((parseInt(childrenN.data.repeat-1))>=iterator){ /*Detection du moment où créer le nouvel indice temporaire*/\n                    /*ici on va calculer l'indice temporaire en fonction de la séquence, si la valeur calculée 1 est supérieure, on remplace l'indice temporaire, si on est inférieur on ajoute à la valeur courante de l'indice temporaire*/\n//                        context.global.tableTimeIndex += parseInt(childrenN.data.time) ;\n//                        context.global.tableInstruction[String(context.global.tableTimeIndex)] = [] ;\n                    } \n                }\n                else {\n                    if(childrenN.type !== 'LIST'){\n                        if(enabledChildren[getNbChildren(obj)-repeat][0]===true){ /* vérification des flags d'activation transmis avant la récurssivité */\n                            buildMdaInstruction(childrenN);\n                            if(childrenN.hasOwnProperty('children')) buildChildrenTableInstruction(childrenN.children,enabledChildren,childrenN.type);\n                        }        \n                    }\n                }\n            }\n            iterator--;\n        }\n        iterator = 1 ;\n        repeat--;\n    }\n}\n/*cette fonction retourne le nombre d'enfants d'une branche*/\nfunction getNbChildren(obj){\n    return obj.length ;\n}\n/*cette fonction construit la table d'instructions pour controller les équipements de cyberScope en fonction des variables globales*/\nfunction buildMdaInstruction(obj){\n    node.warn(obj.title+'-'+obj.type);\n /*   switch(obj.type){\n        case 'AF':\n            node.warn('Autofocus');\n            break;\n        case 'XYZ':\n            node.warn('Go to position');\n            break;\n        //case 'LIGHT':\n        //    node.warn('Switch on the light');\n        //    break;\n        default:\n            break\n    }*/\n    \n    /*context.global.tableInstruction[String(context.global.tableTimeIndex)].push({\n    \"type\" : childrenN.children[0].children[iteratorCopy-iterator].title\n    });*/\n}\n/*fonction de création d'une table 2D en boolean*/\nfunction buildBooleanTrueTable(lg1,lg2){\n    var outputTable = [] ;\n    for(var i=0;i<lg1;i++) outputTable[i] = [lg2] ;\n    for(i=0;i<lg1;i++) for(var j=0;j<lg2;j++) outputTable[i][j] = true ;\n    return outputTable;\n}","outputs":1,"noerr":0,"x":4200,"y":140,"wires":[["fc93b1a3.ddfd1"]]},{"id":"8db182da.d08f4","type":"inject","z":"1ba9e059.87ebc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":180,"wires":[["9674bca7.1928d"]]},{"id":"540501ff.d2664","type":"osc","z":"1ba9e059.87ebc","name":"","path":"","metadata":true,"x":590,"y":180,"wires":[["37297a3e.4c4796"]]},{"id":"934fa096.634f5","type":"debug","z":"1ba9e059.87ebc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":790,"y":300,"wires":[]},{"id":"baa776fc.20c0a8","type":"osc","z":"1ba9e059.87ebc","name":"","path":"","metadata":true,"x":590,"y":300,"wires":[["934fa096.634f5"]]},{"id":"37297a3e.4c4796","type":"udp out","z":"1ba9e059.87ebc","name":"","addr":"localhost","iface":"","port":"1235","ipv":"udp4","outport":"","base64":false,"multicast":"false","x":810,"y":180,"wires":[]},{"id":"f20a6aff.163778","type":"udp in","z":"1ba9e059.87ebc","name":"","iface":"","port":"1235","ipv":"udp4","multicast":"false","group":"","datatype":"buffer","x":220,"y":300,"wires":[["baa776fc.20c0a8"]]},{"id":"9674bca7.1928d","type":"function","z":"1ba9e059.87ebc","name":"","func":"msg.payload = {\n    \"packets\": [\n        {\n            \"address\": \"/carrier/frequency\",\n            \"args\": [\n                {\n                    \"type\": \"f\",\n                    \"value\": 440\n                }\n            ]\n        },\n        {\n            \"address\": \"/carrier/amplitude\",\n            \"args\": [\n                {\n                    \"type\": \"f\",\n                    \"value\": 0.5\n                }\n            ]\n        },\n        {\n            \"address\": \"/blob\",\n                    \"args\": [\n                    {\n                        \"type\": \"b\",\n                        \"value\": [0x63, 0x61, 0x74, 0x21]\n                    }\n                    ]\n            \n        }\n    ]\n}\nreturn msg;\n","outputs":1,"noerr":0,"x":410,"y":180,"wires":[["540501ff.d2664"]]},{"id":"fbfa0d3f.0dd8e","type":"comment","z":"1ba9e059.87ebc","name":"Send a bundle over OSC","info":"","x":270,"y":140,"wires":[]},{"id":"d7b33974.a3c8e8","type":"comment","z":"1ba9e059.87ebc","name":"Receive a bundle over OSC (udp in must be set to Buffer)","info":"","x":370,"y":260,"wires":[]},{"id":"5478b3c3.e0f6bc","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"{\"expanded\":true,\"key\":\"_8\",\"selected\":true,\"title\":\"Sequence 2\",\"type\":\"LOOP\",\"data\":{\"time\":\"2\",\"repeat\":\"4\"},\"children\":[{\"expanded\":true,\"key\":\"_5\",\"selected\":false,\"title\":\"XYZ Position 50\",\"type\":\"XYZ\",\"skeep\":1,\"data\":{\"xPosition\":0,\"yPosition\":0,\"zPosition\":0,\"res1\":1,\"res2\":10},\"children\":[{\"key\":\"_13\",\"selected\":false,\"title\":\"Autofocus\",\"type\":\"AF\",\"data\":{\"lower\":30,\"upper\":30,\"aftbl\":\"LCPlanFl 40x\"}},{\"key\":\"_4\",\"selected\":false,\"title\":\"SC4 + ZS\",\"type\":\"LIGHT\",\"skeep\":1,\"data\":{\"skip\":0,\"zstart\":-5,\"zend\":5,\"zstep\":1,\"shutter\":true}}]},{\"expanded\":true,\"key\":\"_5\",\"selected\":false,\"title\":\"XYZ Position 60\",\"type\":\"XYZ\",\"skeep\":2,\"data\":{\"xPosition\":0,\"yPosition\":0,\"zPosition\":0,\"res1\":1,\"res2\":10},\"children\":[{\"key\":\"_13\",\"selected\":false,\"title\":\"Autofocus\",\"type\":\"AF\",\"data\":{\"lower\":30,\"upper\":30,\"aftbl\":\"LCPlanFl 40x\"}},{\"expanded\":false,\"key\":\"_16\",\"selected\":false,\"title\":\"Mosaic\",\"type\":\"Mosaic\",\"skeep\":1,\"data\":{\"image\":\"\"}},{\"expanded\":false,\"key\":\"_14\",\"selected\":false,\"title\":\"SC6 + Picture\",\"skeep\":1,\"type\":\"LIGHT\",\"data\":{\"time\":100,\"skip\":0,\"number\":1,\"zoffset\":0}}]},{\"expanded\":true,\"key\":\"_5\",\"selected\":false,\"title\":\"Group Position\",\"type\":\"GROUP\",\"skeep\":1,\"children\":[{\"expanded\":true,\"key\":\"_6\",\"selected\":false,\"title\":\"List of positions\",\"type\":\"LIST\",\"children\":[{\"expanded\":false,\"key\":\"_5\",\"selected\":false,\"title\":\"XYZ Position 70\",\"type\":\"XYZ\",\"skeep\":1,\"data\":{\"xPosition\":0,\"yPosition\":0,\"zPosition\":0,\"res1\":1,\"res2\":10}},{\"expanded\":false,\"key\":\"_5\",\"selected\":false,\"title\":\"XYZ Position 80\",\"type\":\"XYZ\",\"skeep\":1,\"data\":{\"xPosition\":0,\"yPosition\":0,\"zPosition\":0,\"res1\":1,\"res2\":10}}]},{\"expanded\":false,\"key\":\"_6\",\"selected\":false,\"title\":\"Autofocus\",\"type\":\"AF\",\"skeep\":1,\"data\":{\"lower\":30,\"upper\":30,\"aftbl\":\"LCPlanFl 40x\"}},{\"expanded\":false,\"key\":\"_7\",\"selected\":false,\"title\":\"SC1 +Picture\",\"type\":\"CAMERA\",\"skeep\":1,\"data\":{\"time\":100,\"skip\":0,\"number\":1,\"zoffset\":0}}]}]}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":3970,"y":60,"wires":[["1d323ac6.f71225"]]},{"id":"1d323ac6.f71225","type":"function","z":"cb80149c.966208","name":"","func":"msg.payload.children.splice(0,1);\nreturn msg;","outputs":1,"noerr":0,"x":4120,"y":60,"wires":[["fc93b1a3.ddfd1"]]},{"id":"e932d3a2.a08eb","type":"template","z":"cb80149c.966208","name":"HTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<head>\n\t<title>Init from xml file</title>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"/>\n\t<meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"/>\n\t<link rel=\"stylesheet\" type=\"text/css\" href=\"codebase/fonts/font_roboto/roboto.css\"/>\n\t<link rel=\"stylesheet\" type=\"text/css\" href=\"codebase/dhtmlx.css\"/>\n\t<script src=\"codebase/dhtmlx.js\"></script>\n\t\t<script>\n\t\tvar myLayout;\n\t\tfunction doOnLoad() {\n\t\t\tmyLayout = new dhtmlXLayoutObject(\"layoutObj\", \"3W\");\n\t\t}\n\t</script>\n</head>\n<body onload=\"doOnLoad();\" class=\" dhxwins_vp_material dhxwins_vp_auto\" style=\"position: static;\">\n\t<div id=\"layoutObj\" class=\" dhxlayout_base_material dhxlayout_base_material dhxlayout_base_material\"><div class=\"dhxlayout_cont\" style=\"left: 0px; width: 600px; top: 0px; height: 400px;\"><div class=\"dhx_cell_layout\" style=\"left: 0px; top: 0px; width: 193px; height: 400px;\"><div class=\"dhx_cell_hdr\" style=\"\"><div class=\"dhx_cell_hdr_text dhx_cell_hdr_text_chrome\" style=\"\"><span>a</span></div><div title=\"Expand / Collapse\" class=\"dhxlayout_arrow dhxlayout_arrow_va\"></div></div><div class=\"dhx_cell_cont_layout\" style=\"left: 0px; top: 42px; width: 191px; height: 358px;\"></div></div><div class=\"dhx_cell_layout dhx_cell_nested_layout\" style=\"left: 207px; top: 0px; width: 393px; height: 400px;\"><div class=\"dhx_cell_hdr dhx_cell_hdr_hidden_no_borders\"><div class=\"dhx_cell_hdr_text dhx_cell_hdr_text_chrome\"></div><div title=\"Expand / Collapse\" class=\"dhxlayout_arrow dhxlayout_arrow_vb\"></div></div><div class=\"dhx_cell_cont_layout dhx_cell_cont_no_borders\" style=\"left: 0px; top: 0px; width: 393px; height: 400px;\"><div class=\" dhxlayout_base_material\" style=\"width: 100%; height: 100%; position: relative; overflow: hidden;\"><div class=\"dhxlayout_cont\" style=\"left: 0px; width: 393px; top: 0px; height: 400px;\"><div class=\"dhx_cell_layout\" style=\"left: 0px; top: 0px; width: 240px; height: 400px;\"><div class=\"dhx_cell_hdr\" style=\"\"><div class=\"dhx_cell_hdr_text dhx_cell_hdr_text_chrome\" style=\"\"><span>b</span></div><div title=\"Expand / Collapse\" class=\"dhxlayout_arrow dhxlayout_arrow_va\"></div></div><div class=\"dhx_cell_cont_layout\" style=\"left: 0px; top: 42px; width: 238px; height: 358px;\"></div></div><div class=\"dhx_cell_layout\" style=\"left: 254px; top: 0px; width: 139px; height: 400px;\"><div class=\"dhx_cell_hdr\" style=\"\"><div class=\"dhx_cell_hdr_text dhx_cell_hdr_text_chrome\" style=\"\"><span>c</span></div><div title=\"Expand / Collapse\" class=\"dhxlayout_arrow dhxlayout_arrow_vb\"></div></div><div class=\"dhx_cell_cont_layout\" style=\"left: 0px; top: 42px; width: 136px; height: 358px;\"></div></div><div class=\"dhxlayout_sep dhxlayout_sep_resize_v\" style=\"left: 240px; top: 0px; width: 14px; height: 400px;\"></div></div></div></div></div><div class=\"dhxlayout_sep dhxlayout_sep_resize_v\" style=\"left: 193px; top: 0px; width: 14px; height: 400px;\"></div></div></div>\n\n</body></html>","output":"str","x":1570,"y":160,"wires":[["3f590d17.f5a322"]]},{"id":"5df1fada.165394","type":"http in","z":"cb80149c.966208","name":"","url":"/myLayoutDHTMLX","method":"get","upload":false,"swaggerDoc":"","x":1370,"y":220,"wires":[["e932d3a2.a08eb"]]},{"id":"3f590d17.f5a322","type":"http response","z":"cb80149c.966208","name":"","statusCode":"","headers":{},"x":1710,"y":160,"wires":[]},{"id":"5abe56db.d565d8","type":"inject","z":"64fc7af.b478584","name":"STOP","topic":"","payload":"MDA-FINISH","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":200,"wires":[["aed1851c.e9ea68","617ddd83.2a3494"]]},{"id":"aed1851c.e9ea68","type":"function","z":"64fc7af.b478584","name":"break/stop MDA time Order","func":"if(msg.payload === 'MDA-FINISH'){\n    context.global.startMDA = 0 ;\n    node.status ({fill:\"red\",shape:\"dot\", text: \"STOP\"});\n    //stop camera python code\n    var msg = {};\n    msg.payload = \"STOP,\"+Date.now();\n    node.send(msg);    \n}\nif(msg.payload === 'MDA-BREAK'){\n    context.global.startMDA = 0 ;\n    node.status ({fill:\"yellow\",shape:\"dot\", text: \"BREAK\"});\n    var msg = {};\n    msg.payload = \"BREAK,\"+Date.now();\n    node.send(msg);    \n}\nif(msg.payload === 'MDA-START'){\n    context.global.startMDA = 1 ;\n    node.status ({text: \"waiting stop ...\"});\n    var msg = {};\n    msg.payload = \"START,\"+Date.now();\n    node.send(msg);    \n}","outputs":1,"noerr":0,"x":460,"y":200,"wires":[["f0ea039a.82c76"]]},{"id":"56c92272.2b973c","type":"function","z":"64fc7af.b478584","name":"Sequencer 2 CyberSCope","func":"if( (context.global.startMDA === 1) && (context.global.initialize === true)){\n    var length = context.global.sequence2[context.global.sync2].length ;\n    //Extent\n    if((msg.payload === 'done')){\n        context.global.extent = msg.extent ;\n        if(context.global.extent===true){\n            if(length===context.global.sync3) context.global.valid = true ;\n            else context.global.valid = false  ;\n        }\n        if(context.global.extent===false){\n            context.global.valid = true ;\n        }\n        context.global.time = parseInt((Date.now()-context.global.initTime)/1000);\n    }\n\n    //Next instruction\n    if( length  !== context.global.sync3 ){\n        var order = context.global.sequence2[context.global.sync2];\n        if((msg.payload === 'done')){\n            context.global.checkFinish = context.global.checkFinish + 1 ;\n            node.status ({fill:\"yellow\",shape:\"dot\", text: context.global.sync2+\"-\"+context.global.sync3+\"-o-\"+context.global.finish+\"-\"+context.global.checkFinish});\n            if(context.global.checkFinish === context.global.finish){\n                context.global.checkFinish = 0 ;\n                if(order.length !==1) {\n                    context.global.finish = order[context.global.sync3].length ; // nombre d'instructions dans la branche la plus profonde de l'object sequencer\n                    for(var i=0;i<order[context.global.sync3].length;i++){ node.send(order[context.global.sync3][i]);}\n                }\n                else{ \n                    node.send(order[context.global.sync3]) ;\n                    context.global.finish = 1 ;\n                }\n                context.global.sync3 = context.global.sync3 + 1 ;\n            }\n        }\n        else{\n            if(order.length !==1) {\n                context.global.finish = order[context.global.sync3].length ; // nombre d'instructions dans la branche la plus profonde de l'object sequencer\n                for(var i=0;i<order[context.global.sync3].length;i++){ node.send(order[context.global.sync3][i]);}\n            }\n            else { \n                //Extent\n                context.global.extent = order[context.global.sync3].extent ;\n                if(context.global.extent===true){\n                    if(length===context.global.sync3) context.global.valid = true ;\n                    else context.global.valid = false  ;\n                }\n                if(context.global.extent===false){\n                    context.global.valid = true ;\n                }\n                context.global.time = parseInt((Date.now()-context.global.timeInit)/1000);\n                /////\n                context.global.finish = 1 ;\n                node.send(order[context.global.sync3]) ;\n            }\n            context.global.sync3 = context.global.sync3 + 1 ;\n        }\n    }\n}","outputs":1,"noerr":0,"x":889,"y":280,"wires":[["a66e5859.17a3d8","190ceb25.c361c5"]],"icon":"node-red/trigger.png"},{"id":"9d7c2f3c.e3365","type":"inject","z":"64fc7af.b478584","name":"START","topic":"","payload":"MDA-START","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":280,"wires":[["aed1851c.e9ea68","617ddd83.2a3494"]]},{"id":"617ddd83.2a3494","type":"function","z":"64fc7af.b478584","name":"start MDA time Order","func":"if(msg.payload === 'MDA-START'){\n    context.global.startMDA = 1 ;\n    context.global.checkFinish = 0 ;\n    context.global.valid = false ; \n    global.set('scanTime',0) ;\n    context.global.sync2 = String(0);\n    context.global.sync3 = 0;\n    ////\n    context.global.initTime  = Date.now();\n    context.global.adjust = 0 ;\n    context.global.time = 0;\n    ////\n    msg.payload = context.global.sequence2[String(0)];\n    node.send(msg);\n    node.status ({fill:\"green\",shape:\"dot\", text: \"START\"});\n    ////\n    context.global.keyPlay = [] ;\n    context.global.keyPlay.push(String(0));\n    ////\n    var mdaSync = setInterval(function(){\n        scanTime = global.get('scanTime') + 0.25 ;\n        global.set('scanTime', scanTime) ;\n        if(context.global.valid){\n            //node.warn(context.global.adjust);\n            for(var key in context.global.sequence2){\n                if((parseInt(key)<=(scanTime+context.global.adjust))&&(context.global.keyPlay.includes(key)===false)){\n                    context.global.adjust = (key) - parseInt((Date.now()-context.global.initTime)/1000);\n                    if(context.global.adjust>=0) context.global.adjust= 0 ;\n                    context.global.sync2 = key;\n                    msg.payload = context.global.sequence2[key];\n                    context.global.sync3 = 0;\n                    context.global.keyPlay.push(key);\n                    node.send(msg);\n                    break ;\n                }\n            }\n        }        \n    },250);\n    global.set('mdaSync',mdaSync);\n    ////\n}\nif(msg.payload === 'MDA-FINISH'){\n    context.global.startMDA = 0 ;\n    node.status ({text: \"waiting start ...\"});\n    clearTimeout(global.get('mdaSync'));\n    //node.warn('Temps total: '+parseInt((Date.now()-context.global.timeInit)/1000)+\" secondes\");\n}\nif(msg.payload === 'MDA-BREAK'){\n    context.global.startMDA = 0 ;\n    node.status ({text: \"waiting restart ...\"});\n    clearTimeout(global.get('mdaSync'));\n    //node.warn('Temps total: '+parseInt((Date.now()-context.global.timeInit)/1000)+\" secondes\");\n}","outputs":1,"noerr":0,"x":440,"y":280,"wires":[["56c92272.2b973c"]]},{"id":"d1e33a82.f0a6f8","type":"inject","z":"64fc7af.b478584","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":1050,"y":60,"wires":[["862d7b30.1a2708"]]},{"id":"862d7b30.1a2708","type":"function","z":"64fc7af.b478584","name":"Object sequencer 2","func":"context.global.extent = true ;\ncontext.global.valid = false ;\ncontext.global.sequence2 = {\n    \"0\" : \n        [\n            [{\n            'topic' : '4',\n            'device' : '4',\n            'sync' : 0,\n            'extent' : false\n            }],\n            [{\n            'topic' : '3',\n            'device' : '3',\n            'sync' : 0,\n            'extent' : false\n            }],\n            [{\n            'topic' : '2',\n            'device' : '2',\n            'sync' : 0,\n            'extent' : false\n            }],\n            [{\n            'topic' : '1',\n            'device' : '1',\n            'sync' : 0,\n            'extent' : false\n            }]//,\n            /*[{\n            'topic' : 'function1',\n            'device' : 'function1',\n            'paylaod' : 'MDA-FINISH'\n            }]*/\n        ],\n    \"10\" : \n        [\n            [{\n            'topic' : '4',\n            'device' : '4',\n            'sync' : 10,\n            'extent' : true\n            }],\n            [{\n            'topic' : '3',\n            'device' : '3',\n            'sync' : 10,\n            'extent' : true\n            }],\n            [{\n            'topic' : '2',\n            'device' : '2',\n            'sync' : 10,\n            'extent' : true\n            }],\n            [{\n            'topic' : 'break',\n            'device' : 'break',\n            'payload' : 'MDA-BREAK'\n            }]\n        ],\n    \"20\" : \n        [\n            [{\n            'topic' : '4',\n            'device' : '4',\n            'sync' : 20,\n            'extent' : false\n            }],\n        [{\n            'topic' : '3',\n            'device' : '3',\n            'sync' : 20,\n            'extent' : false\n            }],\n            [{\n            'topic' : '2',\n            'device' : '2',\n            'sync' : 20,\n            'extent' : false\n            }],\n            [{\n            'topic' : '1',\n            'device' : '1',\n            'sync' : 20,\n            'extent' : false\n            }]\n        ],\n    \"30\" : \n        [\n            [{\n            'topic' : '4',\n            'device' : '4',\n            'sync' : 30,\n            'extent' : true\n            }],\n            [{\n            'topic' : '3',\n            'device' : '3',\n            'sync' : 30,\n            'extent' : true\n            }],\n            [{\n            'topic' : '2',\n            'device' : '2',\n            'sync' : 30,\n            'extent' : true\n            }],\n            [{\n            'topic' : '1',\n            'device' : '1',\n            'sync' : 30,\n            'extent' : true\n            }]\n        ],\n        \"40\" : \n            [\n                [{\n                'topic' : '4',\n                'device' : '4',\n                'sync' : 40,\n                'extent' : false\n                }]\n            ],\n        \"50\" : \n            [\n                [{\n                'topic' : '4',\n                'device' : '4',\n                'sync' : 50,\n                'extent' : true\n                }],\n                [{\n                'topic' : '3',\n                'device' : '3',\n                'sync' : 50,\n                'extent' : true\n                }],\n                [{\n                'topic' : '2',\n                'device' : '2',\n                'sync' : 50,\n                'extent' : true\n                }],\n                [{\n                'topic' : '1',\n                'device' : '1',\n                'sync' : 50,\n                'extent' : true\n                }],\n                [{\n                'payload' : 'MDA-FINISH',\n                'sync' : 50,\n                'extent' : true\n                }]\n            ]\n}","outputs":1,"noerr":0,"x":1210,"y":60,"wires":[[]]},{"id":"3da98c84.69a474","type":"function","z":"64fc7af.b478584","name":"1","func":"if(msg.device === '1'){\n    //var msg = {};\n    //msg.topic = \"1\";\n    msg.payload = \"done\";\n    //msg.device = '1' ;\n    node.status ({fill:\"yellow\",shape:\"dot\", text: \"request\"});\n    setTimeout(function(){\n        node.status ({fill:\"green\",shape:\"dot\", text: \"done\"});\n        node.send(msg);\n    },1000);\n}","outputs":1,"noerr":0,"x":490,"y":340,"wires":[["8047668.2074f98"]],"icon":"node-red/contrast.png"},{"id":"190ceb25.c361c5","type":"debug","z":"64fc7af.b478584","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1070,"y":300,"wires":[]},{"id":"1fa294ca.1ad68b","type":"function","z":"64fc7af.b478584","name":"2","func":"if(msg.device === '2'){\n    //var msg = {};\n    //msg.topic = \"2\";\n    msg.payload = \"done\";\n    ///msg.device = '2' ;\n    node.status ({fill:\"yellow\",shape:\"dot\", text: \"request\"});\n    setTimeout(function(){\n        node.status ({fill:\"green\",shape:\"dot\", text: \"done\"});\n        node.send(msg);\n    },10000);\n}","outputs":1,"noerr":0,"x":490,"y":386,"wires":[["8047668.2074f98"]],"icon":"node-red/contrast.png"},{"id":"e375ae28.f44e2","type":"function","z":"64fc7af.b478584","name":"3","func":"if(msg.device === '3'){\n    //var msg = {};\n    //msg.topic = \"3\";\n    msg.payload = \"done\";\n    //msg.device = '3' ;\n    node.status ({fill:\"yellow\",shape:\"dot\", text: \"request\"});\n    setTimeout(function(){\n        node.status ({fill:\"green\",shape:\"dot\", text: \"done\"});\n        node.send(msg);\n    },1000);\n}","outputs":1,"noerr":0,"x":490,"y":433,"wires":[["8047668.2074f98"]],"icon":"node-red/contrast.png"},{"id":"a66e5859.17a3d8","type":"link out","z":"64fc7af.b478584","name":"BREAK","links":["e2b86259.a9dab","b98cd596.88e968","7adc33b5.e4f0ac","268b79cc.917136","fa49a9b.b968158","28d722a4.fe961e","d337c4a7.d7cbe8"],"x":1035,"y":260,"wires":[]},{"id":"e2b86259.a9dab","type":"link in","z":"64fc7af.b478584","name":"","links":["a66e5859.17a3d8"],"x":395,"y":481,"wires":[["54031df8.45a9b4"]]},{"id":"54031df8.45a9b4","type":"function","z":"64fc7af.b478584","name":"4","func":"if(msg.device === '4'){\n    //var msg = {};\n    //msg.topic = \"4\";\n    msg.payload = \"done\";\n    //msg.device = '3' ;\n    node.status ({fill:\"yellow\",shape:\"dot\", text: \"request\"});\n    setTimeout(function(){\n        node.status ({fill:\"green\",shape:\"dot\", text: \"done\"});\n        node.send(msg);\n    },1000);\n}","outputs":1,"noerr":0,"x":490,"y":481,"wires":[["8047668.2074f98"]],"icon":"node-red/contrast.png"},{"id":"738df290.54b92c","type":"function","z":"64fc7af.b478584","name":"break function","func":"if(msg.device === 'break'){\n    //node.send({'payload':'MDA-BREAK'});\n    node.status ({fill:\"yellow\",shape:\"dot\", text: \"request\"});\n    context.global.sequence2 = {\n    \"0\" : \n        [\n            [{\n            'topic' : '4',\n            'device' : '4',\n            'sync' : 0,\n            'extent' : false\n            }],\n            [{\n            'topic' : '2',\n            'device' : '2',\n            'sync' : 0,\n            'extent' : false\n            }],\n            [{\n            'payload' : 'MDA-FINISH',\n            'sync' : 0,\n            'extent' : false\n            }]\n        ],\n    \"10\":\n        [\n            [{\n            'payload' : 'MDA-FINISH',\n            'sync' : 10,\n            'extent' : false\n            }]\n        ]\n    }\n    setTimeout(function(){\n        node.send({'payload':'MDA-START'});\n    },0);\n    node.status ({fill:\"green\",shape:\"dot\", text: \"request\"});\n}","outputs":1,"noerr":0,"x":180,"y":240,"wires":[["617ddd83.2a3494","aed1851c.e9ea68"]],"icon":"node-red/contrast.png"},{"id":"a3bcdeb0.10e49","type":"debug","z":"64fc7af.b478584","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":829,"y":340,"wires":[]},{"id":"8047668.2074f98","type":"function","z":"64fc7af.b478584","name":"Extent=NO","func":"if((msg.payload === 'done')&&(msg.sync===parseInt(context.global.sync2))) node.send(msg);\n/*\nFiltre pour bloquer un retour de réponse qui aurait été demandé avant que la durée d'une boucle ne soit atteinte\nAinsi on filtre sur msg.sync qui représente la clé de l'object JSON;\nC'est le context.global.sync2 qui dit on on se trouve temporellement\nSi les deux indices ne sont pas égales cela signifit que la réponse qu'on recoit n'appartient pas au temps en \ncours mais à celui d'avant donc on n'envoie pas le message au séquenceur de risque de déclencher l'action suivante et de\ndérégler le séquencement\n*/\n","outputs":1,"noerr":0,"x":670,"y":340,"wires":[["56c92272.2b973c","a3bcdeb0.10e49"]]},{"id":"f0ea039a.82c76","type":"debug","z":"64fc7af.b478584","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":670,"y":200,"wires":[]},{"id":"b98cd596.88e968","type":"link in","z":"64fc7af.b478584","name":"","links":["a66e5859.17a3d8"],"x":55,"y":240,"wires":[["738df290.54b92c"]]},{"id":"7adc33b5.e4f0ac","type":"link in","z":"64fc7af.b478584","name":"","links":["a66e5859.17a3d8"],"x":395,"y":433,"wires":[["e375ae28.f44e2"]]},{"id":"268b79cc.917136","type":"link in","z":"64fc7af.b478584","name":"","links":["a66e5859.17a3d8"],"x":395,"y":386,"wires":[["1fa294ca.1ad68b"]]},{"id":"fa49a9b.b968158","type":"link in","z":"64fc7af.b478584","name":"","links":["a66e5859.17a3d8"],"x":395,"y":340,"wires":[["3da98c84.69a474"]]},{"id":"28d722a4.fe961e","type":"link in","z":"64fc7af.b478584","name":"","links":["a66e5859.17a3d8"],"x":275,"y":160,"wires":[["aed1851c.e9ea68"]]},{"id":"d337c4a7.d7cbe8","type":"link in","z":"64fc7af.b478584","name":"","links":["a66e5859.17a3d8"],"x":275,"y":320,"wires":[["617ddd83.2a3494"]]},{"id":"f3d22c58.c7469","type":"template","z":"cb80149c.966208","name":"MissMarpleHTML","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html lang=\"en\">\n    <head>\n        <meta charset=\"utf-8\">\n        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n        <meta name=\"description\" content=\"\">\n        <meta name=\"author\" content=\"\">\n        <link rel=\"icon\" href=\"bootstrap/favicon.ico\">\n        <title>CyberScope | Lab513</title>\n        <link href=\"bootstrap/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n        <link href=\"bootstrap/assets/css/ie10-viewport-bug-workaround.css\" rel=\"stylesheet\">\n        <link href=\"bootstrap/dashboard.css\" rel=\"stylesheet\">\n        <link href=\"css/style1.css\" rel=\"stylesheet\">\n        <script src=\"bootstrap/assets/js/ie-emulation-modes-warning.js\"></script>\n        <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js\"></script>\n        <script src=\"js/js1.js\"></script>\n        <script src=\"//code.jquery.com/jquery-3.3.1.min.js\"></script>\n        \n        <script type=\"text/javascript\" src=\"wPaint/lib/jquery.1.10.2.min.js\"></script>\n    \n        <link href=\"//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css\" rel=\"stylesheet\">\n        <script src=\"//code.jquery.com/ui/1.12.1/jquery-ui.min.js\"></script>\n        <script src=\"//cdn.jsdelivr.net/npm/ui-contextmenu/jquery.ui-contextmenu.min.js\"></script>\n        <link href=\"fancytree-master/src/skin-win8/ui.fancytree.css\" rel=\"stylesheet\">\n        <script src=\"fancytree-master/src/jquery.fancytree.js\"></script>\n        <script src=\"fancytree-master/src/jquery.fancytree.dnd5.js\"></script>\n        <script src=\"fancytree-master/src/jquery.fancytree.edit.js\"></script>\n        <script src=\"fancytree-master/src/jquery.fancytree.gridnav.js\"></script>\n        <script src=\"fancytree-master/src/jquery.fancytree.table.js\"></script>\n        <script src=\"fancytree-master/src/jquery.fancytree.multi.js\"></script>\n        \n        <script type=\"text/javascript\" src=\"js/jquery.maphilight.js\"></script>\n\n\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.css\">\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.js\"></script>\n      \n        <style type=\"text/css\">\n            img:hover {\n              box-shadow: 0 0 2px 1px rgba(0, 140, 186, 0.5);\n            }\n            .ui-menu {\n                width: 200px;\n                height: 30px;\n                font-size: 63%;\n            }\n            .ui-menu kbd {\n                float: right;\n            }\n            td.alignRight {\n                text-align: right;\n            }\n            td.alignCenter {\n                text-align: center;\n            }\n            td input[type=input] {\n                width: 40px;\n            }\n            span.drag-source{\n                border: 1px solid lightgray;\n                border-radius: 3px;\n                padding: 2px;\n                background-color: lightgray\n            }\n            ul.fancytree-container {\n                max-height: 200px;\n                overflow-y: scroll;\n            }\n            span.fancytree-node.fancytree-drag-source {\n                outline: 1px dotted grey;\n            }\n            span.fancytree-node.fancytree-drop-accept {\n                outline: 1px dotted green;\n            }\n            span.fancytree-node.fancytree-drop-reject {\n                outline: 1px dotted red;\n            }\n            #my_tree{max-height: 700px; overflow-y:scroll; overflow-x: hidden;}\n            #my_function{max-height: 700px; overflow-y:scroll; overflow-x: hidden;}\n            #settings{max-height: 800px; overflow-y:scroll; overflow-x: hidden;}\n        </style>\n    </head>\n\n    <body  onload=\"wsConnect();\" onunload=\"ws.onclose();\">\n    \n        <div id=\"wait\" style=\"text-align: center;\" >\n            <img style=\"margin: 0 auto;\" src='media/Audit.png'><img style=\"margin: 0 auto;\" src='media/loading.gif'><br>\n            <h2>Loading parameters, please wait a few seconds</h2>\n        </div>\n    \n        <div id=\"main\">\n            <nav class=\"navbar navbar-inverse navbar-fixed-top\">\n                <div class=\"container-fluid\">\n                    <div class=\"navbar-header\">\n                        <button type=\"button\" class=\"navbar-toggle collapsed\" data-toggle=\"collapse\" data-target=\"#navbar\" aria-expanded=\"false\" aria-controls=\"navbar\">\n                            <span class=\"sr-only\">Toggle navigation</span>\n                            <span class=\"icon-bar\"></span>\n                            <span class=\"icon-bar\"></span>\n                            <span class=\"icon-bar\"></span>\n                        </button>\n                        <a class=\"navbar-brand\" href=\"javascript: setting();\"><small>Settings Channels</small></a>\n                        <a class=\"navbar-brand\" href=\"javascript: mda();\"><small>Acquisition</small></a>\n                        <a class=\"navbar-brand\" href=\"javascript: calibration();\"><small>Self Calibration</small></a>\n                        <a class=\"navbar-brand\" href=\"#\"><small><div id=\"name_user\"></div></small></a>\n                    </div>\n                    <div id=\"navbar\" class=\"navbar-collapse collapse\">\n                        <ul class=\"nav navbar-nav navbar-right\">\n                            <li><a style=\"color: rgb(255, 102, 102);\" href=\"#\"><small>Documentation | Wiki</small></a></li>\n                            <li><a style=\"color: rgb(0, 255, 64);\" href=\"http://lab513.fr/labr/\"><small>Lab 513 - Hersen's Lab</small></a></li>\n                            <li><a style=\"color: rgb(0, 255, 64);\"  href=\"#\"><small><div id=\"status\"></div></small></a></li>\n                        </ul>\n                    </div>\n                </div>\n            </nav>\n            <div class=\"container-fluid\">\n                <div class=\"row\">\n                    <div>    \n                        <br>\n                        <div id=\"receive\"></div>\n                        <div id=\"alert-success\" class=\"alert alert-success\" role=\"alert\"></div>\n                \n                        <div id=\"live_mode\">\n                            <h2 class=\"sub-header\">Live mode</h2>\n                            <div id=\"live_div\" class=\"table-responsive\">\n                                <img src='icons/work_in_progress.jpg'>\n                        </div>    \n                    </div>\n    \n                    <div id=\"settings\">\n                        <h2 class=\"sub-header\">Settings channels</h2>\n                        <div id=\"name_configChannels\"></div>\n                        <div id=\"available_configChannels\"></div>\n                        <br>\n                        <form method=\"post\" id='setting_channel_form' action=\"/formpost\" ajax=\"true\">\n                            <button class='setting_button' alt='add channel' id=\"setting_button_add_channel\"><img src='icons/add.png'> Add a new setting channel</button>\n                            <button type='submit' alt='save' class='setting_button' id='setting_button_save_channel'><img src='icons/disk.png'> Save the current settings</button>\n                            <div id=\"setting_table_channel\" class=\"table-responsive\"></div>\n                        </form>\n                        <br>\n                        <hr/>\n                    </div>\n                    \n                    <div id=\"settings\">\n                    \n                    </div>  \n                    <div id=\"calibration\">\t\n                        <!--<table style=\"text-align: left; width: 100%;\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n                          <tbody>\n                            <tr>\n                              <td style=\"width:1%;\"></td>\n                              <td style=\"width: 600px;\">\n                                <h3>\n                                    Load a design&nbsp;: &nbsp;\n                                    <select>\n                                        <option>µFluidic sample 1 (25 rooms)</option>\n                                        <option>static pattern (5 rooms)</option>\n                                    </select>\n                                </h3>\n                                <a name=\"map\"></a>\n                                <img class=\"map\" src=\"icons/test_uf2.png\" usemap=\"#map\">\n                                <map name=\"map\">\n                                    <area id=\"room1\" shape=\"poly\" title=\"Room 1\" onmouseover= \"info(1);\" onclick=\"visibilite(1);\" data-maphilight='{ \"fillColor\":\"0000ff\", \"strokeColor\":0000ff, \"strokeWidth\":2, \"fillOpacity\":0.5}' coords=\"361,78,342,96,361,114,381,97\" >\n                                    <area id=\"room2\" shape=\"poly\" title=\"Room 2\" onmouseover= \"info(2);\" onclick=\"visibilite(2);\" data-maphilight='{ \"fillColor\":0000ff, \"strokeColor\":0000ff, \"strokeWidth\":2, \"fillOpacity\":1}' coords=\"381,98,362,116,381,134,401,117\" > \n                                    <area id=\"room3\" shape=\"poly\" title=\"Room 3\" onmouseover= \"info(3);\" onclick=\"visibilite(3);\" data-maphilight='{ \"fillColor\":0000ff, \"strokeColor\":0000ff, \"strokeWidth\":2, \"fillOpacity\":1}' coords=\"400,118,381,136,400,154,420,137\" > \n                                    <area id=\"room4\" shape=\"poly\" title=\"Room 4\" onmouseover= \"info(4);\" onclick=\"visibilite(4);\" data-maphilight='{ \"fillColor\":0000ff, \"strokeColor\":0000ff, \"strokeWidth\":2, \"fillOpacity\":1}' coords=\"420,137,400,155,420,173,440,156\" > \n                                    <area id=\"room5\" shape=\"poly\" title=\"Room 5\" onmouseover= \"info(5);\" onclick=\"visibilite(5);\" data-maphilight='{ \"fillColor\":0000ff, \"strokeColor\":0000ff, \"strokeWidth\":2, \"fillOpacity\":1}' coords=\"438,156,419,174,438,192,458,175\" > \n                                    <area id=\"room6\" shape=\"poly\" title=\"Room 6\" onmouseover= \"info(6);\" onclick=\"visibilite(6);\" data-maphilight='{ \"fillColor\":0000ff, \"strokeColor\":0000ff, \"strokeWidth\":2, \"fillOpacity\":1}' coords=\"285,153,265,173,285,191,304,173\" > \n                                </map>\n                              </td>\n                              <td>\n                                    <div id=\"room\"></div>\n                              </td>\n                            </tr>\n                          </tbody>\n                        </table>-->\n\n<table style=\"text-align: left;\"\n border=\"0\" cellpadding=\"2\" cellspacing=\"5\">\n  <tbody>\n    <tr>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 0px;\"><br>\n      </td>\n      <td\n style=\"width: 511px; background-color: rgb(204, 204, 204);\">Live</td>\n      <td\n style=\"width: 13px; background-color: rgb(255, 255, 255);\"\n colspan=\"1\" rowspan=\"1\"><br>\n      </td>\n      <td\n style=\"background-color: rgb(204, 204, 204); width: 241px;\"\n colspan=\"1\">Global\nparameters</td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td style=\"width: 1%;\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\">Load\na specific design: &nbsp;\n      <select name=\"design\">\n      <option>&micro;Fluidic -\n25 rooms</option>\n      <option>static pattern - 6\nrooms\n      </option>\n      </select>\n      </td>\n      <td style=\"width: 1%;\"></td>\n    </tr>\n    <tr>\n      <td style=\"width: 0px;\"></td>\n      <td style=\"width: 511px;\"></td>\n      <td style=\"width: 13px;\"\n colspan=\"1\" rowspan=\"1\"><br>\n      </td>\n      <td style=\"width: 241px;\"\n colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Objective</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"9\"\n rowspan=\"1\">\n      <select class=\"aftbl\"\n style=\"width: 150px;\">\n      <option name=\"LCPlanFl 20x\"\n value=\"75\">LCPlanFl 20x</option>\n      <option name=\"LCPlanFl 40x\"\n value=\"76\">LCPlanFl 40x</option>\n      <option name=\"LCPlanFl 60x\"\n value=\"79\">LCPlanFl 60x</option>\n      <option name=\"LUCPlanFl 40x\"\n value=\"78\">LUCPlanFl 40x</option>\n      <option name=\"LUCPlanFlN 20x\"\n value=\"75\">LUCPlanFlN 20x</option>\n      <option name=\"LUCPlanFlN 40x\"\n value=\"76\">LUCPlanFlN 40x</option>\n      <option name=\"LUCPlanFlN 60x\"\n value=\"79\">LUCPlanFlN 60x</option>\n      <option name=\"PlanApo 100x O3\"\n value=\"31\">PlanApo 100x O3</option>\n      <option name=\"PlanApo 60x O TIRFM-SP\"\n value=\"70\">PlanApo 60x O TIRFM-SP</option>\n      <option name=\"PlanApo 60x O/LSM\"\n value=\"62\">PlanApo 60x O/LSM</option>\n      <option name=\"PlanApo 60x O3\"\n value=\"30\">PlanApo 60x O3</option>\n      <option name=\"PlanApo 40x W/LSM\"\n value=\"60\">PlanApo 40x W/LSM</option>\n      <option name=\"PlanApoN 60x O\"\n value=\"30\">PlanApoN 60x O</option>\n      <option name=\"SLCPlanFl 40x\"\n value=\"77\">SLCPlanFl 40x</option>\n      <option name=\"UApo 30x 3/340\"\n value=\"45\">UApo 30x 3/340</option>\n      <option name=\"UApo 40x 3/340\"\n value=\"47\">UApo 40x 3/340</option>\n      <option name=\"UApo 40x W\"\n value=\"48\">UApo 40x W</option>\n      <option name=\"UPlanFl 60x OI3\"\n value=\"57\">UPlanFl 60x OI3</option>\n      <option name=\"UPlanApo 20x\"\n value=\"36\">UPlanApo 20x</option>\n      <option name=\"UPlanApo 100x OI3\"\n value=\"43\">UPlanApo 100x OI3</option>\n      <option name=\"UPlanApo 40x OI3\"\n value=\"39\">UPlanApo 40x OI3</option>\n      <option name=\"UPlanApo 60x\"\n value=\"40\">UPlanApo 60x</option>\n      <option name=\"UPlanApo 60x W\"\n value=\"41\">UPlanApo 60x W</option>\n      <option name=\"UPlanApo 60x W/IR\"\n value=\"42\">UPlanApo 60x W/IR</option>\n      <option name=\"UplanFl 100x O3\"\n value=\"58\">UplanFl 100x O3</option>\n      <option name=\"UPlanFl 20x\"\n value=\"55\">UPlanFl 20x</option>\n      <option name=\"UPlanFl 40x O-SP\"\n value=\"71\">UPlanFl 40x O-SP</option>\n      <option name=\"UPlanFl 40x\"\n value=\"56\">UPlanFl 40x</option>\n      <option name=\"UPlanFlN 100x O\"\n value=\"58\">UPlanFlN 100x O</option>\n      <option name=\"UPlanFlN 100x OI\"\n value=\"58\">UPlanFlN 100x OI</option>\n      <option name=\"UPlanFlN 20x\"\n value=\"55\">UPlanFlN 20x</option>\n      <option name=\"UPlanFlN 40x O\"\n value=\"39\">UPlanFlN 40x O</option>\n      <option name=\"UPlanFl 60x\"\n value=\"40\">UPlanFl 60x</option>\n      <option name=\"UPlanFlN 60x OI\"\n value=\"57\">UPlanFlN 60x OI</option>\n      <option name=\"UPlanSApo 100x O\"\n value=\"43\">UPlanSApo 100x O</option>\n      <option name=\"UPlanSApo 20x\"\n value=\"36\">UPlanSApo 20x</option>\n      <option name=\"UPlanSApo 40x\"\n value=\"47\">UPlanSApo 40x</option>\n      <option name=\"UPlanSApo 60x O\"\n value=\"30\">UPlanSApo 60x O</option>\n      <option name=\"UPlanSApo 60x W\"\n value=\"41\">UPlanSApo 60x W</option>\n      <option name=\"UPlanFlN 40x\"\n value=\"56\">UPlanFlN 40x</option>\n      </select>\n      </td>\n      <td></td>\n      <td></td>\n      <td\n style=\"vertical-align: top; width: 46%;\" colspan=\"1\"\n rowspan=\"21\">\n      <div>&nbsp;<a\n name=\"map\"></a><img\n class=\"map\" src=\"icons/test_uf2.png\" usemap=\"#map\"><map\n name=\"map\">\n      <area id=\"room1\" shape=\"poly\"\n title=\"Room 1\" onmouseover=\"info(1);\"\n onclick=\"visibilite(1);\"\n data-maphilight=\"{ &quot;fillColor&quot;:&quot;0000ff&quot;, &quot;strokeColor&quot;:0000ff, &quot;strokeWidth&quot;:2, &quot;fillOpacity&quot;:0.5}\"\n coords=\"361,78,342,96,361,114,381,97\">\n      <area id=\"room2\" shape=\"poly\"\n title=\"Room 2\" onmouseover=\"info(2);\"\n onclick=\"visibilite(2);\"\n data-maphilight=\"{ &quot;fillColor&quot;:0000ff, &quot;strokeColor&quot;:0000ff, &quot;strokeWidth&quot;:2, &quot;fillOpacity&quot;:1}\"\n coords=\"381,98,362,116,381,134,401,117\">\n      <area id=\"room3\" shape=\"poly\"\n title=\"Room 3\" onmouseover=\"info(3);\"\n onclick=\"visibilite(3);\"\n data-maphilight=\"{ &quot;fillColor&quot;:0000ff, &quot;strokeColor&quot;:0000ff, &quot;strokeWidth&quot;:2, &quot;fillOpacity&quot;:1}\"\n coords=\"400,118,381,136,400,154,420,137\">\n      <area id=\"room4\" shape=\"poly\"\n title=\"Room 4\" onmouseover=\"info(4);\"\n onclick=\"visibilite(4);\"\n data-maphilight=\"{ &quot;fillColor&quot;:0000ff, &quot;strokeColor&quot;:0000ff, &quot;strokeWidth&quot;:2, &quot;fillOpacity&quot;:1}\"\n coords=\"420,137,400,155,420,173,440,156\">\n      <area id=\"room5\" shape=\"poly\"\n title=\"Room 5\" onmouseover=\"info(5);\"\n onclick=\"visibilite(5);\"\n data-maphilight=\"{ &quot;fillColor&quot;:0000ff, &quot;strokeColor&quot;:0000ff, &quot;strokeWidth&quot;:2, &quot;fillOpacity&quot;:1}\"\n coords=\"438,156,419,174,438,192,458,175\">\n      <area id=\"room6\" shape=\"poly\"\n title=\"Room 6\" onmouseover=\"info(6);\"\n onclick=\"visibilite(6);\"\n data-maphilight=\"{ &quot;fillColor&quot;:0000ff, &quot;strokeColor&quot;:0000ff, &quot;strokeWidth&quot;:2, &quot;fillOpacity&quot;:1}\"\n coords=\"285,153,265,173,285,191,304,173\">\n      </map>\n      </div>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Initialize\nauto-focus</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP2\"><img\n src=\"icons/shape_align_middle.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\">Refocus</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"1\"\n rowspan=\"1\"><button\n id=\"xPosUP2\"><img\n src=\"icons/shape_align_top.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\">&nbsp;</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\">Offset<br>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><br>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><br>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><br>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"\n colspan=\"10\" rowspan=\"1\"><br>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204); width: 241px;\"\n colspan=\"10\" rowspan=\"1\">Navigation</td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"><br>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"><img\n alt=\"\" src=\"icons/008-arrow-2B.png\"><img\n alt=\"\" src=\"icons/001-arrowB.png\"><img\n alt=\"\" src=\"icons/005-downB.png\"><img\n alt=\"\" src=\"icons/004-arrow-1B.png\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><input\n style=\"width: 50px;\" class=\"res1\" required=\"\"\n value=\"1\" min=\"0\" max=\"100000\" step=\"1\"\n type=\"number\">\n      </td>\n      <td\n style=\"width: 50px; background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP2\"><img\n src=\"icons/007-ascending.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"width: 50px; text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"zPosUP2\"><img\n src=\"icons/007-ascendingB.png\"></button></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"><img\n alt=\"\" src=\"icons/007-ascendingB.png\"><img\n alt=\"\" src=\"icons/002-backB.png\"><img\n alt=\"\" src=\"icons/006-down-1B.png\"><img\n alt=\"\" src=\"icons/003-rightB.png\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); text-align: center;\"><input\n style=\"width: 50px;\" class=\"res2\" required=\"\"\n value=\"10\" min=\"0\" max=\"100000\" step=\"1\"\n type=\"number\">\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP1\"><img\n src=\"icons/008-arrow-2.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"zPosUP1\"><img\n src=\"icons/008-arrow-2B.png\"></button></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">&nbsp;</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><br>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"yPosLF2\"><img\n src=\"icons/002-back.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"yPosLF1\"><img\n src=\"icons/001-arrow.png\"></button></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><strong>X-Y</strong></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"yPosRG1\"><img\n src=\"icons/004-arrow-1.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"yPosRG2\"><img\n src=\"icons/003-right.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><strong>Z</strong></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"><img\n src=\"icons/008-arrow-2.png\"><img\n src=\"icons/001-arrow.png\"><img\n src=\"icons/005-down.png\"><img\n src=\"icons/004-arrow-1.png\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><input\n style=\"width: 50px;\" class=\"res1\" required=\"\"\n value=\"5\" min=\"0\" max=\"100000\" step=\"1\"\n type=\"number\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"xPosDW1\"><img\n src=\"icons/005-down.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"zPosDW1\"><img\n src=\"icons/005-downB.png\"></button></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"><img\n src=\"icons/007-ascending.png\"><img\n src=\"icons/002-back.png\"><img\n src=\"icons/006-down-1.png\"><img\n src=\"icons/003-right.png\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); text-align: center;\"><input\n style=\"width: 50px;\" class=\"res1\" required=\"\"\n value=\"50\" min=\"0\" max=\"100000\" step=\"1\"\n type=\"number\">\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"xPosDW2\"><img\n src=\"icons/006-down-1.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"zPosDW2\"><img\n src=\"icons/006-down-1B.png\"></button></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"\n colspan=\"10\" rowspan=\"1\"><br>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204); width: 241px;\"\n colspan=\"10\" rowspan=\"1\">Camera\ncontrol</td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"><br>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"\n colspan=\"2\" rowspan=\"1\">Time\nexposure (ms)<br>\nTemperature<br>\nGain<br>\nInvert color<br>\nActive color mapping<br>\nBrightness and contrast auto<br>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"8\"\n rowspan=\"1\"><input\n style=\"width: 50px;\" class=\"res1\" required=\"\"\n min=\"0\" max=\"100000\" step=\"1\" value=\"100\"\n type=\"number\"><br>\n      <input style=\"width: 50px;\"\n class=\"res1\" value=\"20\" required=\"\" min=\"0\"\n max=\"100000\" step=\"1\" type=\"number\">&nbsp;\n(only for\nZyla)<br>\n      <input style=\"width: 50px;\"\n class=\"res1\" value=\"1\" required=\"\" min=\"0\"\n max=\"100000\" step=\"1\" type=\"number\"><br>\n      <select id=\"posInvert\">\n      <option selected=\"selected\"\n value=\"OFF\">OFF</option>\n      <option value=\"ON\">ON</option>\n      </select>\n      <br>\n      <select id=\"posMap\">\n      <option value=\"OFF\">OFF</option>\n      <option selected=\"selected\"\n value=\"ON\">ON</option>\n      </select>\n      <br>\n      <select id=\"posMap\">\n      <option value=\"OFF\">OFF</option>\n      <option selected=\"selected\"\n value=\"ON\">ON</option>\n      </select>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"\n colspan=\"10\" rowspan=\"1\"><br>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204); width: 241px;\"\n colspan=\"10\" rowspan=\"1\">Functions</td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td\n style=\"text-align: left; vertical-align: top; width: 13px;\"></td>\n      <td style=\"width: 241px;\"><br>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Setting\nchannel</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\">\n      <select id=\"posInvert\">\n      <option selected=\"selected\"\n value=\"BF\">BF</option>\n      <option value=\"RFF&quot;\">RFF</option>\n      <option value=\"GFP&quot;\">GFP</option>\n      <option value=\"YFP&quot;\">YFP</option>\n      </select>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"2\"\n rowspan=\"1\"><button>ON</button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"2\"\n rowspan=\"1\"><button>OFF</button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Simple\npicture</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP2\"><img\n src=\"icons/camera.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Z-stack</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP2\"><img\n src=\"icons/zstack.png\"></button></td>\n      <td\n style=\"text-align: right; background-color: rgb(255, 255, 255);\"></td>\n      <td colspan=\"2\" rowspan=\"1\"\n style=\"background-color: rgb(255, 255, 255); text-align: left;\">Start:\n      <input style=\"width: 50px;\"\n class=\"res1\" required=\"\" min=\"0\" max=\"100000\"\n step=\"1\" type=\"number\"></td>\n      <td colspan=\"2\" rowspan=\"1\"\n style=\"background-color: rgb(255, 255, 255); text-align: left;\">Stop:\n      <input style=\"width: 50px;\"\n class=\"res1\" required=\"\" min=\"0\" max=\"100000\"\n step=\"1\" type=\"number\"></td>\n      <td colspan=\"3\" rowspan=\"1\"\n style=\"background-color: rgb(255, 255, 255); text-align: left;\">Step:\n      <input style=\"width: 50px;\"\n class=\"res1\" required=\"\" min=\"0\" max=\"100000\"\n step=\"1\" type=\"number\"></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td style=\"width: 0px;\"></td>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td\n style=\"text-align: center; vertical-align: middle;\">\n      <div id=\"room\"></div>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td\n style=\"text-align: center; vertical-align: middle;\"></td>\n      <td></td>\n    </tr>\n  </tbody>\n</table>\n\n\n                  </div>\n\n                    <div id=\"mda\">\n                        <div id=\"name_configMda\"></div>\n                        <div id=\"available_configMda\"></div>\n                        <div id=\"available_channels_mda\"></div>\n\n                        <div id=\"available_ressources\">\n                            <span>&nbsp;&nbsp;&nbsp;Available resources and functions | drag and drop directly on the tree</span><br>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Sequence');\"><img src='icons/arrow_rotate_clockwise.png'>&nbsp;Sequence</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'BREAK');\"><img src='icons/bullet_red.png'>&nbsp;Break</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Group Position');\"><img src='icons/plugin.png'>&nbsp;Group-position</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'XYZ Position');\"><img src='icons/yxz-512.png'>&nbsp;XYZ-position</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Imaging');\"><img src='icons/image.png'>&nbsp;Imaging</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Analysis');\"><img src='icons/color_swatch.png'>&nbsp;Analysis</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'IF');\"><img src='icons/if.png'>&nbsp;IF</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Delay');\"><img src='icons/clock.png'>&nbsp;Delay</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'Slack');\"><img src='icons/comments.png'>&nbsp;Slack</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'µFluidic');\"><img src='icons/uf2.png'>&nbsp;µFluidic</span>\n                            &nbsp;<span class=\"drag-source\" draggable=\"true\" ondragstart=\"event.dataTransfer.setData('text/plain', 'STOP');\"><img src='icons/stop.png'>&nbsp;STOP</span>\n                            &nbsp;   \n                            <button onclick=test();><img src='icons/package_go.png'>&nbsp;Create a new protocol</button>\n                            <button class='setting_button' alt='save' id=\"setting_button_save_configMda\"><img src='icons/package_link.png'>&nbsp;Save the actual protocol</button>\n                            <button class='setting_button' alt='Tooggle' id=\"setting_button_toogle\"><img src='icons/layout_content.png' >Toggle expand</button>\n                            <button onclick=test();><img src='icons/package_go.png'>&nbsp;Start the acquisition</button><br><br>\n                    \n                            <table id=\"\" class=\"table table-striped\" style=\"height: 80%;\">\n                                <tbody>\n                                    <tr>\n                                        <th style=\"width:23%;\">                \n                                            <div id='my_tree'>\n                                                <table id=\"tree\" class=\"sampletree\">\n                                                    <colgroup>\n                                                        <col><col><col style=\"width:100%\">\n                                                    </colgroup>\n                                                    <thead>\n                                                        <tr> <th></th> <th></th> <th></th> <!--<th></th> <th>Z-stacks</th> <th>Autofocus</th> <th>Save Images</th> <th>Comment</th> <th>Color</th>--> </tr>\n                                                    </thead>\n                                                    <tbody>\n                                                    <tr>\n                                                        <td class=\"alignCenter\"></td><td></td><td></td>\n                                                    </tr>\n                                                    </tbody>\n                                                </table>\n                                            </div>\n                                        </th>\n                                        <th style=\"width:25%;\">                \n                                            <div id='my_function'>\n                                                <p><span id=\"lblActive\"></span></p>\n                                                <p><span id=\"lblActiveEsttimatedTime\"></span></p>\n                                            </div>\n                                        </th>\n                                        <th style=\"width:54%;\">                \n \n<table style=\"text-align: left;\"\n border=\"0\" cellpadding=\"2\" cellspacing=\"5\">\n  <tbody>\n    <tr>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 16px;\"><br>\n      </td>\n      <td\n style=\"background-color: rgb(204, 204, 204); width: 511px;\">Live</td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 13px;\"\n colspan=\"1\" rowspan=\"1\"><br>\n      </td>\n      <td\n style=\"background-color: rgb(204, 204, 204); width: 241px;\"\n colspan=\"1\">Global\nparameters</td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\" colspan=\"1\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204);\"></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 16px;\"></td>\n      <td style=\"width: 511px;\"></td>\n      <td style=\"width: 13px;\"\n colspan=\"1\" rowspan=\"1\"><br>\n      </td>\n      <td style=\"width: 241px;\"\n colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td colspan=\"1\"></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 16px;\"\n rowspan=\"20\"> </td>\n      <td\n style=\"text-align: right; vertical-align: top; width: 511px;\"\n colspan=\"1\" rowspan=\"21\">\n      <div\n style=\"text-align: right; vertical-align: top;\" id=\"content\">\n      <div\n style=\"text-align: right; vertical-align: top;\"\n class=\"content-box\"><!-- jQuery UI -->\n      <script type=\"text/javascript\"\n src=\"wPaint/lib/jquery.ui.core.1.10.3.min.js\"></script>\n      <script type=\"text/javascript\"\n src=\"wPaint/lib/jquery.ui.widget.1.10.3.min.js\"></script>\n      <script type=\"text/javascript\"\n src=\"wPaint/lib/jquery.ui.mouse.1.10.3.min.js\"></script>\n      <script type=\"text/javascript\"\n src=\"wPaint/lib/jquery.ui.draggable.1.10.3.min.js\"></script><!-- wColorPicker -->\n      <link rel=\"Stylesheet\"\n type=\"text/css\" href=\"wPaint/lib/wColorPicker.min.css\">\n      <script type=\"text/javascript\"\n src=\"wPaint/lib/wColorPicker.min.js\"></script>\n<!-- wPaint -->\n      <link rel=\"Stylesheet\"\n type=\"text/css\" href=\"wPaint/wPaint.min.css\">\n      <script type=\"text/javascript\"\n src=\"wPaint/wPaint.min.js\"></script>\n      <script type=\"text/javascript\"\n src=\"wPaint/plugins/main/wPaint.menu.main.min.js\"></script>\n      <script type=\"text/javascript\"\n src=\"wPaint/plugins/text/wPaint.menu.text.min.js\"></script>\n      <script type=\"text/javascript\"\n src=\"wPaint/plugins/shapes/wPaint.menu.main.shapes.min.js\"></script>\n      <script type=\"text/javascript\"\n src=\"wPaint/plugins/file/wPaint.menu.main.file.min.js\"></script>\n      <div id=\"wPaint\"\n style=\" position: relative;\">\n          <iframe\n src=\"http://127.0.0.1:5000/\" frameborder=\"0\" height=\"512\"\n width=\"512\"></iframe>\n      <!--<center style=\"margin-bottom: 50px;\">\n      <input value=\"toggle menu\"\n onclick=\"console.log($('#wPaint').wPaint('menuOrientation')); $('#wPaint').wPaint('menuOrientation', $('#wPaint').wPaint('menuOrientation') === 'vertical' ? 'horizontal' : 'vertical');\"\n type=\"button\"></center>\n      <center id=\"wPaint-img\"></center>-->\n      <script type=\"text/javascript\">\nvar images = [\n'/test/uploads/wPaint.png',\n];\nfunction saveImg(image) {\nvar _this = this;\nmask = image ;\nupdateImaging();\nalertmessage('Image saved successfuly !');\n}\nfunction loadImgBg (image) {\n    $('#wPaint').wPaint('image', nodeParameters.data.mask);\n}\nfunction loadImgFg (image) {\n    $('#wPaint').wPaint('image', nodeParameters.data.mask);\n}\n// init wPaint\n$('#wPaint').wPaint({\nmenuOffsetLeft: -35,\nmenuOffsetTop: 600,\nmenuOrientation : 'horizontal',\nsaveImg: saveImg,\nloadImgBg: loadImgBg,\nloadImgFg: loadImgFg,\nmode: 'square',\nlineWidth : '1'\n\n    \n});\n      </script>\n      </div>\n      </div>\n      </td>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Objective</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"9\"\n rowspan=\"1\">\n      <select class=\"aftbl\"\n style=\"width: 150px;\">\n      <option name=\"LCPlanFl 20x\"\n value=\"75\">LCPlanFl 20x</option>\n      <option name=\"LCPlanFl 40x\"\n value=\"76\">LCPlanFl 40x</option>\n      <option name=\"LCPlanFl 60x\"\n value=\"79\">LCPlanFl 60x</option>\n      <option name=\"LUCPlanFl 40x\"\n value=\"78\">LUCPlanFl 40x</option>\n      <option name=\"LUCPlanFlN 20x\"\n value=\"75\">LUCPlanFlN 20x</option>\n      <option name=\"LUCPlanFlN 40x\"\n value=\"76\">LUCPlanFlN 40x</option>\n      <option name=\"LUCPlanFlN 60x\"\n value=\"79\">LUCPlanFlN 60x</option>\n      <option name=\"PlanApo 100x O3\"\n value=\"31\">PlanApo 100x O3</option>\n      <option name=\"PlanApo 60x O TIRFM-SP\"\n value=\"70\">PlanApo 60x O TIRFM-SP</option>\n      <option name=\"PlanApo 60x O/LSM\"\n value=\"62\">PlanApo 60x O/LSM</option>\n      <option name=\"PlanApo 60x O3\"\n value=\"30\">PlanApo 60x O3</option>\n      <option name=\"PlanApo 40x W/LSM\"\n value=\"60\">PlanApo 40x W/LSM</option>\n      <option name=\"PlanApoN 60x O\"\n value=\"30\">PlanApoN 60x O</option>\n      <option name=\"SLCPlanFl 40x\"\n value=\"77\">SLCPlanFl 40x</option>\n      <option name=\"UApo 30x 3/340\"\n value=\"45\">UApo 30x 3/340</option>\n      <option name=\"UApo 40x 3/340\"\n value=\"47\">UApo 40x 3/340</option>\n      <option name=\"UApo 40x W\"\n value=\"48\">UApo 40x W</option>\n      <option name=\"UPlanFl 60x OI3\"\n value=\"57\">UPlanFl 60x OI3</option>\n      <option name=\"UPlanApo 20x\"\n value=\"36\">UPlanApo 20x</option>\n      <option name=\"UPlanApo 100x OI3\"\n value=\"43\">UPlanApo 100x OI3</option>\n      <option name=\"UPlanApo 40x OI3\"\n value=\"39\">UPlanApo 40x OI3</option>\n      <option name=\"UPlanApo 60x\"\n value=\"40\">UPlanApo 60x</option>\n      <option name=\"UPlanApo 60x W\"\n value=\"41\">UPlanApo 60x W</option>\n      <option name=\"UPlanApo 60x W/IR\"\n value=\"42\">UPlanApo 60x W/IR</option>\n      <option name=\"UplanFl 100x O3\"\n value=\"58\">UplanFl 100x O3</option>\n      <option name=\"UPlanFl 20x\"\n value=\"55\">UPlanFl 20x</option>\n      <option name=\"UPlanFl 40x O-SP\"\n value=\"71\">UPlanFl 40x O-SP</option>\n      <option name=\"UPlanFl 40x\"\n value=\"56\">UPlanFl 40x</option>\n      <option name=\"UPlanFlN 100x O\"\n value=\"58\">UPlanFlN 100x O</option>\n      <option name=\"UPlanFlN 100x OI\"\n value=\"58\">UPlanFlN 100x OI</option>\n      <option name=\"UPlanFlN 20x\"\n value=\"55\">UPlanFlN 20x</option>\n      <option name=\"UPlanFlN 40x O\"\n value=\"39\">UPlanFlN 40x O</option>\n      <option name=\"UPlanFl 60x\"\n value=\"40\">UPlanFl 60x</option>\n      <option name=\"UPlanFlN 60x OI\"\n value=\"57\">UPlanFlN 60x OI</option>\n      <option name=\"UPlanSApo 100x O\"\n value=\"43\">UPlanSApo 100x O</option>\n      <option name=\"UPlanSApo 20x\"\n value=\"36\">UPlanSApo 20x</option>\n      <option name=\"UPlanSApo 40x\"\n value=\"47\">UPlanSApo 40x</option>\n      <option name=\"UPlanSApo 60x O\"\n value=\"30\">UPlanSApo 60x O</option>\n      <option name=\"UPlanSApo 60x W\"\n value=\"41\">UPlanSApo 60x W</option>\n      <option name=\"UPlanFlN 40x\"\n value=\"56\">UPlanFlN 40x</option>\n      </select>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Initialize\nauto-focus</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP2\"><img\n src=\"icons/shape_align_middle.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\">Refocus</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"1\"\n rowspan=\"1\"><button\n id=\"xPosUP2\"><img\n src=\"icons/shape_align_top.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\">&nbsp;</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\">Offset<br>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><br>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><br>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><br>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"\n colspan=\"10\" rowspan=\"1\"><br>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204); width: 241px;\"\n colspan=\"10\" rowspan=\"1\">Navigation</td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"><br>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"><img\n alt=\"\" src=\"icons/008-arrow-2B.png\"><img\n alt=\"\" src=\"icons/001-arrowB.png\"><img\n alt=\"\" src=\"icons/005-downB.png\"><img\n alt=\"\" src=\"icons/004-arrow-1B.png\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><input\n style=\"width: 50px;\" class=\"res1\" required=\"\"\n value=\"1\" min=\"0\" max=\"100000\" step=\"1\"\n type=\"number\">\n      </td>\n      <td\n style=\"width: 50px; background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP2\"><img\n src=\"icons/007-ascending.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"width: 50px; text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"zPosUP2\"><img\n src=\"icons/007-ascendingB.png\"></button></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"><img\n alt=\"\" src=\"icons/007-ascendingB.png\"><img\n alt=\"\" src=\"icons/002-backB.png\"><img\n alt=\"\" src=\"icons/006-down-1B.png\"><img\n alt=\"\" src=\"icons/003-rightB.png\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); text-align: center;\"><input\n style=\"width: 50px;\" class=\"res2\" required=\"\"\n value=\"10\" min=\"0\" max=\"100000\" step=\"1\"\n type=\"number\">\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP1\"><img\n src=\"icons/008-arrow-2.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"zPosUP1\"><img\n src=\"icons/008-arrow-2B.png\"></button></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">&nbsp;</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><br>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"yPosLF2\"><img\n src=\"icons/002-back.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"yPosLF1\"><img\n src=\"icons/001-arrow.png\"></button></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><strong>X-Y</strong></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"yPosRG1\"><img\n src=\"icons/004-arrow-1.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"yPosRG2\"><img\n src=\"icons/003-right.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><strong>Z</strong></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"><img\n src=\"icons/008-arrow-2.png\"><img\n src=\"icons/001-arrow.png\"><img\n src=\"icons/005-down.png\"><img\n src=\"icons/004-arrow-1.png\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><input\n style=\"width: 50px;\" class=\"res1\" required=\"\"\n value=\"5\" min=\"0\" max=\"100000\" step=\"1\"\n type=\"number\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"xPosDW1\"><img\n src=\"icons/005-down.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"zPosDW1\"><img\n src=\"icons/005-downB.png\"></button></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"><img\n src=\"icons/007-ascending.png\"><img\n src=\"icons/002-back.png\"><img\n src=\"icons/006-down-1.png\"><img\n src=\"icons/003-right.png\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); text-align: center;\"><input\n style=\"width: 50px;\" class=\"res1\" required=\"\"\n value=\"50\" min=\"0\" max=\"100000\" step=\"1\"\n type=\"number\">\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"xPosDW2\"><img\n src=\"icons/006-down-1.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"text-align: center; background-color: rgb(255, 255, 255);\"><button\n id=\"zPosDW2\"><img\n src=\"icons/006-down-1B.png\"></button></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"\n colspan=\"10\" rowspan=\"1\"><br>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204); width: 241px;\"\n colspan=\"10\" rowspan=\"1\">Camera\ncontrol</td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"><br>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\"\n colspan=\"2\" rowspan=\"1\">Time\nexposure (ms)<br>\nTemperature<br>\nGain<br>\nInvert color<br>\nActive color mapping<br>\nBrightness and contrast auto<br>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"8\"\n rowspan=\"1\"><input\n style=\"width: 50px;\" class=\"res1\" required=\"\"\n min=\"0\" max=\"100000\" step=\"1\" value=\"100\"\n type=\"number\"><br>\n      <input style=\"width: 50px;\"\n class=\"res1\" value=\"20\" required=\"\" min=\"0\"\n max=\"100000\" step=\"1\" type=\"number\">&nbsp;\n(only for\nZyla)<br>\n      <input style=\"width: 50px;\"\n class=\"res1\" value=\"1\" required=\"\" min=\"0\"\n max=\"100000\" step=\"1\" type=\"number\"><br>\n      <select id=\"posInvert\">\n      <option selected=\"selected\"\n value=\"OFF\">OFF</option>\n      <option value=\"ON\">ON</option>\n      </select>\n      <br>\n      <select id=\"posMap\">\n      <option value=\"OFF\">OFF</option>\n      <option selected=\"selected\"\n value=\"ON\">ON</option>\n      </select>\n      <br>\n      <select id=\"posMap\">\n      <option value=\"OFF\">OFF</option>\n      <option selected=\"selected\"\n value=\"ON\">ON</option>\n      </select>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"\n colspan=\"10\" rowspan=\"1\"><br>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(204, 204, 204); width: 241px;\"\n colspan=\"10\" rowspan=\"1\">Functions</td>\n      <td></td>\n    </tr>\n    <tr>\n      <td\n style=\"text-align: left; vertical-align: top; width: 13px;\"></td>\n      <td style=\"width: 241px;\"><br>\n      </td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Setting\nchannel</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\">\n      <select id=\"posInvert\">\n      <option selected=\"selected\"\n value=\"BF\">BF</option>\n      <option value=\"RFF&quot;\">RFF</option>\n      <option value=\"GFP&quot;\">GFP</option>\n      <option value=\"YFP&quot;\">YFP</option>\n      </select>\n      </td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"2\"\n rowspan=\"1\"><button>ON</button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\" colspan=\"2\"\n rowspan=\"1\"><button>OFF</button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Simple\npicture</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP2\"><img\n src=\"icons/camera.png\"></button></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 13px;\"></td>\n      <td\n style=\"background-color: rgb(255, 255, 255); width: 241px;\">Z-stack</td>\n      <td\n style=\"background-color: rgb(255, 255, 255);\"><button\n id=\"xPosUP2\"><img\n src=\"icons/zstack.png\"></button></td>\n      <td\n style=\"text-align: right; background-color: rgb(255, 255, 255);\"></td>\n      <td colspan=\"2\" rowspan=\"1\"\n style=\"background-color: rgb(255, 255, 255); text-align: left;\">Start:\n      <input style=\"width: 50px;\"\n class=\"res1\" required=\"\" min=\"0\" max=\"100000\"\n step=\"1\" type=\"number\"></td>\n      <td colspan=\"2\" rowspan=\"1\"\n style=\"background-color: rgb(255, 255, 255); text-align: left;\">Stop:\n      <input style=\"width: 50px;\"\n class=\"res1\" required=\"\" min=\"0\" max=\"100000\"\n step=\"1\" type=\"number\"></td>\n      <td colspan=\"3\" rowspan=\"1\"\n style=\"background-color: rgb(255, 255, 255); text-align: left;\">Step:\n      <input style=\"width: 50px;\"\n class=\"res1\" required=\"\" min=\"0\" max=\"100000\"\n step=\"1\" type=\"number\"></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td style=\"width: 16px;\"></td>\n      <td style=\"width: 13px;\"></td>\n      <td style=\"width: 241px;\"></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n  </tbody>\n</table>\n\n\n\n\n\n                                        </th>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <script type=\"text/javascript\">\n        var images = [\n          '/test/uploads/wPaint.png',\n        ];\n\n        function saveImg(image) {\n          var _this = this;\n\n          $.ajax({\n            type: 'POST',\n            url: '/test/upload.php',\n            data: {image: image},\n            success: function (resp) {\n\n              // internal function for displaying status messages in the canvas\n              _this._displayStatus('Image saved successfully');\n\n              // doesn't have to be json, can be anything\n              // returned from server after upload as long\n              // as it contains the path to the image url\n              // or a base64 encoded png, either will work\n              resp = $.parseJSON(resp);\n\n              // update images array / object or whatever\n              // is being used to keep track of the images\n              // can store path or base64 here (but path is better since it's much smaller)\n              images.push(resp.img);\n\n              // do something with the image\n              $('#wPaint-img').attr('src', image);\n            }\n          });\n        }\n\n        function loadImgBg () {\n\n          // internal function for displaying background images modal\n          // where images is an array of images (base64 or url path)\n          // NOTE: that if you can't see the bg image changing it's probably\n          // becasue the foregroud image is not transparent.\n          this._showFileModal('bg', images);\n        }\n\n        function loadImgFg () {\n\n          // internal function for displaying foreground images modal\n          // where images is an array of images (base64 or url path)\n          this._showFileModal('fg', images);\n        }\n\n        // init wPaint\n        $('#wPaint').wPaint({\n          menuOffsetLeft: -35,\n          menuOffsetTop: -50,\n          saveImg: saveImg,\n          loadImgBg: loadImgBg,\n          loadImgFg: loadImgFg\n        });\n      </script>\n        \n        \n        \n        \n        \n        <script>window.jQuery || document.write('<script src=\"bootstrap/assets/js/vendor/jquery.min.js\"><\\/script>')</script>\n        <script src=\"bootstrap/dist/js/bootstrap.min.js\"></script>\n        <script src=\"bootstrap/assets/js/vendor/holder.min.js\"></script>\n        <script src=\"bootstrap/assets/js/ie10-viewport-bug-workaround.js\"></script>\n        <script type=\"text/javascript\">\n            $.confirm({\n                title: 'CYBERSCOPE !',\n                theme: \"supervan\",\n                content: '' +\n                '<form action=\"\" class=\"formName\">' +\n                '<div class=\"form-group\">' +\n                '<select class=\"userLog form-control\" id=\"userLog\"><option name=WilliamsB value=0>WilliamsB</option><option name=KalinaH value=1>KalinaH</option><option name=MatthiasL value=2>MatthiasL</option><option name=CélineC value=4>CélineC</option></select>'+\n                '</div>' +\n                '</form>',\n                buttons: {\n                    formSubmit: {\n                        text: 'Log in',\n                        btnClass: 'btn-blue',\n                        action: function () {\n                            var value = $('.userLog').find('option:selected').attr(\"name\");\n                            document.getElementById('name_user').innerHTML = \"User: \"+value;\n                        }\n                    }\n                },\n                onContentReady: function () {\n                    // bind to events\n                    var jc = this;\n                    this.$content.find('form').on('submit', function (e) {\n                        // if the user submits the form by pressing enter in the field.\n                        e.preventDefault();\n                        jc.$$formSubmit.trigger('click'); // reference the button and click it\n                    });\n                }\n            });\n        </script>\n    </body>\n</html>","x":490,"y":100,"wires":[[]]},{"id":"659a5e24.685e","type":"function","z":"cb80149c.966208","name":"create config channel","func":"var order = [] ;\ntry {\n  order = msg.payload.split(\",\");\n}\ncatch(error) {\n  order[0] = msg.payload;\n}\nvar output = {} ;\nif(order[0] === 'mask'){\n    msg.payload =  \"\";\n    node.send(msg);\n}","outputs":1,"noerr":0,"x":2020,"y":1040,"wires":[["8b54171.86780e8"]]},{"id":"8b54171.86780e8","type":"exec","z":"cb80149c.966208","command":"C:/Users/Williams/Desktop/numerotationMosaic.py","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":2260,"y":1140,"wires":[["1887854a.5562cb"],["1887854a.5562cb"],["1887854a.5562cb"]]},{"id":"1887854a.5562cb","type":"debug","z":"cb80149c.966208","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2370,"y":1320,"wires":[]},{"id":"2bb1d879.de45d8","type":"inject","z":"cb80149c.966208","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1920,"y":1200,"wires":[["8b54171.86780e8"]]},{"id":"616b6125.29958","type":"pythonshell in","z":"cb80149c.966208","pyfile":"C:/Users/Williams/Desktop/numerotationMosaiac.py","x":2160,"y":1320,"wires":[["1887854a.5562cb"]],"icon":"node-red/camera.png"}]